import{U as le,a as ce,g as de,r as n,j as e,c as v,C as he,A as oe,B as F,F as E,R as pe,b as I,L as k,d as P,M as H,e as K,f as Z,S as fe,P as Q,h as Y,u as ee,i as je,k as Ne,l as ge,I as ve,m as Ce,n as W,o as h,p as se,q as Se,s as we,t as be,v as _e,w as q,x as X,y as te,z as ae,D as Ee}from"./index-nFkit7W6.js";import{u as Te}from"./use-post-add-user-DfAcN5Ab.js";import ne from"./eye-C3GXP-lN.js";import ie from"./eye-off-C_63c-HP.js";const Ue=i=>{const{mutate:r}=le();return r(["useDeleteUsers"],async({user_id:p})=>(await ce.delete(`${de("USERS")}/${p}`)).data,i)},ye=i=>{const{mutate:r}=le();async function l({skip:p,limit:C}){const c=await ce.get(`${de("USERS")}/?skip=${p}&limit=${C}`);return c.status===200?c.data:[]}return r(["useGetUsers"],l,i)},me=n.forwardRef(({className:i,...r},l)=>e.jsx("div",{className:"",children:e.jsx("table",{ref:l,className:v("w-full caption-bottom text-sm",i),...r})}));me.displayName="Table";const ue=n.forwardRef(({className:i,...r},l)=>e.jsx("thead",{ref:l,className:v("[&_tr]:border-b",i),...r}));ue.displayName="TableHeader";const xe=n.forwardRef(({className:i,...r},l)=>e.jsx("tbody",{ref:l,className:v("[&_tr:last-child]:border-0",i),...r}));xe.displayName="TableBody";const Re=n.forwardRef(({className:i,...r},l)=>e.jsx("tfoot",{ref:l,className:v("bg-primary font-medium text-primary-foreground",i),...r}));Re.displayName="TableFooter";const J=n.forwardRef(({className:i,...r},l)=>e.jsx("tr",{ref:l,className:v("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",i),...r}));J.displayName="TableRow";const N=n.forwardRef(({className:i,...r},l)=>e.jsx("th",{ref:l,className:v("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",i),...r}));N.displayName="TableHead";const g=n.forwardRef(({className:i,...r},l)=>e.jsx("td",{ref:l,className:v("p-4 align-middle [&:has([role=checkbox])]:pr-0",i),...r}));g.displayName="TableCell";const Ae=n.forwardRef(({className:i,...r},l)=>e.jsx("caption",{ref:l,className:v("mt-4 text-sm text-muted-foreground",i),...r}));Ae.displayName="TableCaption";function re({title:i,titleHeader:r,cancelText:l,confirmationText:b,children:p,icon:C,data:c,index:S,onConfirm:$,asChild:z}){const[f,L]=n.useState(!1),[u,O]=n.useState(!1),[o,T]=n.useState(!1),[m,U]=n.useState(c?.password??""),[w,_]=n.useState(c?.username??""),[j,M]=n.useState(c?.password??""),[x,y]=n.useState(c?.is_active??!1),[R,A]=n.useState(c?.is_superuser??!1),[G,B]=n.useState(he),{userData:V}=n.useContext(oe);function s({target:{name:t,value:d}}){B(D=>({...D,[t]:d}))}n.useEffect(()=>{o&&(c?(_(c.username),y(c.is_active),A(c.is_superuser),s({target:{name:"username",value:w}}),s({target:{name:"is_active",value:x}}),s({target:{name:"is_superuser",value:R}})):a())},[o]);function a(){U(""),_(""),M(""),y(!1),A(!1)}return e.jsxs(F,{size:"medium-h-full",open:o,setOpen:T,children:[e.jsx(F.Trigger,{asChild:z,children:p}),e.jsxs(F.Header,{description:r,children:[e.jsx("span",{className:"pr-2",children:i}),e.jsx(E,{name:C,className:"h-6 w-6 pl-1 text-foreground","aria-hidden":"true"})]}),e.jsx(F.Content,{children:e.jsxs(pe,{onSubmit:t=>{if(m!==j){t.preventDefault();return}a(),$(1,G),T(!1),t.preventDefault()},children:[e.jsxs("div",{className:"grid gap-5",children:[e.jsxs(I,{name:"username",children:[e.jsx("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"space-between"},children:e.jsxs(k,{className:"data-[invalid]:label-invalid",children:["Username"," ",e.jsx("span",{className:"font-medium text-destructive",children:"*"})]})}),e.jsx(P,{asChild:!0,children:e.jsx("input",{onChange:({target:{value:t}})=>{s({target:{name:"username",value:t}}),_(t)},value:w,className:"primary-input",required:!0,placeholder:"Username"})}),e.jsx(H,{match:"valueMissing",className:"field-invalid",children:"Please enter your username"})]}),e.jsxs("div",{className:"flex flex-row",children:[e.jsx("div",{className:"mr-3 basis-1/2",children:e.jsxs(I,{name:"password",serverInvalid:m!=j,children:[e.jsx("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"space-between"},children:e.jsxs(k,{className:"data-[invalid]:label-invalid flex",children:["Password"," ",e.jsx("span",{className:"ml-1 mr-1 font-medium text-destructive",children:"*"}),f&&e.jsx(ne,{onClick:()=>L(!f),className:"h-5 cursor-pointer",strokeWidth:1.5}),!f&&e.jsx(ie,{onClick:()=>L(!f),className:"h-5 cursor-pointer",strokeWidth:1.5})]})}),e.jsx(P,{asChild:!0,children:e.jsx("input",{onChange:({target:{value:t}})=>{s({target:{name:"password",value:t}}),U(t)},value:m,className:"primary-input",required:!c,type:f?"text":"password"})}),e.jsx(H,{className:"field-invalid",match:"valueMissing",children:"Please enter a password"}),m!=j&&e.jsx(H,{className:"field-invalid",children:"Passwords do not match"})]})}),e.jsx("div",{className:"basis-1/2",children:e.jsxs(I,{name:"confirmpassword",serverInvalid:m!=j,children:[e.jsx("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"space-between"},children:e.jsxs(k,{className:"data-[invalid]:label-invalid flex",children:["Confirm password"," ",e.jsx("span",{className:"ml-1 mr-1 font-medium text-destructive",children:"*"}),u&&e.jsx(ne,{onClick:()=>O(!u),className:"h-5 cursor-pointer",strokeWidth:1.5}),!u&&e.jsx(ie,{onClick:()=>O(!u),className:"h-5 cursor-pointer",strokeWidth:1.5})]})}),e.jsx(P,{asChild:!0,children:e.jsx("input",{onChange:t=>{M(t.target.value)},value:j,className:"primary-input",required:!c,type:u?"text":"password"})}),e.jsx(H,{className:"field-invalid",match:"valueMissing",children:"Please confirm your password"})]})})]}),e.jsxs("div",{className:"flex gap-8",children:[e.jsx(I,{name:"is_active",children:e.jsxs("div",{children:[e.jsx(k,{className:"data-[invalid]:label-invalid mr-3",children:"Active"}),e.jsx(P,{asChild:!0,children:e.jsx(K,{value:x,checked:x,id:"is_active",className:"relative top-0.5",onCheckedChange:t=>{s({target:{name:"is_active",value:t}}),y(t)}})})]})}),V?.is_superuser&&e.jsx(I,{name:"is_superuser",children:e.jsxs("div",{children:[e.jsx(k,{className:"data-[invalid]:label-invalid mr-3",children:"Superuser"}),e.jsx(P,{asChild:!0,children:e.jsx(K,{checked:R,value:R,id:"is_superuser",className:"relative top-0.5",onCheckedChange:t=>{s({target:{name:"is_superuser",value:t}}),A(t)}})})]})})]})]}),e.jsxs("div",{className:"float-right",children:[e.jsx(Z,{variant:"outline",onClick:()=>{T(!1)},className:"mr-3",children:l}),e.jsx(fe,{asChild:!0,children:e.jsx(Z,{className:"mt-8",children:b})})]})]})})]})}function Le(){const[i,r]=n.useState(""),[l,b]=n.useState(Q),[p,C]=n.useState(Y),c=ee(s=>s.setSuccessData),S=ee(s=>s.setErrorData),{userData:$}=n.useContext(oe),[z,f]=n.useState(0),{mutate:L}=Ue(),{mutate:u}=je(),{mutate:O}=Te(),o=n.useRef([]);n.useEffect(()=>{setTimeout(()=>{j()},500)},[]);const[T,m]=n.useState(o.current),{mutate:U,isPending:w,isIdle:_}=ye({});function j(){U({skip:l*(p-1),limit:l},{onSuccess:s=>{f(s.total_count),o.current=s.users,m(s.users)},onError:()=>{}})}function M(s,a){b(a),C(s),U({skip:a*(s-1),limit:a},{onSuccess:t=>{f(t.total_count),o.current=t.users,m(t.users)}})}function x(){C(Y),b(Q),j()}function y(s){if(r(s),s==="")m(o.current);else{const a=o.current.filter(t=>t.username.toLowerCase().includes(s.toLowerCase()));m(a)}}function R(s){L({user_id:s.id},{onSuccess:()=>{x(),c({title:_e})},onError:a=>{S({title:be,list:[a.response.data.detail]})}})}function A(s,a){u({user_id:s,user:a},{onSuccess:()=>{x(),c({title:X})},onError:t=>{S({title:q,list:[t.response.data.detail]})}})}function G(s,a,t){const d=te.cloneDeep(t);d.is_active=!s,u({user_id:a,user:d},{onSuccess:()=>{x(),c({title:X})},onError:D=>{S({title:q,list:[D.response.data.detail]})}})}function B(s,a,t){const d=te.cloneDeep(t);d.is_superuser=!s,u({user_id:a,user:d},{onSuccess:()=>{x(),c({title:X})},onError:D=>{S({title:q,list:[D.response.data.detail]})}})}function V(s){O(s,{onSuccess:a=>{u({user_id:a.id,user:{is_active:s.is_active,is_superuser:s.is_superuser}},{onSuccess:()=>{x(),c({title:Ee})},onError:t=>{S({title:ae,list:[t.response.data.detail]})}})},onError:a=>{S({title:ae,list:[a.response.data.detail]})}})}return e.jsx(e.Fragment,{children:$&&e.jsxs("div",{className:"admin-page-panel flex h-full flex-col pb-8",children:[e.jsx("div",{className:"main-page-nav-arrangement",children:e.jsxs("span",{className:"main-page-nav-title",children:[e.jsx(E,{name:"Shield",className:"w-6"}),Ne]})}),e.jsx("span",{className:"admin-page-description-text",children:ge}),e.jsxs("div",{className:"flex w-full justify-between px-4",children:[e.jsxs("div",{className:"flex w-96 items-center gap-4",children:[e.jsx(ve,{placeholder:"Search Username",value:i,onChange:s=>y(s.target.value)}),i.length>0?e.jsx("div",{className:"cursor-pointer",onClick:()=>{r(""),m(o.current)},children:e.jsx(E,{name:"X",className:"w-6 text-foreground"})}):e.jsx("div",{children:e.jsx(E,{name:"Search",className:"w-6 text-foreground"})})]}),e.jsx("div",{children:e.jsx(re,{title:"New User",titleHeader:"Add a new user",cancelText:"Cancel",confirmationText:"Save",icon:"UserPlus2",onConfirm:(s,a)=>{V(a)},asChild:!0,children:e.jsx(Z,{variant:"primary",children:"New User"})})})]}),w||_?e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:e.jsx(Ce,{remSize:12})}):o.current.length===0&&!_?e.jsx(e.Fragment,{children:e.jsx("div",{className:"m-4 flex items-center justify-between text-sm",children:"No users registered."})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"m-4 h-fit overflow-x-hidden overflow-y-scroll rounded-md border-2 bg-background custom-scroll"+(w?" border-0":""),children:e.jsxs(me,{className:"table-fixed outline-1",children:[e.jsx(ue,{className:w?"hidden":"table-fixed bg-muted outline-1",children:e.jsxs(J,{children:[e.jsx(N,{className:"h-10",children:"Id"}),e.jsx(N,{className:"h-10",children:"Username"}),e.jsx(N,{className:"h-10",children:"Active"}),e.jsx(N,{className:"h-10",children:"Superuser"}),e.jsx(N,{className:"h-10",children:"Created At"}),e.jsx(N,{className:"h-10",children:"Updated At"}),e.jsx(N,{className:"h-10 w-[100px] text-right"})]})}),!w&&e.jsx(xe,{children:T.map((s,a)=>e.jsxs(J,{children:[e.jsx(g,{className:"truncate py-2 font-medium",children:e.jsx(W,{content:s.id,children:e.jsx("span",{className:"cursor-default",children:s.id})})}),e.jsx(g,{className:"truncate py-2",children:e.jsx(W,{content:s.username,children:e.jsx("span",{className:"cursor-default",children:s.username})})}),e.jsx(g,{className:"relative left-1 truncate py-2 text-align-last-left",children:e.jsxs(h,{size:"x-small",title:"Edit",titleHeader:`${s.username}`,modalContentTitle:"Attention!",cancelText:"Cancel",confirmationText:"Confirm",icon:"UserCog2",data:s,index:a,onConfirm:(t,d)=>{G(d.is_active,d.id,d)},children:[e.jsx(h.Content,{children:e.jsx("span",{children:"Are you completely confident about the changes you are making to this user?"})}),e.jsx(h.Trigger,{children:e.jsx("div",{className:"flex w-fit",children:e.jsx(se,{checked:s.is_active})})})]})}),e.jsx(g,{className:"relative left-1 truncate py-2 text-align-last-left",children:e.jsxs(h,{size:"x-small",title:"Edit",titleHeader:`${s.username}`,modalContentTitle:"Attention!",cancelText:"Cancel",confirmationText:"Confirm",icon:"UserCog2",data:s,index:a,onConfirm:(t,d)=>{B(d.is_superuser,d.id,d)},children:[e.jsx(h.Content,{children:e.jsx("span",{children:"Are you completely confident about the changes you are making to this user?"})}),e.jsx(h.Trigger,{children:e.jsx("div",{className:"flex w-fit",children:e.jsx(se,{checked:s.is_superuser})})})]})}),e.jsx(g,{className:"truncate py-2",children:new Date(s.create_at).toISOString().split("T")[0]}),e.jsx(g,{className:"truncate py-2",children:new Date(s.updated_at).toISOString().split("T")[0]}),e.jsx(g,{className:"flex w-[100px] py-2 text-right",children:e.jsxs("div",{className:"flex",children:[e.jsx(re,{title:"Edit",titleHeader:`${s.id}`,cancelText:"Cancel",confirmationText:"Save",icon:"UserPlus2",data:s,index:a,onConfirm:(t,d)=>{A(s.id,d)},children:e.jsx(W,{content:"Edit",side:"top",children:e.jsx(E,{name:"Pencil",className:"h-4 w-4 cursor-pointer"})})}),e.jsxs(h,{size:"x-small",title:"Delete",titleHeader:"Delete User",modalContentTitle:"Attention!",cancelText:"Cancel",confirmationText:"Delete",icon:"UserMinus2",data:s,index:a,onConfirm:(t,d)=>{R(d)},children:[e.jsx(h.Content,{children:e.jsx("span",{children:"Are you sure you want to delete this user? This action cannot be undone."})}),e.jsx(h.Trigger,{children:e.jsx(E,{name:"Trash2",className:"ml-2 h-4 w-4 cursor-pointer"})})]})]})})]},a))})]})}),e.jsx(Se,{pageIndex:p,pageSize:l,totalRowsCount:z,paginate:M,rowsCount:we})]})]})})}export{Le as default};

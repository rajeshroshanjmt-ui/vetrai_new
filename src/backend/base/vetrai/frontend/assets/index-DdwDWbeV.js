var fn=u=>{throw TypeError(u)};var rs=(u,t,e)=>t.has(u)||fn("Cannot "+e);var ut=(u,t,e)=>(rs(u,t,"read from private field"),e?e.call(u):t.get(u)),Vt=(u,t,e)=>t.has(u)?fn("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(u):t.set(u,e),ni=(u,t,e,i)=>(rs(u,t,"write to private field"),i?i.call(u,e):t.set(u,e),e),xi=(u,t,e)=>(rs(u,t,"access private method"),e);var pn=(u,t,e,i)=>({set _(s){ni(u,t,s,e)},get _(){return ut(u,t,i)}});import{N as Ro,U as Fs,g as Os,O as Lo,r as L,j as g,Q as bt,T as js,c as Pe,V as Do,W as os,F as ie,X as Se,Y as br,f as De,Z as gn,_ as zi,$ as ct,a0 as ui,n as Xe,a1 as rt,a2 as Xt,a3 as xr,a4 as ko,a5 as Sr,a6 as Io,a as Er,a7 as Mo,a8 as Nt,a9 as Oi,aa as No,ab as Fo,ac as Ui,ad as Vi,ae as qi,af as Gi,ag as Wi,ah as Oo,ai as gi,aj as jo,ak as Ho,al as bs,am as Tr,an as Bo,ao as zo,ap as Uo,aq as Vo,ar as Yt,as as mn,at as vn,au as yn,av as xs,aw as as,ax as qo,u as Et,ay as Go,az as _r,aA as wn,aB as xt,aC as Ar,aD as Hs,aE as Bs,aF as Cr,aG as Pr,aH as Rr,aI as Wo,aJ as Xo,J as Lr,aK as Dr,aL as zs,aM as Yo,aN as Ko,aO as Zo,aP as Jo,aQ as Qo,aR as kr,aS as $o,aT as bn,aU as ea,aV as ta,aW as ia,aX as sa,aY as Us,aZ as xn,a_ as Vs,a$ as na,b0 as Si,b1 as ra,b2 as oa,b3 as ls,b4 as Sn,b5 as aa,b6 as la,b7 as ca,b8 as Ei,b9 as Xi,ba as ha,bb as ua,bc as da,bd as fa,be as pa,bf as ga,bg as ji,bh as Tt,bi as ma,bj as En,bk as Tn,y as _t,bl as _n,bm as An,bn as va,bo as ya,bp as ri,bq as wa,br as ba,I as xa,bs as Sa,bt as Ea,bu as Ta,bv as cs,bw as _a,bx as Aa,by as Ca,bz as Pa,bA as Ra,bB as Cn,B as hs,bC as La,bD as Da,bE as ka,bF as Ia,bG as Ma,bH as Na,bI as Fa,bJ as Oa,bK as ja,bL as Ha}from"./index-nFkit7W6.js";var Ti,Ba=new Uint8Array(16);function za(){if(!Ti&&(Ti=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ti))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ti(Ba)}var Ua=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const Pn={randomUUID:Ua};function Va(u,t,e){if(Pn.randomUUID&&!u)return Pn.randomUUID();u=u||{};var i=u.random||(u.rng||za)();return i[6]=i[6]&15|64,i[8]=i[8]&63|128,Ro(i)}var qa="Invariant failed";function Le(u,t){if(!u)throw new Error(qa)}const Ga=(u,t)=>{const{mutate:e}=Fs(),i=async()=>{if(!u)return;const a=await(await fetch(`${Os("FILES")}/download/${u.path}`,{headers:{Accept:"*/*"},credentials:Lo()})).blob(),r=URL.createObjectURL(a),o=document.createElement("a");return o.href=r,o.setAttribute("download",u.filename),document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(r),{}};return e(["useGetDownloadFileMutation",u.path],i,t)},Rn=u=>L.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",...u},L.createElement("defs",null,L.createElement("linearGradient",{id:"vetraiGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%"},L.createElement("stop",{offset:"0%",style:{stopColor:"#6366f1"}}),L.createElement("stop",{offset:"100%",style:{stopColor:"#8b5cf6"}}))),L.createElement("path",{d:"M12 2L3 7v10l9 5 9-5V7l-9-5zm0 2.18l6.9 3.83L12 11.83 5.1 8.01 12 4.18zM5 9.5l6 3.33v6.67l-6-3.33V9.5zm8 10v-6.67l6-3.33v6.67l-6 3.33z",fill:"url(#vetraiGrad)"}),L.createElement("circle",{cx:12,cy:12,r:2,fill:"#10b981"}),L.createElement("path",{d:"M12 8v2M12 14v2M8 12h2M14 12h2",stroke:"#10b981",strokeWidth:1,fill:"none"})),Wa={char:.03,word:.05,line:.1},Gt={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.015}},exit:{transition:{staggerChildren:.05,staggerDirection:-1}}},Xa={hidden:{opacity:0},visible:{opacity:1},exit:{opacity:0}},Ya={blur:{container:Gt,item:{hidden:{opacity:0,filter:"blur(12px)"},visible:{opacity:1,filter:"blur(0px)"},exit:{opacity:0,filter:"blur(12px)"}}},shake:{container:Gt,item:{hidden:{x:0},visible:{x:[-5,5,-5,5,0],transition:{duration:.5}},exit:{x:0}}},scale:{container:Gt,item:{hidden:{opacity:0,scale:0},visible:{opacity:1,scale:1},exit:{opacity:0,scale:0}}},fade:{container:Gt,item:{hidden:{opacity:0},visible:{opacity:1},exit:{opacity:0}}},slide:{container:Gt,item:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0},exit:{opacity:0,y:20}}}},Ir=Do.memo(({segment:u,variants:t,per:e,segmentWrapperClassName:i})=>{const s=e==="line"?g.jsx(bt.span,{variants:t,className:"block",children:u}):e==="word"?g.jsx(bt.span,{variants:t,className:"inline-block whitespace-pre",children:u}):g.jsx(bt.span,{className:"inline-block whitespace-pre",children:u.split("").map((a,r)=>g.jsx(bt.span,{variants:t,className:"inline-block whitespace-pre",children:a},`char-${r}`))});if(!i)return s;const n=e==="line"?"block":"inline-block";return g.jsx("span",{className:Pe(n,i),children:s})});Ir.displayName="AnimationComponent";function Ka({children:u,per:t="word",as:e="span",variants:i,className:s,preset:n,delay:a=0,trigger:r=!0,onAnimationComplete:o,segmentWrapperClassName:l}){let c;t==="line"?c=u.split(`
`):t==="word"?c=u.split(/(\s+)/):c=u.split("");const h=bt[e],d=n?Ya[n]:{container:Gt,item:Xa},f=i?.container||d.container,p=i?.item||d.item,m=t==="line"?void 0:u,v=Wa[t],w={hidden:f.hidden,visible:{...f.visible,transition:{...f.visible?.transition,staggerChildren:f.visible?.transition?.staggerChildren||v,delayChildren:a}},exit:f.exit};return g.jsx(js,{mode:"popLayout",children:r&&g.jsx(h,{initial:"hidden",animate:"visible",exit:"exit","aria-label":m,variants:w,className:Pe("whitespace-pre-wrap",s),onAnimationComplete:o,children:c.map((S,_)=>g.jsx(Ir,{segment:S,variants:p,per:t,segmentWrapperClassName:l},`${t}-${_}-${S}`))})})}function Za({children:u}){return g.jsx(Ka,{per:"char",preset:"fade",as:"span",children:u})}function qs(u,t=25){if(!u||u[t]===void 0)return u;const e=u.split(".").pop(),i=u.slice(0,u.lastIndexOf("."));return i.length>6?`${i.slice(0,t)}...${e}`:u}const Ja=["png","jpg","jpeg","gif","bmp","webp","image"];function Qa({error:u,file:t,loading:e,onDelete:i}){const s=t.type.toLowerCase(),n=Ja.some(a=>s.includes(a));return g.jsx("div",{className:"group relative pb-2",children:e?n?g.jsx("div",{className:"flex h-20 w-20 items-center justify-center rounded-md border border-ring bg-background",children:g.jsxs("svg",{"aria-hidden":"true",className:"h-10 w-10 animate-spin fill-black text-muted",viewBox:"0 0 100 101",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[g.jsx("path",{d:"M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z",fill:"currentColor"}),g.jsx("path",{d:"M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z",fill:"currentFill"})]})}):g.jsx("div",{className:`relative ${n?"h-20 w-20":"h-20 w-80"} cursor-wait rounded-lg border border-ring bg-background transition duration-300`,children:g.jsxs("div",{className:"ml-3 flex h-full w-full items-center gap-2 text-sm",children:[g.jsx(os,{className:"h-10 w-10 rounded-lg"}),g.jsxs("div",{className:"flex flex-col gap-1",children:[g.jsx(os,{className:"h-3 w-48"}),g.jsx(os,{className:"h-3 w-10"})]})]})}):u?g.jsx("div",{children:"Error..."}):g.jsxs("div",{className:"relative mt-2 h-20 w-32 cursor-pointer rounded-lg border border-border bg-background transition duration-300 group-hover:shadow-md",children:[n?g.jsx("img",{src:URL.createObjectURL(t),alt:"file",className:"block h-full w-full rounded-md border border-border"}):g.jsxs("div",{className:"ml-3 flex h-full w-full items-center gap-2 text-sm",children:[g.jsx(ie,{name:"File",className:"h-8 w-8"}),g.jsxs("div",{className:"flex flex-col",children:[g.jsx("span",{className:"font-bold",children:qs(t.name)}),g.jsx("span",{children:"File"})]})]}),g.jsx("div",{className:"absolute -right-2 -top-2 flex h-5 w-5 items-center justify-center opacity-100 transition-opacity",children:g.jsx("div",{className:"group flex h-7 w-7 cursor-pointer items-center justify-center rounded-full bg-muted p-2 transition-all hover:bg-input",onClick:i,children:g.jsx(ie,{name:"X",className:"h-4 w-4 stroke-muted-foreground stroke-2 group-hover:stroke-primary"})})})]})})}const _i={NO_INPUT:"bg-high-indigo text-background",SHOW_STOP:"bg-muted hover:bg-secondary-hover dark:hover:bg-input text-foreground cursor-pointer",DEFAULT:"bg-primary text-primary-foreground hover:bg-primary-hover hover:text-secondary"},$a=({send:u,noInput:t,chatValue:e,files:i})=>{const s=Se(h=>h.stopBuilding),n=Se(h=>h.isBuilding),a=n||i.some(h=>h.loading),r=!(n||i.some(h=>h.loading))&&!t,l=br("form-modal-send-button",a?_i.SHOW_STOP:t?_i.NO_INPUT:_i.DEFAULT),c=h=>{h.stopPropagation(),a&&n?s():a||u()};return g.jsxs(De,{className:l,onClick:c,unstyled:!0,"data-testid":a?"button-stop":"button-send",children:[g.jsx(gn,{condition:a,children:g.jsxs("div",{className:"flex items-center gap-2 rounded-md text-sm font-medium",children:["Stop",g.jsx(zi,{className:"h-4 w-4"})]})}),g.jsx(gn,{condition:r,children:g.jsx("div",{className:"flex h-fit w-fit items-center gap-2 text-sm font-medium",children:"Send"})})]})},el=({checkSendingOk:u,send:t,isBuilding:e,noInput:i,chatValue:s,CHAT_INPUT_PLACEHOLDER:n,CHAT_INPUT_PLACEHOLDER_SEND:a,inputRef:r,files:o,isDragging:l})=>{const c=(p,m)=>p?"Drop here":m?n:"Send a message...",h=o.length>0?"!rounded-t-none border-t-0":"",d=ct(p=>p.setChatValueStore),f="form-input block w-full border-0 custom-scroll focus:border-ring rounded-none shadow-none focus:ring-0 p-0 sm:text-sm !bg-transparent";return L.useEffect(()=>{!e&&!i&&r.current?.focus()},[e,i]),g.jsx(ui,{"data-testid":"input-chat-playground",onKeyDown:p=>{u(p)&&(p.preventDefault(),t())},rows:1,ref:r,disabled:e||i,style:{resize:"none",bottom:`${r?.current?.scrollHeight}px`,maxHeight:"150px",overflow:`${r.current&&r.current.scrollHeight>150?"auto":"hidden"}`},value:s,onChange:p=>{d(p.target.value)},className:br(h,f),placeholder:c(l,i)})},tl=({fileInputRef:u,handleFileChange:t,handleButtonClick:e,isBuilding:i})=>{const s=n=>{n.stopPropagation(),e()};return g.jsx(Xe,{styleClasses:"z-50",side:"right",content:"Attach image (png, jpg, jpeg)",children:g.jsxs("div",{children:[g.jsx("input",{disabled:i,type:"file",ref:u,style:{display:"none"},onChange:t}),g.jsx(De,{disabled:i,className:`btn-playground-actions ${i?"cursor-not-allowed":"text-muted-foreground hover:text-primary"}`,onClick:s,unstyled:!0,children:g.jsx(ie,{className:"h-[18px] w-[18px]",name:"Image"})})]})})},il=({toggleRecording:u})=>{const t=rt(e=>e.setNewSessionCloseVoiceAssistant);return g.jsx(g.Fragment,{children:g.jsx("div",{children:g.jsx(De,{onClick:e=>{e.stopPropagation(),u(),t(!1)},className:"btn-playground-actions group",unstyled:!0,"data-testid":"voice-button",children:g.jsx(ie,{className:"icon-size text-muted-foreground group-hover:text-primary",name:"Mic",strokeWidth:Xt})})})})},sl=({isBuilding:u,checkSendingOk:t,send:e,noInput:i,chatValue:s,inputRef:n,files:a,isDragging:r,handleDeleteFile:o,fileInputRef:l,handleFileChange:c,handleButtonClick:h,setShowAudioInput:d,currentFlowId:f,playgroundPage:p})=>{const m="flex w-full items-center gap-2 py-2 overflow-auto",{data:v}=xr(),w=_=>{_.target.closest("textarea")||(n.current?.focus(),n.current?.setSelectionRange(n.current.value.length,n.current.value.length))},S=_=>{_.target.closest("textarea")||(_.stopPropagation(),_.preventDefault())};return g.jsx("div",{className:"flex w-full flex-col-reverse",children:g.jsxs("div",{"data-testid":"input-wrapper",className:"flex w-full flex-col rounded-md border cursor-text border-input p-4 hover:border-muted-foreground focus:border-[1.75px] has-[:focus]:border-primary",onClick:w,onMouseDown:S,children:[g.jsx(el,{isBuilding:u,checkSendingOk:t,send:e,noInput:i,chatValue:s,CHAT_INPUT_PLACEHOLDER:ko,inputRef:n,files:a,isDragging:r}),g.jsx("div",{className:m,children:a.map(_=>g.jsx(Qa,{error:_.error,file:_.file,loading:_.loading,onDelete:()=>{o(_)}},_.id))}),g.jsxs("div",{className:"flex w-full items-end justify-between",children:[g.jsx("div",{className:u?"cursor-not-allowed":"",children:(!p||p&&Sr)&&g.jsx(tl,{isBuilding:u,fileInputRef:l,handleFileChange:c,handleButtonClick:h})}),g.jsxs("div",{className:"flex items-center gap-2",children:[v?.voice_mode_available&&g.jsx(il,{toggleRecording:()=>d(!0)}),g.jsx("div",{className:p?"ml-auto":"",children:g.jsx($a,{send:e,noInput:i,chatValue:s,files:a})})]})]})]})})},nl=({isBuilding:u,sendMessage:t,stopBuilding:e})=>g.jsx("div",{className:"flex h-full w-full flex-col items-center justify-center",children:g.jsxs("div",{className:"flex w-full flex-col items-center justify-center gap-3 rounded-md border border-input bg-muted p-2 py-4",children:[u?g.jsx(De,{onClick:e,"data-testid":"button-stop",unstyled:!0,className:"form-modal-send-button cursor-pointer bg-muted text-foreground hover:bg-secondary-hover dark:hover:bg-input",children:g.jsxs("div",{className:"flex items-center gap-2 rounded-md text-sm font-medium",children:["Stop",g.jsx(zi,{className:"h-4 w-4"})]})}):g.jsx(De,{"data-testid":"button-send",className:"font-semibold",onClick:async()=>{await t({repeat:1})},children:"Run Flow"}),g.jsxs("p",{className:"text-muted-foreground",children:["Add a"," ",g.jsx("a",{className:"underline underline-offset-4",target:"_blank",href:"https://docs.vetrai.org/components-io#chat-input",rel:"noopener",children:"Chat Input"})," ","component to your flow to send messages."]})]})}),At={pollingQueue:new Map,activePolls:new Map,enqueuePolling(u,t){this.stopAll(),this.pollingQueue.clear(),this.pollingQueue.set(u,[t]),this.startNextPolling(u)},startNextPolling(u){const t=this.pollingQueue.get(u)||[];if(t.length===0){this.activePolls.delete(u);return}const e=t[0];this.activePolls.set(u,e),e.callback()},stopPoll(u){const t=this.activePolls.get(u);t&&(clearInterval(t.interval),this.activePolls.delete(u),this.pollingQueue.delete(u))},stopAll(){this.activePolls.forEach(u=>clearInterval(u.interval)),this.activePolls.clear(),this.pollingQueue.clear()},removeFromQueue(u,t){this.pollingQueue.delete(u)}},rl=u=>{const{mutate:t}=Fs(),e=L.useRef(null),i=L.useRef({}),s=5e3,n=async o=>{const l=o.id||"default";if(o.session_id,i.current[l])return Promise.reject("Request already in progress");try{i.current[l]=!0;const{id:c,mode:h,excludedFields:d,params:f}=o,p={};if(c&&(p.params={flow_id:c}),f){const w={...f};w.session_id&&(w.session_id=Io(w.session_id)),p.params={...p.params,...w}}const m=await Er.get(`${Os("MESSAGES")}`,p),v=Mo(m.data,h,d);return Nt.getState().setMessages(m.data),{rows:m.data,columns:v}}finally{i.current[l]=!1}},a=o=>{const l=o.id||"default";if(i.current[l])return Promise.reject("Request already in progress");if(At.activePolls.has(l)&&At.stopPoll(l),e.current===l&&At.activePolls.has(l))return Promise.resolve({rows:[],columns:[]});e.current=l;const c=Date.now(),h=async()=>{const p=await n(o);o.onSuccess?.(p),o.stopPollingOn?.(p)&&At.stopPoll(l)},f={interval:setInterval(h,s),timestamp:c,id:l,callback:h};return At.enqueuePolling(l,f),n(o).then(p=>(o.onSuccess?.(p),o.stopPollingOn?.(p)&&At.stopPoll(l),p))};return L.useEffect(()=>()=>{e.current&&(At.stopPoll(e.current),At.removeFromQueue(e.current,Date.now()),e.current=null)},[]),t(["useGetMessagesMutation"],o=>a(o)??Promise.reject("Failed to start polling"),u)},ol=(u,t,e,i,s,n,a)=>{const r=window.location.hostname,o=window.location.port,c=`${window.location.protocol==="https:"?"wss:":"ws:"}//${r}:${o}/api/v1/voice/ws/flow_tts/${u}/${a?.toString()}`;try{if(t.current?.readyState===WebSocket.CONNECTING)return;t.current?.readyState===WebSocket.OPEN&&t.current.close();const h=JSON.parse(Oi("lf_audio_settings_playground")||"{}"),d=Oi("lf_audio_language_playground")||"en-US";t.current=new WebSocket(c),t.current.onopen=()=>{e("Connected"),t.current?.readyState===WebSocket.OPEN&&(t.current.send(JSON.stringify({type:"vetrai.elevenlabs.config",enabled:h.provider==="elevenlabs",voice_id:h.provider==="elevenlabs"?h.voice:""})),h.provider!=="elevenlabs"&&t.current.send(JSON.stringify({type:"voice.settings",voice:h.voice||"echo",provider:h.provider||"openai"})),setTimeout(()=>{i()},300))},t.current.onmessage=s,t.current.onclose=f=>{f.code!==1e3&&console.warn(`WebSocket closed with code ${f.code}`),e(`Disconnected (${f.code})`),n()},t.current.onerror=f=>{console.error("WebSocket Error:",f),e("Connection error"),n()}}catch(h){console.error("Failed to create WebSocket:",h),e("Connection failed"),n()}},al=(u,t,e,i,s,n,a)=>ol(u,t,e,i,s,n,a),ll=async(u,t,e,i,s,n,a,r,o,l,c,h)=>{try{const d=localStorage.getItem("lf_selected_microphone"),f=localStorage.getItem("lf_preferred_language")||"en-US",p=await navigator?.mediaDevices?.getUserMedia({audio:{noiseSuppression:!0,echoCancellation:!0,autoGainControl:!0,sampleRate:48e3,deviceId:d?{exact:d}:void 0}});if(!u.current)return;s.current=p,t.current=u?.current?.createMediaStreamSource(p),e.current=u?.current?.createAnalyser(),e.current.fftSize=2048,t.current.connect(e.current);const m=new Blob([l],{type:"application/javascript"}),v=URL.createObjectURL(m);try{try{await u.current.audioWorklet.addModule(v)}catch(w){if(w instanceof DOMException&&w.message.includes("already been loaded"))console.error("AudioWorklet module already loaded, continuing...");else throw w}c.current=new AudioWorkletNode(u.current,"stream_processor"),e.current.connect(c.current),c.current.connect(u.current.destination),c.current.port.onmessage=w=>{if(w.data.type==="input"&&w.data.audio&&i.current){const S=btoa(String.fromCharCode.apply(null,Array.from(new Uint8Array(w.data.audio.buffer))));i.current.send(JSON.stringify({type:"input_audio_buffer.append",audio:S,language:f}))}else w.data.type==="done"&&(o.current.length>0?a():r.current=!1)},n(!0)}catch(w){console.error("AudioWorklet failed to load:",w),h("Error initializing audio: "+w.message)}finally{URL.revokeObjectURL(v)}}catch(d){console.error("Error accessing microphone:",d),h("Error: "+d.message)}},cl=(u,t,e,i,s,n,a,r,o,l,c,h)=>ll(u,t,e,i,s,n,a,r,o,l,c,h),hl=(u,t)=>{const{query:e}=Fs(),i=rt(o=>o.setVoices),s=rt(o=>o.voices),n=async()=>{if(s.length>0)return s;if(!u)return[];const c=(await Er.get(`${Os("VOICE")}/elevenlabs/voice_ids`)).data.map(h=>({name:h.name,value:h.voice_id}));return i(c),c},a={refetchOnMount:!1,refetchOnWindowFocus:!1,staleTime:1e3*60*5,...t};return e(["useGetVoiceList",u],n,a)},Ln=()=>g.jsx(g.Fragment,{children:g.jsx(No,{disabled:!1,children:g.jsxs(Fo,{value:"doNotFilter-addNewVariable",children:[g.jsx(ie,{name:"Plus",className:Pe("mr-2 h-4 w-4 text-primary"),"aria-hidden":"true"}),g.jsx("span",{children:"Add New Variable"})]})})}),ul=()=>g.jsxs("div",{className:"grid gap-1 p-4","data-testid":"voice-assistant-settings-modal-header",children:[g.jsxs("p",{className:"flex items-center gap-2 text-sm text-primary",children:[g.jsx(ie,{name:"Settings",strokeWidth:Xt,className:"h-4 w-4 text-muted-foreground hover:text-foreground"}),"Voice settings"]}),g.jsx("p",{className:"text-mmd leading-4 text-muted-foreground",children:"Voice chat is powered by OpenAI. You can also add more voices with ElevenLabs."})]}),dl=({language:u,handleSetLanguage:t})=>g.jsxs("div",{className:"grid w-full items-center gap-2",children:[g.jsxs("span",{className:"flex w-full items-center text-sm",children:["Preferred Language",g.jsx(Xe,{content:"Select the language for speech recognition",children:g.jsx("div",{children:g.jsx(ie,{name:"Info",strokeWidth:2,className:"relative -top-[3px] left-1 h-[14px] w-[14px] text-placeholder"})})})]}),g.jsxs(Ui,{value:u,onValueChange:t,children:[g.jsx(Vi,{className:"h-9 w-full",children:g.jsx(qi,{placeholder:"Select language"})}),g.jsx(Gi,{className:"max-h-[200px]",children:g.jsx(Wi,{children:Oo?.map(e=>g.jsx(gi,{value:e?.value,children:g.jsx("div",{className:"max-w-[220px] truncate text-left",children:e?.name})},e?.value))})})]})]}),fl=({selectedMicrophone:u,handleSetMicrophone:t,microphones:e,setMicrophones:i,setSelectedMicrophone:s})=>(L.useEffect(()=>{const n=async()=>{try{await navigator?.mediaDevices?.getUserMedia({audio:!0});const r=(await navigator?.mediaDevices?.enumerateDevices())?.filter(o=>o.kind==="audioinput");if(i(r),r.length>0&&!u){const o=localStorage.getItem("lf_selected_microphone");o&&r.some(l=>l.deviceId===o)?s(o):s(r[0].deviceId)}}catch(a){console.error("Error accessing media devices:",a)}};return n(),navigator?.mediaDevices?.addEventListener("devicechange",n),()=>{navigator?.mediaDevices?.removeEventListener("devicechange",n)}},[]),g.jsxs("div",{className:"grid w-full items-center gap-2","data-testid":"voice-assistant-settings-modal-microphone-select",children:[g.jsxs("span",{className:"flex w-full items-center text-sm",children:["Audio Input",g.jsx(Xe,{content:"Select which microphone to use for voice input",children:g.jsx("div",{children:g.jsx(ie,{name:"Info",strokeWidth:2,className:"relative -top-[3px] left-1 h-[14px] w-[14px] text-placeholder"})})})]}),g.jsxs(Ui,{value:u,onValueChange:t,children:[g.jsx(Vi,{className:"h-9 w-full",children:g.jsx(qi,{placeholder:"Select microphone"})}),g.jsx(Gi,{className:"max-h-[200px]",children:g.jsxs(Wi,{children:[e?.map(n=>g.jsx(gi,{value:n?.deviceId,children:g.jsx("div",{className:"max-w-[220px] truncate text-left",children:n?.label||`Microphone ${n?.deviceId?.slice(0,5)}...`})},n?.deviceId)),e?.length===0&&g.jsx(gi,{value:"no-microphones",disabled:!0,children:"No microphones found"})]})})]})]})),pl=({voice:u,handleSetVoice:t,allVoices:e})=>(e=e?.length===0||!e?jo:e,g.jsxs("div",{className:"grid w-full items-center gap-2",children:[g.jsxs("span",{className:"flex w-full items-center text-sm",children:["Voice",g.jsx(Xe,{content:"You can select ElevenLabs voices if you have an ElevenLabs API key. Otherwise, you can only select OpenAI voices.",children:g.jsx("div",{children:g.jsx(ie,{name:"Info",strokeWidth:2,className:"relative -top-[3px] left-1 h-[14px] w-[14px] text-placeholder"})})})]}),g.jsxs(Ui,{value:u,onValueChange:t,children:[g.jsx(Vi,{className:"h-9 w-full",children:g.jsx(qi,{placeholder:"Select"})}),g.jsx(Gi,{className:"max-h-[200px]",children:g.jsx(Wi,{children:e?.map((i,s)=>g.jsx(gi,{value:i?.value,children:g.jsx("div",{className:"max-w-[220px] truncate text-left",children:Ho(i?.name)})},s))})})]})]})),gl=({children:u,userOpenaiApiKey:t,userElevenLabsApiKey:e,setShowSettingsModal:i,hasOpenAIAPIKey:s,language:n,setLanguage:a,handleClickSaveOpenAIApiKey:r,isEditingOpenAIKey:o,setIsEditingOpenAIKey:l,isPlayingRef:c})=>{const h=L.useRef(null),[d,f]=L.useState("alloy"),[p,m]=L.useState(!1),w=rt(Y=>Y.voices).length===0,[S,_]=L.useState(t??""),[A,P]=L.useState(e??""),k=bs(Y=>Y.globalVariablesEntries),N=bs(Y=>Y.globalVariablesEntities),O=rt(Y=>Y.openaiVoices),[j,U]=L.useState(O),G=L.useRef(!1),{data:R,isFetched:D,refetch:I}=hl(A,{enabled:w,refetchOnMount:w,refetchOnWindowFocus:w,staleTime:1/0}),[W,z]=L.useState([]),[B,H]=L.useState(""),[$,J]=L.useState(localStorage.getItem("lf_preferred_language")||"en-US");L.useEffect(()=>{if(D)if(R){const Y=[...O,...R];R.length>0?U(Y):U(O)}else U(O)},[R,D,e]),L.useEffect(()=>{const Y=JSON.parse(Oi("lf_audio_settings_playground")||"{}");D&&Y.provider?f(Y.voice):f(O[0].value)},[D]);const re=Y=>{f(Y),O.some(ve=>ve.value===Y)?xs("lf_audio_settings_playground",JSON.stringify({provider:"openai",voice:Y})):xs("lf_audio_settings_playground",JSON.stringify({provider:"elevenlabs",voice:Y}))},me=Y=>{c.current=!1,m(Y),i(Y,S,A)},Q=Y=>k?.map(le=>le).includes(Y),{mutate:Te}=Tr(),Ae=Y=>{H(Y),localStorage.setItem("lf_selected_microphone",Y)};L.useEffect(()=>{_(t??"")},[t]),L.useEffect(()=>{if(P(e??""),!e){re(O[0].value),U(O);return}I()},[e]),L.useEffect(()=>{s||m(!0)},[s]);const ge=Y=>{J(Y),localStorage.setItem("lf_preferred_language",Y),a&&a(Y)};L.useEffect(()=>{n&&J(n)},[n]);const ae=Y=>{if(Y){if(Y==="OPENAI_API_KEY"){l(!1);return}r(Y),G.current=!0}},Re=Y=>{_(Y)};L.useEffect(()=>{_("")},[o]),L.useEffect(()=>{p||l(!1)},[p]);const Ce=!s||o,de=s&&!o,je=Bo(Y=>{const le=N?.find(ve=>ve.name==="ELEVENLABS_API_KEY");le&&Te({name:"ELEVENLABS_API_KEY",value:Y,id:le.id})},2e3),Ue=Y=>{P(Y),je(Y)};return g.jsx(g.Fragment,{children:g.jsxs(zo,{open:p,onOpenChange:me,children:[g.jsx(Uo,{"data-dropdown-trigger":"true",children:u}),g.jsx(Vo,{className:"w-[324px] rounded-xl shadow-lg",sideOffset:18,alignOffset:-60,align:"end",children:g.jsx("div",{ref:h,className:"rounded-3xl",children:g.jsxs("div",{children:[g.jsx(ul,{}),g.jsx(Yt,{className:"w-full"}),g.jsxs("div",{className:"w-full space-y-4 p-4",children:[g.jsxs("div",{className:"grid w-full items-center gap-2",children:[g.jsxs("span",{className:"flex items-center text-sm",children:["OpenAI API Key",g.jsx("span",{className:"ml-1 text-destructive",children:"*"}),g.jsx(Xe,{content:"OpenAI API key is required to use the voice assistant.",children:g.jsx("div",{children:g.jsx(ie,{name:"Info",strokeWidth:2,className:"relative -top-[3px] left-1 h-[14px] w-[14px] text-placeholder"})})})]}),Ce&&g.jsx(g.Fragment,{children:g.jsx(mn,{isObjectOption:!1,password:!0,nodeStyle:!0,popoverWidth:"16rem",placeholder:yn(!1,"Enter your OpenAI API key"),id:"openai-api-key",options:k?.map(Y=>Y)??[],optionsPlaceholder:"Global Variables",optionsIcon:"Globe",optionsButton:g.jsx(Ln,{}),optionButton:Y=>g.jsx(vn,{option:Y,onConfirmDelete:()=>{}}),value:S,onChange:Re,selectedOption:Q(S)?S:"",commandWidth:"11rem"})}),de&&g.jsx(g.Fragment,{children:g.jsx(De,{variant:"primary",className:"w-full",onClick:()=>l(!0),size:"md",children:"Edit"})})]}),!de&&g.jsxs("div",{className:"flex gap-2",children:[g.jsx(De,{onClick:()=>l(!1),variant:"primary",size:"md",className:"w-full","data-testid":"voice-assistant-settings-modal-cancel-button",children:"Cancel"}),g.jsx(De,{onClick:()=>ae(S),className:"w-full",disabled:!S,size:"md","data-testid":"voice-assistant-settings-modal-save-button",children:o?"Update":"Save"})]}),de&&g.jsxs(g.Fragment,{children:[g.jsxs("div",{className:"grid w-full items-center gap-2",children:[g.jsxs("span",{className:"flex items-center text-sm",children:["ElevenLabs API Key",g.jsx(Xe,{content:"If you have an ElevenLabs API key, you can select ElevenLabs voices.",children:g.jsx("div",{children:g.jsx(ie,{name:"Info",strokeWidth:2,className:"relative -top-[3px] left-1 h-[14px] w-[14px] text-placeholder"})})})]}),g.jsx(mn,{isObjectOption:!1,password:!0,nodeStyle:!0,popoverWidth:"16rem",placeholder:yn(!1,"Enter your ElevenLabs API key"),id:"eleven-labs-api-key",options:k?.map(Y=>Y)??[],optionsPlaceholder:"Global Variables",optionsIcon:"Globe",optionsButton:g.jsx(Ln,{}),optionButton:Y=>g.jsx(vn,{option:Y,onConfirmDelete:()=>{}}),value:A,onChange:Ue,selectedOption:Q(A)?A:"",setSelectedOption:P,commandWidth:"11rem",blockAddNewGlobalVariable:!0})]}),g.jsx(pl,{voice:d,handleSetVoice:re,allVoices:j}),g.jsx(fl,{selectedMicrophone:B,handleSetMicrophone:Ae,microphones:W,setMicrophones:z,setSelectedMicrophone:H}),g.jsx(dl,{language:$,handleSetLanguage:ge})]})]})]})})})]})})},ml=()=>{JSON.parse(Oi("lf_audio_settings_playground")||"{}")?.provider||xs("lf_audio_settings_playground",JSON.stringify({provider:"openai",voice:"alloy"}))},vl=u=>{const t=Math.floor(u/60),e=Math.floor(u%60);return`${t.toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}s`},yl=`
  class StreamProcessor extends AudioWorkletProcessor {
    constructor() {
      super();
      // manipulate this to change the buffer size, 24000 is one per second
      // this.inputBuffer = new Float32Array(24000);
      this.inputBuffer = new Float32Array(128);
      this.inputOffset = 0;
      this.outputBuffers = [];
      this.isPlaying = false;

      this.port.onmessage = (event) => {
        if (event.data.type === 'playback') {
          this.outputBuffers.push(event.data.audio);
          this.isPlaying = true;
        }
        else if (event.data.type === 'stop_playback') {
         // Immediately stop playback and clear any queued audio
         this.outputBuffers = [];
         this.isPlaying = false;
         // Optionally notify main thread if you want
         this.port.postMessage({ type: 'done' });
        }
      };
    }

    process(inputs, outputs, parameters) {
      const input = inputs[0];
      if (input && input.length > 0) {
        const inputData = input[0];
        for (let i = 0; i < inputData.length; i++) {
          this.inputBuffer[this.inputOffset++] = inputData[i];

          if (this.inputOffset >= this.inputBuffer.length) {
            const outputData = new Int16Array(this.inputBuffer.length);
            for (let j = 0; j < this.inputBuffer.length; j++) {
              outputData[j] = Math.max(-1, Math.min(1, this.inputBuffer[j])) * 0x7FFF;
            }
            this.port.postMessage({
              type: 'input',
              audio: outputData
            });
            // manipulate this to change the buffer size, 24000 is one per second
            // this.inputBuffer = new Float32Array(24000);
            this.inputBuffer = new Float32Array(128);
            this.inputOffset = 0;
          }
        }
      }

      const output = outputs[0];
      if (output && output.length > 0 && this.isPlaying) {
        if (this.outputBuffers.length > 0) {
          const currentBuffer = this.outputBuffers[0];
          const chunkSize = Math.min(output[0].length, currentBuffer.length);

          const gain = 0.8;
          for (let channel = 0; channel < output.length; channel++) {
            const outputChannel = output[channel];
            for (let i = 0; i < chunkSize; i++) {
              outputChannel[i] = currentBuffer[i] * gain;
            }
          }

          if (chunkSize === currentBuffer.length) {
            this.outputBuffers.shift();
          } else {
            this.outputBuffers[0] = currentBuffer.slice(chunkSize);
          }
        }

        if (this.outputBuffers.length === 0) {
          this.isPlaying = false;
          this.port.postMessage({ type: 'done' });
        }
      }
      return true;
    }
  }

  try {
    registerProcessor('stream_processor', StreamProcessor);
  } catch (e) {
    // Check for registration error without relying on DOMException
    if (e && e.message && e.message.includes('is already registered')) {
      // Processor already registered, ignore the error
    } else {
      throw e;
    }
  }
`,wl=(u,t,e,i,s)=>{const n=L.useRef(null),a=L.useRef(null),r=L.useRef([]),o=L.useRef(0),l=L.useRef(20),c=L.useRef(!1);L.useEffect(()=>{if(u){if(c.current=!1,i?.current){const d=i.current;d.fftSize=256,a.current=new Uint8Array(d.fftSize),c.current=!0}const h=setInterval(()=>{t(d=>d+1)},1e3);return()=>clearInterval(h)}else e(Array(30).fill(l.current)),s&&s(!1),n.current&&(cancelAnimationFrame(n.current),n.current=null),a.current=null},[u,t,e,s,i]),L.useEffect(()=>{const h=Array(30).fill(0).map((d,f)=>{const p=f/30,m=50+Math.sin(p*Math.PI)*30;return Math.max(l.current,Math.min(80,m))});e(h),r.current=h},[e]),L.useEffect(()=>{if(i?.current&&!c.current&&u){const h=i.current;h.fftSize=256,a.current=new Uint8Array(h.fftSize),c.current=!0}},[i?.current,u]),L.useEffect(()=>{if(!u)return;if(i?.current&&(!a.current||!c.current)){const d=i.current;d.fftSize=256,a.current=new Uint8Array(d.fftSize),c.current=!0}const h=d=>{let f=!1,p=0;if(i?.current&&a.current)try{const v=i.current;a.current.length!==v.fftSize&&(a.current=new Uint8Array(v.fftSize)),v.getByteTimeDomainData(a.current);let w=0,S=0;for(let A=0;A<a.current.length;A++){const P=Math.abs(a.current[A]-128);w+=P,S=Math.max(S,P)}p=(w/(a.current.length*128)*.5+S/128*.5)*10,f=p>.3,s&&s(f)}catch(v){console.error("Error detecting sound:",v),s&&s(!1)}else s&&s(!1);const m=f&&d-o.current>100;m&&(o.current=d),e(v=>v.map((w,S)=>{if(f){const _=r.current[S]||50,A=1+Math.min(1.5,p),P=m?.7+Math.random()*.6:.85+Math.random()*.3,k=_*A*P;return Math.max(l.current,Math.min(120,k))}else return w+(l.current-w)*.2})),n.current=requestAnimationFrame(h)};return n.current=requestAnimationFrame(h),()=>{n.current&&(cancelAnimationFrame(n.current),n.current=null)}},[u,i,s,e])};function bl(u){const t=atob(u),e=new Int16Array(t.length/2);for(let s=0;s<t.length;s+=2){const n=t.charCodeAt(s),a=t.charCodeAt(s+1);e[s/2]=a<<8|n}const i=new Float32Array(e.length);for(let s=0;s<e.length;s++)i[s]=e[s]/32768;return i}const xl=(u,t,e,i,s,n,a,r,o,l,c,h,d,f,p,m,v,w,S)=>{const _=JSON.parse(u.data);switch(_.type){case"response.content_part.added":_.part?.type==="text"&&_.part.text&&l(A=>A+_.part.text);break;case"response.done":if(_.response?.status_details?.error?.code){const A=_.response?.status_details?.error?.code?.replaceAll("_"," ");h(`API key error: ${A}`),S("API key error: "+A,["Please check your API key and try again"])}break;case"response.cancelled":t();break;case"response.audio.delta":if(_.delta&&e.current)try{const A=bl(_.delta),P=e.current.createBuffer(2,A.length,24e3);P.copyToChannel(A,0),P.copyToChannel(A,1),i.current.push(P),s.current||n()}catch(A){console.error("Error processing audio response:",A)}break;case"flow.build.progress":{const A=_.data;switch(A.event){case"start":a(!0);break;case"start_vertex":{v([A.vertex_id],as.BUILDING);const P=c.map(k=>(A.vertex_id===k.data?.targetHandle?.id&&(k.animated=!0,k.className="running"),k));f(P);break}case"end_vertex":v([A.vertex_id],as.BUILT),p({...A.data.build_data,run_id:A.run_id,id:A.vertex_id,valid:!0},A.vertex_id),m([A.vertex_id],!1);break;case"error":v([A.vertex_id],as.ERROR),m([A.vertex_id],!1);break;case"end":a(!1),r(),o();break;case"add_message":d.addMessage(A.data);break}break}case"error":if(_.code==="api_key_missing"){h("Error: API key is missing"),S("API key not valid",["Please check your API key and try again"]);return}if(_.error.message.toLowerCase().includes("api key")){h("Error: API key is missing"),S("API key not valid",["Please check your API key and try again"]);return}_.error.message==="Cancellation failed: no active response found"?t():h("Error: "+_.error);break}},Sl=async(u,t,e)=>{try{u.current?.state==="closed"&&(u.current=null),u.current||(u.current=new(window.AudioContext||window.webkitAudioContext)({sampleRate:24e3})),u.current.state==="suspended"&&await u.current.resume(),e()}catch(i){console.error("Failed to initialize audio:",i),t("Error: Failed to initialize audio")}},El=(u,t,e)=>{u.current.splice(0,u.current.length),t.current=!1,e.current&&e.current.port.postMessage({type:"stop_playback"})},Tl=(u,t,e)=>{if(u.current.length===0){t.current=!1;return}t.current=!0;const i=u.current.shift();if(i&&e.current)try{e.current.port.postMessage({type:"playback",audio:i.getChannelData(0)})}catch(s){console.error("Error playing audio:",s),t.current=!1}},_l=(u,t,e,i,s,n)=>{s.current&&(s.current.getTracks().forEach(a=>{a.stop()}),s.current=null),u.current&&(u.current.disconnect(),u.current=null),t.current&&(t.current.disconnect(),t.current=null),e.current&&(e.current.disconnect(),e.current=null),i.current&&(i.current.close(),i.current=null),n(!1)},Al={};function Cl({flowId:u,setShowAudioInput:t}){const[e,i]=L.useState(0),[s,n]=L.useState(!1),[a,r]=L.useState(""),[o,l]=L.useState(""),[c,h]=L.useState(!1),[d,f]=L.useState(!1),[p,m]=L.useState(Array(30).fill(20)),[v,w]=L.useState(localStorage.getItem("lf_preferred_language")||"en-US"),[S,_]=L.useState(!1),A=L.useRef(null),P=L.useRef(null),k=L.useRef(null),N=L.useRef(null),O=L.useRef([]),j=L.useRef(!1),U=L.useRef(null),G=L.useRef(null),R=L.useRef(null),D=rt(F=>F.soundDetected);rt(F=>F.setIsVoiceAssistantActive);const I=rt(F=>F.setSoundDetected),W=Nt(),z=Se(F=>F.setIsBuilding),B=Se(F=>F.edges),H=Se(F=>F.setEdges),$=Se(F=>F.updateBuildStatus),J=Se(F=>F.addDataToFlowPool),re=Se(F=>F.updateEdgesRunningByNodes),me=Se(F=>F.revertBuiltStatusFromBuilding),Q=Se(F=>F.clearEdgesRunningByNodes),Te=bs(F=>F.globalVariablesEntries),Ae=qo(),ge=Tr(),ae=Et(F=>F.setSuccessData),Re=ct(F=>F.currentSessionId),Ce=Et(F=>F.setErrorData),{data:de}=Go(),Ue=Se(F=>F.currentFlow)?.id,Y=L.useMemo(()=>Te?.find(F=>F==="OPENAI_API_KEY")?.length>0,[Te,open,d]),le=L.useMemo(()=>Te?.find(F=>F==="OPENAI_API_KEY"),[Te,d]),ve=L.useMemo(()=>de?.find(F=>F.name==="OPENAI_API_KEY"),[de]),be=L.useMemo(()=>de?.find(F=>F.name==="ELEVENLABS_API_KEY"),[de]),y=L.useMemo(()=>!!Al?.ELEVENLABS_API_KEY,[Te,d]);L.useEffect(()=>{!s&&Y&&!c?(n(!0),M()):q()},[]);const T=rl(),M=async()=>{Sl(P,r,ye)},K=async()=>{cl(P,U,G,k,R,n,te,j,O,yl,N,r)},q=()=>{_l(U,N,G,k,R,n)},te=()=>{Tl(O,j,N)},Z=F=>{xl(F,Ee,P,O,j,te,z,me,Q,l,B,r,W,H,J,re,$,Y,se)},ye=()=>{al(u,k,r,K,Z,q,Re)},Ee=()=>{El(O,j,N)};wl(s,i,m,G,I);const _e=()=>{T.mutate({mode:"union",id:Ue})},se=(F,ee)=>{Ce({title:F,list:ee}),n(!1)},X=async(F,ee,we)=>{const oe=S&&ve?.id,Ge=be?.id&&we;if(oe||Ge){await ge.mutateAsync({name:ee,value:F,id:we?be?.id:ve?.id},{onSuccess:()=>{ae({title:wn}),f(!d),_(!1)}});return}await Ae.mutateAsync({name:ee,value:F,type:"secret",default_fields:["voice_mode"]},{onSuccess:()=>{ae({title:wn}),f(!d)}})};L.useEffect(()=>(ml(),_e(),()=>{q(),P.current&&(P.current.close(),P.current=null)}),[t]);const{scrollToBottom:x}=_r(),b=()=>{n(!1),q(),t(!1),x({animation:"smooth",duration:1e3})},E=async(F,ee,we)=>{const oe=ee&&ee!=="OPENAI_API_KEY",Ge=we&&we!=="ELEVENLABS_API_KEY";F?(q(),P.current&&(P.current.close(),P.current=null),n(!1)):(i(0),m(Array(30).fill(20)),Y&&(P.current&&(P.current.close(),P.current=null),G.current=null,setTimeout(()=>{M(),K(),n(!0)},100))),oe&&await X(ee,"OPENAI_API_KEY",!1),Ge&&!F&&await X(we,"ELEVENLABS_API_KEY",!0)},C=()=>{s?(U?.current&&U?.current?.mediaStream&&U.current.mediaStream.getAudioTracks().forEach(F=>{F.enabled=!1}),m(Array(30).fill(20)),n(!1)):(U?.current&&U?.current?.mediaStream?U.current.mediaStream.getAudioTracks().forEach(F=>{F.enabled=!0}):K(),n(!0))};L.useEffect(()=>{v&&localStorage.setItem("lf_preferred_language",v)},[v]);const V=async F=>{await X(F,"OPENAI_API_KEY",!1)};return g.jsx(g.Fragment,{children:g.jsx("div",{"data-testid":"voice-assistant-container",className:"mx-auto flex w-full max-w-[324px] items-center justify-center rounded-md border bg-background px-4 py-2 shadow-xl",children:g.jsxs("div",{className:Pe("flex items-center",Y?"gap-3":"gap-2"),children:[g.jsx(Xe,{content:s?"Mute":"Unmute",delayDuration:500,children:g.jsx(De,{unstyled:!0,onClick:C,children:g.jsx(ie,{name:s?"Mic":"MicOff",strokeWidth:Xt,className:"h-4 w-4 text-placeholder-foreground"})})}),g.jsx("div",{ref:A,className:"flex h-5 flex-1 items-center justify-center",children:p.map((F,ee)=>g.jsx("div",{className:Pe("mx-[1px] w-[2px] rounded-sm transition-all duration-200",s&&D?"bg-red-foreground":"bg-placeholder-foreground"),style:{height:`${F}%`}},ee))}),g.jsx("div",{className:"min-w-[50px] cursor-default text-center font-mono text-sm font-medium text-placeholder-foreground",children:Y?vl(e):"--:--s"}),g.jsx("div",{children:g.jsx(gl,{userOpenaiApiKey:le,userElevenLabsApiKey:be?.name,hasElevenLabsApiKeyEnv:y,setShowSettingsModal:E,hasOpenAIAPIKey:Y,language:v,setLanguage:w,handleClickSaveOpenAIApiKey:V,isEditingOpenAIKey:S,setIsEditingOpenAIKey:_,isPlayingRef:j,children:Y?g.jsx(g.Fragment,{children:g.jsx(De,{"data-testid":"voice-assistant-settings-icon",unstyled:!0,children:g.jsx(ie,{name:"Settings",strokeWidth:Xt,className:Pe("relative top-[2px] h-4 w-4 text-muted-foreground hover:text-foreground")})})}):g.jsx(g.Fragment,{children:g.jsx(De,{variant:"outlineAmber",size:"icon","data-testid":"voice-assistant-settings-icon-without-openai",className:"h-8 w-8",children:g.jsx(ie,{name:"Key",strokeWidth:Xt,className:Pe("h-4 w-4 text-accent-amber-foreground")})})})})}),g.jsx(De,{unstyled:!0,onClick:b,"data-testid":"voice-assistant-close-button",children:g.jsx(ie,{name:"X",strokeWidth:Xt,className:"h-4 w-4 text-muted-foreground hover:text-foreground"})})]})})})}const Pl=(u,t)=>(L.useEffect(()=>{t.current&&t.current.scrollHeight!==0&&(t.current.style.height="inherit",t.current.style.height=`${t.current.scrollHeight}px`)},[u]),t),Rl=(u,t)=>(L.useEffect(()=>{!u&&t.current&&t.current.focus()},[u,t]),t);function Ll({sendMessage:u,inputRef:t,noInput:e,files:i,setFiles:s,isDragging:n,playgroundPage:a}){const r=xt(U=>U.currentFlowId),o=L.useRef(null),l=Et(U=>U.setErrorData),{validateFileSize:c}=Ar(),h=Se(U=>U.stopBuilding),d=Se(U=>U.isBuilding),f=ct(U=>U.chatValueStore),{scrollToBottom:p}=_r(),[m,v]=L.useState(!1),w=rt(U=>U.setIsVoiceAssistantActive),S=rt(U=>U.newSessionCloseVoiceAssistant);L.useEffect(()=>{m&&w(!0)},[m]),Rl(d,t),Pl(f,t);const{mutate:_}=Hs(),A=async U=>{if(a&&!Sr)return;let G=null;if("clipboardData"in U){const R=U.clipboardData?.items;if(R)for(let D=0;D<R.length;D++){const I=R[D].getAsFile();if(I){G=I;break}}}else G=U.target.files?.[0]??null;if(G){const R=G.name.split(".").pop()?.toLowerCase();try{c(G)}catch(z){z instanceof Error&&l({title:z.message});return}if(!R||!Bs.includes(R)){l({title:"Error uploading file",list:[Cr,Pr]});return}const I=new Rr().randomUUID(10),W=G.type.split("/")[0];s(z=>[...z,{file:G,loading:!0,error:!1,id:I,type:W}]),_({file:G,id:r},{onSuccess:z=>{s(B=>{const H=[...B],$=H.findIndex(J=>J.id===I);return H[$].loading=!1,H[$].path=z.file_path,H})},onError:z=>{s(B=>{const H=[...B],$=H.findIndex(J=>J.id===I);return H[$].loading=!1,H[$].error=!0,H}),l({title:"Error uploading file",list:[z.response?.data?.detail]})}})}"target"in U&&U.target instanceof HTMLInputElement&&(U.target.value="")};L.useEffect(()=>(document.addEventListener("paste",A),()=>{document.removeEventListener("paste",A)}),[A,r,d]);const P=ct(U=>U.setChatValueStore),k=async()=>{const U=f,G=i.map(D=>D.path??"").filter(D=>D!==""),R=[...i];s([]);try{p({animation:"smooth",duration:1e3}),await u({repeat:1,files:G})}catch{P(U),s(R)}},N=U=>U.key==="Enter"&&!d&&!U.shiftKey&&!U.nativeEvent.isComposing,O=()=>{o.current.click()},j=U=>{s(G=>G.filter(R=>R.id!==U.id))};return e?g.jsx(nl,{isBuilding:d,sendMessage:u,stopBuilding:h}):g.jsx(js,{mode:"wait",children:m&&!S?g.jsx(bt.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:g.jsx(Cl,{flowId:r,setShowAudioInput:v})},"voice-assistant"):g.jsx(bt.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:g.jsx(sl,{isBuilding:d,checkSendingOk:N,send:k,noInput:e,chatValue:f,inputRef:t,files:i,isDragging:n,handleDeleteFile:j,fileInputRef:o,handleFileChange:A,handleButtonClick:O,setShowAudioInput:v,currentFlowId:r,playgroundPage:a})},"input-wrapper")})}const Dl=({sendMessage:u,inputRef:t,noInput:e,files:i,setFiles:s,isDragging:n,playgroundPage:a})=>g.jsx(Ll,{sendMessage:u,inputRef:t,noInput:e,files:i,setFiles:s,isDragging:n,playgroundPage:a}),kl=u=>{const[t,e]=L.useState([]),{mutate:i}=Hs(),{setErrorData:s}=Et(),n=ct(r=>r.maxFileSizeUpload);return{files:t,setFiles:e,handleFiles:r=>{if(r){const o=r[0],l=o.name.split(".").pop()?.toLowerCase();if(o.size>n){s({title:Wo(Xo(n))});return}if(!l||!Bs.includes(l)){console.error("Error uploading file"),s({title:"Error uploading file",list:[Cr,Pr]});return}const h=new Rr().randomUUID(3),d=o.type.split("/")[0],f=o;e(p=>[...p,{file:f,loading:!0,error:!1,id:h,type:d}]),i({file:f,id:u},{onSuccess:p=>{e(m=>{const v=[...m],w=v.findIndex(S=>S.id===h);return v[w].loading=!1,v[w].path=p.file_path,v})},onError:p=>{e(m=>{const v=[...m],w=v.findIndex(S=>S.id===h);return v[w].loading=!1,v[w].error=!0,v}),s({title:"Error uploading file",list:[p.response?.data?.detail]})}})}}}},Il=u=>kl(u),Ml=()=>{const[u,t]=L.useState(!0);return L.useEffect(()=>{const e=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}},[]),u};function Ss(){return g.jsx("div",{className:"relative flex h-8 w-8 items-center justify-center rounded-md bg-muted",children:g.jsx("div",{className:"flex h-8 w-8 items-center justify-center",children:g.jsx(Lr,{title:"Vetrai Logo",className:"absolute h-[18px] w-[18px]"})})})}function Nl(){return g.jsxs("div",{className:"flex w-full gap-4 rounded-md p-2",children:[g.jsx(Ss,{}),g.jsx("div",{className:"flex items-center",children:g.jsx("div",{children:g.jsx(Dr,{className:"",duration:1,children:"Flow running..."})})})]})}const Fl=(u,t)=>({dragOver:n=>{t||(n.preventDefault(),n.dataTransfer.types.some(a=>a==="Files")&&u(!0))},dragEnter:n=>{t||(n.dataTransfer.types.some(a=>a==="Files")&&u(!0),n.preventDefault())},dragLeave:n=>{t||(n.preventDefault(),u(!1))}});var us={},dt={};const Ol="Ã",jl="Ã¡",Hl="Ä‚",Bl="Äƒ",zl="âˆ¾",Ul="âˆ¿",Vl="âˆ¾Ì³",ql="Ã‚",Gl="Ã¢",Wl="Â´",Xl="Ğ",Yl="Ğ°",Kl="Ã†",Zl="Ã¦",Jl="â¡",Ql="ğ”„",$l="ğ”",ec="Ã€",tc="Ã ",ic="â„µ",sc="â„µ",nc="Î‘",rc="Î±",oc="Ä€",ac="Ä",lc="â¨¿",cc="&",hc="&",uc="â©•",dc="â©“",fc="âˆ§",pc="â©œ",gc="â©˜",mc="â©š",vc="âˆ ",yc="â¦¤",wc="âˆ ",bc="â¦¨",xc="â¦©",Sc="â¦ª",Ec="â¦«",Tc="â¦¬",_c="â¦­",Ac="â¦®",Cc="â¦¯",Pc="âˆ¡",Rc="âˆŸ",Lc="âŠ¾",Dc="â¦",kc="âˆ¢",Ic="Ã…",Mc="â¼",Nc="Ä„",Fc="Ä…",Oc="ğ”¸",jc="ğ•’",Hc="â©¯",Bc="â‰ˆ",zc="â©°",Uc="â‰Š",Vc="â‰‹",qc="'",Gc="â¡",Wc="â‰ˆ",Xc="â‰Š",Yc="Ã…",Kc="Ã¥",Zc="ğ’œ",Jc="ğ’¶",Qc="â‰”",$c="*",eh="â‰ˆ",th="â‰",ih="Ãƒ",sh="Ã£",nh="Ã„",rh="Ã¤",oh="âˆ³",ah="â¨‘",lh="â‰Œ",ch="Ï¶",hh="â€µ",uh="âˆ½",dh="â‹",fh="âˆ–",ph="â«§",gh="âŠ½",mh="âŒ…",vh="âŒ†",yh="âŒ…",wh="âµ",bh="â¶",xh="â‰Œ",Sh="Ğ‘",Eh="Ğ±",Th="â€",_h="âˆµ",Ah="âˆµ",Ch="âˆµ",Ph="â¦°",Rh="Ï¶",Lh="â„¬",Dh="â„¬",kh="Î’",Ih="Î²",Mh="â„¶",Nh="â‰¬",Fh="ğ”…",Oh="ğ”Ÿ",jh="â‹‚",Hh="â—¯",Bh="â‹ƒ",zh="â¨€",Uh="â¨",Vh="â¨‚",qh="â¨†",Gh="â˜…",Wh="â–½",Xh="â–³",Yh="â¨„",Kh="â‹",Zh="â‹€",Jh="â¤",Qh="â§«",$h="â–ª",eu="â–´",tu="â–¾",iu="â—‚",su="â–¸",nu="â£",ru="â–’",ou="â–‘",au="â–“",lu="â–ˆ",cu="=âƒ¥",hu="â‰¡âƒ¥",uu="â«­",du="âŒ",fu="ğ”¹",pu="ğ•“",gu="âŠ¥",mu="âŠ¥",vu="â‹ˆ",yu="â§‰",wu="â”",bu="â••",xu="â•–",Su="â•—",Eu="â”Œ",Tu="â•’",_u="â•“",Au="â•”",Cu="â”€",Pu="â•",Ru="â”¬",Lu="â•¤",Du="â•¥",ku="â•¦",Iu="â”´",Mu="â•§",Nu="â•¨",Fu="â•©",Ou="âŠŸ",ju="âŠ",Hu="âŠ ",Bu="â”˜",zu="â•›",Uu="â•œ",Vu="â•",qu="â””",Gu="â•˜",Wu="â•™",Xu="â•š",Yu="â”‚",Ku="â•‘",Zu="â”¼",Ju="â•ª",Qu="â•«",$u="â•¬",ed="â”¤",td="â•¡",id="â•¢",sd="â•£",nd="â”œ",rd="â•",od="â•Ÿ",ad="â• ",ld="â€µ",cd="Ë˜",hd="Ë˜",ud="Â¦",dd="ğ’·",fd="â„¬",pd="â",gd="âˆ½",md="â‹",vd="â§…",yd="\\",wd="âŸˆ",bd="â€¢",xd="â€¢",Sd="â‰",Ed="âª®",Td="â‰",_d="â‰",Ad="â‰",Cd="Ä†",Pd="Ä‡",Rd="â©„",Ld="â©‰",Dd="â©‹",kd="âˆ©",Id="â‹’",Md="â©‡",Nd="â©€",Fd="â……",Od="âˆ©ï¸€",jd="â",Hd="Ë‡",Bd="â„­",zd="â©",Ud="ÄŒ",Vd="Ä",qd="Ã‡",Gd="Ã§",Wd="Äˆ",Xd="Ä‰",Yd="âˆ°",Kd="â©Œ",Zd="â©",Jd="ÄŠ",Qd="Ä‹",$d="Â¸",ef="Â¸",tf="â¦²",sf="Â¢",nf="Â·",rf="Â·",of="ğ” ",af="â„­",lf="Ğ§",cf="Ñ‡",hf="âœ“",uf="âœ“",df="Î§",ff="Ï‡",pf="Ë†",gf="â‰—",mf="â†º",vf="â†»",yf="âŠ›",wf="âŠš",bf="âŠ",xf="âŠ™",Sf="Â®",Ef="â“ˆ",Tf="âŠ–",_f="âŠ•",Af="âŠ—",Cf="â—‹",Pf="â§ƒ",Rf="â‰—",Lf="â¨",Df="â«¯",kf="â§‚",If="âˆ²",Mf="â€",Nf="â€™",Ff="â™£",Of="â™£",jf=":",Hf="âˆ·",Bf="â©´",zf="â‰”",Uf="â‰”",Vf=",",qf="@",Gf="âˆ",Wf="âˆ˜",Xf="âˆ",Yf="â„‚",Kf="â‰…",Zf="â©­",Jf="â‰¡",Qf="âˆ®",$f="âˆ¯",ep="âˆ®",tp="ğ•”",ip="â„‚",sp="âˆ",np="âˆ",rp="Â©",op="Â©",ap="â„—",lp="âˆ³",cp="â†µ",hp="âœ—",up="â¨¯",dp="ğ’",fp="ğ’¸",pp="â«",gp="â«‘",mp="â«",vp="â«’",yp="â‹¯",wp="â¤¸",bp="â¤µ",xp="â‹",Sp="â‹Ÿ",Ep="â†¶",Tp="â¤½",_p="â©ˆ",Ap="â©†",Cp="â‰",Pp="âˆª",Rp="â‹“",Lp="â©Š",Dp="âŠ",kp="â©…",Ip="âˆªï¸€",Mp="â†·",Np="â¤¼",Fp="â‹",Op="â‹Ÿ",jp="â‹",Hp="â‹",Bp="Â¤",zp="â†¶",Up="â†·",Vp="â‹",qp="â‹",Gp="âˆ²",Wp="âˆ±",Xp="âŒ­",Yp="â€ ",Kp="â€¡",Zp="â„¸",Jp="â†“",Qp="â†¡",$p="â‡“",eg="â€",tg="â«¤",ig="âŠ£",sg="â¤",ng="Ë",rg="Ä",og="Ä",ag="Ğ”",lg="Ğ´",cg="â€¡",hg="â‡Š",ug="â……",dg="â…†",fg="â¤‘",pg="â©·",gg="Â°",mg="âˆ‡",vg="Î”",yg="Î´",wg="â¦±",bg="â¥¿",xg="ğ”‡",Sg="ğ”¡",Eg="â¥¥",Tg="â‡ƒ",_g="â‡‚",Ag="Â´",Cg="Ë™",Pg="Ë",Rg="`",Lg="Ëœ",Dg="â‹„",kg="â‹„",Ig="â‹„",Mg="â™¦",Ng="â™¦",Fg="Â¨",Og="â…†",jg="Ï",Hg="â‹²",Bg="Ã·",zg="Ã·",Ug="â‹‡",Vg="â‹‡",qg="Ğ‚",Gg="Ñ’",Wg="âŒ",Xg="âŒ",Yg="$",Kg="ğ”»",Zg="ğ••",Jg="Â¨",Qg="Ë™",$g="âƒœ",em="â‰",tm="â‰‘",im="â‰",sm="âˆ¸",nm="âˆ”",rm="âŠ¡",om="âŒ†",am="âˆ¯",lm="Â¨",cm="â‡“",hm="â‡",um="â‡”",dm="â«¤",fm="âŸ¸",pm="âŸº",gm="âŸ¹",mm="â‡’",vm="âŠ¨",ym="â‡‘",wm="â‡•",bm="âˆ¥",xm="â¤“",Sm="â†“",Em="â†“",Tm="â‡“",_m="â‡µ",Am="Ì‘",Cm="â‡Š",Pm="â‡ƒ",Rm="â‡‚",Lm="â¥",Dm="â¥",km="â¥–",Im="â†½",Mm="â¥Ÿ",Nm="â¥—",Fm="â‡",Om="â†§",jm="âŠ¤",Hm="â¤",Bm="âŒŸ",zm="âŒŒ",Um="ğ’Ÿ",Vm="ğ’¹",qm="Ğ…",Gm="Ñ•",Wm="â§¶",Xm="Ä",Ym="Ä‘",Km="â‹±",Zm="â–¿",Jm="â–¾",Qm="â‡µ",$m="â¥¯",ev="â¦¦",tv="Ğ",iv="ÑŸ",sv="âŸ¿",nv="Ã‰",rv="Ã©",ov="â©®",av="Äš",lv="Ä›",cv="ÃŠ",hv="Ãª",uv="â‰–",dv="â‰•",fv="Ğ­",pv="Ñ",gv="â©·",mv="Ä–",vv="Ä—",yv="â‰‘",wv="â…‡",bv="â‰’",xv="ğ”ˆ",Sv="ğ”¢",Ev="âªš",Tv="Ãˆ",_v="Ã¨",Av="âª–",Cv="âª˜",Pv="âª™",Rv="âˆˆ",Lv="â§",Dv="â„“",kv="âª•",Iv="âª—",Mv="Ä’",Nv="Ä“",Fv="âˆ…",Ov="âˆ…",jv="â—»",Hv="âˆ…",Bv="â–«",zv="â€„",Uv="â€…",Vv="â€ƒ",qv="ÅŠ",Gv="Å‹",Wv="â€‚",Xv="Ä˜",Yv="Ä™",Kv="ğ”¼",Zv="ğ•–",Jv="â‹•",Qv="â§£",$v="â©±",ey="Îµ",ty="Î•",iy="Îµ",sy="Ïµ",ny="â‰–",ry="â‰•",oy="â‰‚",ay="âª–",ly="âª•",cy="â©µ",hy="=",uy="â‰‚",dy="â‰Ÿ",fy="â‡Œ",py="â‰¡",gy="â©¸",my="â§¥",vy="â¥±",yy="â‰“",wy="â„¯",by="â„°",xy="â‰",Sy="â©³",Ey="â‰‚",Ty="Î—",_y="Î·",Ay="Ã",Cy="Ã°",Py="Ã‹",Ry="Ã«",Ly="â‚¬",Dy="!",ky="âˆƒ",Iy="âˆƒ",My="â„°",Ny="â…‡",Fy="â…‡",Oy="â‰’",jy="Ğ¤",Hy="Ñ„",By="â™€",zy="ï¬ƒ",Uy="ï¬€",Vy="ï¬„",qy="ğ”‰",Gy="ğ”£",Wy="ï¬",Xy="â—¼",Yy="â–ª",Ky="fj",Zy="â™­",Jy="ï¬‚",Qy="â–±",$y="Æ’",ew="ğ”½",tw="ğ•—",iw="âˆ€",sw="âˆ€",nw="â‹”",rw="â«™",ow="â„±",aw="â¨",lw="Â½",cw="â…“",hw="Â¼",uw="â…•",dw="â…™",fw="â…›",pw="â…”",gw="â…–",mw="Â¾",vw="â…—",yw="â…œ",ww="â…˜",bw="â…š",xw="â…",Sw="â…",Ew="â„",Tw="âŒ¢",_w="ğ’»",Aw="â„±",Cw="Çµ",Pw="Î“",Rw="Î³",Lw="Ïœ",Dw="Ï",kw="âª†",Iw="Ä",Mw="ÄŸ",Nw="Ä¢",Fw="Äœ",Ow="Ä",jw="Ğ“",Hw="Ğ³",Bw="Ä ",zw="Ä¡",Uw="â‰¥",Vw="â‰§",qw="âªŒ",Gw="â‹›",Ww="â‰¥",Xw="â‰§",Yw="â©¾",Kw="âª©",Zw="â©¾",Jw="âª€",Qw="âª‚",$w="âª„",eb="â‹›ï¸€",tb="âª”",ib="ğ”Š",sb="ğ”¤",nb="â‰«",rb="â‹™",ob="â‹™",ab="â„·",lb="Ğƒ",cb="Ñ“",hb="âª¥",ub="â‰·",db="âª’",fb="âª¤",pb="âªŠ",gb="âªŠ",mb="âªˆ",vb="â‰©",yb="âªˆ",wb="â‰©",bb="â‹§",xb="ğ”¾",Sb="ğ•˜",Eb="`",Tb="â‰¥",_b="â‹›",Ab="â‰§",Cb="âª¢",Pb="â‰·",Rb="â©¾",Lb="â‰³",Db="ğ’¢",kb="â„Š",Ib="â‰³",Mb="âª",Nb="âª",Fb="âª§",Ob="â©º",jb=">",Hb=">",Bb="â‰«",zb="â‹—",Ub="â¦•",Vb="â©¼",qb="âª†",Gb="â¥¸",Wb="â‹—",Xb="â‹›",Yb="âªŒ",Kb="â‰·",Zb="â‰³",Jb="â‰©ï¸€",Qb="â‰©ï¸€",$b="Ë‡",ex="â€Š",tx="Â½",ix="â„‹",sx="Ğª",nx="ÑŠ",rx="â¥ˆ",ox="â†”",ax="â‡”",lx="â†­",cx="^",hx="â„",ux="Ä¤",dx="Ä¥",fx="â™¥",px="â™¥",gx="â€¦",mx="âŠ¹",vx="ğ”¥",yx="â„Œ",wx="â„‹",bx="â¤¥",xx="â¤¦",Sx="â‡¿",Ex="âˆ»",Tx="â†©",_x="â†ª",Ax="ğ•™",Cx="â„",Px="â€•",Rx="â”€",Lx="ğ’½",Dx="â„‹",kx="â„",Ix="Ä¦",Mx="Ä§",Nx="â‰",Fx="â‰",Ox="âƒ",jx="â€",Hx="Ã",Bx="Ã­",zx="â£",Ux="Ã",Vx="Ã®",qx="Ğ˜",Gx="Ğ¸",Wx="Ä°",Xx="Ğ•",Yx="Ğµ",Kx="Â¡",Zx="â‡”",Jx="ğ”¦",Qx="â„‘",$x="ÃŒ",eS="Ã¬",tS="â…ˆ",iS="â¨Œ",sS="âˆ­",nS="â§œ",rS="â„©",oS="Ä²",aS="Ä³",lS="Äª",cS="Ä«",hS="â„‘",uS="â…ˆ",dS="â„",fS="â„‘",pS="Ä±",gS="â„‘",mS="âŠ·",vS="Æµ",yS="â‡’",wS="â„…",bS="âˆ",xS="â§",SS="Ä±",ES="âŠº",TS="âˆ«",_S="âˆ¬",AS="â„¤",CS="âˆ«",PS="âŠº",RS="â‹‚",LS="â¨—",DS="â¨¼",kS="â£",IS="â¢",MS="Ğ",NS="Ñ‘",FS="Ä®",OS="Ä¯",jS="ğ•€",HS="ğ•š",BS="Î™",zS="Î¹",US="â¨¼",VS="Â¿",qS="ğ’¾",GS="â„",WS="âˆˆ",XS="â‹µ",YS="â‹¹",KS="â‹´",ZS="â‹³",JS="âˆˆ",QS="â¢",$S="Ä¨",eE="Ä©",tE="Ğ†",iE="Ñ–",sE="Ã",nE="Ã¯",rE="Ä´",oE="Äµ",aE="Ğ™",lE="Ğ¹",cE="ğ”",hE="ğ”§",uE="È·",dE="ğ•",fE="ğ•›",pE="ğ’¥",gE="ğ’¿",mE="Ğˆ",vE="Ñ˜",yE="Ğ„",wE="Ñ”",bE="Îš",xE="Îº",SE="Ï°",EE="Ä¶",TE="Ä·",_E="Ğš",AE="Ğº",CE="ğ”",PE="ğ”¨",RE="Ä¸",LE="Ğ¥",DE="Ñ…",kE="ĞŒ",IE="Ñœ",ME="ğ•‚",NE="ğ•œ",FE="ğ’¦",OE="ğ“€",jE="â‡š",HE="Ä¹",BE="Äº",zE="â¦´",UE="â„’",VE="Î›",qE="Î»",GE="âŸ¨",WE="âŸª",XE="â¦‘",YE="âŸ¨",KE="âª…",ZE="â„’",JE="Â«",QE="â‡¤",$E="â¤Ÿ",e0="â†",t0="â†",i0="â‡",s0="â¤",n0="â†©",r0="â†«",o0="â¤¹",a0="â¥³",l0="â†¢",c0="â¤™",h0="â¤›",u0="âª«",d0="âª­",f0="âª­ï¸€",p0="â¤Œ",g0="â¤",m0="â²",v0="{",y0="[",w0="â¦‹",b0="â¦",x0="â¦",S0="Ä½",E0="Ä¾",T0="Ä»",_0="Ä¼",A0="âŒˆ",C0="{",P0="Ğ›",R0="Ğ»",L0="â¤¶",D0="â€œ",k0="â€",I0="â¥§",M0="â¥‹",N0="â†²",F0="â‰¤",O0="â‰¦",j0="âŸ¨",H0="â‡¤",B0="â†",z0="â†",U0="â‡",V0="â‡†",q0="â†¢",G0="âŒˆ",W0="âŸ¦",X0="â¥¡",Y0="â¥™",K0="â‡ƒ",Z0="âŒŠ",J0="â†½",Q0="â†¼",$0="â‡‡",eT="â†”",tT="â†”",iT="â‡”",sT="â‡†",nT="â‡‹",rT="â†­",oT="â¥",aT="â†¤",lT="âŠ£",cT="â¥š",hT="â‹‹",uT="â§",dT="âŠ²",fT="âŠ´",pT="â¥‘",gT="â¥ ",mT="â¥˜",vT="â†¿",yT="â¥’",wT="â†¼",bT="âª‹",xT="â‹š",ST="â‰¤",ET="â‰¦",TT="â©½",_T="âª¨",AT="â©½",CT="â©¿",PT="âª",RT="âªƒ",LT="â‹šï¸€",DT="âª“",kT="âª…",IT="â‹–",MT="â‹š",NT="âª‹",FT="â‹š",OT="â‰¦",jT="â‰¶",HT="â‰¶",BT="âª¡",zT="â‰²",UT="â©½",VT="â‰²",qT="â¥¼",GT="âŒŠ",WT="ğ”",XT="ğ”©",YT="â‰¶",KT="âª‘",ZT="â¥¢",JT="â†½",QT="â†¼",$T="â¥ª",e_="â–„",t_="Ğ‰",i_="Ñ™",s_="â‡‡",n_="â‰ª",r_="â‹˜",o_="âŒ",a_="â‡š",l_="â¥«",c_="â—º",h_="Ä¿",u_="Å€",d_="â°",f_="â°",p_="âª‰",g_="âª‰",m_="âª‡",v_="â‰¨",y_="âª‡",w_="â‰¨",b_="â‹¦",x_="âŸ¬",S_="â‡½",E_="âŸ¦",T_="âŸµ",__="âŸµ",A_="âŸ¸",C_="âŸ·",P_="âŸ·",R_="âŸº",L_="âŸ¼",D_="âŸ¶",k_="âŸ¶",I_="âŸ¹",M_="â†«",N_="â†¬",F_="â¦…",O_="ğ•ƒ",j_="ğ•",H_="â¨­",B_="â¨´",z_="âˆ—",U_="_",V_="â†™",q_="â†˜",G_="â—Š",W_="â—Š",X_="â§«",Y_="(",K_="â¦“",Z_="â‡†",J_="âŒŸ",Q_="â‡‹",$_="â¥­",eA="â€",tA="âŠ¿",iA="â€¹",sA="ğ“",nA="â„’",rA="â†°",oA="â†°",aA="â‰²",lA="âª",cA="âª",hA="[",uA="â€˜",dA="â€š",fA="Å",pA="Å‚",gA="âª¦",mA="â©¹",vA="<",yA="<",wA="â‰ª",bA="â‹–",xA="â‹‹",SA="â‹‰",EA="â¥¶",TA="â©»",_A="â—ƒ",AA="âŠ´",CA="â—‚",PA="â¦–",RA="â¥Š",LA="â¥¦",DA="â‰¨ï¸€",kA="â‰¨ï¸€",IA="Â¯",MA="â™‚",NA="âœ ",FA="âœ ",OA="â†¦",jA="â†¦",HA="â†§",BA="â†¤",zA="â†¥",UA="â–®",VA="â¨©",qA="Ğœ",GA="Ğ¼",WA="â€”",XA="âˆº",YA="âˆ¡",KA="âŸ",ZA="â„³",JA="ğ”",QA="ğ”ª",$A="â„§",eC="Âµ",tC="*",iC="â«°",sC="âˆ£",nC="Â·",rC="âŠŸ",oC="âˆ’",aC="âˆ¸",lC="â¨ª",cC="âˆ“",hC="â«›",uC="â€¦",dC="âˆ“",fC="âŠ§",pC="ğ•„",gC="ğ•",mC="âˆ“",vC="ğ“‚",yC="â„³",wC="âˆ¾",bC="Îœ",xC="Î¼",SC="âŠ¸",EC="âŠ¸",TC="âˆ‡",_C="Åƒ",AC="Å„",CC="âˆ âƒ’",PC="â‰‰",RC="â©°Ì¸",LC="â‰‹Ì¸",DC="Å‰",kC="â‰‰",IC="â™®",MC="â„•",NC="â™®",FC="Â ",OC="â‰Ì¸",jC="â‰Ì¸",HC="â©ƒ",BC="Å‡",zC="Åˆ",UC="Å…",VC="Å†",qC="â‰‡",GC="â©­Ì¸",WC="â©‚",XC="Ğ",YC="Ğ½",KC="â€“",ZC="â¤¤",JC="â†—",QC="â‡—",$C="â†—",eP="â‰ ",tP="â‰Ì¸",iP="â€‹",sP="â€‹",nP="â€‹",rP="â€‹",oP="â‰¢",aP="â¤¨",lP="â‰‚Ì¸",cP="â‰«",hP="â‰ª",uP=`
`,dP="âˆ„",fP="âˆ„",pP="ğ”‘",gP="ğ”«",mP="â‰§Ì¸",vP="â‰±",yP="â‰±",wP="â‰§Ì¸",bP="â©¾Ì¸",xP="â©¾Ì¸",SP="â‹™Ì¸",EP="â‰µ",TP="â‰«âƒ’",_P="â‰¯",AP="â‰¯",CP="â‰«Ì¸",PP="â†®",RP="â‡",LP="â«²",DP="âˆ‹",kP="â‹¼",IP="â‹º",MP="âˆ‹",NP="ĞŠ",FP="Ñš",OP="â†š",jP="â‡",HP="â€¥",BP="â‰¦Ì¸",zP="â‰°",UP="â†š",VP="â‡",qP="â†®",GP="â‡",WP="â‰°",XP="â‰¦Ì¸",YP="â©½Ì¸",KP="â©½Ì¸",ZP="â‰®",JP="â‹˜Ì¸",QP="â‰´",$P="â‰ªâƒ’",eR="â‰®",tR="â‹ª",iR="â‹¬",sR="â‰ªÌ¸",nR="âˆ¤",rR="â ",oR="Â ",aR="ğ•Ÿ",lR="â„•",cR="â«¬",hR="Â¬",uR="â‰¢",dR="â‰­",fR="âˆ¦",pR="âˆ‰",gR="â‰ ",mR="â‰‚Ì¸",vR="âˆ„",yR="â‰¯",wR="â‰±",bR="â‰§Ì¸",xR="â‰«Ì¸",SR="â‰¹",ER="â©¾Ì¸",TR="â‰µ",_R="â‰Ì¸",AR="â‰Ì¸",CR="âˆ‰",PR="â‹µÌ¸",RR="â‹¹Ì¸",LR="âˆ‰",DR="â‹·",kR="â‹¶",IR="â§Ì¸",MR="â‹ª",NR="â‹¬",FR="â‰®",OR="â‰°",jR="â‰¸",HR="â‰ªÌ¸",BR="â©½Ì¸",zR="â‰´",UR="âª¢Ì¸",VR="âª¡Ì¸",qR="âˆŒ",GR="âˆŒ",WR="â‹¾",XR="â‹½",YR="âŠ€",KR="âª¯Ì¸",ZR="â‹ ",JR="âˆŒ",QR="â§Ì¸",$R="â‹«",e1="â‹­",t1="âŠÌ¸",i1="â‹¢",s1="âŠÌ¸",n1="â‹£",r1="âŠ‚âƒ’",o1="âŠˆ",a1="âŠ",l1="âª°Ì¸",c1="â‹¡",h1="â‰¿Ì¸",u1="âŠƒâƒ’",d1="âŠ‰",f1="â‰",p1="â‰„",g1="â‰‡",m1="â‰‰",v1="âˆ¤",y1="âˆ¦",w1="âˆ¦",b1="â«½âƒ¥",x1="âˆ‚Ì¸",S1="â¨”",E1="âŠ€",T1="â‹ ",_1="âŠ€",A1="âª¯Ì¸",C1="âª¯Ì¸",P1="â¤³Ì¸",R1="â†›",L1="â‡",D1="â†Ì¸",k1="â†›",I1="â‡",M1="â‹«",N1="â‹­",F1="âŠ",O1="â‹¡",j1="âª°Ì¸",H1="ğ’©",B1="ğ“ƒ",z1="âˆ¤",U1="âˆ¦",V1="â‰",q1="â‰„",G1="â‰„",W1="âˆ¤",X1="âˆ¦",Y1="â‹¢",K1="â‹£",Z1="âŠ„",J1="â«…Ì¸",Q1="âŠˆ",$1="âŠ‚âƒ’",eL="âŠˆ",tL="â«…Ì¸",iL="âŠ",sL="âª°Ì¸",nL="âŠ…",rL="â«†Ì¸",oL="âŠ‰",aL="âŠƒâƒ’",lL="âŠ‰",cL="â«†Ì¸",hL="â‰¹",uL="Ã‘",dL="Ã±",fL="â‰¸",pL="â‹ª",gL="â‹¬",mL="â‹«",vL="â‹­",yL="Î",wL="Î½",bL="#",xL="â„–",SL="â€‡",EL="â‰âƒ’",TL="âŠ¬",_L="âŠ­",AL="âŠ®",CL="âŠ¯",PL="â‰¥âƒ’",RL=">âƒ’",LL="â¤„",DL="â§",kL="â¤‚",IL="â‰¤âƒ’",ML="<âƒ’",NL="âŠ´âƒ’",FL="â¤ƒ",OL="âŠµâƒ’",jL="âˆ¼âƒ’",HL="â¤£",BL="â†–",zL="â‡–",UL="â†–",VL="â¤§",qL="Ã“",GL="Ã³",WL="âŠ›",XL="Ã”",YL="Ã´",KL="âŠš",ZL="Ğ",JL="Ğ¾",QL="âŠ",$L="Å",eD="Å‘",tD="â¨¸",iD="âŠ™",sD="â¦¼",nD="Å’",rD="Å“",oD="â¦¿",aD="ğ”’",lD="ğ”¬",cD="Ë›",hD="Ã’",uD="Ã²",dD="â§",fD="â¦µ",pD="Î©",gD="âˆ®",mD="â†º",vD="â¦¾",yD="â¦»",wD="â€¾",bD="â§€",xD="ÅŒ",SD="Å",ED="Î©",TD="Ï‰",_D="ÎŸ",AD="Î¿",CD="â¦¶",PD="âŠ–",RD="ğ•†",LD="ğ• ",DD="â¦·",kD="â€œ",ID="â€˜",MD="â¦¹",ND="âŠ•",FD="â†»",OD="â©”",jD="âˆ¨",HD="â©",BD="â„´",zD="â„´",UD="Âª",VD="Âº",qD="âŠ¶",GD="â©–",WD="â©—",XD="â©›",YD="â“ˆ",KD="ğ’ª",ZD="â„´",JD="Ã˜",QD="Ã¸",$D="âŠ˜",ek="Ã•",tk="Ãµ",ik="â¨¶",sk="â¨·",nk="âŠ—",rk="Ã–",ok="Ã¶",ak="âŒ½",lk="â€¾",ck="â",hk="â´",uk="âœ",dk="Â¶",fk="âˆ¥",pk="âˆ¥",gk="â«³",mk="â«½",vk="âˆ‚",yk="âˆ‚",wk="ĞŸ",bk="Ğ¿",xk="%",Sk=".",Ek="â€°",Tk="âŠ¥",_k="â€±",Ak="ğ”“",Ck="ğ”­",Pk="Î¦",Rk="Ï†",Lk="Ï•",Dk="â„³",kk="â˜",Ik="Î ",Mk="Ï€",Nk="â‹”",Fk="Ï–",Ok="â„",jk="â„",Hk="â„",Bk="â¨£",zk="âŠ",Uk="â¨¢",Vk="+",qk="âˆ”",Gk="â¨¥",Wk="â©²",Xk="Â±",Yk="Â±",Kk="â¨¦",Zk="â¨§",Jk="Â±",Qk="â„Œ",$k="â¨•",eI="ğ•¡",tI="â„™",iI="Â£",sI="âª·",nI="âª»",rI="â‰º",oI="â‰¼",aI="âª·",lI="â‰º",cI="â‰¼",hI="â‰º",uI="âª¯",dI="â‰¼",fI="â‰¾",pI="âª¯",gI="âª¹",mI="âªµ",vI="â‹¨",yI="âª¯",wI="âª³",bI="â‰¾",xI="â€²",SI="â€³",EI="â„™",TI="âª¹",_I="âªµ",AI="â‹¨",CI="âˆ",PI="âˆ",RI="âŒ®",LI="âŒ’",DI="âŒ“",kI="âˆ",II="âˆ",MI="âˆ·",NI="âˆ",FI="â‰¾",OI="âŠ°",jI="ğ’«",HI="ğ“…",BI="Î¨",zI="Ïˆ",UI="â€ˆ",VI="ğ””",qI="ğ”®",GI="â¨Œ",WI="ğ•¢",XI="â„š",YI="â—",KI="ğ’¬",ZI="ğ“†",JI="â„",QI="â¨–",$I="?",eM="â‰Ÿ",tM='"',iM='"',sM="â‡›",nM="âˆ½Ì±",rM="Å”",oM="Å•",aM="âˆš",lM="â¦³",cM="âŸ©",hM="âŸ«",uM="â¦’",dM="â¦¥",fM="âŸ©",pM="Â»",gM="â¥µ",mM="â‡¥",vM="â¤ ",yM="â¤³",wM="â†’",bM="â† ",xM="â‡’",SM="â¤",EM="â†ª",TM="â†¬",_M="â¥…",AM="â¥´",CM="â¤–",PM="â†£",RM="â†",LM="â¤š",DM="â¤œ",kM="âˆ¶",IM="â„š",MM="â¤",NM="â¤",FM="â¤",OM="â³",jM="}",HM="]",BM="â¦Œ",zM="â¦",UM="â¦",VM="Å˜",qM="Å™",GM="Å–",WM="Å—",XM="âŒ‰",YM="}",KM="Ğ ",ZM="Ñ€",JM="â¤·",QM="â¥©",$M="â€",eN="â€",tN="â†³",iN="â„œ",sN="â„›",nN="â„œ",rN="â„",oN="â„œ",aN="â–­",lN="Â®",cN="Â®",hN="âˆ‹",uN="â‡‹",dN="â¥¯",fN="â¥½",pN="âŒ‹",gN="ğ”¯",mN="â„œ",vN="â¥¤",yN="â‡",wN="â‡€",bN="â¥¬",xN="Î¡",SN="Ï",EN="Ï±",TN="âŸ©",_N="â‡¥",AN="â†’",CN="â†’",PN="â‡’",RN="â‡„",LN="â†£",DN="âŒ‰",kN="âŸ§",IN="â¥",MN="â¥•",NN="â‡‚",FN="âŒ‹",ON="â‡",jN="â‡€",HN="â‡„",BN="â‡Œ",zN="â‡‰",UN="â†",VN="â†¦",qN="âŠ¢",GN="â¥›",WN="â‹Œ",XN="â§",YN="âŠ³",KN="âŠµ",ZN="â¥",JN="â¥œ",QN="â¥”",$N="â†¾",eF="â¥“",tF="â‡€",iF="Ëš",sF="â‰“",nF="â‡„",rF="â‡Œ",oF="â€",aF="â±",lF="â±",cF="â«®",hF="âŸ­",uF="â‡¾",dF="âŸ§",fF="â¦†",pF="ğ•£",gF="â„",mF="â¨®",vF="â¨µ",yF="â¥°",wF=")",bF="â¦”",xF="â¨’",SF="â‡‰",EF="â‡›",TF="â€º",_F="ğ“‡",AF="â„›",CF="â†±",PF="â†±",RF="]",LF="â€™",DF="â€™",kF="â‹Œ",IF="â‹Š",MF="â–¹",NF="âŠµ",FF="â–¸",OF="â§",jF="â§´",HF="â¥¨",BF="â„",zF="Åš",UF="Å›",VF="â€š",qF="âª¸",GF="Å ",WF="Å¡",XF="âª¼",YF="â‰»",KF="â‰½",ZF="âª°",JF="âª´",QF="Å",$F="ÅŸ",eO="Åœ",tO="Å",iO="âªº",sO="âª¶",nO="â‹©",rO="â¨“",oO="â‰¿",aO="Ğ¡",lO="Ñ",cO="âŠ¡",hO="â‹…",uO="â©¦",dO="â¤¥",fO="â†˜",pO="â‡˜",gO="â†˜",mO="Â§",vO=";",yO="â¤©",wO="âˆ–",bO="âˆ–",xO="âœ¶",SO="ğ”–",EO="ğ”°",TO="âŒ¢",_O="â™¯",AO="Ğ©",CO="Ñ‰",PO="Ğ¨",RO="Ñˆ",LO="â†“",DO="â†",kO="âˆ£",IO="âˆ¥",MO="â†’",NO="â†‘",FO="Â­",OO="Î£",jO="Ïƒ",HO="Ï‚",BO="Ï‚",zO="âˆ¼",UO="â©ª",VO="â‰ƒ",qO="â‰ƒ",GO="âª",WO="âª ",XO="âª",YO="âªŸ",KO="â‰†",ZO="â¨¤",JO="â¥²",QO="â†",$O="âˆ˜",ej="âˆ–",tj="â¨³",ij="â§¤",sj="âˆ£",nj="âŒ£",rj="âªª",oj="âª¬",aj="âª¬ï¸€",lj="Ğ¬",cj="ÑŒ",hj="âŒ¿",uj="â§„",dj="/",fj="ğ•Š",pj="ğ•¤",gj="â™ ",mj="â™ ",vj="âˆ¥",yj="âŠ“",wj="âŠ“ï¸€",bj="âŠ”",xj="âŠ”ï¸€",Sj="âˆš",Ej="âŠ",Tj="âŠ‘",_j="âŠ",Aj="âŠ‘",Cj="âŠ",Pj="âŠ’",Rj="âŠ",Lj="âŠ’",Dj="â–¡",kj="â–¡",Ij="âŠ“",Mj="âŠ",Nj="âŠ‘",Fj="âŠ",Oj="âŠ’",jj="âŠ”",Hj="â–ª",Bj="â–¡",zj="â–ª",Uj="â†’",Vj="ğ’®",qj="ğ“ˆ",Gj="âˆ–",Wj="âŒ£",Xj="â‹†",Yj="â‹†",Kj="â˜†",Zj="â˜…",Jj="Ïµ",Qj="Ï•",$j="Â¯",eH="âŠ‚",tH="â‹",iH="âª½",sH="â«…",nH="âŠ†",rH="â«ƒ",oH="â«",aH="â«‹",lH="âŠŠ",cH="âª¿",hH="â¥¹",uH="âŠ‚",dH="â‹",fH="âŠ†",pH="â«…",gH="âŠ†",mH="âŠŠ",vH="â«‹",yH="â«‡",wH="â«•",bH="â«“",xH="âª¸",SH="â‰»",EH="â‰½",TH="â‰»",_H="âª°",AH="â‰½",CH="â‰¿",PH="âª°",RH="âªº",LH="âª¶",DH="â‹©",kH="â‰¿",IH="âˆ‹",MH="âˆ‘",NH="âˆ‘",FH="â™ª",OH="Â¹",jH="Â²",HH="Â³",BH="âŠƒ",zH="â‹‘",UH="âª¾",VH="â«˜",qH="â«†",GH="âŠ‡",WH="â«„",XH="âŠƒ",YH="âŠ‡",KH="âŸ‰",ZH="â«—",JH="â¥»",QH="â«‚",$H="â«Œ",eB="âŠ‹",tB="â«€",iB="âŠƒ",sB="â‹‘",nB="âŠ‡",rB="â«†",oB="âŠ‹",aB="â«Œ",lB="â«ˆ",cB="â«”",hB="â«–",uB="â¤¦",dB="â†™",fB="â‡™",pB="â†™",gB="â¤ª",mB="ÃŸ",vB="	",yB="âŒ–",wB="Î¤",bB="Ï„",xB="â´",SB="Å¤",EB="Å¥",TB="Å¢",_B="Å£",AB="Ğ¢",CB="Ñ‚",PB="âƒ›",RB="âŒ•",LB="ğ”—",DB="ğ”±",kB="âˆ´",IB="âˆ´",MB="âˆ´",NB="Î˜",FB="Î¸",OB="Ï‘",jB="Ï‘",HB="â‰ˆ",BB="âˆ¼",zB="âŸâ€Š",UB="â€‰",VB="â€‰",qB="â‰ˆ",GB="âˆ¼",WB="Ã",XB="Ã¾",YB="Ëœ",KB="âˆ¼",ZB="â‰ƒ",JB="â‰…",QB="â‰ˆ",$B="â¨±",e2="âŠ ",t2="Ã—",i2="â¨°",s2="âˆ­",n2="â¤¨",r2="âŒ¶",o2="â«±",a2="âŠ¤",l2="ğ•‹",c2="ğ•¥",h2="â«š",u2="â¤©",d2="â€´",f2="â„¢",p2="â„¢",g2="â–µ",m2="â–¿",v2="â—ƒ",y2="âŠ´",w2="â‰œ",b2="â–¹",x2="âŠµ",S2="â—¬",E2="â‰œ",T2="â¨º",_2="âƒ›",A2="â¨¹",C2="â§",P2="â¨»",R2="â¢",L2="ğ’¯",D2="ğ“‰",k2="Ğ¦",I2="Ñ†",M2="Ğ‹",N2="Ñ›",F2="Å¦",O2="Å§",j2="â‰¬",H2="â†",B2="â† ",z2="Ãš",U2="Ãº",V2="â†‘",q2="â†Ÿ",G2="â‡‘",W2="â¥‰",X2="Ğ",Y2="Ñ",K2="Å¬",Z2="Å­",J2="Ã›",Q2="Ã»",$2="Ğ£",ez="Ñƒ",tz="â‡…",iz="Å°",sz="Å±",nz="â¥®",rz="â¥¾",oz="ğ”˜",az="ğ”²",lz="Ã™",cz="Ã¹",hz="â¥£",uz="â†¿",dz="â†¾",fz="â–€",pz="âŒœ",gz="âŒœ",mz="âŒ",vz="â—¸",yz="Åª",wz="Å«",bz="Â¨",xz="_",Sz="âŸ",Ez="âµ",Tz="â",_z="â‹ƒ",Az="âŠ",Cz="Å²",Pz="Å³",Rz="ğ•Œ",Lz="ğ•¦",Dz="â¤’",kz="â†‘",Iz="â†‘",Mz="â‡‘",Nz="â‡…",Fz="â†•",Oz="â†•",jz="â‡•",Hz="â¥®",Bz="â†¿",zz="â†¾",Uz="âŠ",Vz="â†–",qz="â†—",Gz="Ï…",Wz="Ï’",Xz="Ï’",Yz="Î¥",Kz="Ï…",Zz="â†¥",Jz="âŠ¥",Qz="â‡ˆ",$z="âŒ",eU="âŒ",tU="âŒ",iU="Å®",sU="Å¯",nU="â—¹",rU="ğ’°",oU="ğ“Š",aU="â‹°",lU="Å¨",cU="Å©",hU="â–µ",uU="â–´",dU="â‡ˆ",fU="Ãœ",pU="Ã¼",gU="â¦§",mU="â¦œ",vU="Ïµ",yU="Ï°",wU="âˆ…",bU="Ï•",xU="Ï–",SU="âˆ",EU="â†•",TU="â‡•",_U="Ï±",AU="Ï‚",CU="âŠŠï¸€",PU="â«‹ï¸€",RU="âŠ‹ï¸€",LU="â«Œï¸€",DU="Ï‘",kU="âŠ²",IU="âŠ³",MU="â«¨",NU="â««",FU="â«©",OU="Ğ’",jU="Ğ²",HU="âŠ¢",BU="âŠ¨",zU="âŠ©",UU="âŠ«",VU="â«¦",qU="âŠ»",GU="âˆ¨",WU="â‹",XU="â‰š",YU="â‹®",KU="|",ZU="â€–",JU="|",QU="â€–",$U="âˆ£",eV="|",tV="â˜",iV="â‰€",sV="â€Š",nV="ğ”™",rV="ğ”³",oV="âŠ²",aV="âŠ‚âƒ’",lV="âŠƒâƒ’",cV="ğ•",hV="ğ•§",uV="âˆ",dV="âŠ³",fV="ğ’±",pV="ğ“‹",gV="â«‹ï¸€",mV="âŠŠï¸€",vV="â«Œï¸€",yV="âŠ‹ï¸€",wV="âŠª",bV="â¦š",xV="Å´",SV="Åµ",EV="â©Ÿ",TV="âˆ§",_V="â‹€",AV="â‰™",CV="â„˜",PV="ğ”š",RV="ğ”´",LV="ğ•",DV="ğ•¨",kV="â„˜",IV="â‰€",MV="â‰€",NV="ğ’²",FV="ğ“Œ",OV="â‹‚",jV="â—¯",HV="â‹ƒ",BV="â–½",zV="ğ”›",UV="ğ”µ",VV="âŸ·",qV="âŸº",GV="Î",WV="Î¾",XV="âŸµ",YV="âŸ¸",KV="âŸ¼",ZV="â‹»",JV="â¨€",QV="ğ•",$V="ğ•©",eq="â¨",tq="â¨‚",iq="âŸ¶",sq="âŸ¹",nq="ğ’³",rq="ğ“",oq="â¨†",aq="â¨„",lq="â–³",cq="â‹",hq="â‹€",uq="Ã",dq="Ã½",fq="Ğ¯",pq="Ñ",gq="Å¶",mq="Å·",vq="Ğ«",yq="Ñ‹",wq="Â¥",bq="ğ”œ",xq="ğ”¶",Sq="Ğ‡",Eq="Ñ—",Tq="ğ•",_q="ğ•ª",Aq="ğ’´",Cq="ğ“",Pq="Ğ®",Rq="Ñ",Lq="Ã¿",Dq="Å¸",kq="Å¹",Iq="Åº",Mq="Å½",Nq="Å¾",Fq="Ğ—",Oq="Ğ·",jq="Å»",Hq="Å¼",Bq="â„¨",zq="â€‹",Uq="Î–",Vq="Î¶",qq="ğ”·",Gq="â„¨",Wq="Ğ–",Xq="Ğ¶",Yq="â‡",Kq="ğ•«",Zq="â„¤",Jq="ğ’µ",Qq="ğ“",$q="â€",eG="â€Œ",Mr={Aacute:Ol,aacute:jl,Abreve:Hl,abreve:Bl,ac:zl,acd:Ul,acE:Vl,Acirc:ql,acirc:Gl,acute:Wl,Acy:Xl,acy:Yl,AElig:Kl,aelig:Zl,af:Jl,Afr:Ql,afr:$l,Agrave:ec,agrave:tc,alefsym:ic,aleph:sc,Alpha:nc,alpha:rc,Amacr:oc,amacr:ac,amalg:lc,amp:cc,AMP:hc,andand:uc,And:dc,and:fc,andd:pc,andslope:gc,andv:mc,ang:vc,ange:yc,angle:wc,angmsdaa:bc,angmsdab:xc,angmsdac:Sc,angmsdad:Ec,angmsdae:Tc,angmsdaf:_c,angmsdag:Ac,angmsdah:Cc,angmsd:Pc,angrt:Rc,angrtvb:Lc,angrtvbd:Dc,angsph:kc,angst:Ic,angzarr:Mc,Aogon:Nc,aogon:Fc,Aopf:Oc,aopf:jc,apacir:Hc,ap:Bc,apE:zc,ape:Uc,apid:Vc,apos:qc,ApplyFunction:Gc,approx:Wc,approxeq:Xc,Aring:Yc,aring:Kc,Ascr:Zc,ascr:Jc,Assign:Qc,ast:$c,asymp:eh,asympeq:th,Atilde:ih,atilde:sh,Auml:nh,auml:rh,awconint:oh,awint:ah,backcong:lh,backepsilon:ch,backprime:hh,backsim:uh,backsimeq:dh,Backslash:fh,Barv:ph,barvee:gh,barwed:mh,Barwed:vh,barwedge:yh,bbrk:wh,bbrktbrk:bh,bcong:xh,Bcy:Sh,bcy:Eh,bdquo:Th,becaus:_h,because:Ah,Because:Ch,bemptyv:Ph,bepsi:Rh,bernou:Lh,Bernoullis:Dh,Beta:kh,beta:Ih,beth:Mh,between:Nh,Bfr:Fh,bfr:Oh,bigcap:jh,bigcirc:Hh,bigcup:Bh,bigodot:zh,bigoplus:Uh,bigotimes:Vh,bigsqcup:qh,bigstar:Gh,bigtriangledown:Wh,bigtriangleup:Xh,biguplus:Yh,bigvee:Kh,bigwedge:Zh,bkarow:Jh,blacklozenge:Qh,blacksquare:$h,blacktriangle:eu,blacktriangledown:tu,blacktriangleleft:iu,blacktriangleright:su,blank:nu,blk12:ru,blk14:ou,blk34:au,block:lu,bne:cu,bnequiv:hu,bNot:uu,bnot:du,Bopf:fu,bopf:pu,bot:gu,bottom:mu,bowtie:vu,boxbox:yu,boxdl:wu,boxdL:bu,boxDl:xu,boxDL:Su,boxdr:Eu,boxdR:Tu,boxDr:_u,boxDR:Au,boxh:Cu,boxH:Pu,boxhd:Ru,boxHd:Lu,boxhD:Du,boxHD:ku,boxhu:Iu,boxHu:Mu,boxhU:Nu,boxHU:Fu,boxminus:Ou,boxplus:ju,boxtimes:Hu,boxul:Bu,boxuL:zu,boxUl:Uu,boxUL:Vu,boxur:qu,boxuR:Gu,boxUr:Wu,boxUR:Xu,boxv:Yu,boxV:Ku,boxvh:Zu,boxvH:Ju,boxVh:Qu,boxVH:$u,boxvl:ed,boxvL:td,boxVl:id,boxVL:sd,boxvr:nd,boxvR:rd,boxVr:od,boxVR:ad,bprime:ld,breve:cd,Breve:hd,brvbar:ud,bscr:dd,Bscr:fd,bsemi:pd,bsim:gd,bsime:md,bsolb:vd,bsol:yd,bsolhsub:wd,bull:bd,bullet:xd,bump:Sd,bumpE:Ed,bumpe:Td,Bumpeq:_d,bumpeq:Ad,Cacute:Cd,cacute:Pd,capand:Rd,capbrcup:Ld,capcap:Dd,cap:kd,Cap:Id,capcup:Md,capdot:Nd,CapitalDifferentialD:Fd,caps:Od,caret:jd,caron:Hd,Cayleys:Bd,ccaps:zd,Ccaron:Ud,ccaron:Vd,Ccedil:qd,ccedil:Gd,Ccirc:Wd,ccirc:Xd,Cconint:Yd,ccups:Kd,ccupssm:Zd,Cdot:Jd,cdot:Qd,cedil:$d,Cedilla:ef,cemptyv:tf,cent:sf,centerdot:nf,CenterDot:rf,cfr:of,Cfr:af,CHcy:lf,chcy:cf,check:hf,checkmark:uf,Chi:df,chi:ff,circ:pf,circeq:gf,circlearrowleft:mf,circlearrowright:vf,circledast:yf,circledcirc:wf,circleddash:bf,CircleDot:xf,circledR:Sf,circledS:Ef,CircleMinus:Tf,CirclePlus:_f,CircleTimes:Af,cir:Cf,cirE:Pf,cire:Rf,cirfnint:Lf,cirmid:Df,cirscir:kf,ClockwiseContourIntegral:If,CloseCurlyDoubleQuote:Mf,CloseCurlyQuote:Nf,clubs:Ff,clubsuit:Of,colon:jf,Colon:Hf,Colone:Bf,colone:zf,coloneq:Uf,comma:Vf,commat:qf,comp:Gf,compfn:Wf,complement:Xf,complexes:Yf,cong:Kf,congdot:Zf,Congruent:Jf,conint:Qf,Conint:$f,ContourIntegral:ep,copf:tp,Copf:ip,coprod:sp,Coproduct:np,copy:rp,COPY:op,copysr:ap,CounterClockwiseContourIntegral:lp,crarr:cp,cross:hp,Cross:up,Cscr:dp,cscr:fp,csub:pp,csube:gp,csup:mp,csupe:vp,ctdot:yp,cudarrl:wp,cudarrr:bp,cuepr:xp,cuesc:Sp,cularr:Ep,cularrp:Tp,cupbrcap:_p,cupcap:Ap,CupCap:Cp,cup:Pp,Cup:Rp,cupcup:Lp,cupdot:Dp,cupor:kp,cups:Ip,curarr:Mp,curarrm:Np,curlyeqprec:Fp,curlyeqsucc:Op,curlyvee:jp,curlywedge:Hp,curren:Bp,curvearrowleft:zp,curvearrowright:Up,cuvee:Vp,cuwed:qp,cwconint:Gp,cwint:Wp,cylcty:Xp,dagger:Yp,Dagger:Kp,daleth:Zp,darr:Jp,Darr:Qp,dArr:$p,dash:eg,Dashv:tg,dashv:ig,dbkarow:sg,dblac:ng,Dcaron:rg,dcaron:og,Dcy:ag,dcy:lg,ddagger:cg,ddarr:hg,DD:ug,dd:dg,DDotrahd:fg,ddotseq:pg,deg:gg,Del:mg,Delta:vg,delta:yg,demptyv:wg,dfisht:bg,Dfr:xg,dfr:Sg,dHar:Eg,dharl:Tg,dharr:_g,DiacriticalAcute:Ag,DiacriticalDot:Cg,DiacriticalDoubleAcute:Pg,DiacriticalGrave:Rg,DiacriticalTilde:Lg,diam:Dg,diamond:kg,Diamond:Ig,diamondsuit:Mg,diams:Ng,die:Fg,DifferentialD:Og,digamma:jg,disin:Hg,div:Bg,divide:zg,divideontimes:Ug,divonx:Vg,DJcy:qg,djcy:Gg,dlcorn:Wg,dlcrop:Xg,dollar:Yg,Dopf:Kg,dopf:Zg,Dot:Jg,dot:Qg,DotDot:$g,doteq:em,doteqdot:tm,DotEqual:im,dotminus:sm,dotplus:nm,dotsquare:rm,doublebarwedge:om,DoubleContourIntegral:am,DoubleDot:lm,DoubleDownArrow:cm,DoubleLeftArrow:hm,DoubleLeftRightArrow:um,DoubleLeftTee:dm,DoubleLongLeftArrow:fm,DoubleLongLeftRightArrow:pm,DoubleLongRightArrow:gm,DoubleRightArrow:mm,DoubleRightTee:vm,DoubleUpArrow:ym,DoubleUpDownArrow:wm,DoubleVerticalBar:bm,DownArrowBar:xm,downarrow:Sm,DownArrow:Em,Downarrow:Tm,DownArrowUpArrow:_m,DownBreve:Am,downdownarrows:Cm,downharpoonleft:Pm,downharpoonright:Rm,DownLeftRightVector:Lm,DownLeftTeeVector:Dm,DownLeftVectorBar:km,DownLeftVector:Im,DownRightTeeVector:Mm,DownRightVectorBar:Nm,DownRightVector:Fm,DownTeeArrow:Om,DownTee:jm,drbkarow:Hm,drcorn:Bm,drcrop:zm,Dscr:Um,dscr:Vm,DScy:qm,dscy:Gm,dsol:Wm,Dstrok:Xm,dstrok:Ym,dtdot:Km,dtri:Zm,dtrif:Jm,duarr:Qm,duhar:$m,dwangle:ev,DZcy:tv,dzcy:iv,dzigrarr:sv,Eacute:nv,eacute:rv,easter:ov,Ecaron:av,ecaron:lv,Ecirc:cv,ecirc:hv,ecir:uv,ecolon:dv,Ecy:fv,ecy:pv,eDDot:gv,Edot:mv,edot:vv,eDot:yv,ee:wv,efDot:bv,Efr:xv,efr:Sv,eg:Ev,Egrave:Tv,egrave:_v,egs:Av,egsdot:Cv,el:Pv,Element:Rv,elinters:Lv,ell:Dv,els:kv,elsdot:Iv,Emacr:Mv,emacr:Nv,empty:Fv,emptyset:Ov,EmptySmallSquare:jv,emptyv:Hv,EmptyVerySmallSquare:Bv,emsp13:zv,emsp14:Uv,emsp:Vv,ENG:qv,eng:Gv,ensp:Wv,Eogon:Xv,eogon:Yv,Eopf:Kv,eopf:Zv,epar:Jv,eparsl:Qv,eplus:$v,epsi:ey,Epsilon:ty,epsilon:iy,epsiv:sy,eqcirc:ny,eqcolon:ry,eqsim:oy,eqslantgtr:ay,eqslantless:ly,Equal:cy,equals:hy,EqualTilde:uy,equest:dy,Equilibrium:fy,equiv:py,equivDD:gy,eqvparsl:my,erarr:vy,erDot:yy,escr:wy,Escr:by,esdot:xy,Esim:Sy,esim:Ey,Eta:Ty,eta:_y,ETH:Ay,eth:Cy,Euml:Py,euml:Ry,euro:Ly,excl:Dy,exist:ky,Exists:Iy,expectation:My,exponentiale:Ny,ExponentialE:Fy,fallingdotseq:Oy,Fcy:jy,fcy:Hy,female:By,ffilig:zy,fflig:Uy,ffllig:Vy,Ffr:qy,ffr:Gy,filig:Wy,FilledSmallSquare:Xy,FilledVerySmallSquare:Yy,fjlig:Ky,flat:Zy,fllig:Jy,fltns:Qy,fnof:$y,Fopf:ew,fopf:tw,forall:iw,ForAll:sw,fork:nw,forkv:rw,Fouriertrf:ow,fpartint:aw,frac12:lw,frac13:cw,frac14:hw,frac15:uw,frac16:dw,frac18:fw,frac23:pw,frac25:gw,frac34:mw,frac35:vw,frac38:yw,frac45:ww,frac56:bw,frac58:xw,frac78:Sw,frasl:Ew,frown:Tw,fscr:_w,Fscr:Aw,gacute:Cw,Gamma:Pw,gamma:Rw,Gammad:Lw,gammad:Dw,gap:kw,Gbreve:Iw,gbreve:Mw,Gcedil:Nw,Gcirc:Fw,gcirc:Ow,Gcy:jw,gcy:Hw,Gdot:Bw,gdot:zw,ge:Uw,gE:Vw,gEl:qw,gel:Gw,geq:Ww,geqq:Xw,geqslant:Yw,gescc:Kw,ges:Zw,gesdot:Jw,gesdoto:Qw,gesdotol:$w,gesl:eb,gesles:tb,Gfr:ib,gfr:sb,gg:nb,Gg:rb,ggg:ob,gimel:ab,GJcy:lb,gjcy:cb,gla:hb,gl:ub,glE:db,glj:fb,gnap:pb,gnapprox:gb,gne:mb,gnE:vb,gneq:yb,gneqq:wb,gnsim:bb,Gopf:xb,gopf:Sb,grave:Eb,GreaterEqual:Tb,GreaterEqualLess:_b,GreaterFullEqual:Ab,GreaterGreater:Cb,GreaterLess:Pb,GreaterSlantEqual:Rb,GreaterTilde:Lb,Gscr:Db,gscr:kb,gsim:Ib,gsime:Mb,gsiml:Nb,gtcc:Fb,gtcir:Ob,gt:jb,GT:Hb,Gt:Bb,gtdot:zb,gtlPar:Ub,gtquest:Vb,gtrapprox:qb,gtrarr:Gb,gtrdot:Wb,gtreqless:Xb,gtreqqless:Yb,gtrless:Kb,gtrsim:Zb,gvertneqq:Jb,gvnE:Qb,Hacek:$b,hairsp:ex,half:tx,hamilt:ix,HARDcy:sx,hardcy:nx,harrcir:rx,harr:ox,hArr:ax,harrw:lx,Hat:cx,hbar:hx,Hcirc:ux,hcirc:dx,hearts:fx,heartsuit:px,hellip:gx,hercon:mx,hfr:vx,Hfr:yx,HilbertSpace:wx,hksearow:bx,hkswarow:xx,hoarr:Sx,homtht:Ex,hookleftarrow:Tx,hookrightarrow:_x,hopf:Ax,Hopf:Cx,horbar:Px,HorizontalLine:Rx,hscr:Lx,Hscr:Dx,hslash:kx,Hstrok:Ix,hstrok:Mx,HumpDownHump:Nx,HumpEqual:Fx,hybull:Ox,hyphen:jx,Iacute:Hx,iacute:Bx,ic:zx,Icirc:Ux,icirc:Vx,Icy:qx,icy:Gx,Idot:Wx,IEcy:Xx,iecy:Yx,iexcl:Kx,iff:Zx,ifr:Jx,Ifr:Qx,Igrave:$x,igrave:eS,ii:tS,iiiint:iS,iiint:sS,iinfin:nS,iiota:rS,IJlig:oS,ijlig:aS,Imacr:lS,imacr:cS,image:hS,ImaginaryI:uS,imagline:dS,imagpart:fS,imath:pS,Im:gS,imof:mS,imped:vS,Implies:yS,incare:wS,in:"âˆˆ",infin:bS,infintie:xS,inodot:SS,intcal:ES,int:TS,Int:_S,integers:AS,Integral:CS,intercal:PS,Intersection:RS,intlarhk:LS,intprod:DS,InvisibleComma:kS,InvisibleTimes:IS,IOcy:MS,iocy:NS,Iogon:FS,iogon:OS,Iopf:jS,iopf:HS,Iota:BS,iota:zS,iprod:US,iquest:VS,iscr:qS,Iscr:GS,isin:WS,isindot:XS,isinE:YS,isins:KS,isinsv:ZS,isinv:JS,it:QS,Itilde:$S,itilde:eE,Iukcy:tE,iukcy:iE,Iuml:sE,iuml:nE,Jcirc:rE,jcirc:oE,Jcy:aE,jcy:lE,Jfr:cE,jfr:hE,jmath:uE,Jopf:dE,jopf:fE,Jscr:pE,jscr:gE,Jsercy:mE,jsercy:vE,Jukcy:yE,jukcy:wE,Kappa:bE,kappa:xE,kappav:SE,Kcedil:EE,kcedil:TE,Kcy:_E,kcy:AE,Kfr:CE,kfr:PE,kgreen:RE,KHcy:LE,khcy:DE,KJcy:kE,kjcy:IE,Kopf:ME,kopf:NE,Kscr:FE,kscr:OE,lAarr:jE,Lacute:HE,lacute:BE,laemptyv:zE,lagran:UE,Lambda:VE,lambda:qE,lang:GE,Lang:WE,langd:XE,langle:YE,lap:KE,Laplacetrf:ZE,laquo:JE,larrb:QE,larrbfs:$E,larr:e0,Larr:t0,lArr:i0,larrfs:s0,larrhk:n0,larrlp:r0,larrpl:o0,larrsim:a0,larrtl:l0,latail:c0,lAtail:h0,lat:u0,late:d0,lates:f0,lbarr:p0,lBarr:g0,lbbrk:m0,lbrace:v0,lbrack:y0,lbrke:w0,lbrksld:b0,lbrkslu:x0,Lcaron:S0,lcaron:E0,Lcedil:T0,lcedil:_0,lceil:A0,lcub:C0,Lcy:P0,lcy:R0,ldca:L0,ldquo:D0,ldquor:k0,ldrdhar:I0,ldrushar:M0,ldsh:N0,le:F0,lE:O0,LeftAngleBracket:j0,LeftArrowBar:H0,leftarrow:B0,LeftArrow:z0,Leftarrow:U0,LeftArrowRightArrow:V0,leftarrowtail:q0,LeftCeiling:G0,LeftDoubleBracket:W0,LeftDownTeeVector:X0,LeftDownVectorBar:Y0,LeftDownVector:K0,LeftFloor:Z0,leftharpoondown:J0,leftharpoonup:Q0,leftleftarrows:$0,leftrightarrow:eT,LeftRightArrow:tT,Leftrightarrow:iT,leftrightarrows:sT,leftrightharpoons:nT,leftrightsquigarrow:rT,LeftRightVector:oT,LeftTeeArrow:aT,LeftTee:lT,LeftTeeVector:cT,leftthreetimes:hT,LeftTriangleBar:uT,LeftTriangle:dT,LeftTriangleEqual:fT,LeftUpDownVector:pT,LeftUpTeeVector:gT,LeftUpVectorBar:mT,LeftUpVector:vT,LeftVectorBar:yT,LeftVector:wT,lEg:bT,leg:xT,leq:ST,leqq:ET,leqslant:TT,lescc:_T,les:AT,lesdot:CT,lesdoto:PT,lesdotor:RT,lesg:LT,lesges:DT,lessapprox:kT,lessdot:IT,lesseqgtr:MT,lesseqqgtr:NT,LessEqualGreater:FT,LessFullEqual:OT,LessGreater:jT,lessgtr:HT,LessLess:BT,lesssim:zT,LessSlantEqual:UT,LessTilde:VT,lfisht:qT,lfloor:GT,Lfr:WT,lfr:XT,lg:YT,lgE:KT,lHar:ZT,lhard:JT,lharu:QT,lharul:$T,lhblk:e_,LJcy:t_,ljcy:i_,llarr:s_,ll:n_,Ll:r_,llcorner:o_,Lleftarrow:a_,llhard:l_,lltri:c_,Lmidot:h_,lmidot:u_,lmoustache:d_,lmoust:f_,lnap:p_,lnapprox:g_,lne:m_,lnE:v_,lneq:y_,lneqq:w_,lnsim:b_,loang:x_,loarr:S_,lobrk:E_,longleftarrow:T_,LongLeftArrow:__,Longleftarrow:A_,longleftrightarrow:C_,LongLeftRightArrow:P_,Longleftrightarrow:R_,longmapsto:L_,longrightarrow:D_,LongRightArrow:k_,Longrightarrow:I_,looparrowleft:M_,looparrowright:N_,lopar:F_,Lopf:O_,lopf:j_,loplus:H_,lotimes:B_,lowast:z_,lowbar:U_,LowerLeftArrow:V_,LowerRightArrow:q_,loz:G_,lozenge:W_,lozf:X_,lpar:Y_,lparlt:K_,lrarr:Z_,lrcorner:J_,lrhar:Q_,lrhard:$_,lrm:eA,lrtri:tA,lsaquo:iA,lscr:sA,Lscr:nA,lsh:rA,Lsh:oA,lsim:aA,lsime:lA,lsimg:cA,lsqb:hA,lsquo:uA,lsquor:dA,Lstrok:fA,lstrok:pA,ltcc:gA,ltcir:mA,lt:vA,LT:yA,Lt:wA,ltdot:bA,lthree:xA,ltimes:SA,ltlarr:EA,ltquest:TA,ltri:_A,ltrie:AA,ltrif:CA,ltrPar:PA,lurdshar:RA,luruhar:LA,lvertneqq:DA,lvnE:kA,macr:IA,male:MA,malt:NA,maltese:FA,Map:"â¤…",map:OA,mapsto:jA,mapstodown:HA,mapstoleft:BA,mapstoup:zA,marker:UA,mcomma:VA,Mcy:qA,mcy:GA,mdash:WA,mDDot:XA,measuredangle:YA,MediumSpace:KA,Mellintrf:ZA,Mfr:JA,mfr:QA,mho:$A,micro:eC,midast:tC,midcir:iC,mid:sC,middot:nC,minusb:rC,minus:oC,minusd:aC,minusdu:lC,MinusPlus:cC,mlcp:hC,mldr:uC,mnplus:dC,models:fC,Mopf:pC,mopf:gC,mp:mC,mscr:vC,Mscr:yC,mstpos:wC,Mu:bC,mu:xC,multimap:SC,mumap:EC,nabla:TC,Nacute:_C,nacute:AC,nang:CC,nap:PC,napE:RC,napid:LC,napos:DC,napprox:kC,natural:IC,naturals:MC,natur:NC,nbsp:FC,nbump:OC,nbumpe:jC,ncap:HC,Ncaron:BC,ncaron:zC,Ncedil:UC,ncedil:VC,ncong:qC,ncongdot:GC,ncup:WC,Ncy:XC,ncy:YC,ndash:KC,nearhk:ZC,nearr:JC,neArr:QC,nearrow:$C,ne:eP,nedot:tP,NegativeMediumSpace:iP,NegativeThickSpace:sP,NegativeThinSpace:nP,NegativeVeryThinSpace:rP,nequiv:oP,nesear:aP,nesim:lP,NestedGreaterGreater:cP,NestedLessLess:hP,NewLine:uP,nexist:dP,nexists:fP,Nfr:pP,nfr:gP,ngE:mP,nge:vP,ngeq:yP,ngeqq:wP,ngeqslant:bP,nges:xP,nGg:SP,ngsim:EP,nGt:TP,ngt:_P,ngtr:AP,nGtv:CP,nharr:PP,nhArr:RP,nhpar:LP,ni:DP,nis:kP,nisd:IP,niv:MP,NJcy:NP,njcy:FP,nlarr:OP,nlArr:jP,nldr:HP,nlE:BP,nle:zP,nleftarrow:UP,nLeftarrow:VP,nleftrightarrow:qP,nLeftrightarrow:GP,nleq:WP,nleqq:XP,nleqslant:YP,nles:KP,nless:ZP,nLl:JP,nlsim:QP,nLt:$P,nlt:eR,nltri:tR,nltrie:iR,nLtv:sR,nmid:nR,NoBreak:rR,NonBreakingSpace:oR,nopf:aR,Nopf:lR,Not:cR,not:hR,NotCongruent:uR,NotCupCap:dR,NotDoubleVerticalBar:fR,NotElement:pR,NotEqual:gR,NotEqualTilde:mR,NotExists:vR,NotGreater:yR,NotGreaterEqual:wR,NotGreaterFullEqual:bR,NotGreaterGreater:xR,NotGreaterLess:SR,NotGreaterSlantEqual:ER,NotGreaterTilde:TR,NotHumpDownHump:_R,NotHumpEqual:AR,notin:CR,notindot:PR,notinE:RR,notinva:LR,notinvb:DR,notinvc:kR,NotLeftTriangleBar:IR,NotLeftTriangle:MR,NotLeftTriangleEqual:NR,NotLess:FR,NotLessEqual:OR,NotLessGreater:jR,NotLessLess:HR,NotLessSlantEqual:BR,NotLessTilde:zR,NotNestedGreaterGreater:UR,NotNestedLessLess:VR,notni:qR,notniva:GR,notnivb:WR,notnivc:XR,NotPrecedes:YR,NotPrecedesEqual:KR,NotPrecedesSlantEqual:ZR,NotReverseElement:JR,NotRightTriangleBar:QR,NotRightTriangle:$R,NotRightTriangleEqual:e1,NotSquareSubset:t1,NotSquareSubsetEqual:i1,NotSquareSuperset:s1,NotSquareSupersetEqual:n1,NotSubset:r1,NotSubsetEqual:o1,NotSucceeds:a1,NotSucceedsEqual:l1,NotSucceedsSlantEqual:c1,NotSucceedsTilde:h1,NotSuperset:u1,NotSupersetEqual:d1,NotTilde:f1,NotTildeEqual:p1,NotTildeFullEqual:g1,NotTildeTilde:m1,NotVerticalBar:v1,nparallel:y1,npar:w1,nparsl:b1,npart:x1,npolint:S1,npr:E1,nprcue:T1,nprec:_1,npreceq:A1,npre:C1,nrarrc:P1,nrarr:R1,nrArr:L1,nrarrw:D1,nrightarrow:k1,nRightarrow:I1,nrtri:M1,nrtrie:N1,nsc:F1,nsccue:O1,nsce:j1,Nscr:H1,nscr:B1,nshortmid:z1,nshortparallel:U1,nsim:V1,nsime:q1,nsimeq:G1,nsmid:W1,nspar:X1,nsqsube:Y1,nsqsupe:K1,nsub:Z1,nsubE:J1,nsube:Q1,nsubset:$1,nsubseteq:eL,nsubseteqq:tL,nsucc:iL,nsucceq:sL,nsup:nL,nsupE:rL,nsupe:oL,nsupset:aL,nsupseteq:lL,nsupseteqq:cL,ntgl:hL,Ntilde:uL,ntilde:dL,ntlg:fL,ntriangleleft:pL,ntrianglelefteq:gL,ntriangleright:mL,ntrianglerighteq:vL,Nu:yL,nu:wL,num:bL,numero:xL,numsp:SL,nvap:EL,nvdash:TL,nvDash:_L,nVdash:AL,nVDash:CL,nvge:PL,nvgt:RL,nvHarr:LL,nvinfin:DL,nvlArr:kL,nvle:IL,nvlt:ML,nvltrie:NL,nvrArr:FL,nvrtrie:OL,nvsim:jL,nwarhk:HL,nwarr:BL,nwArr:zL,nwarrow:UL,nwnear:VL,Oacute:qL,oacute:GL,oast:WL,Ocirc:XL,ocirc:YL,ocir:KL,Ocy:ZL,ocy:JL,odash:QL,Odblac:$L,odblac:eD,odiv:tD,odot:iD,odsold:sD,OElig:nD,oelig:rD,ofcir:oD,Ofr:aD,ofr:lD,ogon:cD,Ograve:hD,ograve:uD,ogt:dD,ohbar:fD,ohm:pD,oint:gD,olarr:mD,olcir:vD,olcross:yD,oline:wD,olt:bD,Omacr:xD,omacr:SD,Omega:ED,omega:TD,Omicron:_D,omicron:AD,omid:CD,ominus:PD,Oopf:RD,oopf:LD,opar:DD,OpenCurlyDoubleQuote:kD,OpenCurlyQuote:ID,operp:MD,oplus:ND,orarr:FD,Or:OD,or:jD,ord:HD,order:BD,orderof:zD,ordf:UD,ordm:VD,origof:qD,oror:GD,orslope:WD,orv:XD,oS:YD,Oscr:KD,oscr:ZD,Oslash:JD,oslash:QD,osol:$D,Otilde:ek,otilde:tk,otimesas:ik,Otimes:sk,otimes:nk,Ouml:rk,ouml:ok,ovbar:ak,OverBar:lk,OverBrace:ck,OverBracket:hk,OverParenthesis:uk,para:dk,parallel:fk,par:pk,parsim:gk,parsl:mk,part:vk,PartialD:yk,Pcy:wk,pcy:bk,percnt:xk,period:Sk,permil:Ek,perp:Tk,pertenk:_k,Pfr:Ak,pfr:Ck,Phi:Pk,phi:Rk,phiv:Lk,phmmat:Dk,phone:kk,Pi:Ik,pi:Mk,pitchfork:Nk,piv:Fk,planck:Ok,planckh:jk,plankv:Hk,plusacir:Bk,plusb:zk,pluscir:Uk,plus:Vk,plusdo:qk,plusdu:Gk,pluse:Wk,PlusMinus:Xk,plusmn:Yk,plussim:Kk,plustwo:Zk,pm:Jk,Poincareplane:Qk,pointint:$k,popf:eI,Popf:tI,pound:iI,prap:sI,Pr:nI,pr:rI,prcue:oI,precapprox:aI,prec:lI,preccurlyeq:cI,Precedes:hI,PrecedesEqual:uI,PrecedesSlantEqual:dI,PrecedesTilde:fI,preceq:pI,precnapprox:gI,precneqq:mI,precnsim:vI,pre:yI,prE:wI,precsim:bI,prime:xI,Prime:SI,primes:EI,prnap:TI,prnE:_I,prnsim:AI,prod:CI,Product:PI,profalar:RI,profline:LI,profsurf:DI,prop:kI,Proportional:II,Proportion:MI,propto:NI,prsim:FI,prurel:OI,Pscr:jI,pscr:HI,Psi:BI,psi:zI,puncsp:UI,Qfr:VI,qfr:qI,qint:GI,qopf:WI,Qopf:XI,qprime:YI,Qscr:KI,qscr:ZI,quaternions:JI,quatint:QI,quest:$I,questeq:eM,quot:tM,QUOT:iM,rAarr:sM,race:nM,Racute:rM,racute:oM,radic:aM,raemptyv:lM,rang:cM,Rang:hM,rangd:uM,range:dM,rangle:fM,raquo:pM,rarrap:gM,rarrb:mM,rarrbfs:vM,rarrc:yM,rarr:wM,Rarr:bM,rArr:xM,rarrfs:SM,rarrhk:EM,rarrlp:TM,rarrpl:_M,rarrsim:AM,Rarrtl:CM,rarrtl:PM,rarrw:RM,ratail:LM,rAtail:DM,ratio:kM,rationals:IM,rbarr:MM,rBarr:NM,RBarr:FM,rbbrk:OM,rbrace:jM,rbrack:HM,rbrke:BM,rbrksld:zM,rbrkslu:UM,Rcaron:VM,rcaron:qM,Rcedil:GM,rcedil:WM,rceil:XM,rcub:YM,Rcy:KM,rcy:ZM,rdca:JM,rdldhar:QM,rdquo:$M,rdquor:eN,rdsh:tN,real:iN,realine:sN,realpart:nN,reals:rN,Re:oN,rect:aN,reg:lN,REG:cN,ReverseElement:hN,ReverseEquilibrium:uN,ReverseUpEquilibrium:dN,rfisht:fN,rfloor:pN,rfr:gN,Rfr:mN,rHar:vN,rhard:yN,rharu:wN,rharul:bN,Rho:xN,rho:SN,rhov:EN,RightAngleBracket:TN,RightArrowBar:_N,rightarrow:AN,RightArrow:CN,Rightarrow:PN,RightArrowLeftArrow:RN,rightarrowtail:LN,RightCeiling:DN,RightDoubleBracket:kN,RightDownTeeVector:IN,RightDownVectorBar:MN,RightDownVector:NN,RightFloor:FN,rightharpoondown:ON,rightharpoonup:jN,rightleftarrows:HN,rightleftharpoons:BN,rightrightarrows:zN,rightsquigarrow:UN,RightTeeArrow:VN,RightTee:qN,RightTeeVector:GN,rightthreetimes:WN,RightTriangleBar:XN,RightTriangle:YN,RightTriangleEqual:KN,RightUpDownVector:ZN,RightUpTeeVector:JN,RightUpVectorBar:QN,RightUpVector:$N,RightVectorBar:eF,RightVector:tF,ring:iF,risingdotseq:sF,rlarr:nF,rlhar:rF,rlm:oF,rmoustache:aF,rmoust:lF,rnmid:cF,roang:hF,roarr:uF,robrk:dF,ropar:fF,ropf:pF,Ropf:gF,roplus:mF,rotimes:vF,RoundImplies:yF,rpar:wF,rpargt:bF,rppolint:xF,rrarr:SF,Rrightarrow:EF,rsaquo:TF,rscr:_F,Rscr:AF,rsh:CF,Rsh:PF,rsqb:RF,rsquo:LF,rsquor:DF,rthree:kF,rtimes:IF,rtri:MF,rtrie:NF,rtrif:FF,rtriltri:OF,RuleDelayed:jF,ruluhar:HF,rx:BF,Sacute:zF,sacute:UF,sbquo:VF,scap:qF,Scaron:GF,scaron:WF,Sc:XF,sc:YF,sccue:KF,sce:ZF,scE:JF,Scedil:QF,scedil:$F,Scirc:eO,scirc:tO,scnap:iO,scnE:sO,scnsim:nO,scpolint:rO,scsim:oO,Scy:aO,scy:lO,sdotb:cO,sdot:hO,sdote:uO,searhk:dO,searr:fO,seArr:pO,searrow:gO,sect:mO,semi:vO,seswar:yO,setminus:wO,setmn:bO,sext:xO,Sfr:SO,sfr:EO,sfrown:TO,sharp:_O,SHCHcy:AO,shchcy:CO,SHcy:PO,shcy:RO,ShortDownArrow:LO,ShortLeftArrow:DO,shortmid:kO,shortparallel:IO,ShortRightArrow:MO,ShortUpArrow:NO,shy:FO,Sigma:OO,sigma:jO,sigmaf:HO,sigmav:BO,sim:zO,simdot:UO,sime:VO,simeq:qO,simg:GO,simgE:WO,siml:XO,simlE:YO,simne:KO,simplus:ZO,simrarr:JO,slarr:QO,SmallCircle:$O,smallsetminus:ej,smashp:tj,smeparsl:ij,smid:sj,smile:nj,smt:rj,smte:oj,smtes:aj,SOFTcy:lj,softcy:cj,solbar:hj,solb:uj,sol:dj,Sopf:fj,sopf:pj,spades:gj,spadesuit:mj,spar:vj,sqcap:yj,sqcaps:wj,sqcup:bj,sqcups:xj,Sqrt:Sj,sqsub:Ej,sqsube:Tj,sqsubset:_j,sqsubseteq:Aj,sqsup:Cj,sqsupe:Pj,sqsupset:Rj,sqsupseteq:Lj,square:Dj,Square:kj,SquareIntersection:Ij,SquareSubset:Mj,SquareSubsetEqual:Nj,SquareSuperset:Fj,SquareSupersetEqual:Oj,SquareUnion:jj,squarf:Hj,squ:Bj,squf:zj,srarr:Uj,Sscr:Vj,sscr:qj,ssetmn:Gj,ssmile:Wj,sstarf:Xj,Star:Yj,star:Kj,starf:Zj,straightepsilon:Jj,straightphi:Qj,strns:$j,sub:eH,Sub:tH,subdot:iH,subE:sH,sube:nH,subedot:rH,submult:oH,subnE:aH,subne:lH,subplus:cH,subrarr:hH,subset:uH,Subset:dH,subseteq:fH,subseteqq:pH,SubsetEqual:gH,subsetneq:mH,subsetneqq:vH,subsim:yH,subsub:wH,subsup:bH,succapprox:xH,succ:SH,succcurlyeq:EH,Succeeds:TH,SucceedsEqual:_H,SucceedsSlantEqual:AH,SucceedsTilde:CH,succeq:PH,succnapprox:RH,succneqq:LH,succnsim:DH,succsim:kH,SuchThat:IH,sum:MH,Sum:NH,sung:FH,sup1:OH,sup2:jH,sup3:HH,sup:BH,Sup:zH,supdot:UH,supdsub:VH,supE:qH,supe:GH,supedot:WH,Superset:XH,SupersetEqual:YH,suphsol:KH,suphsub:ZH,suplarr:JH,supmult:QH,supnE:$H,supne:eB,supplus:tB,supset:iB,Supset:sB,supseteq:nB,supseteqq:rB,supsetneq:oB,supsetneqq:aB,supsim:lB,supsub:cB,supsup:hB,swarhk:uB,swarr:dB,swArr:fB,swarrow:pB,swnwar:gB,szlig:mB,Tab:vB,target:yB,Tau:wB,tau:bB,tbrk:xB,Tcaron:SB,tcaron:EB,Tcedil:TB,tcedil:_B,Tcy:AB,tcy:CB,tdot:PB,telrec:RB,Tfr:LB,tfr:DB,there4:kB,therefore:IB,Therefore:MB,Theta:NB,theta:FB,thetasym:OB,thetav:jB,thickapprox:HB,thicksim:BB,ThickSpace:zB,ThinSpace:UB,thinsp:VB,thkap:qB,thksim:GB,THORN:WB,thorn:XB,tilde:YB,Tilde:KB,TildeEqual:ZB,TildeFullEqual:JB,TildeTilde:QB,timesbar:$B,timesb:e2,times:t2,timesd:i2,tint:s2,toea:n2,topbot:r2,topcir:o2,top:a2,Topf:l2,topf:c2,topfork:h2,tosa:u2,tprime:d2,trade:f2,TRADE:p2,triangle:g2,triangledown:m2,triangleleft:v2,trianglelefteq:y2,triangleq:w2,triangleright:b2,trianglerighteq:x2,tridot:S2,trie:E2,triminus:T2,TripleDot:_2,triplus:A2,trisb:C2,tritime:P2,trpezium:R2,Tscr:L2,tscr:D2,TScy:k2,tscy:I2,TSHcy:M2,tshcy:N2,Tstrok:F2,tstrok:O2,twixt:j2,twoheadleftarrow:H2,twoheadrightarrow:B2,Uacute:z2,uacute:U2,uarr:V2,Uarr:q2,uArr:G2,Uarrocir:W2,Ubrcy:X2,ubrcy:Y2,Ubreve:K2,ubreve:Z2,Ucirc:J2,ucirc:Q2,Ucy:$2,ucy:ez,udarr:tz,Udblac:iz,udblac:sz,udhar:nz,ufisht:rz,Ufr:oz,ufr:az,Ugrave:lz,ugrave:cz,uHar:hz,uharl:uz,uharr:dz,uhblk:fz,ulcorn:pz,ulcorner:gz,ulcrop:mz,ultri:vz,Umacr:yz,umacr:wz,uml:bz,UnderBar:xz,UnderBrace:Sz,UnderBracket:Ez,UnderParenthesis:Tz,Union:_z,UnionPlus:Az,Uogon:Cz,uogon:Pz,Uopf:Rz,uopf:Lz,UpArrowBar:Dz,uparrow:kz,UpArrow:Iz,Uparrow:Mz,UpArrowDownArrow:Nz,updownarrow:Fz,UpDownArrow:Oz,Updownarrow:jz,UpEquilibrium:Hz,upharpoonleft:Bz,upharpoonright:zz,uplus:Uz,UpperLeftArrow:Vz,UpperRightArrow:qz,upsi:Gz,Upsi:Wz,upsih:Xz,Upsilon:Yz,upsilon:Kz,UpTeeArrow:Zz,UpTee:Jz,upuparrows:Qz,urcorn:$z,urcorner:eU,urcrop:tU,Uring:iU,uring:sU,urtri:nU,Uscr:rU,uscr:oU,utdot:aU,Utilde:lU,utilde:cU,utri:hU,utrif:uU,uuarr:dU,Uuml:fU,uuml:pU,uwangle:gU,vangrt:mU,varepsilon:vU,varkappa:yU,varnothing:wU,varphi:bU,varpi:xU,varpropto:SU,varr:EU,vArr:TU,varrho:_U,varsigma:AU,varsubsetneq:CU,varsubsetneqq:PU,varsupsetneq:RU,varsupsetneqq:LU,vartheta:DU,vartriangleleft:kU,vartriangleright:IU,vBar:MU,Vbar:NU,vBarv:FU,Vcy:OU,vcy:jU,vdash:HU,vDash:BU,Vdash:zU,VDash:UU,Vdashl:VU,veebar:qU,vee:GU,Vee:WU,veeeq:XU,vellip:YU,verbar:KU,Verbar:ZU,vert:JU,Vert:QU,VerticalBar:$U,VerticalLine:eV,VerticalSeparator:tV,VerticalTilde:iV,VeryThinSpace:sV,Vfr:nV,vfr:rV,vltri:oV,vnsub:aV,vnsup:lV,Vopf:cV,vopf:hV,vprop:uV,vrtri:dV,Vscr:fV,vscr:pV,vsubnE:gV,vsubne:mV,vsupnE:vV,vsupne:yV,Vvdash:wV,vzigzag:bV,Wcirc:xV,wcirc:SV,wedbar:EV,wedge:TV,Wedge:_V,wedgeq:AV,weierp:CV,Wfr:PV,wfr:RV,Wopf:LV,wopf:DV,wp:kV,wr:IV,wreath:MV,Wscr:NV,wscr:FV,xcap:OV,xcirc:jV,xcup:HV,xdtri:BV,Xfr:zV,xfr:UV,xharr:VV,xhArr:qV,Xi:GV,xi:WV,xlarr:XV,xlArr:YV,xmap:KV,xnis:ZV,xodot:JV,Xopf:QV,xopf:$V,xoplus:eq,xotime:tq,xrarr:iq,xrArr:sq,Xscr:nq,xscr:rq,xsqcup:oq,xuplus:aq,xutri:lq,xvee:cq,xwedge:hq,Yacute:uq,yacute:dq,YAcy:fq,yacy:pq,Ycirc:gq,ycirc:mq,Ycy:vq,ycy:yq,yen:wq,Yfr:bq,yfr:xq,YIcy:Sq,yicy:Eq,Yopf:Tq,yopf:_q,Yscr:Aq,yscr:Cq,YUcy:Pq,yucy:Rq,yuml:Lq,Yuml:Dq,Zacute:kq,zacute:Iq,Zcaron:Mq,zcaron:Nq,Zcy:Fq,zcy:Oq,Zdot:jq,zdot:Hq,zeetrf:Bq,ZeroWidthSpace:zq,Zeta:Uq,zeta:Vq,zfr:qq,Zfr:Gq,ZHcy:Wq,zhcy:Xq,zigrarr:Yq,zopf:Kq,Zopf:Zq,Zscr:Jq,zscr:Qq,zwj:$q,zwnj:eG},tG="Ã",iG="Ã¡",sG="Ã‚",nG="Ã¢",rG="Â´",oG="Ã†",aG="Ã¦",lG="Ã€",cG="Ã ",hG="&",uG="&",dG="Ã…",fG="Ã¥",pG="Ãƒ",gG="Ã£",mG="Ã„",vG="Ã¤",yG="Â¦",wG="Ã‡",bG="Ã§",xG="Â¸",SG="Â¢",EG="Â©",TG="Â©",_G="Â¤",AG="Â°",CG="Ã·",PG="Ã‰",RG="Ã©",LG="ÃŠ",DG="Ãª",kG="Ãˆ",IG="Ã¨",MG="Ã",NG="Ã°",FG="Ã‹",OG="Ã«",jG="Â½",HG="Â¼",BG="Â¾",zG=">",UG=">",VG="Ã",qG="Ã­",GG="Ã",WG="Ã®",XG="Â¡",YG="ÃŒ",KG="Ã¬",ZG="Â¿",JG="Ã",QG="Ã¯",$G="Â«",eW="<",tW="<",iW="Â¯",sW="Âµ",nW="Â·",rW="Â ",oW="Â¬",aW="Ã‘",lW="Ã±",cW="Ã“",hW="Ã³",uW="Ã”",dW="Ã´",fW="Ã’",pW="Ã²",gW="Âª",mW="Âº",vW="Ã˜",yW="Ã¸",wW="Ã•",bW="Ãµ",xW="Ã–",SW="Ã¶",EW="Â¶",TW="Â±",_W="Â£",AW='"',CW='"',PW="Â»",RW="Â®",LW="Â®",DW="Â§",kW="Â­",IW="Â¹",MW="Â²",NW="Â³",FW="ÃŸ",OW="Ã",jW="Ã¾",HW="Ã—",BW="Ãš",zW="Ãº",UW="Ã›",VW="Ã»",qW="Ã™",GW="Ã¹",WW="Â¨",XW="Ãœ",YW="Ã¼",KW="Ã",ZW="Ã½",JW="Â¥",QW="Ã¿",$W={Aacute:tG,aacute:iG,Acirc:sG,acirc:nG,acute:rG,AElig:oG,aelig:aG,Agrave:lG,agrave:cG,amp:hG,AMP:uG,Aring:dG,aring:fG,Atilde:pG,atilde:gG,Auml:mG,auml:vG,brvbar:yG,Ccedil:wG,ccedil:bG,cedil:xG,cent:SG,copy:EG,COPY:TG,curren:_G,deg:AG,divide:CG,Eacute:PG,eacute:RG,Ecirc:LG,ecirc:DG,Egrave:kG,egrave:IG,ETH:MG,eth:NG,Euml:FG,euml:OG,frac12:jG,frac14:HG,frac34:BG,gt:zG,GT:UG,Iacute:VG,iacute:qG,Icirc:GG,icirc:WG,iexcl:XG,Igrave:YG,igrave:KG,iquest:ZG,Iuml:JG,iuml:QG,laquo:$G,lt:eW,LT:tW,macr:iW,micro:sW,middot:nW,nbsp:rW,not:oW,Ntilde:aW,ntilde:lW,Oacute:cW,oacute:hW,Ocirc:uW,ocirc:dW,Ograve:fW,ograve:pW,ordf:gW,ordm:mW,Oslash:vW,oslash:yW,Otilde:wW,otilde:bW,Ouml:xW,ouml:SW,para:EW,plusmn:TW,pound:_W,quot:AW,QUOT:CW,raquo:PW,reg:RW,REG:LW,sect:DW,shy:kW,sup1:IW,sup2:MW,sup3:NW,szlig:FW,THORN:OW,thorn:jW,times:HW,Uacute:BW,uacute:zW,Ucirc:UW,ucirc:VW,Ugrave:qW,ugrave:GW,uml:WW,Uuml:XW,uuml:YW,Yacute:KW,yacute:ZW,yen:JW,yuml:QW},e3="&",t3="'",i3=">",s3="<",n3='"',Nr={amp:e3,apos:t3,gt:i3,lt:s3,quot:n3};var qt={};const r3={0:65533,128:8364,130:8218,131:402,132:8222,133:8230,134:8224,135:8225,136:710,137:8240,138:352,139:8249,140:338,142:381,145:8216,146:8217,147:8220,148:8221,149:8226,150:8211,151:8212,152:732,153:8482,154:353,155:8250,156:339,158:382,159:376};var Dn;function o3(){if(Dn)return qt;Dn=1;var u=qt&&qt.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(qt,"__esModule",{value:!0});var t=u(r3),e=String.fromCodePoint||function(s){var n="";return s>65535&&(s-=65536,n+=String.fromCharCode(s>>>10&1023|55296),s=56320|s&1023),n+=String.fromCharCode(s),n};function i(s){return s>=55296&&s<=57343||s>1114111?"ï¿½":(s in t.default&&(s=t.default[s]),e(s))}return qt.default=i,qt}var kn;function In(){if(kn)return dt;kn=1;var u=dt&&dt.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(dt,"__esModule",{value:!0}),dt.decodeHTML=dt.decodeHTMLStrict=dt.decodeXML=void 0;var t=u(Mr),e=u($W),i=u(Nr),s=u(o3()),n=/&(?:[a-zA-Z0-9]+|#[xX][\da-fA-F]+|#\d+);/g;dt.decodeXML=a(i.default),dt.decodeHTMLStrict=a(t.default);function a(l){var c=o(l);return function(h){return String(h).replace(n,c)}}var r=function(l,c){return l<c?1:-1};dt.decodeHTML=(function(){for(var l=Object.keys(e.default).sort(r),c=Object.keys(t.default).sort(r),h=0,d=0;h<c.length;h++)l[d]===c[h]?(c[h]+=";?",d++):c[h]+=";";var f=new RegExp("&(?:"+c.join("|")+"|#[xX][\\da-fA-F]+;?|#\\d+;?)","g"),p=o(t.default);function m(v){return v.substr(-1)!==";"&&(v+=";"),p(v)}return function(v){return String(v).replace(f,m)}})();function o(l){return function(h){if(h.charAt(1)==="#"){var d=h.charAt(2);return d==="X"||d==="x"?s.default(parseInt(h.substr(3),16)):s.default(parseInt(h.substr(2),10))}return l[h.slice(1,-1)]||h}}return dt}var Qe={},Mn;function Nn(){if(Mn)return Qe;Mn=1;var u=Qe&&Qe.__importDefault||function(w){return w&&w.__esModule?w:{default:w}};Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.escapeUTF8=Qe.escape=Qe.encodeNonAsciiHTML=Qe.encodeHTML=Qe.encodeXML=void 0;var t=u(Nr),e=r(t.default),i=o(e);Qe.encodeXML=v(e);var s=u(Mr),n=r(s.default),a=o(n);Qe.encodeHTML=d(n,a),Qe.encodeNonAsciiHTML=v(n);function r(w){return Object.keys(w).sort().reduce(function(S,_){return S[w[_]]="&"+_+";",S},{})}function o(w){for(var S=[],_=[],A=0,P=Object.keys(w);A<P.length;A++){var k=P[A];k.length===1?S.push("\\"+k):_.push(k)}S.sort();for(var N=0;N<S.length-1;N++){for(var O=N;O<S.length-1&&S[O].charCodeAt(1)+1===S[O+1].charCodeAt(1);)O+=1;var j=1+O-N;j<3||S.splice(N,j,S[N]+"-"+S[O])}return _.unshift("["+S.join("")+"]"),new RegExp(_.join("|"),"g")}var l=/(?:[\x80-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/g,c=String.prototype.codePointAt!=null?function(w){return w.codePointAt(0)}:function(w){return(w.charCodeAt(0)-55296)*1024+w.charCodeAt(1)-56320+65536};function h(w){return"&#x"+(w.length>1?c(w):w.charCodeAt(0)).toString(16).toUpperCase()+";"}function d(w,S){return function(_){return _.replace(S,function(A){return w[A]}).replace(l,h)}}var f=new RegExp(i.source+"|"+l.source,"g");function p(w){return w.replace(f,h)}Qe.escape=p;function m(w){return w.replace(i,h)}Qe.escapeUTF8=m;function v(w){return function(S){return S.replace(f,function(_){return w[_]||h(_)})}}return Qe}var Fn;function a3(){return Fn||(Fn=1,(function(u){Object.defineProperty(u,"__esModule",{value:!0}),u.decodeXMLStrict=u.decodeHTML5Strict=u.decodeHTML4Strict=u.decodeHTML5=u.decodeHTML4=u.decodeHTMLStrict=u.decodeHTML=u.decodeXML=u.encodeHTML5=u.encodeHTML4=u.escapeUTF8=u.escape=u.encodeNonAsciiHTML=u.encodeHTML=u.encodeXML=u.encode=u.decodeStrict=u.decode=void 0;var t=In(),e=Nn();function i(o,l){return(!l||l<=0?t.decodeXML:t.decodeHTML)(o)}u.decode=i;function s(o,l){return(!l||l<=0?t.decodeXML:t.decodeHTMLStrict)(o)}u.decodeStrict=s;function n(o,l){return(!l||l<=0?e.encodeXML:e.encodeHTML)(o)}u.encode=n;var a=Nn();Object.defineProperty(u,"encodeXML",{enumerable:!0,get:function(){return a.encodeXML}}),Object.defineProperty(u,"encodeHTML",{enumerable:!0,get:function(){return a.encodeHTML}}),Object.defineProperty(u,"encodeNonAsciiHTML",{enumerable:!0,get:function(){return a.encodeNonAsciiHTML}}),Object.defineProperty(u,"escape",{enumerable:!0,get:function(){return a.escape}}),Object.defineProperty(u,"escapeUTF8",{enumerable:!0,get:function(){return a.escapeUTF8}}),Object.defineProperty(u,"encodeHTML4",{enumerable:!0,get:function(){return a.encodeHTML}}),Object.defineProperty(u,"encodeHTML5",{enumerable:!0,get:function(){return a.encodeHTML}});var r=In();Object.defineProperty(u,"decodeXML",{enumerable:!0,get:function(){return r.decodeXML}}),Object.defineProperty(u,"decodeHTML",{enumerable:!0,get:function(){return r.decodeHTML}}),Object.defineProperty(u,"decodeHTMLStrict",{enumerable:!0,get:function(){return r.decodeHTMLStrict}}),Object.defineProperty(u,"decodeHTML4",{enumerable:!0,get:function(){return r.decodeHTML}}),Object.defineProperty(u,"decodeHTML5",{enumerable:!0,get:function(){return r.decodeHTML}}),Object.defineProperty(u,"decodeHTML4Strict",{enumerable:!0,get:function(){return r.decodeHTMLStrict}}),Object.defineProperty(u,"decodeHTML5Strict",{enumerable:!0,get:function(){return r.decodeHTMLStrict}}),Object.defineProperty(u,"decodeXMLStrict",{enumerable:!0,get:function(){return r.decodeXML}})})(us)),us}var ds,On;function l3(){if(On)return ds;On=1;function u(R,D){if(!(R instanceof D))throw new TypeError("Cannot call a class as a function")}function t(R,D){for(var I=0;I<D.length;I++){var W=D[I];W.enumerable=W.enumerable||!1,W.configurable=!0,"value"in W&&(W.writable=!0),Object.defineProperty(R,W.key,W)}}function e(R,D,I){return D&&t(R.prototype,D),R}function i(R,D){var I=typeof Symbol<"u"&&R[Symbol.iterator]||R["@@iterator"];if(!I){if(Array.isArray(R)||(I=s(R))||D){I&&(R=I);var W=0,z=function(){};return{s:z,n:function(){return W>=R.length?{done:!0}:{done:!1,value:R[W++]}},e:function(re){throw re},f:z}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var B=!0,H=!1,$;return{s:function(){I=I.call(R)},n:function(){var re=I.next();return B=re.done,re},e:function(re){H=!0,$=re},f:function(){try{!B&&I.return!=null&&I.return()}finally{if(H)throw $}}}}function s(R,D){if(R){if(typeof R=="string")return n(R,D);var I=Object.prototype.toString.call(R).slice(8,-1);if(I==="Object"&&R.constructor&&(I=R.constructor.name),I==="Map"||I==="Set")return Array.from(R);if(I==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(I))return n(R,D)}}function n(R,D){(D==null||D>R.length)&&(D=R.length);for(var I=0,W=new Array(D);I<D;I++)W[I]=R[I];return W}var a=a3(),r={fg:"#FFF",bg:"#000",newline:!1,escapeXML:!1,stream:!1,colors:o()};function o(){var R={0:"#000",1:"#A00",2:"#0A0",3:"#A50",4:"#00A",5:"#A0A",6:"#0AA",7:"#AAA",8:"#555",9:"#F55",10:"#5F5",11:"#FF5",12:"#55F",13:"#F5F",14:"#5FF",15:"#FFF"};return v(0,5).forEach(function(D){v(0,5).forEach(function(I){v(0,5).forEach(function(W){return l(D,I,W,R)})})}),v(0,23).forEach(function(D){var I=D+232,W=c(D*10+8);R[I]="#"+W+W+W}),R}function l(R,D,I,W){var z=16+R*36+D*6+I,B=R>0?R*40+55:0,H=D>0?D*40+55:0,$=I>0?I*40+55:0;W[z]=h([B,H,$])}function c(R){for(var D=R.toString(16);D.length<2;)D="0"+D;return D}function h(R){var D=[],I=i(R),W;try{for(I.s();!(W=I.n()).done;){var z=W.value;D.push(c(z))}}catch(B){I.e(B)}finally{I.f()}return"#"+D.join("")}function d(R,D,I,W){var z;return D==="text"?z=_(I,W):D==="display"?z=p(R,I,W):D==="xterm256Foreground"?z=k(R,W.colors[I]):D==="xterm256Background"?z=N(R,W.colors[I]):D==="rgb"&&(z=f(R,I)),z}function f(R,D){D=D.substring(2).slice(0,-1);var I=+D.substr(0,2),W=D.substring(5).split(";"),z=W.map(function(B){return("0"+Number(B).toString(16)).substr(-2)}).join("");return P(R,(I===38?"color:#":"background-color:#")+z)}function p(R,D,I){D=parseInt(D,10);var W={"-1":function(){return"<br/>"},0:function(){return R.length&&m(R)},1:function(){return A(R,"b")},3:function(){return A(R,"i")},4:function(){return A(R,"u")},8:function(){return P(R,"display:none")},9:function(){return A(R,"strike")},22:function(){return P(R,"font-weight:normal;text-decoration:none;font-style:normal")},23:function(){return O(R,"i")},24:function(){return O(R,"u")},39:function(){return k(R,I.fg)},49:function(){return N(R,I.bg)},53:function(){return P(R,"text-decoration:overline")}},z;return W[D]?z=W[D]():4<D&&D<7?z=A(R,"blink"):29<D&&D<38?z=k(R,I.colors[D-30]):39<D&&D<48?z=N(R,I.colors[D-40]):89<D&&D<98?z=k(R,I.colors[8+(D-90)]):99<D&&D<108&&(z=N(R,I.colors[8+(D-100)])),z}function m(R){var D=R.slice(0);return R.length=0,D.reverse().map(function(I){return"</"+I+">"}).join("")}function v(R,D){for(var I=[],W=R;W<=D;W++)I.push(W);return I}function w(R){return function(D){return(R===null||D.category!==R)&&R!=="all"}}function S(R){R=parseInt(R,10);var D=null;return R===0?D="all":R===1?D="bold":2<R&&R<5?D="underline":4<R&&R<7?D="blink":R===8?D="hide":R===9?D="strike":29<R&&R<38||R===39||89<R&&R<98?D="foreground-color":(39<R&&R<48||R===49||99<R&&R<108)&&(D="background-color"),D}function _(R,D){return D.escapeXML?a.encodeXML(R):R}function A(R,D,I){return I||(I=""),R.push(D),"<".concat(D).concat(I?' style="'.concat(I,'"'):"",">")}function P(R,D){return A(R,"span",D)}function k(R,D){return A(R,"span","color:"+D)}function N(R,D){return A(R,"span","background-color:"+D)}function O(R,D){var I;if(R.slice(-1)[0]===D&&(I=R.pop()),I)return"</"+D+">"}function j(R,D,I){var W=!1,z=3;function B(){return""}function H(Y,le){return I("xterm256Foreground",le),""}function $(Y,le){return I("xterm256Background",le),""}function J(Y){return D.newline?I("display",-1):I("text",Y),""}function re(Y,le){W=!0,le.trim().length===0&&(le="0"),le=le.trimRight(";").split(";");var ve=i(le),be;try{for(ve.s();!(be=ve.n()).done;){var y=be.value;I("display",y)}}catch(T){ve.e(T)}finally{ve.f()}return""}function me(Y){return I("text",Y),""}function Q(Y){return I("rgb",Y),""}var Te=[{pattern:/^\x08+/,sub:B},{pattern:/^\x1b\[[012]?K/,sub:B},{pattern:/^\x1b\[\(B/,sub:B},{pattern:/^\x1b\[[34]8;2;\d+;\d+;\d+m/,sub:Q},{pattern:/^\x1b\[38;5;(\d+)m/,sub:H},{pattern:/^\x1b\[48;5;(\d+)m/,sub:$},{pattern:/^\n/,sub:J},{pattern:/^\r+\n/,sub:J},{pattern:/^\r/,sub:J},{pattern:/^\x1b\[((?:\d{1,3};?)+|)m/,sub:re},{pattern:/^\x1b\[\d?J/,sub:B},{pattern:/^\x1b\[\d{0,3};\d{0,3}f/,sub:B},{pattern:/^\x1b\[?[\d;]{0,3}/,sub:B},{pattern:/^(([^\x1b\x08\r\n])+)/,sub:me}];function Ae(Y,le){le>z&&W||(W=!1,R=R.replace(Y.pattern,Y.sub))}var ge=[],ae=R,Re=ae.length;e:for(;Re>0;){for(var Ce=0,de=0,je=Te.length;de<je;Ce=++de){var Ue=Te[Ce];if(Ae(Ue,Ce),R.length!==Re){Re=R.length;continue e}}if(R.length===Re)break;ge.push(0),Re=R.length}return ge}function U(R,D,I){return D!=="text"&&(R=R.filter(w(S(I))),R.push({token:D,data:I,category:S(I)})),R}var G=(function(){function R(D){u(this,R),D=D||{},D.colors&&(D.colors=Object.assign({},r.colors,D.colors)),this.options=Object.assign({},r,D),this.stack=[],this.stickyStack=[]}return e(R,[{key:"toHtml",value:function(I){var W=this;I=typeof I=="string"?[I]:I;var z=this.stack,B=this.options,H=[];return this.stickyStack.forEach(function($){var J=d(z,$.token,$.data,B);J&&H.push(J)}),j(I.join(""),B,function($,J){var re=d(z,$,J,B);re&&H.push(re),B.stream&&(W.stickyStack=U(W.stickyStack,$,J))}),z.length&&H.push(m(z)),H.join("")}}]),R})();return ds=G,ds}var c3=l3();const h3=zs(c3),u3=""+new URL("robot-BsccFpqT.png",import.meta.url).href,d3=({closeChat:u,fitViewNode:t,chat:e,showError:i,lastMessage:s,blocks:n})=>g.jsx(g.Fragment,{children:g.jsx("div",{className:"w-5/6 max-w-[768px] py-4 word-break-break-word",children:g.jsx(js,{mode:"wait",children:!i&&s?g.jsxs(bt.div,{initial:{opacity:1},exit:{opacity:0},className:"flex w-full gap-4 rounded-md p-2",children:[g.jsx(Ss,{}),g.jsx("div",{className:"flex items-center",children:g.jsx(Dr,{className:"",duration:1,children:"Flow running..."})})]},"loading"):g.jsxs(bt.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:"flex w-full gap-4 rounded-md p-2",children:[g.jsx(Ss,{}),n.map((a,r)=>g.jsx("div",{className:"w-full rounded-xl border border-error-red-border bg-error-red p-4 text-sm text-foreground",children:a.contents.map((o,l)=>o.type==="error"?g.jsxs("div",{className:"",children:[g.jsxs("div",{className:"mb-2 flex items-center",children:[g.jsx(ie,{className:"mr-2 h-[18px] w-[18px] text-destructive",name:"OctagonAlert"}),o.component&&g.jsx(g.Fragment,{children:g.jsxs("span",{children:["An error occured in the"," ",g.jsx("span",{className:Pe(u??"cursor-pointer underline"),onClick:()=>{t(e.properties?.source?.id??""),u?.()},children:g.jsx("strong",{children:o.component})})," ","Component, stopping your flow. See below for more details."]})})]}),g.jsxs("div",{children:[g.jsx("h3",{className:"pb-3 font-semibold",children:"Error details:"}),o.field&&g.jsxs("p",{className:"pb-1",children:["Field: ",o.field]}),o.reason&&g.jsx("span",{className:"",children:g.jsx(Yo,{remarkPlugins:[Ko],components:{a:({node:c,...h})=>g.jsx("a",{...h,target:"_blank",className:"underline",rel:"noopener noreferrer",children:h.children}),p({node:c,...h}){return g.jsx("span",{className:"inline-block w-fit max-w-full",children:h.children})},code:({node:c,className:h,children:d,...f})=>{let p=d;if(Array.isArray(d)&&d.length===1&&typeof d[0]=="string"&&(p=d[0]),typeof p=="string")return p.length&&p[0]==="â–"?g.jsx("span",{className:"form-modal-markdown-span"}):Zo(h,f)?g.jsx(Jo,{language:Qo(h),code:String(p).replace(/\n$/,"")}):g.jsx("code",{className:h,...f,children:p})}},children:o.reason})}),o.solution&&g.jsxs("div",{className:"mt-4",children:[g.jsx("h3",{className:"pb-3 font-semibold",children:"Steps to fix:"}),g.jsxs("ol",{className:"list-decimal pl-5",children:[g.jsx("li",{children:"Check the component settings"}),g.jsx("li",{children:"Ensure all required fields are filled"}),g.jsx("li",{children:"Re-run your flow"})]})]})]})]},l):null)},r))]},"error")})})});function jn({message:u,onEdit:t,onCancel:e}){const[i,s]=L.useState(u),n=L.useRef(null),[a,r]=L.useState(!1),o=()=>{n.current&&(n.current.style.height="auto",n.current.style.height=`${n.current.scrollHeight+3}px`)};return L.useEffect(()=>{o()},[]),g.jsxs("div",{className:"flex h-fit w-full flex-col rounded-md bg-muted px-4 py-2",children:[g.jsx(ui,{ref:n,className:"max-h-[400px] w-full resize-none rounded-none border-0 bg-muted shadow-none focus:ring-0",value:i,autoFocus:!0,onChange:l=>s(l.target.value)}),g.jsxs("div",{className:"flex w-full flex-row-reverse justify-between",children:[g.jsxs("div",{className:"flex w-full flex-row-reverse items-center justify-between",children:[g.jsxs("div",{className:"flex min-w-fit flex-row-reverse gap-2",children:[g.jsx(De,{"data-testid":"save-button",onMouseDown:()=>r(!0),onClick:()=>{t(i),r(!1)},className:"mt-2 bg-primary text-background hover:bg-primary-hover hover:text-secondary",children:"Save"}),g.jsx(De,{variant:"secondary","data-testid":"cancel-button",onMouseDown:()=>r(!0),onClick:()=>{e(),r(!1)},className:"mt-2 !bg-transparent text-foreground hover:!bg-secondary-hover",children:"Cancel"})]}),g.jsx("div",{className:"text-mmd font-medium text-muted-foreground word-break-break-word",children:"Editing messages will update the memory but won't restart the conversation."})]}),g.jsx("div",{})]})]})}function f3(u){return`relative h-20 w-80 cursor-pointer rounded-lg border border-ring bg-muted shadow transition duration-300 hover:drop-shadow-lg ${u?"shadow-md":""}`}function Hn({isHovered:u,handleDownload:t}){if(u)return g.jsx("div",{className:"absolute right-1 top-1 rounded-md bg-muted text-sm font-bold text-foreground",children:g.jsx(De,{unstyled:!0,className:"bg-transparent px-2 py-1 text-ring",onClick:t,children:g.jsx(ie,{name:"DownloadCloud",className:"h-5 w-5 bg-transparent text-current hover:scale-110"})})})}const p3=new Set(["png","jpg","jpeg","gif","webp","image"]);function g3({fileName:u,path:t,fileType:e,showFile:i=!0}){const[s,n]=L.useState(!1),{mutate:a}=Ga({filename:u,path:t});function r(){n(!0)}function o(){n(!1)}const l=f3(s),c=`${kr()}files/images/${t}`;if(i)return p3.has(e)?g.jsx("div",{className:"inline-block w-full rounded-lg transition-all",onMouseEnter:r,onMouseLeave:o,style:{display:"inline-block"},children:g.jsxs("div",{className:"relative w-[50%] rounded-lg border border-border",children:[g.jsx("img",{src:c,alt:"generated image",className:"m-0 h-auto w-auto rounded-lg border border-border p-0 transition-all"}),g.jsx(Hn,{isHovered:s,handleDownload:()=>a(void 0)})]})}):g.jsxs("div",{className:l,onClick:()=>a(void 0),onMouseEnter:r,onMouseLeave:o,children:[g.jsxs("div",{className:"ml-3 flex h-full w-full items-center gap-2 text-sm",children:[g.jsx(ie,{name:"File",className:"h-8 w-8"}),g.jsxs("div",{className:"flex flex-col",children:[g.jsx("span",{className:"font-bold",children:qs(u,20)}),g.jsx("span",{children:"File"})]})]}),g.jsx(Hn,{isHovered:s,handleDownload:()=>a(void 0)})]})}function m3({fileName:u,path:t,fileType:e,showFile:i=!0}){return g.jsx(g3,{fileName:u,path:t,fileType:e,showFile:i})}function v3({index:u,path:t}){const[e,i]=L.useState(!0);let s="",n="",a="";return typeof t=="string"?(s=t.split("/").pop()||"",n=t.split(".").pop()||"",a=t):(s=t.name,n=t.type,a=t.path),g.jsxs("div",{className:"flex flex-col gap-2",children:[g.jsxs("span",{onClick:()=>i(!e),className:"flex cursor-pointer gap-2 text-sm text-muted-foreground",children:[qs(s,50),g.jsx(ie,{name:e?"ChevronDown":"ChevronRight"})]}),g.jsx(m3,{showFile:e,fileName:s,fileType:n,path:a})]},u)}function y3({onEdit:u,onCopy:t,onEvaluate:e,isBotMessage:i,evaluation:s,isAudioMessage:n}){const[a,r]=L.useState(!1),o=()=>{t(),r(!0),setTimeout(()=>r(!1),2e3)},l=c=>{e?.(s===c?null:c)};return g.jsxs("div",{className:"flex items-center rounded-md border border-border bg-background",children:[!n&&u&&g.jsx(Xe,{styleClasses:"z-50",content:"Edit message",side:"top",children:g.jsx("div",{className:"p-1",children:g.jsx(De,{variant:"ghost",size:"icon",onClick:u,className:"h-8 w-8",children:g.jsx(ie,{name:"Pen",className:"h-4 w-4"})})})}),g.jsx(Xe,{styleClasses:"z-50",content:a?"Copied!":"Copy message",side:"top",children:g.jsx("div",{className:"p-1",children:g.jsx(De,{variant:"ghost",size:"icon",onClick:o,className:"h-8 w-8",children:g.jsx(ie,{name:a?"Check":"Copy",className:"h-4 w-4"})})})}),i&&g.jsxs("div",{className:"flex",children:[g.jsx(Xe,{styleClasses:"z-50",content:"Helpful",side:"top",children:g.jsx("div",{className:"p-1",children:g.jsx(De,{variant:"ghost",size:"icon",onClick:()=>l(!0),className:"h-8 w-8","data-testid":"helpful-button",children:g.jsx(ie,{name:s===!0?"ThumbUpIconCustom":"ThumbsUp",className:Pe("h-4 w-4")})})})}),g.jsx(Xe,{styleClasses:"z-50",content:"Not helpful",side:"top",children:g.jsx("div",{className:"p-1",children:g.jsx(De,{variant:"ghost",size:"icon",onClick:()=>l(!1),className:"h-8 w-8","data-testid":"not-helpful-button",children:g.jsx(ie,{name:s===!1?"ThumbDownIconCustom":"ThumbsDown",className:Pe("h-4 w-4")})})})})]})]})}const Bn=u=>u?u.map(t=>typeof t=="string"?t:t.path):[];function w3({chat:u,lastMessage:t,updateChat:e,closeChat:i,playgroundPage:s}){const n=new h3({newline:!0}),[a,r]=L.useState(!0),[o,l]=L.useState(u.stream_url),c=xt(z=>z.currentFlowId),h=Se(z=>z.fitViewNode),[d,f]=L.useState(u.message?u.message.toString():""),[p,m]=L.useState(!1),v=L.useRef(void 0),w=Et(z=>z.setErrorData),S=L.useRef(d),[_,A]=L.useState(!1),[P,k]=L.useState(!1),N=Se(z=>z.isBuilding),O=u.category==="audio";L.useEffect(()=>{const z=u.message?u.message.toString():"";f(z),S.current=d},[u,N]);const j=z=>(m(!0),new Promise((B,H)=>{v.current=new EventSource(z),v.current.onmessage=$=>{const J=JSON.parse($.data);J.chunk&&f(re=>re+J.chunk)},v.current.onerror=$=>{m(!1),v.current?.close(),l(void 0),JSON.parse($.data)?.error&&w({title:"Error on Streaming",list:[JSON.parse($.data)?.error]}),e(u,S.current),H(new Error("Streaming failed"))},v.current.addEventListener("close",$=>{l(void 0),v.current?.close(),m(!1),B(!0)})}));L.useEffect(()=>{o&&!p&&j(o).then(()=>{e&&e(u,S.current)}).catch(z=>{console.error(z)})},[o,d]),L.useEffect(()=>()=>{v.current?.close()},[]),L.useEffect(()=>{if(u.category==="error"){const z=setTimeout(()=>{k(!0)},50);return()=>clearTimeout(z)}},[u.category]);let U=d??"";try{U=decodeURIComponent(d)}catch{}const G=U?.trim()==="",{mutate:R}=$o(),D=z=>{R({message:{id:u.id,files:Bn(u.files),sender_name:u.sender_name??"AI",text:z,sender:u.isSend?"User":"Machine",flow_id:c,session_id:u.session??""},refetch:!0},{onSuccess:()=>{e(u,z),A(!1)},onError:()=>{w({title:"Error updating messages."})}})},I=z=>{R({message:{...u,files:Bn(u.files),sender_name:u.sender_name??"AI",text:u.message.toString(),sender:u.isSend?"User":"Machine",flow_id:c,session_id:u.session??"",properties:{...u.properties,positive_feedback:z}},refetch:!0},{onError:()=>{w({title:"Error updating messages."})}})},W=u.edit?g.jsx("div",{className:"text-sm text-muted-foreground",children:"(Edited)"}):null;if(u.category==="error"){const z=u.content_blocks??[];return g.jsx(d3,{blocks:z,showError:P,lastMessage:t,closeChat:i,fitViewNode:h,chat:u})}return g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"w-full py-4 word-break-break-word",children:g.jsxs("div",{className:Pe("group relative flex w-full gap-4 rounded-md p-2",_?"":"hover:bg-muted"),children:[g.jsx("div",{className:Pe("relative flex h-[32px] w-[32px] items-center justify-center overflow-hidden rounded-md text-2xl",u.isSend?"border border-border hover:border-input":"bg-muted"),style:u.properties?.background_color?{backgroundColor:u.properties.background_color}:{},children:u.isSend?g.jsx("div",{className:"flex h-[18px] w-[18px] items-center justify-center",children:u.properties?.icon?u.properties.icon.match(/[\u2600-\u27BF\uD83C-\uDBFF\uDC00-\uDFFF]/)?g.jsx("div",{className:"",children:u.properties.icon}):g.jsx(ie,{name:u.properties.icon}):s?s?g.jsx(ie,{name:"User"}):g.jsx(bn,{}):g.jsx(bn,{})}):g.jsx("div",{className:"flex h-[18px] w-[18px] items-center justify-center",children:u.properties?.icon?u.properties.icon.match(/[\u2600-\u27BF\uD83C-\uDBFF\uDC00-\uDFFF]/)?g.jsx("span",{className:"",children:u.properties.icon}):g.jsx(ie,{name:u.properties.icon}):g.jsx("img",{src:u3,className:"absolute bottom-0 left-0 scale-[60%]",alt:"robot_image"})})}),g.jsxs("div",{className:"flex w-[94%] flex-col",children:[g.jsx("div",{children:g.jsxs("div",{className:Pe("flex max-w-full items-baseline gap-3 truncate pb-2 text-sm font-semibold"),style:u.properties?.text_color?{color:u.properties.text_color}:{},"data-testid":"sender_name_"+u.sender_name?.toLocaleLowerCase(),children:[g.jsxs("span",{className:"flex items-center gap-2",children:[u.sender_name,O&&g.jsx("div",{className:"flex h-5 w-5 items-center justify-center rounded-sm bg-muted",children:g.jsx(ie,{name:"mic",className:"h-3 w-3 text-muted-foreground"})})]}),u.properties?.source&&!s&&g.jsx("div",{className:"text-mmd font-normal text-muted-foreground",children:u.properties?.source.source})]})}),u.content_blocks&&u.content_blocks.length>0&&g.jsx(ea,{playgroundPage:s,contentBlocks:u.content_blocks,isLoading:u.properties?.state==="partial"&&N&&t,state:u.properties?.state,chatId:u.id}),u.isSend?g.jsx("div",{className:"form-modal-chat-text-position flex-grow",children:g.jsxs("div",{className:"flex w-full flex-col",children:[_?g.jsx(jn,{message:U,onEdit:z=>{D(z)},onCancel:()=>A(!1)},`edit-message-${u.id}`):g.jsx(g.Fragment,{children:g.jsxs("div",{className:Pe("w-full items-baseline whitespace-pre-wrap break-words text-sm font-normal",G?"text-muted-foreground":"text-primary"),"data-testid":`chat-message-${u.sender_name}-${d}`,children:[G?sa:U,W]})}),u.files&&g.jsx("div",{className:"my-2 flex flex-col gap-5",children:u.files?.map((z,B)=>g.jsx(v3,{index:B,path:z}))})]})}):g.jsx("div",{className:"form-modal-chat-text-position flex-grow",children:g.jsxs("div",{className:"form-modal-chat-text",children:[a&&u.thought&&u.thought!==""&&g.jsx("div",{onClick:()=>r(z=>!z),className:"form-modal-chat-icon-div",children:g.jsx(ie,{name:"MessageSquare",className:"form-modal-chat-icon"})}),u.thought&&u.thought!==""&&!a&&g.jsx(ta,{className:"form-modal-chat-thought",content:n.toHtml(u.thought??""),onClick:()=>r(z=>!z)}),u.thought&&u.thought!==""&&!a&&g.jsx("br",{}),g.jsx("div",{className:"flex w-full flex-col",children:g.jsx("div",{className:"flex w-full flex-col dark:text-white","data-testid":"div-chat-message",children:g.jsx("div",{"data-testid":"chat-message-"+u.sender_name+"-"+d,className:"flex w-full flex-col",children:d===""&&N&&t?g.jsx(ie,{name:"MoreHorizontal",className:"h-8 w-8 animate-pulse"}):g.jsx("div",{className:"min-h-8 w-full",children:_?g.jsx(jn,{message:U,onEdit:z=>{D(z)},onCancel:()=>A(!1)},`edit-message-${u.id}`):g.jsx(ia,{isAudioMessage:O,chat:u,isEmpty:G,chatMessage:d,editedFlag:W})})})})})]})})]}),!_&&g.jsx("div",{className:"invisible absolute -top-4 right-0 group-hover:visible",children:g.jsx("div",{children:g.jsx(y3,{onCopy:()=>{navigator.clipboard.writeText(d)},onEdit:s?void 0:()=>A(!0),className:"h-fit group-hover:visible",isBotMessage:!u.isSend,onEvaluate:I,evaluation:u.properties?.positive_feedback,isAudioMessage:O})})})]})}),g.jsx("div",{id:t?"last-chat-message":void 0})]})}const Ai=new WeakMap,b3=(u,t)=>{let e=Ai.get(u);e===void 0&&(e=new Date(u.timestamp).getTime(),Ai.set(u,e));let i=Ai.get(t);return i===void 0&&(i=new Date(t.timestamp).getTime(),Ai.set(t,i)),e!==i?e-i:u.isSend&&!t.isSend?-1:!u.isSend&&t.isSend?1:0},x3=L.memo(w3,(u,t)=>u.chat.message===t.chat.message&&u.chat.id===t.chat.id&&u.chat.session===t.chat.session&&u.chat.content_blocks===t.chat.content_blocks&&u.chat.properties===t.chat.properties&&u.lastMessage===t.lastMessage);function S3({sendMessage:u,visibleSession:t,focusChat:e,closeChat:i,playgroundPage:s,sidebarOpen:n}){const a=Se(H=>H.inputs),r=xt(H=>H.currentFlowId),o=Us(),[l,c]=L.useState(void 0),h=Nt(H=>H.messages),d=Se(H=>H.nodes),f=a.find(H=>H.type==="ChatInput"),p=d.find(H=>H.id===f?.id),m=Nt(H=>H.displayLoadingMessage),v=Se(H=>H.isBuilding),w=a.map(H=>H.type),S=Se(H=>H.updateFlowPool),_=ct(H=>H.setChatValueStore),A=Ml();L.useEffect(()=>{const $=[...h.filter(J=>J.flow_id===o&&(t===J.session_id||t===null)).map(J=>{let re=J.files;if(!Array.isArray(re)){if(re==="[]"||re==="")re=[];else if(typeof re=="string")try{re=JSON.parse(re)}catch(me){console.error("Error parsing files:",me),re=[]}}return{isSend:J.sender==="User",message:J.text,sender_name:J.sender_name,files:re,id:J.id,timestamp:J.timestamp,session:J.session_id,edit:J.edit,background_color:J.background_color||"",text_color:J.text_color||"",content_blocks:J.content_blocks||[],category:J.category||"",properties:J.properties||{}}})].sort(b3);h.length===0&&!v&&p&&A&&_(p.data.node.template.input_value.value??""),c($)},[h,t]);const P=L.useRef(null);L.useEffect(()=>{P.current&&e&&P.current.focus()},[e]);function k(H,$){H.message=$,H.componentId&&S(H.componentId,{message:$,sender_name:H.sender_name??"Bot",sender:H.isSend?"User":"Machine"})}const{files:N,setFiles:O,handleFiles:j}=Il(r),[U,G]=L.useState(!1),{dragOver:R,dragEnter:D,dragLeave:I}=Fl(G,!!s),W=H=>{if(s){H.stopPropagation();return}H.preventDefault(),H.stopPropagation(),H.dataTransfer.files&&H.dataTransfer.files.length>0&&(j(H.dataTransfer.files),H.dataTransfer.clearData()),G(!1)},z=L.useMemo(()=>g.jsx(Nl,{}),[]),B=rt(H=>H.isVoiceAssistantActive);return g.jsxs(xn,{className:Pe("flex h-full w-full flex-col rounded-md",t?"h-[95%]":"h-full",n&&!B&&"pointer-events-none blur-sm lg:pointer-events-auto lg:blur-0"),onDragOver:R,onDragEnter:D,onDragLeave:I,onDrop:W,resize:"smooth",initial:"instant",mass:1,children:[g.jsxs(xn.Content,{className:"flex flex-col min-h-full",children:[g.jsx("div",{className:"flex flex-col flex-grow place-self-center w-5/6 max-w-[768px]",children:l&&(v||l?.length>0?l?.map((H,$)=>g.jsx(x3,{chat:H,lastMessage:l.length-1===$,updateChat:k,closeChat:i,playgroundPage:s},`${H.id}-${$}`)):g.jsx("div",{className:"flex flex-grow w-full flex-col items-center justify-center",children:g.jsxs("div",{className:"flex flex-col items-center justify-center gap-4 p-8",children:[g.jsx(Lr,{title:"Vetrai logo",className:"h-10 w-10 scale-[1.5]"}),g.jsxs("div",{className:"flex flex-col items-center justify-center",children:[g.jsx("h3",{className:"mt-2 pb-2 text-2xl font-semibold text-primary",children:"New chat"}),g.jsx("p",{className:"text-lg text-muted-foreground","data-testid":"new-chat-text",children:g.jsx(Za,{children:"Test your flow with a chat prompt"})})]})]})}))}),g.jsx("div",{className:m?"w-full max-w-[768px] py-4 word-break-break-word md:w-5/6":"",ref:P,children:m&&l?.[l.length-1]?.category!=="error"&&z})]}),g.jsx("div",{className:"m-auto w-full max-w-[768px] md:w-5/6",children:g.jsx(Dl,{playgroundPage:!!s,noInput:!w.includes("ChatInput"),sendMessage:async({repeat:H,files:$})=>{await u({repeat:H,files:$}),Vs()},inputRef:P,files:N,setFiles:O,isDragging:U})})]})}const E3=({selectedViewField:u,visibleSession:t,sessions:e,sidebarOpen:i,currentFlowId:s,setSidebarOpen:n,setvisibleSession:a,setSelectedViewField:r,messagesFetched:o,sessionId:l,sendMessage:c,canvasOpen:h,setOpen:d,playgroundPage:f})=>g.jsxs("div",{className:Pe("flex h-full w-full flex-col justify-between px-4 pb-4 pt-2",u?"hidden":""),children:[g.jsxs("div",{className:Pe("flex h-10 shrink-0 items-center text-base font-semibold",f?"justify-between":"lg:justify-start"),children:[g.jsx("div",{className:Pe(i?"lg:hidden":"left-4"),children:g.jsx("div",{className:"flex items-center gap-2",children:g.jsx(De,{variant:"ghost",size:"icon",onClick:()=>n(!0),className:"h-8 w-8",children:g.jsx(ie,{name:"PanelLeftOpen",className:"h-[18px] w-[18px] text-ring"})})})}),t&&e.length>0&&g.jsx("div",{className:Pe("truncate text-center font-semibold",f?"":"mr-12 flex-grow lg:mr-0",i?"blur-sm lg:blur-0":""),children:t===s?"Default Session":`${t}`}),g.jsxs("div",{className:Pe(i?"pointer-events-none opacity-0":"","flex items-center justify-center rounded-sm ring-offset-background transition-opacity focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",f?"right-2 top-4":"absolute right-12 top-2 h-8"),children:[g.jsx(Xe,{side:"bottom",styleClasses:"z-50",content:"New Chat",children:g.jsx(De,{className:"mr-2 h-[32px] w-[32px] hover:bg-secondary-hover",variant:"ghost",size:"icon",onClick:()=>{a(void 0),r(void 0)},children:g.jsx(ie,{name:"Plus",className:"!h-[18px] !w-[18px] text-ring"})})}),!f&&g.jsx(Yt,{orientation:"vertical"})]})]}),o&&g.jsx(S3,{focusChat:l,sendMessage:c,visibleSession:t,closeChat:h?()=>{d(!1)}:void 0,playgroundPage:f,sidebarOpen:i})]}),T3=()=>`Session ${new Date().toLocaleString("en-US",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit",hour12:!1,second:"2-digit",timeZone:"UTC"})}`;function _3({field:u,updateValue:t}){const e=xt(S=>S.currentFlowId),[i,s]=L.useState(!1),[n,a]=L.useState(""),[r,o]=L.useState(null),l=Et(S=>S.setErrorData),{validateFileSize:c}=Ar();L.useEffect(()=>{n&&t(n,"file")},[n]),L.useEffect(()=>{if(u){const S=u.split("/")[1],_=e.toString();o(`${kr()}files/images/${_}/${S}`)}},[]);const h=S=>{S.preventDefault(),S.dataTransfer.types.some(_=>_==="Files")&&s(!0)},d=S=>{S.dataTransfer.types.some(_=>_==="Files")&&s(!0),S.preventDefault()},f=S=>{S.preventDefault(),s(!1)},p=S=>{if(S.preventDefault(),S.dataTransfer.files.length>0){const _=S.dataTransfer.files[0];v(_);const A=new FileReader;A.onload=P=>{const k=P.target?.result;o(k)},A.readAsDataURL(_)}s(!1)},{mutate:m}=Hs(),v=async S=>{if(S){try{c(S)}catch(A){A instanceof Error&&l({title:A.message});return}const _=new FileReader;_.onload=A=>{const P=A.target?.result;o(P);const k=document.createElement("img");k.src=P,document.body.appendChild(k)},_.readAsDataURL(S),m({file:S,id:e},{onSuccess:A=>{const{file_path:P}=A;a(P)},onError:A=>{l({title:"Error uploading file",list:[A.response?.data?.detail]}),console.error("Error occurred while uploading file")}})}},w=()=>{na({multiple:!1,accept:Bs.join(",")}).then(S=>v(S[0]))};return g.jsx(g.Fragment,{children:g.jsxs("div",{onDragOver:h,onDragEnter:d,onDragLeave:f,onDrop:p,className:"flex h-full w-full items-center justify-between"+(i?"flex h-28 flex-col items-center justify-center gap-4 text-xs font-light":""),children:[!i&&g.jsx(De,{variant:"primary",onClick:w,children:"Upload or drop your file"}),i?g.jsxs(g.Fragment,{children:[g.jsx(ie,{name:"ArrowUpToLine",className:"h-5 w-5 stroke-1"}),'"Drop your file here"']}):r?g.jsx("img",{className:"order-last h-12 w-12 rounded-full object-cover",src:r??""}):g.jsx(g.Fragment,{children:g.jsx(ie,{name:"SunIcon",className:"h-8 w-8 stroke-1"})})]})})}function A3({field:u,updateValue:t}){return g.jsx(_3,{field:u,updateValue:t})}var ki={exports:{}},C3=ki.exports,zn;function P3(){return zn||(zn=1,(function(u,t){(function(e,i){i()})(C3,function(){function e(l,c){return typeof c>"u"?c={autoBom:!1}:typeof c!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),c={autoBom:!c}),c.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(l.type)?new Blob(["\uFEFF",l],{type:l.type}):l}function i(l,c,h){var d=new XMLHttpRequest;d.open("GET",l),d.responseType="blob",d.onload=function(){o(d.response,c,h)},d.onerror=function(){console.error("could not download file")},d.send()}function s(l){var c=new XMLHttpRequest;c.open("HEAD",l,!1);try{c.send()}catch{}return 200<=c.status&&299>=c.status}function n(l){try{l.dispatchEvent(new MouseEvent("click"))}catch{var c=document.createEvent("MouseEvents");c.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),l.dispatchEvent(c)}}var a=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof Si=="object"&&Si.global===Si?Si:void 0,r=a.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),o=a.saveAs||(typeof window!="object"||window!==a?function(){}:"download"in HTMLAnchorElement.prototype&&!r?function(l,c,h){var d=a.URL||a.webkitURL,f=document.createElement("a");c=c||l.name||"download",f.download=c,f.rel="noopener",typeof l=="string"?(f.href=l,f.origin===location.origin?n(f):s(f.href)?i(l,c,h):n(f,f.target="_blank")):(f.href=d.createObjectURL(l),setTimeout(function(){d.revokeObjectURL(f.href)},4e4),setTimeout(function(){n(f)},0))}:"msSaveOrOpenBlob"in navigator?function(l,c,h){if(c=c||l.name||"download",typeof l!="string")navigator.msSaveOrOpenBlob(e(l,h),c);else if(s(l))i(l,c,h);else{var d=document.createElement("a");d.href=l,d.target="_blank",setTimeout(function(){n(d)})}}:function(l,c,h,d){if(d=d||open("","_blank"),d&&(d.document.title=d.document.body.innerText="downloading..."),typeof l=="string")return i(l,c,h);var f=l.type==="application/octet-stream",p=/constructor/i.test(a.HTMLElement)||a.safari,m=/CriOS\/[\d]+/.test(navigator.userAgent);if((m||f&&p||r)&&typeof FileReader<"u"){var v=new FileReader;v.onloadend=function(){var _=v.result;_=m?_:_.replace(/^data:[^;]*;/,"data:attachment/file;"),d?d.location.href=_:location=_,d=null},v.readAsDataURL(l)}else{var w=a.URL||a.webkitURL,S=w.createObjectURL(l);d?d.location=S:location.href=S,d=null,setTimeout(function(){w.revokeObjectURL(S)},4e4)}});a.saveAs=o.saveAs=o,u.exports=o})})(ki)),ki.exports}var R3=P3(),Ii={exports:{}},L3=Ii.exports,Un;function D3(){return Un||(Un=1,(function(u){function t(e){return new t.Viewer(e)}(function(e){e.version={versionStr:"4.1.1",major:parseInt("4",10),minor:parseInt("1",10),revision:parseInt("1",10)};var i={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object AsyncFunction]":"function","[object Promise]":"promise","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},s=Object.prototype.toString,n=Object.prototype.hasOwnProperty;e.isFunction=function(a){return e.type(a)==="function"},e.isArray=Array.isArray||function(a){return e.type(a)==="array"},e.isWindow=function(a){return a&&typeof a=="object"&&"setInterval"in a},e.type=function(a){return a==null?String(a):i[s.call(a)]||"object"},e.isPlainObject=function(a){if(!a||t.type(a)!=="object"||a.nodeType||e.isWindow(a)||a.constructor&&!n.call(a,"constructor")&&!n.call(a.constructor.prototype,"isPrototypeOf"))return!1;var r;for(var o in a)r=o;return r===void 0||n.call(a,r)},e.isEmptyObject=function(a){for(var r in a)return!1;return!0},e.freezeObject=function(a){return Object.freeze?e.freezeObject=Object.freeze:e.freezeObject=function(r){return r},e.freezeObject(a)},e.supportsCanvas=(function(){var a=document.createElement("canvas");return!!(e.isFunction(a.getContext)&&a.getContext("2d"))})(),e.isCanvasTainted=function(a){var r=!1;try{a.getContext("2d").getImageData(0,0,1,1)}catch{r=!0}return r},e.supportsAddEventListener=(function(){return!!(document.documentElement.addEventListener&&document.addEventListener)})(),e.supportsRemoveEventListener=(function(){return!!(document.documentElement.removeEventListener&&document.removeEventListener)})(),e.supportsEventListenerOptions=(function(){var a=0;if(e.supportsAddEventListener)try{var r={get capture(){return a++,!1},get once(){return a++,!1},get passive(){return a++,!1}};window.addEventListener("test",null,r),window.removeEventListener("test",null,r)}catch{a=0}return a>=3})(),e.getCurrentPixelDensityRatio=function(){if(e.supportsCanvas){var a=document.createElement("canvas").getContext("2d"),r=window.devicePixelRatio||1,o=a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||a.backingStorePixelRatio||1;return Math.max(r,1)/o}else return 1},e.pixelDensityRatio=e.getCurrentPixelDensityRatio()})(t),(function(e){e.extend=function(){var o,l,c,h,d,f,p=arguments[0]||{},m=arguments.length,v=!1,w=1;for(typeof p=="boolean"&&(v=p,p=arguments[1]||{},w=2),typeof p!="object"&&!t.isFunction(p)&&(p={}),m===w&&(p=this,--w);w<m;w++)if(o=arguments[w],o!==null||o!==void 0)for(l in o){var S=Object.getOwnPropertyDescriptor(o,l);if(S!==void 0){if(S.get||S.set){Object.defineProperty(p,l,S);continue}h=S.value}else{e.console.warn('Could not copy inherited property "'+l+'".');continue}p!==h&&(v&&h&&(t.isPlainObject(h)||(d=t.isArray(h)))?(c=p[l],d?(d=!1,f=c&&t.isArray(c)?c:[]):f=c&&t.isPlainObject(c)?c:{},p[l]=t.extend(v,f,h)):h!==void 0&&(p[l]=h))}return p};var i=function(){if(typeof navigator!="object")return!1;var o=navigator.userAgent;return typeof o!="string"?!1:o.indexOf("iPhone")!==-1||o.indexOf("iPad")!==-1||o.indexOf("iPod")!==-1};e.extend(e,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},splitHashDataForPost:!1,panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{dragToPan:!0,scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,dblClickDragToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,dblClickDragToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,dblClickDragToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,dblClickDragToZoom:!1,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerDblClickDrag:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:i(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorElement:null,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,subPixelRoundingForTransparency:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,tileRetryMax:0,tileRetryDelay:2500,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"],silenceMultiImageWarnings:!1},SIGNAL:"----seadragon----",delegate:function(o,l){return function(){var c=arguments;return c===void 0&&(c=[]),l.apply(o,c)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5,EDGE:6,CHROMEEDGE:7},SUBPIXEL_ROUNDING_OCCURRENCES:{NEVER:0,ONLY_AT_REST:1,ALWAYS:2},_viewers:new Map,getViewer:function(o){return e._viewers.get(this.getElement(o))},getElement:function(o){return typeof o=="string"&&(o=document.getElementById(o)),o},getElementPosition:function(o){var l=new e.Point,c,h;for(o=e.getElement(o),c=e.getElementStyle(o).position==="fixed",h=r(o,c);h;)l.x+=o.offsetLeft,l.y+=o.offsetTop,c&&(l=l.plus(e.getPageScroll())),o=h,c=e.getElementStyle(o).position==="fixed",h=r(o,c);return l},getElementOffset:function(o){o=e.getElement(o);var l=o&&o.ownerDocument,c,h,d={top:0,left:0};return l?(c=l.documentElement,typeof o.getBoundingClientRect<"u"&&(d=o.getBoundingClientRect()),h=l===l.window?l:l.nodeType===9?l.defaultView||l.parentWindow:!1,new e.Point(d.left+(h.pageXOffset||c.scrollLeft)-(c.clientLeft||0),d.top+(h.pageYOffset||c.scrollTop)-(c.clientTop||0))):new e.Point},getElementSize:function(o){return o=e.getElement(o),new e.Point(o.clientWidth,o.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(o){return o=e.getElement(o),o.currentStyle}:function(o){return o=e.getElement(o),window.getComputedStyle(o,"")},getCssPropertyWithVendorPrefix:function(o){var l={};return e.getCssPropertyWithVendorPrefix=function(c){if(l[c]!==void 0)return l[c];var h=document.createElement("div").style,d=null;if(h[c]!==void 0)d=c;else for(var f=["Webkit","Moz","MS","O","webkit","moz","ms","o"],p=e.capitalizeFirstLetter(c),m=0;m<f.length;m++){var v=f[m]+p;if(h[v]!==void 0){d=v;break}}return l[c]=d,d},e.getCssPropertyWithVendorPrefix(o)},capitalizeFirstLetter:function(o){return o.charAt(0).toUpperCase()+o.slice(1)},positiveModulo:function(o,l){var c=o%l;return c<0&&(c+=l),c},pointInElement:function(o,l){o=e.getElement(o);var c=e.getElementOffset(o),h=e.getElementSize(o);return l.x>=c.x&&l.x<c.x+h.x&&l.y<c.y+h.y&&l.y>=c.y},getMousePosition:function(o){if(typeof o.pageX=="number")e.getMousePosition=function(l){var c=new e.Point;return c.x=l.pageX,c.y=l.pageY,c};else if(typeof o.clientX=="number")e.getMousePosition=function(l){var c=new e.Point;return c.x=l.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,c.y=l.clientY+document.body.scrollTop+document.documentElement.scrollTop,c};else throw new Error("Unknown event mouse position, no known technique.");return e.getMousePosition(o)},getPageScroll:function(){var o=document.documentElement||{},l=document.body||{};if(typeof window.pageXOffset=="number")e.getPageScroll=function(){return new e.Point(window.pageXOffset,window.pageYOffset)};else if(l.scrollLeft||l.scrollTop)e.getPageScroll=function(){return new e.Point(document.body.scrollLeft,document.body.scrollTop)};else if(o.scrollLeft||o.scrollTop)e.getPageScroll=function(){return new e.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)};else return new e.Point(0,0);return e.getPageScroll()},setPageScroll:function(o){if(typeof window.scrollTo<"u")e.setPageScroll=function(h){window.scrollTo(h.x,h.y)};else{var l=e.getPageScroll();if(l.x===o.x&&l.y===o.y)return;document.body.scrollLeft=o.x,document.body.scrollTop=o.y;var c=e.getPageScroll();if(c.x!==l.x&&c.y!==l.y){e.setPageScroll=function(h){document.body.scrollLeft=h.x,document.body.scrollTop=h.y};return}if(document.documentElement.scrollLeft=o.x,document.documentElement.scrollTop=o.y,c=e.getPageScroll(),c.x!==l.x&&c.y!==l.y){e.setPageScroll=function(h){document.documentElement.scrollLeft=h.x,document.documentElement.scrollTop=h.y};return}e.setPageScroll=function(h){}}e.setPageScroll(o)},getWindowSize:function(){var o=document.documentElement||{},l=document.body||{};if(typeof window.innerWidth=="number")e.getWindowSize=function(){return new e.Point(window.innerWidth,window.innerHeight)};else if(o.clientWidth||o.clientHeight)e.getWindowSize=function(){return new e.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else if(l.clientWidth||l.clientHeight)e.getWindowSize=function(){return new e.Point(document.body.clientWidth,document.body.clientHeight)};else throw new Error("Unknown window size, no known technique.");return e.getWindowSize()},makeCenteredNode:function(o){o=e.getElement(o);var l=[e.makeNeutralElement("div"),e.makeNeutralElement("div"),e.makeNeutralElement("div")];return e.extend(l[0].style,{display:"table",height:"100%",width:"100%"}),e.extend(l[1].style,{display:"table-row"}),e.extend(l[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),l[0].appendChild(l[1]),l[1].appendChild(l[2]),l[2].appendChild(o),l[0]},makeNeutralElement:function(o){var l=document.createElement(o),c=l.style;return c.background="transparent none",c.border="none",c.margin="0px",c.padding="0px",c.position="static",l},now:function(){return Date.now?e.now=Date.now:e.now=function(){return new Date().getTime()},e.now()},makeTransparentImage:function(o){var l=e.makeNeutralElement("img");return l.src=o,l},setElementOpacity:function(o,l,c){var h,d;o=e.getElement(o),c&&!e.Browser.alpha&&(l=Math.round(l)),e.Browser.opacity?o.style.opacity=l<1?l:"":l<1?(h=Math.round(100*l),d="alpha(opacity="+h+")",o.style.filter=d):o.style.filter=""},setElementTouchActionNone:function(o){o=e.getElement(o),typeof o.style.touchAction<"u"?o.style.touchAction="none":typeof o.style.msTouchAction<"u"&&(o.style.msTouchAction="none")},setElementPointerEvents:function(o,l){o=e.getElement(o),typeof o.style<"u"&&typeof o.style.pointerEvents<"u"&&(o.style.pointerEvents=l)},setElementPointerEventsNone:function(o){e.setElementPointerEvents(o,"none")},addClass:function(o,l){o=e.getElement(o),o.className?(" "+o.className+" ").indexOf(" "+l+" ")===-1&&(o.className+=" "+l):o.className=l},indexOf:function(o,l,c){return Array.prototype.indexOf?this.indexOf=function(h,d,f){return h.indexOf(d,f)}:this.indexOf=function(h,d,f){var p,m=f||0,v;if(!h)throw new TypeError;if(v=h.length,v===0||m>=v)return-1;for(m<0&&(m=v-Math.abs(m)),p=m;p<v;p++)if(h[p]===d)return p;return-1},this.indexOf(o,l,c)},removeClass:function(o,l){var c,h=[],d;for(o=e.getElement(o),c=o.className.split(/\s+/),d=0;d<c.length;d++)c[d]&&c[d]!==l&&h.push(c[d]);o.className=h.join(" ")},normalizeEventListenerOptions:function(o){var l;return typeof o<"u"?typeof o=="boolean"?l=e.supportsEventListenerOptions?{capture:o}:o:l=e.supportsEventListenerOptions?o:typeof o.capture<"u"?o.capture:!1:l=e.supportsEventListenerOptions?{capture:!1}:!1,l},addEvent:(function(){if(e.supportsAddEventListener)return function(o,l,c,h){h=e.normalizeEventListenerOptions(h),o=e.getElement(o),o.addEventListener(l,c,h)};if(document.documentElement.attachEvent&&document.attachEvent)return function(o,l,c){o=e.getElement(o),o.attachEvent("on"+l,c)};throw new Error("No known event model.")})(),removeEvent:(function(){if(e.supportsRemoveEventListener)return function(o,l,c,h){h=e.normalizeEventListenerOptions(h),o=e.getElement(o),o.removeEventListener(l,c,h)};if(document.documentElement.detachEvent&&document.detachEvent)return function(o,l,c){o=e.getElement(o),o.detachEvent("on"+l,c)};throw new Error("No known event model.")})(),cancelEvent:function(o){o.preventDefault()},eventIsCanceled:function(o){return o.defaultPrevented},stopEvent:function(o){o.stopPropagation()},createCallback:function(o,l){var c=[],h;for(h=2;h<arguments.length;h++)c.push(arguments[h]);return function(){var d=c.concat([]),f;for(f=0;f<arguments.length;f++)d.push(arguments[f]);return l.apply(o,d)}},getUrlParameter:function(o){var l=a[o];return l||null},getUrlProtocol:function(o){var l=o.match(/^([a-z]+:)\/\//i);return l===null?window.location.protocol:l[1].toLowerCase()},createAjaxRequest:function(o){var l;try{l=!!new ActiveXObject("Microsoft.XMLHTTP")}catch{l=!1}if(l)window.XMLHttpRequest?e.createAjaxRequest=function(c){return c?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:e.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else if(window.XMLHttpRequest)e.createAjaxRequest=function(){return new XMLHttpRequest};else throw new Error("Browser doesn't support XMLHttpRequest.");return e.createAjaxRequest(o)},makeAjaxRequest:function(o,l,c){var h,d,f,p;e.isPlainObject(o)&&(l=o.success,c=o.error,h=o.withCredentials,d=o.headers,f=o.responseType||null,p=o.postData||null,o=o.url);var m=e.getUrlProtocol(o),v=e.createAjaxRequest(m==="file:");if(!e.isFunction(l))throw new Error("makeAjaxRequest requires a success callback");v.onreadystatechange=function(){v.readyState===4&&(v.onreadystatechange=function(){},v.status>=200&&v.status<300||v.status===0&&m!=="http:"&&m!=="https:"?l(v):e.isFunction(c)?c(v):e.console.error("AJAX request returned %d: %s",v.status,o))};var w=p?"POST":"GET";try{if(v.open(w,o,!0),f&&(v.responseType=f),d)for(var S in d)Object.prototype.hasOwnProperty.call(d,S)&&d[S]&&v.setRequestHeader(S,d[S]);h&&(v.withCredentials=!0),v.send(p)}catch(_){e.console.error("%s while making AJAX request: %s",_.name,_.message),v.onreadystatechange=function(){},e.isFunction(c)&&c(v,_)}return v},jsonp:function(o){var l,c=o.url,h=document.head||document.getElementsByTagName("head")[0]||document.documentElement,d=o.callbackName||"openseadragon"+e.now(),f=window[d],p="$1"+d+"$2",m=o.param||"callback",v=o.callback;c=c.replace(/(=)\?(&|$)|\?\?/i,p),c+=(/\?/.test(c)?"&":"?")+m+"="+d,window[d]=function(w){if(f)window[d]=f;else try{delete window[d]}catch{}v&&e.isFunction(v)&&v(w)},l=document.createElement("script"),(o.async!==void 0||o.async!==!1)&&(l.async="async"),o.scriptCharset&&(l.charset=o.scriptCharset),l.src=c,l.onload=l.onreadystatechange=function(w,S){(S||!l.readyState||/loaded|complete/.test(l.readyState))&&(l.onload=l.onreadystatechange=null,h&&l.parentNode&&h.removeChild(l),l=void 0)},h.insertBefore(l,h.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(o){if(window.DOMParser)e.parseXml=function(l){var c=null,h;return h=new DOMParser,c=h.parseFromString(l,"text/xml"),c};else if(window.ActiveXObject)e.parseXml=function(l){var c=null;return c=new ActiveXObject("Microsoft.XMLDOM"),c.async=!1,c.loadXML(l),c};else throw new Error("Browser doesn't support XML DOM.");return e.parseXml(o)},parseJSON:function(o){return e.parseJSON=window.JSON.parse,e.parseJSON(o)},imageFormatSupported:function(o){return o=o||"",!!n[o.toLowerCase()]},setImageFormatsSupported:function(o){e.extend(n,o)}});var s=function(o){};e.console=window.console||{log:s,debug:s,info:s,warn:s,error:s,assert:s},e.Browser={vendor:e.BROWSERS.UNKNOWN,version:0,alpha:!0};var n={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},a={};(function(){var o=navigator.appVersion,l=navigator.userAgent,c;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&(e.Browser.vendor=e.BROWSERS.IE,e.Browser.version=parseFloat(l.substring(l.indexOf("MSIE")+5,l.indexOf(";",l.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(l.indexOf("Edge")>=0?(e.Browser.vendor=e.BROWSERS.EDGE,e.Browser.version=parseFloat(l.substring(l.indexOf("Edge")+5))):l.indexOf("Edg")>=0?(e.Browser.vendor=e.BROWSERS.CHROMEEDGE,e.Browser.version=parseFloat(l.substring(l.indexOf("Edg")+4))):l.indexOf("Firefox")>=0?(e.Browser.vendor=e.BROWSERS.FIREFOX,e.Browser.version=parseFloat(l.substring(l.indexOf("Firefox")+8))):l.indexOf("Safari")>=0?(e.Browser.vendor=l.indexOf("Chrome")>=0?e.BROWSERS.CHROME:e.BROWSERS.SAFARI,e.Browser.version=parseFloat(l.substring(l.substring(0,l.indexOf("Safari")).lastIndexOf("/")+1,l.indexOf("Safari")))):(c=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),c.exec(l)!==null&&(e.Browser.vendor=e.BROWSERS.IE,e.Browser.version=parseFloat(RegExp.$1))));break;case"Opera":e.Browser.vendor=e.BROWSERS.OPERA,e.Browser.version=parseFloat(o);break}var h=window.location.search.substring(1),d=h.split("&"),f,p,m;for(m=0;m<d.length;m++)if(f=d[m],p=f.indexOf("="),p>0){var v=f.substring(0,p),w=f.substring(p+1);try{a[v]=decodeURIComponent(w)}catch{e.console.error("Ignoring malformed URL parameter: %s=%s",v,w)}}e.Browser.alpha=!(e.Browser.vendor===e.BROWSERS.CHROME&&e.Browser.version<2),e.Browser.opacity=!0,e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<11&&e.console.error("Internet Explorer versions < 11 are not supported by OpenSeadragon")})(),(function(o){var l=o.requestAnimationFrame||o.mozRequestAnimationFrame||o.webkitRequestAnimationFrame||o.msRequestAnimationFrame,c=o.cancelAnimationFrame||o.mozCancelAnimationFrame||o.webkitCancelAnimationFrame||o.msCancelAnimationFrame;if(l&&c)e.requestAnimationFrame=function(){return l.apply(o,arguments)},e.cancelAnimationFrame=function(){return c.apply(o,arguments)};else{var h=[],d=[],f=0,p;e.requestAnimationFrame=function(m){return h.push([++f,m]),p||(p=setInterval(function(){if(h.length){var v=e.now(),w=d;for(d=h,h=w;d.length;)d.shift()[1](v)}else clearInterval(p),p=void 0},1e3/50)),f},e.cancelAnimationFrame=function(m){var v,w;for(v=0,w=h.length;v<w;v+=1)if(h[v][0]===m){h.splice(v,1);return}for(v=0,w=d.length;v<w;v+=1)if(d[v][0]===m){d.splice(v,1);return}}}})(window);function r(o,l){return l&&o!==document.body?document.body:o.offsetParent}})(t),(function(e,i){u.exports?u.exports=i():e.OpenSeadragon=i()})(L3,function(){return t}),(function(e){var i={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.fullscreenElement},i.requestFullScreen=function(s){return s.requestFullscreen()},i.exitFullScreen=function(){document.exitFullscreen()},i.fullScreenEventName="fullscreenchange",i.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.msFullscreenElement},i.requestFullScreen=function(s){return s.msRequestFullscreen()},i.exitFullScreen=function(){document.msExitFullscreen()},i.fullScreenEventName="MSFullscreenChange",i.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.webkitFullscreenElement},i.requestFullScreen=function(s){return s.webkitRequestFullscreen()},i.exitFullScreen=function(){document.webkitExitFullscreen()},i.fullScreenEventName="webkitfullscreenchange",i.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},i.requestFullScreen=function(s){return s.webkitRequestFullScreen()},i.exitFullScreen=function(){document.webkitCancelFullScreen()},i.fullScreenEventName="webkitfullscreenchange",i.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.mozFullScreenElement},i.requestFullScreen=function(s){return s.mozRequestFullScreen()},i.exitFullScreen=function(){document.mozCancelFullScreen()},i.fullScreenEventName="mozfullscreenchange",i.fullScreenErrorEventName="mozfullscreenerror"),i.isFullScreen=function(){return i.getFullScreenElement()!==null},i.cancelFullScreen=function(){e.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),i.exitFullScreen()},e.extend(e,i)})(t),(function(e){e.EventSource=function(){this.events={}},e.EventSource.prototype={addOnceHandler:function(i,s,n,a,r){var o=this;a=a||1;var l=0,c=function(h){return l++,l===a&&o.removeHandler(i,c),s(h)};this.addHandler(i,c,n,r)},addHandler:function(i,s,n,a){var r=this.events[i];if(r||(this.events[i]=r=[]),s&&e.isFunction(s)){var o=r.length,l={handler:s,userData:n||null,priority:a||0};for(r[o]=l;o>0&&r[o-1].priority<r[o].priority;)r[o]=r[o-1],r[o-1]=l,o--}},removeHandler:function(i,s){var n=this.events[i],a=[],r;if(n&&e.isArray(n)){for(r=0;r<n.length;r++)n[r].handler!==s&&a.push(n[r]);this.events[i]=a}},numberOfHandlers:function(i){var s=this.events[i];return s?s.length:0},removeAllHandlers:function(i){if(i)this.events[i]=[];else for(var s in this.events)this.events[s]=[]},getHandler:function(i){var s=this.events[i];return!s||!s.length?null:(s=s.length===1?[s[0]]:Array.apply(null,s),function(n,a){var r,o=s.length;for(r=0;r<o;r++)s[r]&&(a.eventSource=n,a.userData=s[r].userData,s[r].handler(a))})},raiseEvent:function(i,s){var n=this.getHandler(i);if(n)return n(this,s||{})}}})(t),(function(e){var i={};e.MouseTracker=function(x){var b=arguments;e.isPlainObject(x)||(x={element:b[0],clickTimeThreshold:b[1],clickDistThreshold:b[2]}),this.hash=Math.random(),this.element=e.getElement(x.element),this.clickTimeThreshold=x.clickTimeThreshold||e.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=x.clickDistThreshold||e.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=x.dblClickTimeThreshold||e.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=x.dblClickDistThreshold||e.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=x.userData||null,this.stopDelay=x.stopDelay||50,this.preProcessEventHandler=x.preProcessEventHandler||null,this.contextMenuHandler=x.contextMenuHandler||null,this.enterHandler=x.enterHandler||null,this.leaveHandler=x.leaveHandler||null,this.exitHandler=x.exitHandler||null,this.overHandler=x.overHandler||null,this.outHandler=x.outHandler||null,this.pressHandler=x.pressHandler||null,this.nonPrimaryPressHandler=x.nonPrimaryPressHandler||null,this.releaseHandler=x.releaseHandler||null,this.nonPrimaryReleaseHandler=x.nonPrimaryReleaseHandler||null,this.moveHandler=x.moveHandler||null,this.scrollHandler=x.scrollHandler||null,this.clickHandler=x.clickHandler||null,this.dblClickHandler=x.dblClickHandler||null,this.dragHandler=x.dragHandler||null,this.dragEndHandler=x.dragEndHandler||null,this.pinchHandler=x.pinchHandler||null,this.stopHandler=x.stopHandler||null,this.keyDownHandler=x.keyDownHandler||null,this.keyUpHandler=x.keyUpHandler||null,this.keyHandler=x.keyHandler||null,this.focusHandler=x.focusHandler||null,this.blurHandler=x.blurHandler||null;var E=this;i[this.hash]={click:function(C){_(E,C)},dblclick:function(C){A(E,C)},keydown:function(C){P(E,C)},keyup:function(C){k(E,C)},keypress:function(C){N(E,C)},focus:function(C){O(E,C)},blur:function(C){j(E,C)},contextmenu:function(C){U(E,C)},wheel:function(C){G(E,C)},mousewheel:function(C){R(E,C)},DOMMouseScroll:function(C){R(E,C)},MozMousePixelScroll:function(C){R(E,C)},losecapture:function(C){I(E,C)},mouseenter:function(C){Q(E,C)},mouseleave:function(C){Te(E,C)},mouseover:function(C){Ae(E,C)},mouseout:function(C){ge(E,C)},mousedown:function(C){ae(E,C)},mouseup:function(C){Re(E,C)},mousemove:function(C){je(E,C)},touchstart:function(C){W(E,C)},touchend:function(C){z(E,C)},touchmove:function(C){B(E,C)},touchcancel:function(C){H(E,C)},gesturestart:function(C){$(E,C)},gesturechange:function(C){J(E,C)},gotpointercapture:function(C){re(E,C)},lostpointercapture:function(C){me(E,C)},pointerenter:function(C){Q(E,C)},pointerleave:function(C){Te(E,C)},pointerover:function(C){Ae(E,C)},pointerout:function(C){ge(E,C)},pointerdown:function(C){ae(E,C)},pointerup:function(C){Re(E,C)},pointermove:function(C){je(E,C)},pointercancel:function(C){le(E,C)},pointerupcaptured:function(C){Ce(E,C)},pointermovecaptured:function(C){Ue(E,C)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null,sentDragEvent:!1},this.hasGestureHandlers=!!(this.pressHandler||this.nonPrimaryPressHandler||this.releaseHandler||this.nonPrimaryReleaseHandler||this.clickHandler||this.dblClickHandler||this.dragHandler||this.dragEndHandler||this.pinchHandler),this.hasScrollHandler=!!this.scrollHandler,e.MouseTracker.havePointerEvents&&e.setElementPointerEvents(this.element,"auto"),this.exitHandler&&e.console.error("MouseTracker.exitHandler is deprecated. Use MouseTracker.leaveHandler instead."),x.startDisabled||this.setTracking(!0)},e.MouseTracker.prototype={destroy:function(){o(this),this.element=null,i[this.hash]=null,delete i[this.hash]},isTracking:function(){return i[this.hash].tracking},setTracking:function(x){return x?r(this):o(this),this},getActivePointersListByType:function(x){var b=i[this.hash],E,C=b.activePointersLists.length,V;for(E=0;E<C;E++)if(b.activePointersLists[E].type===x)return b.activePointersLists[E];return V=new e.MouseTracker.GesturePointList(x),b.activePointersLists.push(V),V},getActivePointerCount:function(){var x=i[this.hash],b,E=x.activePointersLists.length,C=0;for(b=0;b<E;b++)C+=x.activePointersLists[b].getLength();return C},preProcessEventHandler:function(){},contextMenuHandler:function(){},enterHandler:function(){},leaveHandler:function(){},exitHandler:function(){},overHandler:function(){},outHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}};var s=(function(){try{return window.self!==window.top}catch{return!0}})();function n(x){try{return x.addEventListener&&x.removeEventListener}catch{return!1}}e.MouseTracker.gesturePointVelocityTracker=(function(){var x=[],b=0,E=0,C=function(we,oe){return we.hash.toString()+oe.type+oe.id.toString()},V=function(){var we,oe=x.length,Ge,Ve,Ut=e.now(),hn,un,dn;for(hn=Ut-E,E=Ut,we=0;we<oe;we++)Ge=x[we],Ve=Ge.gPoint,Ve.direction=Math.atan2(Ve.currentPos.y-Ge.lastPos.y,Ve.currentPos.x-Ge.lastPos.x),un=Ge.lastPos.distanceTo(Ve.currentPos),Ge.lastPos=Ve.currentPos,dn=1e3*un/(hn+1),Ve.speed=.75*dn+.25*Ve.speed},F=function(we,oe){var Ge=C(we,oe);x.push({guid:Ge,gPoint:oe,lastPos:oe.currentPos}),x.length===1&&(E=e.now(),b=window.setInterval(V,50))},ee=function(we,oe){var Ge=C(we,oe),Ve,Ut=x.length;for(Ve=0;Ve<Ut;Ve++)if(x[Ve].guid===Ge){x.splice(Ve,1),Ut--,Ut===0&&window.clearInterval(b);break}};return{addPoint:F,removePoint:ee}})(),e.MouseTracker.captureElement=document,e.MouseTracker.wheelEventName=e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll",e.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur","contextmenu",e.MouseTracker.wheelEventName],e.MouseTracker.wheelEventName==="DOMMouseScroll"&&e.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent?(e.MouseTracker.havePointerEvents=!0,e.MouseTracker.subscribeEvents.push("pointerenter","pointerleave","pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),e.MouseTracker.havePointerCapture=(function(){var x=document.createElement("div");return e.isFunction(x.setPointerCapture)&&e.isFunction(x.releasePointerCapture)})(),e.MouseTracker.havePointerCapture&&e.MouseTracker.subscribeEvents.push("gotpointercapture","lostpointercapture")):(e.MouseTracker.havePointerEvents=!1,e.MouseTracker.subscribeEvents.push("mouseenter","mouseleave","mouseover","mouseout","mousedown","mouseup","mousemove"),e.MouseTracker.mousePointerId="legacy-mouse",e.MouseTracker.havePointerCapture=(function(){var x=document.createElement("div");return e.isFunction(x.setCapture)&&e.isFunction(x.releaseCapture)})(),e.MouseTracker.havePointerCapture&&e.MouseTracker.subscribeEvents.push("losecapture"),"ontouchstart"in window&&e.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&e.MouseTracker.subscribeEvents.push("gesturestart","gesturechange")),e.MouseTracker.GesturePointList=function(x){this._gPoints=[],this.type=x,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},e.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(x){return this._gPoints.push(x)},removeById:function(x){var b,E=this._gPoints.length;for(b=0;b<E;b++)if(this._gPoints[b].id===x){this._gPoints.splice(b,1);break}return this._gPoints.length},getByIndex:function(x){return x<this._gPoints.length?this._gPoints[x]:null},getById:function(x){var b,E=this._gPoints.length;for(b=0;b<E;b++)if(this._gPoints[b].id===x)return this._gPoints[b];return null},getPrimary:function(x){var b,E=this._gPoints.length;for(b=0;b<E;b++)if(this._gPoints[b].isPrimary)return this._gPoints[b];return null},addContact:function(){++this.contacts,this.contacts>1&&(this.type==="mouse"||this.type==="pen")&&(e.console.warn("GesturePointList.addContact() Implausible contacts value"),this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};function a(x){var b=i[x.hash],E,C,V,F,ee,we=b.activePointersLists.length;for(E=0;E<we;E++)if(V=b.activePointersLists[E],V.getLength()>0){for(ee=[],F=V.asArray(),C=0;C<F.length;C++)ee.push(F[C]);for(C=0;C<ee.length;C++)be(x,V,ee[C])}for(E=0;E<we;E++)b.activePointersLists.pop();b.sentDragEvent=!1}function r(x){var b=i[x.hash],E,C;if(!b.tracking){for(C=0;C<e.MouseTracker.subscribeEvents.length;C++)E=e.MouseTracker.subscribeEvents[C],e.addEvent(x.element,E,b[E],E===e.MouseTracker.wheelEventName?{passive:!1,capture:!1}:!1);a(x),b.tracking=!0}}function o(x){var b=i[x.hash],E,C;if(b.tracking){for(C=0;C<e.MouseTracker.subscribeEvents.length;C++)E=e.MouseTracker.subscribeEvents[C],e.removeEvent(x.element,E,b[E],!1);a(x),b.tracking=!1}}function l(x,b){var E=i[x.hash];if(b==="pointerevent")return{upName:"pointerup",upHandler:E.pointerupcaptured,moveName:"pointermove",moveHandler:E.pointermovecaptured};if(b==="mouse")return{upName:"pointerup",upHandler:E.pointerupcaptured,moveName:"pointermove",moveHandler:E.pointermovecaptured};if(b==="touch")return{upName:"touchend",upHandler:E.touchendcaptured,moveName:"touchmove",moveHandler:E.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function c(x,b){var E;if(e.MouseTracker.havePointerCapture)if(e.MouseTracker.havePointerEvents)try{x.element.setPointerCapture(b.id)}catch{e.console.warn("setPointerCapture() called on invalid pointer ID");return}else x.element.setCapture(!0);else E=l(x,e.MouseTracker.havePointerEvents?"pointerevent":b.type),s&&n(window.top)&&e.addEvent(window.top,E.upName,E.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,E.upName,E.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,E.moveName,E.moveHandler,!0);M(x,b,!0)}function h(x,b){var E,C,V;if(e.MouseTracker.havePointerCapture)if(e.MouseTracker.havePointerEvents){if(C=x.getActivePointersListByType(b.type),V=C.getById(b.id),!V||!V.captured)return;try{x.element.releasePointerCapture(b.id)}catch{}}else x.element.releaseCapture();else E=l(x,e.MouseTracker.havePointerEvents?"pointerevent":b.type),s&&n(window.top)&&e.removeEvent(window.top,E.upName,E.upHandler,!0),e.removeEvent(e.MouseTracker.captureElement,E.moveName,E.moveHandler,!0),e.removeEvent(e.MouseTracker.captureElement,E.upName,E.upHandler,!0);M(x,b,!1)}function d(x){return e.MouseTracker.havePointerEvents?x.pointerId:e.MouseTracker.mousePointerId}function f(x){return e.MouseTracker.havePointerEvents?x.pointerType||(e.Browser.vendor===e.BROWSERS.IE?"mouse":""):"mouse"}function p(x){return e.MouseTracker.havePointerEvents?x.isPrimary:!0}function m(x){return e.getMousePosition(x)}function v(x,b){return w(m(x),b)}function w(x,b){var E=e.getElementOffset(b);return x.minus(E)}function S(x,b){return new e.Point((x.x+b.x)/2,(x.y+b.y)/2)}function _(x,b){var E={originalEvent:b,eventType:"click",pointerType:"mouse",isEmulated:!1};T(x,E),E.preventDefault&&!E.defaultPrevented&&e.cancelEvent(b),E.stopPropagation&&e.stopEvent(b)}function A(x,b){var E={originalEvent:b,eventType:"dblclick",pointerType:"mouse",isEmulated:!1};T(x,E),E.preventDefault&&!E.defaultPrevented&&e.cancelEvent(b),E.stopPropagation&&e.stopEvent(b)}function P(x,b){var E=null,C={originalEvent:b,eventType:"keydown",pointerType:"",isEmulated:!1};T(x,C),x.keyDownHandler&&!C.preventGesture&&!C.defaultPrevented&&(E={eventSource:x,keyCode:b.keyCode?b.keyCode:b.charCode,ctrl:b.ctrlKey,shift:b.shiftKey,alt:b.altKey,meta:b.metaKey,originalEvent:b,preventDefault:C.preventDefault||C.defaultPrevented,userData:x.userData},x.keyDownHandler(E)),(E&&E.preventDefault||C.preventDefault&&!C.defaultPrevented)&&e.cancelEvent(b),C.stopPropagation&&e.stopEvent(b)}function k(x,b){var E=null,C={originalEvent:b,eventType:"keyup",pointerType:"",isEmulated:!1};T(x,C),x.keyUpHandler&&!C.preventGesture&&!C.defaultPrevented&&(E={eventSource:x,keyCode:b.keyCode?b.keyCode:b.charCode,ctrl:b.ctrlKey,shift:b.shiftKey,alt:b.altKey,meta:b.metaKey,originalEvent:b,preventDefault:C.preventDefault||C.defaultPrevented,userData:x.userData},x.keyUpHandler(E)),(E&&E.preventDefault||C.preventDefault&&!C.defaultPrevented)&&e.cancelEvent(b),C.stopPropagation&&e.stopEvent(b)}function N(x,b){var E=null,C={originalEvent:b,eventType:"keypress",pointerType:"",isEmulated:!1};T(x,C),x.keyHandler&&!C.preventGesture&&!C.defaultPrevented&&(E={eventSource:x,keyCode:b.keyCode?b.keyCode:b.charCode,ctrl:b.ctrlKey,shift:b.shiftKey,alt:b.altKey,meta:b.metaKey,originalEvent:b,preventDefault:C.preventDefault||C.defaultPrevented,userData:x.userData},x.keyHandler(E)),(E&&E.preventDefault||C.preventDefault&&!C.defaultPrevented)&&e.cancelEvent(b),C.stopPropagation&&e.stopEvent(b)}function O(x,b){var E={originalEvent:b,eventType:"focus",pointerType:"",isEmulated:!1};T(x,E),x.focusHandler&&!E.preventGesture&&x.focusHandler({eventSource:x,originalEvent:b,userData:x.userData})}function j(x,b){var E={originalEvent:b,eventType:"blur",pointerType:"",isEmulated:!1};T(x,E),x.blurHandler&&!E.preventGesture&&x.blurHandler({eventSource:x,originalEvent:b,userData:x.userData})}function U(x,b){var E=null,C={originalEvent:b,eventType:"contextmenu",pointerType:"mouse",isEmulated:!1};T(x,C),x.contextMenuHandler&&!C.preventGesture&&!C.defaultPrevented&&(E={eventSource:x,position:w(m(b),x.element),originalEvent:C.originalEvent,preventDefault:C.preventDefault||C.defaultPrevented,userData:x.userData},x.contextMenuHandler(E)),(E&&E.preventDefault||C.preventDefault&&!C.defaultPrevented)&&e.cancelEvent(b),C.stopPropagation&&e.stopEvent(b)}function G(x,b){D(x,b,b)}function R(x,b){var E={target:b.target||b.srcElement,type:"wheel",shiftKey:b.shiftKey||!1,clientX:b.clientX,clientY:b.clientY,pageX:b.pageX?b.pageX:b.clientX,pageY:b.pageY?b.pageY:b.clientY,deltaMode:b.type==="MozMousePixelScroll"?0:1,deltaX:0,deltaZ:0};e.MouseTracker.wheelEventName==="mousewheel"?E.deltaY=-b.wheelDelta/e.DEFAULT_SETTINGS.pixelsPerWheelLine:E.deltaY=b.detail,D(x,E,b)}function D(x,b,E){var C=0,V,F=null;C=b.deltaY<0?1:-1,V={originalEvent:b,eventType:"wheel",pointerType:"mouse",isEmulated:b!==E},T(x,V),x.scrollHandler&&!V.preventGesture&&!V.defaultPrevented&&(F={eventSource:x,pointerType:"mouse",position:v(b,x.element),scroll:C,shift:b.shiftKey,isTouchEvent:!1,originalEvent:E,preventDefault:V.preventDefault||V.defaultPrevented,userData:x.userData},x.scrollHandler(F)),V.stopPropagation&&e.stopEvent(E),(F&&F.preventDefault||V.preventDefault&&!V.defaultPrevented)&&e.cancelEvent(E)}function I(x,b){var E={id:e.MouseTracker.mousePointerId,type:"mouse"},C={originalEvent:b,eventType:"lostpointercapture",pointerType:"mouse",isEmulated:!1};T(x,C),b.target===x.element&&M(x,E,!1),C.stopPropagation&&e.stopEvent(b)}function W(x,b){var E,C,V=b.changedTouches.length,F,ee=x.getActivePointersListByType("touch");E=e.now(),ee.getLength()>b.touches.length-V&&e.console.warn("Tracked touch contact count doesn't match event.touches.length");var we={originalEvent:b,eventType:"pointerdown",pointerType:"touch",isEmulated:!1};for(T(x,we),C=0;C<V;C++)F={id:b.changedTouches[C].identifier,type:"touch",isPrimary:ee.getLength()===0,currentPos:m(b.changedTouches[C]),currentTime:E},K(x,we,F),ye(x,we,F,0),M(x,F,!0);we.preventDefault&&!we.defaultPrevented&&e.cancelEvent(b),we.stopPropagation&&e.stopEvent(b)}function z(x,b){var E,C,V=b.changedTouches.length,F;E=e.now();var ee={originalEvent:b,eventType:"pointerup",pointerType:"touch",isEmulated:!1};for(T(x,ee),C=0;C<V;C++)F={id:b.changedTouches[C].identifier,type:"touch",currentPos:m(b.changedTouches[C]),currentTime:E},Ee(x,ee,F,0),M(x,F,!1),q(x,ee,F);ee.preventDefault&&!ee.defaultPrevented&&e.cancelEvent(b),ee.stopPropagation&&e.stopEvent(b)}function B(x,b){var E,C,V=b.changedTouches.length,F;E=e.now();var ee={originalEvent:b,eventType:"pointermove",pointerType:"touch",isEmulated:!1};for(T(x,ee),C=0;C<V;C++)F={id:b.changedTouches[C].identifier,type:"touch",currentPos:m(b.changedTouches[C]),currentTime:E},_e(x,ee,F);ee.preventDefault&&!ee.defaultPrevented&&e.cancelEvent(b),ee.stopPropagation&&e.stopEvent(b)}function H(x,b){var E=b.changedTouches.length,C,V,F={originalEvent:b,eventType:"pointercancel",pointerType:"touch",isEmulated:!1};for(T(x,F),C=0;C<E;C++)V={id:b.changedTouches[C].identifier,type:"touch"},se(x,F,V);F.stopPropagation&&e.stopEvent(b)}function $(x,b){return e.eventIsCanceled(b)||b.preventDefault(),!1}function J(x,b){return e.eventIsCanceled(b)||b.preventDefault(),!1}function re(x,b){var E={originalEvent:b,eventType:"gotpointercapture",pointerType:f(b),isEmulated:!1};T(x,E),b.target===x.element&&M(x,{id:b.pointerId,type:f(b)},!0),E.stopPropagation&&e.stopEvent(b)}function me(x,b){var E={originalEvent:b,eventType:"lostpointercapture",pointerType:f(b),isEmulated:!1};T(x,E),b.target===x.element&&M(x,{id:b.pointerId,type:f(b)},!1),E.stopPropagation&&e.stopEvent(b)}function Q(x,b){var E={id:d(b),type:f(b),isPrimary:p(b),currentPos:m(b),currentTime:e.now()},C={originalEvent:b,eventType:"pointerenter",pointerType:E.type,isEmulated:!1};T(x,C),K(x,C,E)}function Te(x,b){var E={id:d(b),type:f(b),isPrimary:p(b),currentPos:m(b),currentTime:e.now()},C={originalEvent:b,eventType:"pointerleave",pointerType:E.type,isEmulated:!1};T(x,C),q(x,C,E)}function Ae(x,b){var E={id:d(b),type:f(b),isPrimary:p(b),currentPos:m(b),currentTime:e.now()},C={originalEvent:b,eventType:"pointerover",pointerType:E.type,isEmulated:!1};T(x,C),te(x,C,E),C.preventDefault&&!C.defaultPrevented&&e.cancelEvent(b),C.stopPropagation&&e.stopEvent(b)}function ge(x,b){var E={id:d(b),type:f(b),isPrimary:p(b),currentPos:m(b),currentTime:e.now()},C={originalEvent:b,eventType:"pointerout",pointerType:E.type,isEmulated:!1};T(x,C),Z(x,C,E),C.preventDefault&&!C.defaultPrevented&&e.cancelEvent(b),C.stopPropagation&&e.stopEvent(b)}function ae(x,b){var E={id:d(b),type:f(b),isPrimary:p(b),currentPos:m(b),currentTime:e.now()},C=e.MouseTracker.havePointerEvents&&E.type==="touch"&&e.Browser.vendor!==e.BROWSERS.IE,V={originalEvent:b,eventType:"pointerdown",pointerType:E.type,isEmulated:!1};T(x,V),ye(x,V,E,b.button),V.preventDefault&&!V.defaultPrevented&&e.cancelEvent(b),V.stopPropagation&&e.stopEvent(b),V.shouldCapture&&(C?M(x,E,!0):c(x,E))}function Re(x,b){de(x,b)}function Ce(x,b){var E=x.getActivePointersListByType(f(b));E.getById(b.pointerId)&&de(x,b),e.stopEvent(b)}function de(x,b){var E;E={id:d(b),type:f(b),isPrimary:p(b),currentPos:m(b),currentTime:e.now()};var C={originalEvent:b,eventType:"pointerup",pointerType:E.type,isEmulated:!1};T(x,C),Ee(x,C,E,b.button),C.preventDefault&&!C.defaultPrevented&&e.cancelEvent(b),C.stopPropagation&&e.stopEvent(b),C.shouldReleaseCapture&&(b.target===x.element?h(x,E):M(x,E,!1))}function je(x,b){Y(x,b)}function Ue(x,b){var E=x.getActivePointersListByType(f(b));E.getById(b.pointerId)&&Y(x,b),e.stopEvent(b)}function Y(x,b){var E={id:d(b),type:f(b),isPrimary:p(b),currentPos:m(b),currentTime:e.now()},C={originalEvent:b,eventType:"pointermove",pointerType:E.type,isEmulated:!1};T(x,C),_e(x,C,E),C.preventDefault&&!C.defaultPrevented&&e.cancelEvent(b),C.stopPropagation&&e.stopEvent(b)}function le(x,b){var E={id:b.pointerId,type:f(b)},C={originalEvent:b,eventType:"pointercancel",pointerType:E.type,isEmulated:!1};T(x,C),se(x,C,E),C.stopPropagation&&e.stopEvent(b)}function ve(x,b){return b.speed=0,b.direction=0,b.contactPos=b.currentPos,b.contactTime=b.currentTime,b.lastPos=b.currentPos,b.lastTime=b.currentTime,x.add(b)}function be(x,b,E){var C,V=b.getById(E.id);return V?(V.captured&&(e.console.warn("stopTrackingPointer() called on captured pointer"),h(x,V)),b.removeContact(),C=b.removeById(E.id)):C=b.getLength(),C}function y(x,b){switch(b.eventType){case"pointermove":b.isStoppable=!0,b.isCancelable=!0,b.preventDefault=!1,b.preventGesture=!x.hasGestureHandlers,b.stopPropagation=!1;break;case"pointerover":case"pointerout":case"contextmenu":case"keydown":case"keyup":case"keypress":b.isStoppable=!0,b.isCancelable=!0,b.preventDefault=!1,b.preventGesture=!1,b.stopPropagation=!1;break;case"pointerdown":b.isStoppable=!0,b.isCancelable=!0,b.preventDefault=!1,b.preventGesture=!x.hasGestureHandlers,b.stopPropagation=!1;break;case"pointerup":b.isStoppable=!0,b.isCancelable=!0,b.preventDefault=!1,b.preventGesture=!x.hasGestureHandlers,b.stopPropagation=!1;break;case"wheel":b.isStoppable=!0,b.isCancelable=!0,b.preventDefault=!1,b.preventGesture=!x.hasScrollHandler,b.stopPropagation=!1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":b.isStoppable=!0,b.isCancelable=!1,b.preventDefault=!1,b.preventGesture=!1,b.stopPropagation=!1;break;case"click":b.isStoppable=!0,b.isCancelable=!0,b.preventDefault=!!x.clickHandler,b.preventGesture=!1,b.stopPropagation=!1;break;case"dblclick":b.isStoppable=!0,b.isCancelable=!0,b.preventDefault=!!x.dblClickHandler,b.preventGesture=!1,b.stopPropagation=!1;break;default:b.isStoppable=!1,b.isCancelable=!1,b.preventDefault=!1,b.preventGesture=!1,b.stopPropagation=!1;break}}function T(x,b){b.eventSource=x,b.eventPhase=b.originalEvent&&typeof b.originalEvent.eventPhase<"u"?b.originalEvent.eventPhase:0,b.defaultPrevented=e.eventIsCanceled(b.originalEvent),b.shouldCapture=!1,b.shouldReleaseCapture=!1,b.userData=x.userData,y(x,b),x.preProcessEventHandler&&x.preProcessEventHandler(b)}function M(x,b,E){var C=x.getActivePointersListByType(b.type),V=C.getById(b.id);V?E&&!V.captured?(V.captured=!0,C.captureCount++):!E&&V.captured&&(V.captured=!1,C.captureCount--,C.captureCount<0&&(C.captureCount=0,e.console.warn("updatePointerCaptured() - pointsList.captureCount went negative"))):e.console.warn("updatePointerCaptured() called on untracked pointer")}function K(x,b,E){var C=x.getActivePointersListByType(E.type),V;V=C.getById(E.id),V?(V.insideElement=!0,V.lastPos=V.currentPos,V.lastTime=V.currentTime,V.currentPos=E.currentPos,V.currentTime=E.currentTime,E=V):(E.captured=!1,E.insideElementPressed=!1,E.insideElement=!0,ve(C,E)),x.enterHandler&&x.enterHandler({eventSource:x,pointerType:E.type,position:w(E.currentPos,x.element),buttons:C.buttons,pointers:x.getActivePointerCount(),insideElementPressed:E.insideElementPressed,buttonDownAny:C.buttons!==0,isTouchEvent:E.type==="touch",originalEvent:b.originalEvent,userData:x.userData})}function q(x,b,E){var C=x.getActivePointersListByType(E.type),V,F;V=C.getById(E.id),V?(V.captured?(V.insideElement=!1,V.lastPos=V.currentPos,V.lastTime=V.currentTime,V.currentPos=E.currentPos,V.currentTime=E.currentTime):be(x,C,V),E=V):(E.captured=!1,E.insideElementPressed=!1),(x.leaveHandler||x.exitHandler)&&(F={eventSource:x,pointerType:E.type,position:E.currentPos&&w(E.currentPos,x.element),buttons:C.buttons,pointers:x.getActivePointerCount(),insideElementPressed:E.insideElementPressed,buttonDownAny:C.buttons!==0,isTouchEvent:E.type==="touch",originalEvent:b.originalEvent,userData:x.userData},x.leaveHandler&&x.leaveHandler(F),x.exitHandler&&x.exitHandler(F))}function te(x,b,E){var C,V;C=x.getActivePointersListByType(E.type),V=C.getById(E.id),V?E=V:(E.captured=!1,E.insideElementPressed=!1),x.overHandler&&x.overHandler({eventSource:x,pointerType:E.type,position:w(E.currentPos,x.element),buttons:C.buttons,pointers:x.getActivePointerCount(),insideElementPressed:E.insideElementPressed,buttonDownAny:C.buttons!==0,isTouchEvent:E.type==="touch",originalEvent:b.originalEvent,userData:x.userData})}function Z(x,b,E){var C,V;C=x.getActivePointersListByType(E.type),V=C.getById(E.id),V?E=V:(E.captured=!1,E.insideElementPressed=!1),x.outHandler&&x.outHandler({eventSource:x,pointerType:E.type,position:E.currentPos&&w(E.currentPos,x.element),buttons:C.buttons,pointers:x.getActivePointerCount(),insideElementPressed:E.insideElementPressed,buttonDownAny:C.buttons!==0,isTouchEvent:E.type==="touch",originalEvent:b.originalEvent,userData:x.userData})}function ye(x,b,E,C){var V=i[x.hash],F=x.getActivePointersListByType(E.type),ee;if(typeof b.originalEvent.buttons<"u"?F.buttons=b.originalEvent.buttons:C===0?F.buttons|=1:C===1?F.buttons|=4:C===2?F.buttons|=2:C===3?F.buttons|=8:C===4?F.buttons|=16:C===5&&(F.buttons|=32),C!==0){b.shouldCapture=!1,b.shouldReleaseCapture=!1,x.nonPrimaryPressHandler&&!b.preventGesture&&!b.defaultPrevented&&(b.preventDefault=!0,x.nonPrimaryPressHandler({eventSource:x,pointerType:E.type,position:w(E.currentPos,x.element),button:C,buttons:F.buttons,isTouchEvent:E.type==="touch",originalEvent:b.originalEvent,userData:x.userData}));return}ee=F.getById(E.id),ee?(ee.insideElementPressed=!0,ee.insideElement=!0,ee.originalTarget=b.originalEvent.target,ee.contactPos=E.currentPos,ee.contactTime=E.currentTime,ee.lastPos=ee.currentPos,ee.lastTime=ee.currentTime,ee.currentPos=E.currentPos,ee.currentTime=E.currentTime,E=ee):(E.captured=!1,E.insideElementPressed=!0,E.insideElement=!0,E.originalTarget=b.originalEvent.target,ve(F,E)),F.addContact(),!b.preventGesture&&!b.defaultPrevented?(b.shouldCapture=!0,b.shouldReleaseCapture=!1,b.preventDefault=!0,(x.dragHandler||x.dragEndHandler||x.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.addPoint(x,E),F.contacts===1?x.pressHandler&&!b.preventGesture&&x.pressHandler({eventSource:x,pointerType:E.type,position:w(E.contactPos,x.element),buttons:F.buttons,isTouchEvent:E.type==="touch",originalEvent:b.originalEvent,userData:x.userData}):F.contacts===2&&x.pinchHandler&&E.type==="touch"&&(V.pinchGPoints=F.asArray(),V.lastPinchDist=V.currentPinchDist=V.pinchGPoints[0].currentPos.distanceTo(V.pinchGPoints[1].currentPos),V.lastPinchCenter=V.currentPinchCenter=S(V.pinchGPoints[0].currentPos,V.pinchGPoints[1].currentPos))):(b.shouldCapture=!1,b.shouldReleaseCapture=!1)}function Ee(x,b,E,C){var V=i[x.hash],F=x.getActivePointersListByType(E.type),ee,we,oe,Ge=!1,Ve;if(typeof b.originalEvent.buttons<"u"?F.buttons=b.originalEvent.buttons:C===0?F.buttons^=-2:C===1?F.buttons^=-5:C===2?F.buttons^=-3:C===3?F.buttons^=-9:C===4?F.buttons^=-17:C===5&&(F.buttons^=-33),b.shouldCapture=!1,C!==0){b.shouldReleaseCapture=!1,x.nonPrimaryReleaseHandler&&!b.preventGesture&&!b.defaultPrevented&&(b.preventDefault=!0,x.nonPrimaryReleaseHandler({eventSource:x,pointerType:E.type,position:w(E.currentPos,x.element),button:C,buttons:F.buttons,isTouchEvent:E.type==="touch",originalEvent:b.originalEvent,userData:x.userData}));return}oe=F.getById(E.id),oe?(F.removeContact(),oe.captured&&(Ge=!0),oe.lastPos=oe.currentPos,oe.lastTime=oe.currentTime,oe.currentPos=E.currentPos,oe.currentTime=E.currentTime,oe.insideElement||be(x,F,oe),ee=oe.currentPos,we=oe.currentTime):(E.captured=!1,E.insideElementPressed=!1,E.insideElement=!0,ve(F,E),oe=E),!b.preventGesture&&!b.defaultPrevented&&(Ge?(b.shouldReleaseCapture=!0,b.preventDefault=!0,(x.dragHandler||x.dragEndHandler||x.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.removePoint(x,oe),F.contacts===0?(x.releaseHandler&&ee&&x.releaseHandler({eventSource:x,pointerType:oe.type,position:w(ee,x.element),buttons:F.buttons,insideElementPressed:oe.insideElementPressed,insideElementReleased:oe.insideElement,isTouchEvent:oe.type==="touch",originalEvent:b.originalEvent,userData:x.userData}),x.dragEndHandler&&V.sentDragEvent&&x.dragEndHandler({eventSource:x,pointerType:oe.type,position:w(oe.currentPos,x.element),speed:oe.speed,direction:oe.direction,shift:b.originalEvent.shiftKey,isTouchEvent:oe.type==="touch",originalEvent:b.originalEvent,userData:x.userData}),V.sentDragEvent=!1,(x.clickHandler||x.dblClickHandler)&&oe.insideElement&&(Ve=we-oe.contactTime<=x.clickTimeThreshold&&oe.contactPos.distanceTo(ee)<=x.clickDistThreshold,x.clickHandler&&x.clickHandler({eventSource:x,pointerType:oe.type,position:w(oe.currentPos,x.element),quick:Ve,shift:b.originalEvent.shiftKey,isTouchEvent:oe.type==="touch",originalEvent:b.originalEvent,originalTarget:oe.originalTarget,userData:x.userData}),x.dblClickHandler&&Ve&&(F.clicks++,F.clicks===1?(V.lastClickPos=ee,V.dblClickTimeOut=setTimeout(function(){F.clicks=0},x.dblClickTimeThreshold)):F.clicks===2&&(clearTimeout(V.dblClickTimeOut),F.clicks=0,V.lastClickPos.distanceTo(ee)<=x.dblClickDistThreshold&&x.dblClickHandler({eventSource:x,pointerType:oe.type,position:w(oe.currentPos,x.element),shift:b.originalEvent.shiftKey,isTouchEvent:oe.type==="touch",originalEvent:b.originalEvent,userData:x.userData}),V.lastClickPos=null)))):F.contacts===2&&x.pinchHandler&&oe.type==="touch"&&(V.pinchGPoints=F.asArray(),V.lastPinchDist=V.currentPinchDist=V.pinchGPoints[0].currentPos.distanceTo(V.pinchGPoints[1].currentPos),V.lastPinchCenter=V.currentPinchCenter=S(V.pinchGPoints[0].currentPos,V.pinchGPoints[1].currentPos))):(b.shouldReleaseCapture=!1,x.releaseHandler&&ee&&(x.releaseHandler({eventSource:x,pointerType:oe.type,position:w(ee,x.element),buttons:F.buttons,insideElementPressed:oe.insideElementPressed,insideElementReleased:oe.insideElement,isTouchEvent:oe.type==="touch",originalEvent:b.originalEvent,userData:x.userData}),b.preventDefault=!0)))}function _e(x,b,E){var C=i[x.hash],V=x.getActivePointersListByType(E.type),F,ee,we;if(typeof b.originalEvent.buttons<"u"&&(V.buttons=b.originalEvent.buttons),F=V.getById(E.id),F)F.lastPos=F.currentPos,F.lastTime=F.currentTime,F.currentPos=E.currentPos,F.currentTime=E.currentTime;else return;b.shouldCapture=!1,b.shouldReleaseCapture=!1,x.stopHandler&&E.type==="mouse"&&(clearTimeout(x.stopTimeOut),x.stopTimeOut=setTimeout(function(){X(x,b.originalEvent,E.type)},x.stopDelay)),V.contacts===0?x.moveHandler&&x.moveHandler({eventSource:x,pointerType:E.type,position:w(E.currentPos,x.element),buttons:V.buttons,isTouchEvent:E.type==="touch",originalEvent:b.originalEvent,userData:x.userData}):V.contacts===1?(x.moveHandler&&(F=V.asArray()[0],x.moveHandler({eventSource:x,pointerType:F.type,position:w(F.currentPos,x.element),buttons:V.buttons,isTouchEvent:F.type==="touch",originalEvent:b.originalEvent,userData:x.userData})),x.dragHandler&&!b.preventGesture&&!b.defaultPrevented&&(F=V.asArray()[0],we=F.currentPos.minus(F.lastPos),x.dragHandler({eventSource:x,pointerType:F.type,position:w(F.currentPos,x.element),buttons:V.buttons,delta:we,speed:F.speed,direction:F.direction,shift:b.originalEvent.shiftKey,isTouchEvent:F.type==="touch",originalEvent:b.originalEvent,userData:x.userData}),b.preventDefault=!0,C.sentDragEvent=!0)):V.contacts===2&&(x.moveHandler&&(ee=V.asArray(),x.moveHandler({eventSource:x,pointerType:ee[0].type,position:w(S(ee[0].currentPos,ee[1].currentPos),x.element),buttons:V.buttons,isTouchEvent:ee[0].type==="touch",originalEvent:b.originalEvent,userData:x.userData})),x.pinchHandler&&E.type==="touch"&&!b.preventGesture&&!b.defaultPrevented&&(we=C.pinchGPoints[0].currentPos.distanceTo(C.pinchGPoints[1].currentPos),we!==C.currentPinchDist&&(C.lastPinchDist=C.currentPinchDist,C.currentPinchDist=we,C.lastPinchCenter=C.currentPinchCenter,C.currentPinchCenter=S(C.pinchGPoints[0].currentPos,C.pinchGPoints[1].currentPos),x.pinchHandler({eventSource:x,pointerType:"touch",gesturePoints:C.pinchGPoints,lastCenter:w(C.lastPinchCenter,x.element),center:w(C.currentPinchCenter,x.element),lastDistance:C.lastPinchDist,distance:C.currentPinchDist,shift:b.originalEvent.shiftKey,originalEvent:b.originalEvent,userData:x.userData}),b.preventDefault=!0)))}function se(x,b,E){var C=x.getActivePointersListByType(E.type),V;V=C.getById(E.id),V&&be(x,C,V)}function X(x,b,E){x.stopHandler&&x.stopHandler({eventSource:x,pointerType:E,position:v(b,x.element),buttons:x.getActivePointersListByType(E).buttons,isTouchEvent:E==="touch",originalEvent:b,userData:x.userData})}})(t),(function(e){e.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},e.Control=function(i,s,n){var a=i.parentNode;typeof s=="number"&&(e.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),s={anchor:s}),s.attachToViewer=typeof s.attachToViewer>"u"?!0:s.attachToViewer,this.autoFade=typeof s.autoFade>"u"?!0:s.autoFade,this.element=i,this.anchor=s.anchor,this.container=n,this.anchor===e.ControlAnchor.ABSOLUTE?(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top=typeof s.top=="number"?s.top+"px":s.top,this.wrapper.style.left=typeof s.left=="number"?s.left+"px":s.left,this.wrapper.style.height=typeof s.height=="number"?s.height+"px":s.height,this.wrapper.style.width=typeof s.width=="number"?s.width+"px":s.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor===e.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),s.attachToViewer?this.anchor===e.ControlAnchor.TOP_RIGHT||this.anchor===e.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):a.appendChild(this.wrapper)},e.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.anchor!==e.ControlAnchor.NONE&&this.container.removeChild(this.wrapper)},isVisible:function(){return this.wrapper.style.display!=="none"},setVisible:function(i){this.wrapper.style.display=i?this.anchor===e.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(i){this.element[e.SIGNAL]&&e.Browser.vendor===e.BROWSERS.IE?e.setElementOpacity(this.element,i,!0):e.setElementOpacity(this.wrapper,i,!0)}}})(t),(function(e){e.ControlDock=function(s){var n=["topleft","topright","bottomright","bottomleft"],a,r;for(e.extend(!0,this,{id:"controldock-"+e.now()+"-"+Math.floor(Math.random()*1e6),container:e.makeNeutralElement("div"),controls:[]},s),this.container.onsubmit=function(){return!1},this.element&&(this.element=e.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),r=0;r<n.length;r++)a=n[r],this.controls[a]=e.makeNeutralElement("div"),this.controls[a].style.position="absolute",a.match("left")&&(this.controls[a].style.left="0px"),a.match("right")&&(this.controls[a].style.right="0px"),a.match("top")&&(this.controls[a].style.top="0px"),a.match("bottom")&&(this.controls[a].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},e.ControlDock.prototype={addControl:function(s,n){s=e.getElement(s);var a=null;if(!(i(this,s)>=0)){switch(n.anchor){case e.ControlAnchor.TOP_RIGHT:a=this.controls.topright,s.style.position="relative",s.style.paddingRight="0px",s.style.paddingTop="0px";break;case e.ControlAnchor.BOTTOM_RIGHT:a=this.controls.bottomright,s.style.position="relative",s.style.paddingRight="0px",s.style.paddingBottom="0px";break;case e.ControlAnchor.BOTTOM_LEFT:a=this.controls.bottomleft,s.style.position="relative",s.style.paddingLeft="0px",s.style.paddingBottom="0px";break;case e.ControlAnchor.TOP_LEFT:a=this.controls.topleft,s.style.position="relative",s.style.paddingLeft="0px",s.style.paddingTop="0px";break;case e.ControlAnchor.ABSOLUTE:a=this.container,s.style.margin="0px",s.style.padding="0px";break;default:case e.ControlAnchor.NONE:a=this.container,s.style.margin="0px",s.style.padding="0px";break}this.controls.push(new e.Control(s,n,a)),s.style.display="inline-block"}},removeControl:function(s){s=e.getElement(s);var n=i(this,s);return n>=0&&(this.controls[n].destroy(),this.controls.splice(n,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var s;for(s=this.controls.length-1;s>=0;s--)if(this.controls[s].isVisible())return!0;return!1},setControlsEnabled:function(s){var n;for(n=this.controls.length-1;n>=0;n--)this.controls[n].setVisible(s);return this}};function i(s,n){var a=s.controls,r;for(r=a.length-1;r>=0;r--)if(a[r].element===n)return r;return-1}})(t),(function(e){e.Placement=e.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})})(t),(function(e){var i={},s=1;e.Viewer=function(y){var T=arguments,M=this,K;if(e.isPlainObject(y)||(y={id:T[0],xmlPath:T.length>1?T[1]:void 0,prefixUrl:T.length>2?T[2]:void 0,controls:T.length>3?T[3]:void 0,overlays:T.length>4?T[4]:void 0}),y.config&&(e.extend(!0,y,y.config),delete y.config),e.extend(!0,this,{id:y.id,hash:y.hash||s++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttonGroup:null,profiler:null},e.DEFAULT_SETTINGS,y),typeof this.hash>"u")throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(typeof i[this.hash]<"u"&&e.console.warn("Hash "+this.hash+" has already been used."),i[this.hash]={fsBoundsDelta:new e.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,needsResize:!1,forceResize:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null,lastClickTime:null,draggingToZoom:!1},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._updatePixelDensityRatioBind=null,this._lastScrollTime=e.now(),e.EventSource.call(this),this.addHandler("open-failed",function(q){var te=e.getString("Errors.OpenFailed",q.eventSource,q.message);M._showMessage(te)}),e.ControlDock.call(this,y),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=e.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",(function(q){q.width="100%",q.height="100%",q.overflow="hidden",q.position="absolute",q.top="0px",q.left="0px"})(this.canvas.style),e.setElementTouchActionNone(this.canvas),y.tabIndex!==""&&(this.canvas.tabIndex=y.tabIndex===void 0?0:y.tabIndex),this.container.className="openseadragon-container",(function(q){q.width="100%",q.height="100%",q.position="relative",q.overflow="hidden",q.left="0px",q.top="0px",q.textAlign="left"})(this.container.style),e.setElementTouchActionNone(this.container),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new e.MouseTracker({userData:"Viewer.innerTracker",element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,contextMenuHandler:e.delegate(this,v),keyDownHandler:e.delegate(this,w),keyHandler:e.delegate(this,S),clickHandler:e.delegate(this,_),dblClickHandler:e.delegate(this,A),dragHandler:e.delegate(this,P),dragEndHandler:e.delegate(this,k),enterHandler:e.delegate(this,N),leaveHandler:e.delegate(this,O),pressHandler:e.delegate(this,j),releaseHandler:e.delegate(this,U),nonPrimaryPressHandler:e.delegate(this,G),nonPrimaryReleaseHandler:e.delegate(this,R),scrollHandler:e.delegate(this,z),pinchHandler:e.delegate(this,D),focusHandler:e.delegate(this,I),blurHandler:e.delegate(this,W)}),this.outerTracker=new e.MouseTracker({userData:"Viewer.outerTracker",element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:e.delegate(this,B),leaveHandler:e.delegate(this,H)}),this.toolbar&&(this.toolbar=new e.ControlDock({element:this.toolbar})),this.bindStandardControls(),i[this.hash].prevContainerSize=n(this.container),window.ResizeObserver?(this._autoResizePolling=!1,this._resizeObserver=new ResizeObserver(function(){i[M.hash].needsResize=!0}),this._resizeObserver.observe(this.container,{})):this._autoResizePolling=!0,this.world=new e.World({viewer:this}),this.world.addHandler("add-item",function(q){M.source=M.world.getItemAt(0).source,i[M.hash].forceRedraw=!0,M._updateRequestId||(M._updateRequestId=l(M,$))}),this.world.addHandler("remove-item",function(q){M.world.getItemCount()?M.source=M.world.getItemAt(0).source:M.source=null,i[M.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(q){M.viewport&&M.viewport._setContentBounds(M.world.getHomeBounds(),M.world.getContentFactor())}),this.world.addHandler("item-index-change",function(q){M.source=M.world.getItemAt(0).source}),this.viewport=new e.Viewport({containerSize:i[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins,silenceMultiImageWarnings:this.silenceMultiImageWarnings}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new e.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:y.timeout,tileRetryMax:this.tileRetryMax,tileRetryDelay:this.tileRetryDelay}),this.tileCache=new e.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new e.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=e.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(K=this.buttonGroup.buttons.indexOf(this.rotateLeft),this.buttonGroup.buttons.splice(K,1),this.buttonGroup.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(K=this.buttonGroup.buttons.indexOf(this.rotateRight),this.buttonGroup.buttons.splice(K,1),this.buttonGroup.element.removeChild(this.rotateRight.element))),this._addUpdatePixelDensityRatioEvent(),this.showNavigator&&(this.navigator=new e.Navigator({element:this.navigatorElement,id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy,animationTime:this.animationTime})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),K=0;K<this.customControls.length;K++)this.addControl(this.customControls[K].id,{anchor:this.customControls[K].anchor});e.requestAnimationFrame(function(){h(M)}),this.imageSmoothingEnabled!==void 0&&!this.imageSmoothingEnabled&&this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled),e._viewers.set(this.element,this)},e.extend(e.Viewer.prototype,e.EventSource.prototype,e.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(y){return e.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(y)},openTileSource:function(y){return e.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(y)},get buttons(){return e.console.warn("Viewer.buttons is deprecated; Please use Viewer.buttonGroup"),this.buttonGroup},open:function(y,T){var M=this;if(this.close(),!y)return this;if(this.sequenceMode&&e.isArray(y))return this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),typeof T<"u"&&!isNaN(T)&&(this.initialPage=T),this.tileSources=y,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),this._updateSequenceButtons(this._sequenceIndex),this;if(e.isArray(y)||(y=[y]),!y.length)return this;this._opening=!0;for(var K=y.length,q=0,te=0,Z,ye=function(){if(q+te===K)if(q){(M._firstOpen||!M.preserveViewport)&&(M.viewport.goHome(!0),M.viewport.update()),M._firstOpen=!1;var se=y[0];if(se.tileSource&&(se=se.tileSource),M.overlays&&!M.preserveOverlays)for(var X=0;X<M.overlays.length;X++)M.currentOverlays[X]=r(M,M.overlays[X]);M._drawOverlays(),M._opening=!1,M.raiseEvent("open",{source:se})}else M._opening=!1,M.raiseEvent("open-failed",Z)},Ee=function(se){(!e.isPlainObject(se)||!se.tileSource)&&(se={tileSource:se}),se.index!==void 0&&(e.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete se.index),se.collectionImmediately===void 0&&(se.collectionImmediately=!0);var X=se.success;se.success=function(b){if(q++,se.tileSource.overlays)for(var E=0;E<se.tileSource.overlays.length;E++)M.addOverlay(se.tileSource.overlays[E]);X&&X(b),ye()};var x=se.error;se.error=function(b){te++,Z||(Z=b),x&&x(b),ye()},M.addTiledImage(se)},_e=0;_e<y.length;_e++)Ee(y[_e]);return this},close:function(){return i[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),i[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(i[this.hash]){if(this.raiseEvent("before-destroy"),this._removeUpdatePixelDensityRatioEvent(),this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this._resizeObserver&&this._resizeObserver.disconnect(),this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),this._updateRequestId!==null&&(e.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.navigator&&(this.navigator.destroy(),i[this.navigator.hash]=null,delete i[this.navigator.hash],this.navigator=null),this.buttonGroup)this.buttonGroup.destroy();else if(this.customButtons)for(;this.customButtons.length;)this.customButtons.pop().destroy();if(this.paging&&this.paging.destroy(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.container.onsubmit=null,this.clearControls(),this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),i[this.hash]=null,delete i[this.hash],this.canvas=null,this.container=null,e._viewers.delete(this.element),this.element=null,this.raiseEvent("destroy"),this.removeAllHandlers()}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(y){return this.innerTracker.setTracking(y),this.outerTracker.setTracking(y),this.raiseEvent("mouse-enabled",{enabled:y}),this},areControlsEnabled:function(){var y=this.controls.length,T;for(T=0;T<this.controls.length;T++)y=y&&this.controls[T].isVisible();return y},setControlsEnabled:function(y){return y?f(this):h(this),this.raiseEvent("controls-enabled",{enabled:y}),this},setDebugMode:function(y){for(var T=0;T<this.world.getItemCount();T++)this.world.getItemAt(T).debugMode=y;this.debugMode=y,this.forceRedraw()},setAjaxHeaders:function(y,T){if(y===null&&(y={}),!e.isPlainObject(y)){console.error("[Viewer.setAjaxHeaders] Ignoring invalid headers, must be a plain object");return}if(T===void 0&&(T=!0),this.ajaxHeaders=y,T){for(var M=0;M<this.world.getItemCount();M++)this.world.getItemAt(M)._updateAjaxHeaders(!0);if(this.navigator&&this.navigator.setAjaxHeaders(this.ajaxHeaders,!0),this.referenceStrip&&this.referenceStrip.miniViewers)for(var K in this.referenceStrip.miniViewers)this.referenceStrip.miniViewers[K].setAjaxHeaders(this.ajaxHeaders,!0)}},addButton:function(y){this.buttonGroup.addButton(y)},isFullPage:function(){return i[this.hash].fullPage},setFullPage:function(y){var T=document.body,M=T.style,K=document.documentElement.style,q=this,te,Z;if(y===this.isFullPage())return this;var ye={fullPage:y,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",ye),ye.preventDefaultAction)return this;if(y){for(this.elementSize=e.getElementSize(this.element),this.pageScroll=e.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=M.margin,this.docMargin=K.margin,M.margin="0",K.margin="0",this.bodyPadding=M.padding,this.docPadding=K.padding,M.padding="0",K.padding="0",this.bodyWidth=M.width,this.docWidth=K.width,M.width="100%",K.width="100%",this.bodyHeight=M.height,this.docHeight=K.height,M.height="100%",K.height="100%",this.bodyDisplay=M.display,M.display="block",this.previousBody=[],i[this.hash].prevElementParent=this.element.parentNode,i[this.hash].prevNextSibling=this.element.nextSibling,i[this.hash].prevElementWidth=this.element.style.width,i[this.hash].prevElementHeight=this.element.style.height,te=T.childNodes.length,Z=0;Z<te;Z++)this.previousBody.push(T.childNodes[0]),T.removeChild(T.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,T.appendChild(this.toolbar.element),e.addClass(this.toolbar.element,"fullpage")),e.addClass(this.element,"fullpage"),T.appendChild(this.element),this.element.style.height="100vh",this.element.style.width="100vw",this.toolbar&&this.toolbar.element&&(this.element.style.height=e.getElementSize(this.element).y-e.getElementSize(this.toolbar.element).y+"px"),i[this.hash].fullPage=!0,e.delegate(this,B)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,M.margin=this.bodyMargin,K.margin=this.docMargin,M.padding=this.bodyPadding,K.padding=this.docPadding,M.width=this.bodyWidth,K.width=this.docWidth,M.height=this.bodyHeight,K.height=this.docHeight,M.display=this.bodyDisplay,T.removeChild(this.element),te=this.previousBody.length,Z=0;Z<te;Z++)T.appendChild(this.previousBody.shift());e.removeClass(this.element,"fullpage"),i[this.hash].prevElementParent.insertBefore(this.element,i[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(T.removeChild(this.toolbar.element),e.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=i[this.hash].prevElementWidth,this.element.style.height=i[this.hash].prevElementHeight;var Ee=0,_e=function(){e.setPageScroll(q.pageScroll);var se=e.getPageScroll();Ee++,Ee<10&&(se.x!==q.pageScroll.x||se.y!==q.pageScroll.y)&&e.requestAnimationFrame(_e)};e.requestAnimationFrame(_e),i[this.hash].fullPage=!1,e.delegate(this,H)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:y}),this},setFullScreen:function(y){var T=this;if(!e.supportsFullScreen)return this.setFullPage(y);if(e.isFullScreen()===y)return this;var M={fullScreen:y,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",M),M.preventDefaultAction)return this;if(y){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var K=function(){var q=e.isFullScreen();q||(e.removeEvent(document,e.fullScreenEventName,K),e.removeEvent(document,e.fullScreenErrorEventName,K),T.setFullPage(!1),T.isFullPage()&&(T.element.style.width=T.fullPageStyleWidth,T.element.style.height=T.fullPageStyleHeight)),T.navigator&&T.viewport&&setTimeout(function(){T.navigator.update(T.viewport)}),T.raiseEvent("full-screen",{fullScreen:q})};e.addEvent(document,e.fullScreenEventName,K),e.addEvent(document,e.fullScreenErrorEventName,K),e.requestFullScreen(document.body)}else e.exitFullScreen();return this},isVisible:function(){return this.container.style.visibility!=="hidden"},isFullScreen:function(){return e.isFullScreen()&&this.isFullPage()},setVisible:function(y){return this.container.style.visibility=y?"":"hidden",this.raiseEvent("visible",{visible:y}),this},addTiledImage:function(y){e.console.assert(y,"[Viewer.addTiledImage] options is required"),e.console.assert(y.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),e.console.assert(!y.replace||y.index>-1&&y.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var T=this;y.replace&&(y.replaceItem=T.world.getItemAt(y.index)),this._hideMessage(),y.placeholderFillStyle===void 0&&(y.placeholderFillStyle=this.placeholderFillStyle),y.opacity===void 0&&(y.opacity=this.opacity),y.preload===void 0&&(y.preload=this.preload),y.compositeOperation===void 0&&(y.compositeOperation=this.compositeOperation),y.crossOriginPolicy===void 0&&(y.crossOriginPolicy=y.tileSource.crossOriginPolicy!==void 0?y.tileSource.crossOriginPolicy:this.crossOriginPolicy),y.ajaxWithCredentials===void 0&&(y.ajaxWithCredentials=this.ajaxWithCredentials),y.loadTilesWithAjax===void 0&&(y.loadTilesWithAjax=this.loadTilesWithAjax),e.isPlainObject(y.ajaxHeaders)||(y.ajaxHeaders={});var M={options:y};function K(Z){for(var ye=0;ye<T._loadQueue.length;ye++)if(T._loadQueue[ye]===M){T._loadQueue.splice(ye,1);break}T._loadQueue.length===0&&q(M),T.raiseEvent("add-item-failed",Z),y.error&&y.error(Z)}function q(Z){T.collectionMode&&(T.world.arrange({immediately:Z.options.collectionImmediately,rows:T.collectionRows,columns:T.collectionColumns,layout:T.collectionLayout,tileSize:T.collectionTileSize,tileMargin:T.collectionTileMargin}),T.world.setAutoRefigureSizes(!0))}if(e.isArray(y.tileSource)){setTimeout(function(){K({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:y.tileSource,options:y})});return}this._loadQueue.push(M);function te(){for(var Z,ye,Ee;T._loadQueue.length&&(Z=T._loadQueue[0],!!Z.tileSource);){if(T._loadQueue.splice(0,1),Z.options.replace){var _e=T.world.getIndexOfItem(Z.options.replaceItem);_e!==-1&&(Z.options.index=_e),T.world.removeItem(Z.options.replaceItem)}ye=new e.TiledImage({viewer:T,source:Z.tileSource,viewport:T.viewport,drawer:T.drawer,tileCache:T.tileCache,imageLoader:T.imageLoader,x:Z.options.x,y:Z.options.y,width:Z.options.width,height:Z.options.height,fitBounds:Z.options.fitBounds,fitBoundsPlacement:Z.options.fitBoundsPlacement,clip:Z.options.clip,placeholderFillStyle:Z.options.placeholderFillStyle,opacity:Z.options.opacity,preload:Z.options.preload,degrees:Z.options.degrees,flipped:Z.options.flipped,compositeOperation:Z.options.compositeOperation,springStiffness:T.springStiffness,animationTime:T.animationTime,minZoomImageRatio:T.minZoomImageRatio,wrapHorizontal:T.wrapHorizontal,wrapVertical:T.wrapVertical,immediateRender:T.immediateRender,blendTime:T.blendTime,alwaysBlend:T.alwaysBlend,minPixelRatio:T.minPixelRatio,smoothTileEdgesMinZoom:T.smoothTileEdgesMinZoom,iOSDevice:T.iOSDevice,crossOriginPolicy:Z.options.crossOriginPolicy,ajaxWithCredentials:Z.options.ajaxWithCredentials,loadTilesWithAjax:Z.options.loadTilesWithAjax,ajaxHeaders:Z.options.ajaxHeaders,debugMode:T.debugMode,subPixelRoundingForTransparency:T.subPixelRoundingForTransparency}),T.collectionMode&&T.world.setAutoRefigureSizes(!1),T.navigator&&(Ee=e.extend({},Z.options,{replace:!1,originalTiledImage:ye,tileSource:Z.tileSource}),T.navigator.addTiledImage(Ee)),T.world.addItem(ye,{index:Z.options.index}),T._loadQueue.length===0&&q(Z),T.world.getItemCount()===1&&!T.preserveViewport&&T.viewport.goHome(!0),Z.options.success&&Z.options.success({item:ye})}}a(this,y.tileSource,y,function(Z){M.tileSource=Z,te()},function(Z){Z.options=y,K(Z),te()})},addSimpleImage:function(y){e.console.assert(y,"[Viewer.addSimpleImage] options is required"),e.console.assert(y.url,"[Viewer.addSimpleImage] options.url is required");var T=e.extend({},y,{tileSource:{type:"image",url:y.url}});delete T.url,this.addTiledImage(T)},addLayer:function(y){var T=this;e.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var M=e.extend({},y,{success:function(K){T.raiseEvent("add-layer",{options:y,drawer:K.item})},error:function(K){T.raiseEvent("add-layer-failed",K)}});return this.addTiledImage(M),this},getLayerAtLevel:function(y){return e.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(y)},getLevelOfLayer:function(y){return e.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(y)},getLayersCount:function(){return e.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(y,T){return e.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(y,T)},removeLayer:function(y){return e.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(y)},forceRedraw:function(){return i[this.hash].forceRedraw=!0,this},forceResize:function(){i[this.hash].needsResize=!0,i[this.hash].forceResize=!0},bindSequenceControls:function(){var y=e.delegate(this,p),T=e.delegate(this,m),M=e.delegate(this,this.goToNextPage),K=e.delegate(this,this.goToPreviousPage),q=this.navImages,te=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(te=!1),this.previousButton=new e.Button({element:this.previousButton?e.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.PreviousPage"),srcRest:Q(this.prefixUrl,q.previous.REST),srcGroup:Q(this.prefixUrl,q.previous.GROUP),srcHover:Q(this.prefixUrl,q.previous.HOVER),srcDown:Q(this.prefixUrl,q.previous.DOWN),onRelease:K,onFocus:y,onBlur:T}),this.nextButton=new e.Button({element:this.nextButton?e.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.NextPage"),srcRest:Q(this.prefixUrl,q.next.REST),srcGroup:Q(this.prefixUrl,q.next.GROUP),srcHover:Q(this.prefixUrl,q.next.HOVER),srcDown:Q(this.prefixUrl,q.next.DOWN),onRelease:M,onFocus:y,onBlur:T}),this.navPrevNextWrap||this.previousButton.disable(),(!this.tileSources||!this.tileSources.length)&&this.nextButton.disable(),te&&(this.paging=new e.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:e.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||e.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var y=e.delegate(this,Te),T=e.delegate(this,ge),M=e.delegate(this,Ce),K=e.delegate(this,Ae),q=e.delegate(this,de),te=e.delegate(this,Ue),Z=e.delegate(this,Y),ye=e.delegate(this,le),Ee=e.delegate(this,ve),_e=e.delegate(this,be),se=e.delegate(this,p),X=e.delegate(this,m),x=this.navImages,b=[],E=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(E=!1),this.showZoomControl&&(b.push(this.zoomInButton=new e.Button({element:this.zoomInButton?e.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomIn"),srcRest:Q(this.prefixUrl,x.zoomIn.REST),srcGroup:Q(this.prefixUrl,x.zoomIn.GROUP),srcHover:Q(this.prefixUrl,x.zoomIn.HOVER),srcDown:Q(this.prefixUrl,x.zoomIn.DOWN),onPress:y,onRelease:T,onClick:M,onEnter:y,onExit:T,onFocus:se,onBlur:X})),b.push(this.zoomOutButton=new e.Button({element:this.zoomOutButton?e.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomOut"),srcRest:Q(this.prefixUrl,x.zoomOut.REST),srcGroup:Q(this.prefixUrl,x.zoomOut.GROUP),srcHover:Q(this.prefixUrl,x.zoomOut.HOVER),srcDown:Q(this.prefixUrl,x.zoomOut.DOWN),onPress:K,onRelease:T,onClick:q,onEnter:K,onExit:T,onFocus:se,onBlur:X}))),this.showHomeControl&&b.push(this.homeButton=new e.Button({element:this.homeButton?e.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Home"),srcRest:Q(this.prefixUrl,x.home.REST),srcGroup:Q(this.prefixUrl,x.home.GROUP),srcHover:Q(this.prefixUrl,x.home.HOVER),srcDown:Q(this.prefixUrl,x.home.DOWN),onRelease:te,onFocus:se,onBlur:X})),this.showFullPageControl&&b.push(this.fullPageButton=new e.Button({element:this.fullPageButton?e.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.FullPage"),srcRest:Q(this.prefixUrl,x.fullpage.REST),srcGroup:Q(this.prefixUrl,x.fullpage.GROUP),srcHover:Q(this.prefixUrl,x.fullpage.HOVER),srcDown:Q(this.prefixUrl,x.fullpage.DOWN),onRelease:Z,onFocus:se,onBlur:X})),this.showRotationControl&&(b.push(this.rotateLeftButton=new e.Button({element:this.rotateLeftButton?e.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateLeft"),srcRest:Q(this.prefixUrl,x.rotateleft.REST),srcGroup:Q(this.prefixUrl,x.rotateleft.GROUP),srcHover:Q(this.prefixUrl,x.rotateleft.HOVER),srcDown:Q(this.prefixUrl,x.rotateleft.DOWN),onRelease:ye,onFocus:se,onBlur:X})),b.push(this.rotateRightButton=new e.Button({element:this.rotateRightButton?e.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateRight"),srcRest:Q(this.prefixUrl,x.rotateright.REST),srcGroup:Q(this.prefixUrl,x.rotateright.GROUP),srcHover:Q(this.prefixUrl,x.rotateright.HOVER),srcDown:Q(this.prefixUrl,x.rotateright.DOWN),onRelease:Ee,onFocus:se,onBlur:X}))),this.showFlipControl&&b.push(this.flipButton=new e.Button({element:this.flipButton?e.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Flip"),srcRest:Q(this.prefixUrl,x.flip.REST),srcGroup:Q(this.prefixUrl,x.flip.GROUP),srcHover:Q(this.prefixUrl,x.flip.HOVER),srcDown:Q(this.prefixUrl,x.flip.DOWN),onRelease:_e,onFocus:se,onBlur:X})),E?(this.buttonGroup=new e.ButtonGroup({buttons:b,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttonGroup.element,this.addHandler("open",e.delegate(this,je)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||e.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||e.ControlAnchor.TOP_LEFT})):this.customButtons=b),this},currentPage:function(){return this._sequenceIndex},goToPage:function(y){return this.tileSources&&y>=0&&y<this.tileSources.length&&(this._sequenceIndex=y,this._updateSequenceButtons(y),this.open(this.tileSources[y]),this.referenceStrip&&this.referenceStrip.setFocus(y),this.raiseEvent("page",{page:y})),this},addOverlay:function(y,T,M,K){var q;if(e.isPlainObject(y)?q=y:q={element:y,location:T,placement:M,onDraw:K},y=e.getElement(q.element),o(this.currentOverlays,y)>=0)return this;var te=r(this,q);return this.currentOverlays.push(te),te.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:y,location:q.location,placement:q.placement}),this},updateOverlay:function(y,T,M){var K;return y=e.getElement(y),K=o(this.currentOverlays,y),K>=0&&(this.currentOverlays[K].update(T,M),i[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:y,location:T,placement:M})),this},removeOverlay:function(y){var T;return y=e.getElement(y),T=o(this.currentOverlays,y),T>=0&&(this.currentOverlays[T].destroy(),this.currentOverlays.splice(T,1),i[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:y})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return i[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(y){var T;return y=e.getElement(y),T=o(this.currentOverlays,y),T>=0?this.currentOverlays[T]:null},_updateSequenceButtons:function(y){this.nextButton&&(!this.tileSources||this.tileSources.length-1===y?this.navPrevNextWrap||this.nextButton.disable():this.nextButton.enable()),this.previousButton&&(y>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(y){this._hideMessage();var T=e.makeNeutralElement("div");T.appendChild(document.createTextNode(y)),this.messageDiv=e.makeCenteredNode(T),e.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var y=this.messageDiv;y&&(y.parentNode.removeChild(y),delete this.messageDiv)},gestureSettingsByDeviceType:function(y){switch(y){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var y,T=this.currentOverlays.length;for(y=0;y<T;y++)this.currentOverlays[y].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new e.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else e.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')},_addUpdatePixelDensityRatioEvent:function(){this._updatePixelDensityRatioBind=this._updatePixelDensityRatio.bind(this),e.addEvent(window,"resize",this._updatePixelDensityRatioBind)},_removeUpdatePixelDensityRatioEvent:function(){e.removeEvent(window,"resize",this._updatePixelDensityRatioBind)},_updatePixelDensityRatio:function(){var y=e.pixelDensityRatio,T=e.getCurrentPixelDensityRatio();y!==T&&(e.pixelDensityRatio=T,this.world.resetItems(),this.forceRedraw())},goToPreviousPage:function(){var y=this._sequenceIndex-1;this.navPrevNextWrap&&y<0&&(y+=this.tileSources.length),this.goToPage(y)},goToNextPage:function(){var y=this._sequenceIndex+1;this.navPrevNextWrap&&y>=this.tileSources.length&&(y=0),this.goToPage(y)},isAnimating:function(){return i[this.hash].animating}});function n(y){return y=e.getElement(y),new e.Point(y.clientWidth===0?1:y.clientWidth,y.clientHeight===0?1:y.clientHeight)}function a(y,T,M,K,q){var te=y;if(e.type(T)==="string"){if(T.match(/^\s*<.*>\s*$/))T=e.parseXml(T);else if(T.match(/^\s*[{[].*[}\]]\s*$/))try{var Z=e.parseJSON(T);T=Z}catch{}}function ye(Ee,_e){Ee.ready?K(Ee):(Ee.addHandler("ready",function(){K(Ee)}),Ee.addHandler("open-failed",function(se){q({message:se.message,source:_e})}))}setTimeout(function(){if(e.type(T)==="string")T=new e.TileSource({url:T,crossOriginPolicy:M.crossOriginPolicy!==void 0?M.crossOriginPolicy:y.crossOriginPolicy,ajaxWithCredentials:y.ajaxWithCredentials,ajaxHeaders:M.ajaxHeaders?M.ajaxHeaders:y.ajaxHeaders,splitHashDataForPost:y.splitHashDataForPost,useCanvas:y.useCanvas,success:function(X){K(X.tileSource)}}),T.addHandler("open-failed",function(X){q(X)});else if(e.isPlainObject(T)||T.nodeType)if(T.crossOriginPolicy===void 0&&(M.crossOriginPolicy!==void 0||y.crossOriginPolicy!==void 0)&&(T.crossOriginPolicy=M.crossOriginPolicy!==void 0?M.crossOriginPolicy:y.crossOriginPolicy),T.ajaxWithCredentials===void 0&&(T.ajaxWithCredentials=y.ajaxWithCredentials),T.useCanvas===void 0&&(T.useCanvas=y.useCanvas),e.isFunction(T.getTileUrl)){var Ee=new e.TileSource(T);Ee.getTileUrl=T.getTileUrl,K(Ee)}else{var _e=e.TileSource.determineType(te,T);if(!_e){q({message:"Unable to load TileSource",source:T});return}var se=_e.prototype.configure.apply(te,[T]);ye(new _e(se),T)}else ye(T,T)})}function r(y,T){if(T instanceof e.Overlay)return T;var M=null;if(T.element)M=e.getElement(T.element);else{var K=T.id?T.id:"openseadragon-overlay-"+Math.floor(Math.random()*1e7);M=e.getElement(T.id),M||(M=document.createElement("a"),M.href="#/overlay/"+K),M.id=K,e.addClass(M,T.className?T.className:"openseadragon-overlay")}var q=T.location,te=T.width,Z=T.height;if(!q){var ye=T.x,Ee=T.y;if(T.px!==void 0){var _e=y.viewport.imageToViewportRectangle(new e.Rect(T.px,T.py,te||0,Z||0));ye=_e.x,Ee=_e.y,te=te!==void 0?_e.width:void 0,Z=Z!==void 0?_e.height:void 0}q=new e.Point(ye,Ee)}var se=T.placement;return se&&e.type(se)==="string"&&(se=e.Placement[T.placement.toUpperCase()]),new e.Overlay({element:M,location:q,placement:se,onDraw:T.onDraw,checkResize:T.checkResize,width:te,height:Z,rotationMode:T.rotationMode})}function o(y,T){var M;for(M=y.length-1;M>=0;M--)if(y[M].element===T)return M;return-1}function l(y,T){return e.requestAnimationFrame(function(){T(y)})}function c(y){e.requestAnimationFrame(function(){d(y)})}function h(y){y.autoHideControls&&(y.controlsShouldFade=!0,y.controlsFadeBeginTime=e.now()+y.controlsFadeDelay,window.setTimeout(function(){c(y)},y.controlsFadeDelay))}function d(y){var T,M,K,q;if(y.controlsShouldFade){for(T=e.now(),M=T-y.controlsFadeBeginTime,K=1-M/y.controlsFadeLength,K=Math.min(1,K),K=Math.max(0,K),q=y.controls.length-1;q>=0;q--)y.controls[q].autoFade&&y.controls[q].setOpacity(K);K>0&&c(y)}}function f(y){var T;for(y.controlsShouldFade=!1,T=y.controls.length-1;T>=0;T--)y.controls[T].setOpacity(1)}function p(){f(this)}function m(){h(this)}function v(y){var T={tracker:y.eventSource,position:y.position,originalEvent:y.originalEvent,preventDefault:y.preventDefault};this.raiseEvent("canvas-contextmenu",T),y.preventDefault=T.preventDefault}function w(y){var T={originalEvent:y.originalEvent,preventDefaultAction:!1,preventVerticalPan:y.preventVerticalPan||!this.panVertical,preventHorizontalPan:y.preventHorizontalPan||!this.panHorizontal};if(this.raiseEvent("canvas-key",T),!T.preventDefaultAction&&!y.ctrl&&!y.alt&&!y.meta)switch(y.keyCode){case 38:T.preventVerticalPan||(y.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),y.preventDefault=!0;break;case 40:T.preventVerticalPan||(y.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),y.preventDefault=!0;break;case 37:T.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),y.preventDefault=!0;break;case 39:T.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),y.preventDefault=!0;break;case 187:this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),y.preventDefault=!0;break;case 189:this.viewport.zoomBy(.9),this.viewport.applyConstraints(),y.preventDefault=!0;break;case 48:this.viewport.goHome(),this.viewport.applyConstraints(),y.preventDefault=!0;break;case 87:T.preventVerticalPan||(y.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-40))),this.viewport.applyConstraints()),y.preventDefault=!0;break;case 83:T.preventVerticalPan||(y.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,40))),this.viewport.applyConstraints()),y.preventDefault=!0;break;case 65:T.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-40,0))),this.viewport.applyConstraints()),y.preventDefault=!0;break;case 68:T.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(40,0))),this.viewport.applyConstraints()),y.preventDefault=!0;break;case 82:y.shift?this.viewport.flipped?this.viewport.setRotation(this.viewport.getRotation()+this.rotationIncrement):this.viewport.setRotation(this.viewport.getRotation()-this.rotationIncrement):this.viewport.flipped?this.viewport.setRotation(this.viewport.getRotation()-this.rotationIncrement):this.viewport.setRotation(this.viewport.getRotation()+this.rotationIncrement),this.viewport.applyConstraints(),y.preventDefault=!0;break;case 70:this.viewport.toggleFlip(),y.preventDefault=!0;break;case 74:this.goToPreviousPage();break;case 75:this.goToNextPage();break;default:y.preventDefault=!1;break}else y.preventDefault=!1}function S(y){var T={originalEvent:y.originalEvent};this.raiseEvent("canvas-key-press",T)}function _(y){var T,M=document.activeElement===this.canvas;M||this.canvas.focus(),this.viewport.flipped&&(y.position.x=this.viewport.getContainerSize().x-y.position.x);var K={tracker:y.eventSource,position:y.position,quick:y.quick,shift:y.shift,originalEvent:y.originalEvent,originalTarget:y.originalTarget,preventDefaultAction:!1};this.raiseEvent("canvas-click",K),!K.preventDefaultAction&&this.viewport&&y.quick&&(T=this.gestureSettingsByDeviceType(y.pointerType),T.clickToZoom===!0&&(this.viewport.zoomBy(y.shift?1/this.zoomPerClick:this.zoomPerClick,T.zoomToRefPoint?this.viewport.pointFromPixel(y.position,!0):null),this.viewport.applyConstraints()),T.dblClickDragToZoom&&(i[this.hash].draggingToZoom===!0?(i[this.hash].lastClickTime=null,i[this.hash].draggingToZoom=!1):i[this.hash].lastClickTime=e.now()))}function A(y){var T,M={tracker:y.eventSource,position:y.position,shift:y.shift,originalEvent:y.originalEvent,preventDefaultAction:!1};this.raiseEvent("canvas-double-click",M),!M.preventDefaultAction&&this.viewport&&(T=this.gestureSettingsByDeviceType(y.pointerType),T.dblClickToZoom&&(this.viewport.zoomBy(y.shift?1/this.zoomPerClick:this.zoomPerClick,T.zoomToRefPoint?this.viewport.pointFromPixel(y.position,!0):null),this.viewport.applyConstraints()))}function P(y){var T,M={tracker:y.eventSource,pointerType:y.pointerType,position:y.position,delta:y.delta,speed:y.speed,direction:y.direction,shift:y.shift,originalEvent:y.originalEvent,preventDefaultAction:!1};if(this.raiseEvent("canvas-drag",M),T=this.gestureSettingsByDeviceType(y.pointerType),!M.preventDefaultAction&&this.viewport){if(T.dblClickDragToZoom&&i[this.hash].draggingToZoom){var K=Math.pow(this.zoomPerDblClickDrag,y.delta.y/50);this.viewport.zoomBy(K)}else if(T.dragToPan&&!i[this.hash].draggingToZoom){if(this.panHorizontal||(y.delta.x=0),this.panVertical||(y.delta.y=0),this.viewport.flipped&&(y.delta.x=-y.delta.x),this.constrainDuringPan){var q=this.viewport.deltaPointsFromPixels(y.delta.negate());this.viewport.centerSpringX.target.value+=q.x,this.viewport.centerSpringY.target.value+=q.y;var te=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=q.x,this.viewport.centerSpringY.target.value-=q.y,te.xConstrained&&(y.delta.x=0),te.yConstrained&&(y.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(y.delta.negate()),T.flickEnabled&&!this.constrainDuringPan)}}}function k(y){var T,M={tracker:y.eventSource,pointerType:y.pointerType,position:y.position,speed:y.speed,direction:y.direction,shift:y.shift,originalEvent:y.originalEvent,preventDefaultAction:!1};if(this.raiseEvent("canvas-drag-end",M),T=this.gestureSettingsByDeviceType(y.pointerType),!M.preventDefaultAction&&this.viewport){if(!i[this.hash].draggingToZoom&&T.flickEnabled&&y.speed>=T.flickMinSpeed){var K=0;this.panHorizontal&&(K=T.flickMomentum*y.speed*Math.cos(y.direction));var q=0;this.panVertical&&(q=T.flickMomentum*y.speed*Math.sin(y.direction));var te=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),Z=this.viewport.pointFromPixel(new e.Point(te.x-K,te.y-q));this.viewport.panTo(Z,!1)}this.viewport.applyConstraints()}T.dblClickDragToZoom&&i[this.hash].draggingToZoom===!0&&(i[this.hash].draggingToZoom=!1)}function N(y){this.raiseEvent("canvas-enter",{tracker:y.eventSource,pointerType:y.pointerType,position:y.position,buttons:y.buttons,pointers:y.pointers,insideElementPressed:y.insideElementPressed,buttonDownAny:y.buttonDownAny,originalEvent:y.originalEvent})}function O(y){this.raiseEvent("canvas-exit",{tracker:y.eventSource,pointerType:y.pointerType,position:y.position,buttons:y.buttons,pointers:y.pointers,insideElementPressed:y.insideElementPressed,buttonDownAny:y.buttonDownAny,originalEvent:y.originalEvent})}function j(y){var T;if(this.raiseEvent("canvas-press",{tracker:y.eventSource,pointerType:y.pointerType,position:y.position,insideElementPressed:y.insideElementPressed,insideElementReleased:y.insideElementReleased,originalEvent:y.originalEvent}),T=this.gestureSettingsByDeviceType(y.pointerType),T.dblClickDragToZoom){var M=i[this.hash].lastClickTime,K=e.now();if(M===null)return;K-M<this.dblClickTimeThreshold&&(i[this.hash].draggingToZoom=!0),i[this.hash].lastClickTime=null}}function U(y){this.raiseEvent("canvas-release",{tracker:y.eventSource,pointerType:y.pointerType,position:y.position,insideElementPressed:y.insideElementPressed,insideElementReleased:y.insideElementReleased,originalEvent:y.originalEvent})}function G(y){this.raiseEvent("canvas-nonprimary-press",{tracker:y.eventSource,position:y.position,pointerType:y.pointerType,button:y.button,buttons:y.buttons,originalEvent:y.originalEvent})}function R(y){this.raiseEvent("canvas-nonprimary-release",{tracker:y.eventSource,position:y.position,pointerType:y.pointerType,button:y.button,buttons:y.buttons,originalEvent:y.originalEvent})}function D(y){var T,M,K,q,te={tracker:y.eventSource,pointerType:y.pointerType,gesturePoints:y.gesturePoints,lastCenter:y.lastCenter,center:y.center,lastDistance:y.lastDistance,distance:y.distance,shift:y.shift,originalEvent:y.originalEvent,preventDefaultPanAction:!1,preventDefaultZoomAction:!1,preventDefaultRotateAction:!1};if(this.raiseEvent("canvas-pinch",te),this.viewport&&(T=this.gestureSettingsByDeviceType(y.pointerType),T.pinchToZoom&&(!te.preventDefaultPanAction||!te.preventDefaultZoomAction)&&(M=this.viewport.pointFromPixel(y.center,!0),T.zoomToRefPoint&&!te.preventDefaultPanAction&&(K=this.viewport.pointFromPixel(y.lastCenter,!0),q=K.minus(M),this.panHorizontal||(q.x=0),this.panVertical||(q.y=0),this.viewport.panBy(q,!0)),te.preventDefaultZoomAction||this.viewport.zoomBy(y.distance/y.lastDistance,M,!0),this.viewport.applyConstraints()),T.pinchRotate&&!te.preventDefaultRotateAction)){var Z=Math.atan2(y.gesturePoints[0].currentPos.y-y.gesturePoints[1].currentPos.y,y.gesturePoints[0].currentPos.x-y.gesturePoints[1].currentPos.x),ye=Math.atan2(y.gesturePoints[0].lastPos.y-y.gesturePoints[1].lastPos.y,y.gesturePoints[0].lastPos.x-y.gesturePoints[1].lastPos.x);M=this.viewport.pointFromPixel(y.center,!0),this.viewport.rotateTo(this.viewport.getRotation(!0)+(Z-ye)*(180/Math.PI),M,!0)}}function I(y){this.raiseEvent("canvas-focus",{tracker:y.eventSource,originalEvent:y.originalEvent})}function W(y){this.raiseEvent("canvas-blur",{tracker:y.eventSource,originalEvent:y.originalEvent})}function z(y){var T,M,K,q,te;q=e.now(),te=q-this._lastScrollTime,te>this.minScrollDeltaTime?(this._lastScrollTime=q,T={tracker:y.eventSource,position:y.position,scroll:y.scroll,shift:y.shift,originalEvent:y.originalEvent,preventDefaultAction:!1,preventDefault:!0},this.raiseEvent("canvas-scroll",T),!T.preventDefaultAction&&this.viewport&&(this.viewport.flipped&&(y.position.x=this.viewport.getContainerSize().x-y.position.x),M=this.gestureSettingsByDeviceType(y.pointerType),M.scrollToZoom&&(K=Math.pow(this.zoomPerScroll,y.scroll),this.viewport.zoomBy(K,M.zoomToRefPoint?this.viewport.pointFromPixel(y.position,!0):null),this.viewport.applyConstraints())),y.preventDefault=T.preventDefault):y.preventDefault=!0}function B(y){i[this.hash].mouseInside=!0,f(this),this.raiseEvent("container-enter",{tracker:y.eventSource,pointerType:y.pointerType,position:y.position,buttons:y.buttons,pointers:y.pointers,insideElementPressed:y.insideElementPressed,buttonDownAny:y.buttonDownAny,originalEvent:y.originalEvent})}function H(y){y.pointers<1&&(i[this.hash].mouseInside=!1,i[this.hash].animating||h(this)),this.raiseEvent("container-exit",{tracker:y.eventSource,pointerType:y.pointerType,position:y.position,buttons:y.buttons,pointers:y.pointers,insideElementPressed:y.insideElementPressed,buttonDownAny:y.buttonDownAny,originalEvent:y.originalEvent})}function $(y){re(y),y.isOpen()?y._updateRequestId=l(y,$):y._updateRequestId=!1}function J(y,T){var M=y.viewport,K=M.getZoom(),q=M.getCenter();M.resize(T,y.preserveImageSizeOnResize),M.panTo(q,!0);var te;if(y.preserveImageSizeOnResize)te=i[y.hash].prevContainerSize.x/T.x;else{var Z=new e.Point(0,0),ye=new e.Point(i[y.hash].prevContainerSize.x,i[y.hash].prevContainerSize.y).distanceTo(Z),Ee=new e.Point(T.x,T.y).distanceTo(Z);te=Ee/ye*i[y.hash].prevContainerSize.x/T.x}M.zoomTo(K*te,null,!0),i[y.hash].prevContainerSize=T,i[y.hash].forceRedraw=!0,i[y.hash].needsResize=!1,i[y.hash].forceResize=!1}function re(y){if(!(y._opening||!i[y.hash])){if(y.autoResize||i[y.hash].forceResize){var T;if(y._autoResizePolling){T=n(y.container);var M=i[y.hash].prevContainerSize;T.equals(M)||(i[y.hash].needsResize=!0)}i[y.hash].needsResize&&J(y,T||n(y.container))}var K=y.viewport.update(),q=y.world.update()||K;K&&y.raiseEvent("viewport-change"),y.referenceStrip&&(q=y.referenceStrip.update(y.viewport)||q);var te=i[y.hash].animating;!te&&q&&(y.raiseEvent("animation-start"),f(y));var Z=te&&!q;Z&&(i[y.hash].animating=!1),(q||Z||i[y.hash].forceRedraw||y.world.needsDraw())&&(me(y),y._drawOverlays(),y.navigator&&y.navigator.update(y.viewport),i[y.hash].forceRedraw=!1,q&&y.raiseEvent("animation")),Z&&(y.raiseEvent("animation-finish"),i[y.hash].mouseInside||h(y)),i[y.hash].animating=q}}function me(y){y.imageLoader.clear(),y.drawer.clear(),y.world.draw(),y.raiseEvent("update-viewport",{})}function Q(y,T){return y?y+T:T}function Te(){i[this.hash].lastZoomTime=e.now(),i[this.hash].zoomFactor=this.zoomPerSecond,i[this.hash].zooming=!0,ae(this)}function Ae(){i[this.hash].lastZoomTime=e.now(),i[this.hash].zoomFactor=1/this.zoomPerSecond,i[this.hash].zooming=!0,ae(this)}function ge(){i[this.hash].zooming=!1}function ae(y){e.requestAnimationFrame(e.delegate(y,Re))}function Re(){var y,T,M;i[this.hash].zooming&&this.viewport&&(y=e.now(),T=y-i[this.hash].lastZoomTime,M=Math.pow(i[this.hash].zoomFactor,T/1e3),this.viewport.zoomBy(M),this.viewport.applyConstraints(),i[this.hash].lastZoomTime=y,ae(this))}function Ce(){this.viewport&&(i[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function de(){this.viewport&&(i[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function je(){this.buttonGroup&&(this.buttonGroup.emulateEnter(),this.buttonGroup.emulateLeave())}function Ue(){this.viewport&&this.viewport.goHome()}function Y(){this.isFullPage()&&!e.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttonGroup&&this.buttonGroup.emulateLeave(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function le(){if(this.viewport){var y=this.viewport.getRotation();this.viewport.flipped?y+=this.rotationIncrement:y-=this.rotationIncrement,this.viewport.setRotation(y)}}function ve(){if(this.viewport){var y=this.viewport.getRotation();this.viewport.flipped?y-=this.rotationIncrement:y+=this.rotationIncrement,this.viewport.setRotation(y)}}function be(){this.viewport.toggleFlip()}})(t),(function(e){e.Navigator=function(l){var c=l.viewer,h=this,d,f;l.element||l.id?(l.element?(l.id&&e.console.warn("Given option.id for Navigator was ignored since option.element was provided and is being used instead."),l.element.id?l.id=l.element.id:l.id="navigator-"+e.now(),this.element=l.element):this.element=document.getElementById(l.id),l.controlOptions={anchor:e.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(l.id="navigator-"+e.now(),this.element=e.makeNeutralElement("div"),l.controlOptions={anchor:e.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:l.autoFade},l.position&&(l.position==="BOTTOM_RIGHT"?l.controlOptions.anchor=e.ControlAnchor.BOTTOM_RIGHT:l.position==="BOTTOM_LEFT"?l.controlOptions.anchor=e.ControlAnchor.BOTTOM_LEFT:l.position==="TOP_RIGHT"?l.controlOptions.anchor=e.ControlAnchor.TOP_RIGHT:l.position==="TOP_LEFT"?l.controlOptions.anchor=e.ControlAnchor.TOP_LEFT:l.position==="ABSOLUTE"&&(l.controlOptions.anchor=e.ControlAnchor.ABSOLUTE,l.controlOptions.top=l.top,l.controlOptions.left=l.left,l.controlOptions.height=l.height,l.controlOptions.width=l.width))),this.element.id=l.id,this.element.className+=" navigator",l=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.navigatorSizeRatio},l,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:l.animationTime,autoResize:!1,minZoomImageRatio:1,background:l.background,opacity:l.opacity,borderColor:l.borderColor,displayRegionColor:l.displayRegionColor}),l.minPixelRatio=this.minPixelRatio=c.minPixelRatio,e.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new e.Point(1,1),this.totalBorderWidths=new e.Point(this.borderWidth*2,this.borderWidth*2).minus(this.fudge),l.controlOptions.anchor!==e.ControlAnchor.NONE&&(function(v,w){v.margin="0px",v.border=w+"px solid "+l.borderColor,v.padding="0px",v.background=l.background,v.opacity=l.opacity,v.overflow="hidden"})(this.element.style,this.borderWidth),this.displayRegion=e.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",(function(v,w){v.position="relative",v.top="0px",v.left="0px",v.fontSize="0px",v.overflow="hidden",v.border=w+"px solid "+l.displayRegionColor,v.margin="0px",v.padding="0px",v.background="transparent",v.float="left",v.cssFloat="left",v.styleFloat="left",v.zIndex=999999999,v.cursor="default",v.boxSizing="content-box"})(this.displayRegion.style,this.borderWidth),e.setElementPointerEventsNone(this.displayRegion),e.setElementTouchActionNone(this.displayRegion),this.displayRegionContainer=e.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",e.setElementPointerEventsNone(this.displayRegionContainer),e.setElementTouchActionNone(this.displayRegionContainer),c.addControl(this.element,l.controlOptions),this._resizeWithViewer=l.controlOptions.anchor!==e.ControlAnchor.ABSOLUTE&&l.controlOptions.anchor!==e.ControlAnchor.NONE,l.width&&l.height?(this.setWidth(l.width),this.setHeight(l.height)):this._resizeWithViewer&&(d=e.getElementSize(c.element),this.element.style.height=Math.round(d.y*l.sizeRatio)+"px",this.element.style.width=Math.round(d.x*l.sizeRatio)+"px",this.oldViewerSize=d,f=e.getElementSize(this.element),this.elementArea=f.x*f.y),this.oldContainerSize=new e.Point(0,0),e.Viewer.apply(this,[l]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer);function p(v,w){r(h.displayRegionContainer,v),r(h.displayRegion,-v),h.viewport.setRotation(v,w)}if(l.navigatorRotate){var m=l.viewer.viewport?l.viewer.viewport.getRotation():l.viewer.degrees||0;p(m,!0),l.viewer.addHandler("rotate",function(v){p(v.degrees,v.immediately)})}this.innerTracker.destroy(),this.innerTracker=new e.MouseTracker({userData:"Navigator.innerTracker",element:this.element,dragHandler:e.delegate(this,s),clickHandler:e.delegate(this,i),releaseHandler:e.delegate(this,n),scrollHandler:e.delegate(this,a),preProcessEventHandler:function(v){v.eventType==="wheel"&&(v.preventDefault=!0)}}),this.outerTracker.userData="Navigator.outerTracker",e.setElementPointerEventsNone(this.canvas),e.setElementPointerEventsNone(this.container),this.addHandler("reset-size",function(){h.viewport&&h.viewport.goHome(!0)}),c.world.addHandler("item-index-change",function(v){window.setTimeout(function(){var w=h.world.getItemAt(v.previousIndex);h.world.setItemIndex(w,v.newIndex)},1)}),c.world.addHandler("remove-item",function(v){var w=v.item,S=h._getMatchingItem(w);S&&h.world.removeItem(S)}),this.update(c.viewport)},e.extend(e.Navigator.prototype,e.EventSource.prototype,e.Viewer.prototype,{updateSize:function(){if(this.viewport){var l=new e.Point(this.container.clientWidth===0?1:this.container.clientWidth,this.container.clientHeight===0?1:this.container.clientHeight);l.equals(this.oldContainerSize)||(this.viewport.resize(l,!0),this.viewport.goHome(!0),this.oldContainerSize=l,this.drawer.clear(),this.world.draw())}},setWidth:function(l){this.width=l,this.element.style.width=typeof l=="number"?l+"px":l,this._resizeWithViewer=!1,this.updateSize()},setHeight:function(l){this.height=l,this.element.style.height=typeof l=="number"?l+"px":l,this._resizeWithViewer=!1,this.updateSize()},setFlip:function(l){return this.viewport.setFlip(l),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(l){o(this.displayRegion,l),o(this.canvas,l),o(this.element,l)},update:function(l){var c,h,d,f,p,m;if(c=e.getElementSize(this.viewer.element),this._resizeWithViewer&&c.x&&c.y&&!c.equals(this.oldViewerSize)&&(this.oldViewerSize=c,this.maintainSizeRatio||!this.elementArea?(h=c.x*this.sizeRatio,d=c.y*this.sizeRatio):(h=Math.sqrt(this.elementArea*(c.x/c.y)),d=this.elementArea/h),this.element.style.width=Math.round(h)+"px",this.element.style.height=Math.round(d)+"px",this.elementArea||(this.elementArea=h*d),this.updateSize()),l&&this.viewport){if(f=l.getBoundsNoRotate(!0),p=this.viewport.pixelFromPointNoRotate(f.getTopLeft(),!1),m=this.viewport.pixelFromPointNoRotate(f.getBottomRight(),!1).minus(this.totalBorderWidths),!this.navigatorRotate){var v=l.getRotation(!0);r(this.displayRegion,-v)}var w=this.displayRegion.style;w.display=this.world.getItemCount()?"block":"none",w.top=p.y.toFixed(2)+"px",w.left=p.x.toFixed(2)+"px";var S=m.x-p.x,_=m.y-p.y;w.width=Math.round(Math.max(S,0))+"px",w.height=Math.round(Math.max(_,0))+"px"}},addTiledImage:function(l){var c=this,h=l.originalTiledImage;delete l.original;var d=e.extend({},l,{success:function(f){var p=f.item;p._originalForNavigator=h,c._matchBounds(p,h,!0),c._matchOpacity(p,h),c._matchCompositeOperation(p,h);function m(){c._matchBounds(p,h)}function v(){c._matchOpacity(p,h)}function w(){c._matchCompositeOperation(p,h)}h.addHandler("bounds-change",m),h.addHandler("clip-change",m),h.addHandler("opacity-change",v),h.addHandler("composite-operation-change",w)}});return e.Viewer.prototype.addTiledImage.apply(this,[d])},destroy:function(){return e.Viewer.prototype.destroy.apply(this)},_getMatchingItem:function(l){for(var c=this.world.getItemCount(),h,d=0;d<c;d++)if(h=this.world.getItemAt(d),h._originalForNavigator===l)return h;return null},_matchBounds:function(l,c,h){var d=c.getBoundsNoRotate();l.setPosition(d.getTopLeft(),h),l.setWidth(d.width,h),l.setRotation(c.getRotation(),h),l.setClip(c.getClip()),l.setFlip(c.getFlip())},_matchOpacity:function(l,c){l.setOpacity(c.opacity)},_matchCompositeOperation:function(l,c){l.setCompositeOperation(c.compositeOperation)}});function i(l){var c={tracker:l.eventSource,position:l.position,quick:l.quick,shift:l.shift,originalEvent:l.originalEvent,preventDefaultAction:!1};if(this.viewer.raiseEvent("navigator-click",c),!c.preventDefaultAction&&l.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)){this.viewer.viewport.flipped&&(l.position.x=this.viewport.getContainerSize().x-l.position.x);var h=this.viewport.pointFromPixel(l.position);this.panVertical?this.panHorizontal||(h.x=this.viewer.viewport.getCenter(!0).x):h.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(h),this.viewer.viewport.applyConstraints()}}function s(l){var c={tracker:l.eventSource,position:l.position,delta:l.delta,speed:l.speed,direction:l.direction,shift:l.shift,originalEvent:l.originalEvent,preventDefaultAction:!1};this.viewer.raiseEvent("navigator-drag",c),!c.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(l.delta.x=0),this.panVertical||(l.delta.y=0),this.viewer.viewport.flipped&&(l.delta.x=-l.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(l.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function n(l){l.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function a(l){var c={tracker:l.eventSource,position:l.position,scroll:l.scroll,shift:l.shift,originalEvent:l.originalEvent,preventDefault:l.preventDefault};this.viewer.raiseEvent("navigator-scroll",c),l.preventDefault=c.preventDefault}function r(l,c){o(l,"rotate("+c+"deg)")}function o(l,c){l.style.webkitTransform=c,l.style.mozTransform=c,l.style.msTransform=c,l.style.oTransform=c,l.style.transform=c}})(t),(function(e){var i={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};e.extend(e,{getString:function(s){var n=s.split("."),a=null,r=arguments,o=i,l;for(l=0;l<n.length-1;l++)o=o[n[l]]||{};return a=o[n[l]],typeof a!="string"&&(e.console.error("Untranslated source string:",s),a=""),a.replace(/\{\d+\}/g,function(c){var h=parseInt(c.match(/\d+/),10)+1;return h<r.length?r[h]:""})},setString:function(s,n){var a=s.split("."),r=i,o;for(o=0;o<a.length-1;o++)r[a[o]]||(r[a[o]]={}),r=r[a[o]];r[a[o]]=n}})})(t),(function(e){e.Point=function(i,s){this.x=typeof i=="number"?i:0,this.y=typeof s=="number"?s:0},e.Point.prototype={clone:function(){return new e.Point(this.x,this.y)},plus:function(i){return new e.Point(this.x+i.x,this.y+i.y)},minus:function(i){return new e.Point(this.x-i.x,this.y-i.y)},times:function(i){return new e.Point(this.x*i,this.y*i)},divide:function(i){return new e.Point(this.x/i,this.y/i)},negate:function(){return new e.Point(-this.x,-this.y)},distanceTo:function(i){return Math.sqrt(Math.pow(this.x-i.x,2)+Math.pow(this.y-i.y,2))},squaredDistanceTo:function(i){return Math.pow(this.x-i.x,2)+Math.pow(this.y-i.y,2)},apply:function(i){return new e.Point(i(this.x),i(this.y))},equals:function(i){return i instanceof e.Point&&this.x===i.x&&this.y===i.y},rotate:function(i,s){s=s||new e.Point(0,0);var n,a;if(i%90===0){var r=e.positiveModulo(i,360);switch(r){case 0:n=1,a=0;break;case 90:n=0,a=1;break;case 180:n=-1,a=0;break;case 270:n=0,a=-1;break}}else{var o=i*Math.PI/180;n=Math.cos(o),a=Math.sin(o)}var l=n*(this.x-s.x)-a*(this.y-s.y)+s.x,c=a*(this.x-s.x)+n*(this.y-s.y)+s.y;return new e.Point(l,c)},toString:function(){return"("+Math.round(this.x*100)/100+","+Math.round(this.y*100)/100+")"}}})(t),(function(e){e.TileSource=function(s,n,a,r,o,l){var c=this,h=arguments,d,f;if(e.isPlainObject(s)?d=s:d={width:h[0],height:h[1],tileSize:h[2],tileOverlap:h[3],minLevel:h[4],maxLevel:h[5]},e.EventSource.call(this),e.extend(!0,this,d),!this.success){for(f=0;f<arguments.length;f++)if(e.isFunction(arguments[f])){this.success=arguments[f];break}}this.success&&this.addHandler("ready",function(p){c.success(p)}),e.type(arguments[0])==="string"&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new e.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=d.width&&d.height?d.width/d.height:1,this.dimensions=new e.Point(d.width,d.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=d.tileOverlap?d.tileOverlap:0,this.minLevel=d.minLevel?d.minLevel:0,this.maxLevel=d.maxLevel!==void 0&&d.maxLevel!==null?d.maxLevel:d.width&&d.height?Math.ceil(Math.log(Math.max(d.width,d.height))/Math.log(2)):0,this.success&&e.isFunction(this.success)&&this.success(this))},e.TileSource.prototype={getTileSize:function(s){return e.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(s){return this._tileWidth?this._tileWidth:this.getTileSize(s)},getTileHeight:function(s){return this._tileHeight?this._tileHeight:this.getTileSize(s)},setMaxLevel:function(s){this.maxLevel=s,this._memoizeLevelScale()},getLevelScale:function(s){return this._memoizeLevelScale(),this.getLevelScale(s)},_memoizeLevelScale:function(){var s={},n;for(n=0;n<=this.maxLevel;n++)s[n]=1/Math.pow(2,this.maxLevel-n);this.getLevelScale=function(a){return s[a]}},getNumTiles:function(s){var n=this.getLevelScale(s),a=Math.ceil(n*this.dimensions.x/this.getTileWidth(s)),r=Math.ceil(n*this.dimensions.y/this.getTileHeight(s));return new e.Point(a,r)},getPixelRatio:function(s){var n=this.dimensions.times(this.getLevelScale(s)),a=1/n.x*e.pixelDensityRatio,r=1/n.y*e.pixelDensityRatio;return new e.Point(a,r)},getClosestLevel:function(){var s,n;for(s=this.minLevel+1;s<=this.maxLevel&&(n=this.getNumTiles(s),!(n.x>1||n.y>1));s++);return s-1},getTileAtPoint:function(s,n){var a=n.x>=0&&n.x<=1&&n.y>=0&&n.y<=1/this.aspectRatio;e.console.assert(a,"[TileSource.getTileAtPoint] must be called with a valid point.");var r=this.dimensions.x*this.getLevelScale(s),o=n.x*r,l=n.y*r,c=Math.floor(o/this.getTileWidth(s)),h=Math.floor(l/this.getTileHeight(s));n.x>=1&&(c=this.getNumTiles(s).x-1);var d=1e-15;return n.y>=1/this.aspectRatio-d&&(h=this.getNumTiles(s).y-1),new e.Point(c,h)},getTileBounds:function(s,n,a,r){var o=this.dimensions.times(this.getLevelScale(s)),l=this.getTileWidth(s),c=this.getTileHeight(s),h=n===0?0:l*n-this.tileOverlap,d=a===0?0:c*a-this.tileOverlap,f=l+(n===0?1:2)*this.tileOverlap,p=c+(a===0?1:2)*this.tileOverlap,m=1/o.x;return f=Math.min(f,o.x-h),p=Math.min(p,o.y-d),r?new e.Rect(0,0,f,p):new e.Rect(h*m,d*m,f*m,p*m)},getImageInfo:function(s){var n=this,a,r,o,l,c,h,d;s&&(c=s.split("/"),h=c[c.length-1],d=h.lastIndexOf("."),d>-1&&(c[c.length-1]=h.slice(0,d)));var f=null;if(this.splitHashDataForPost){var p=s.indexOf("#");p!==-1&&(f=s.substring(p+1),s=s.substr(0,p))}r=function(m){typeof m=="string"&&(m=e.parseXml(m));var v=e.TileSource.determineType(n,m,s);if(!v){n.raiseEvent("open-failed",{message:"Unable to load TileSource",source:s});return}l=v.prototype.configure.apply(n,[m,s,f]),l.ajaxWithCredentials===void 0&&(l.ajaxWithCredentials=n.ajaxWithCredentials),o=new v(l),n.ready=!0,n.raiseEvent("ready",{tileSource:o})},s.match(/\.js$/)?(a=s.split("/").pop().replace(".js",""),e.jsonp({url:s,async:!1,callbackName:a,callback:r})):e.makeAjaxRequest({url:s,postData:f,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(m){var v=i(m);r(v)},error:function(m,v){var w;try{w="HTTP "+m.status+" attempting to load TileSource: "+s}catch{var S;typeof v>"u"||!v.toString?S="Unknown error":S=v.toString(),w=S+" attempting to load TileSource: "+s}e.console.error(w),n.raiseEvent("open-failed",{message:w,source:s,postData:f})}})},supports:function(s,n){return!1},configure:function(s,n,a){throw new Error("Method not implemented.")},getTileUrl:function(s,n,a){throw new Error("Method not implemented.")},getTilePostData:function(s,n,a){return null},getTileAjaxHeaders:function(s,n,a){return{}},getTileHashKey:function(s,n,a,r,o,l){function c(h){return o?h+"+"+JSON.stringify(o):h}return c(typeof r!="string"?s+"/"+n+"_"+a:r)},tileExists:function(s,n,a){var r=this.getNumTiles(s);return s>=this.minLevel&&s<=this.maxLevel&&n>=0&&a>=0&&n<r.x&&a<r.y},hasTransparency:function(s,n,a,r){return!!s||n.match(".png")},downloadTileStart:function(s){var n=s.userData,a=new Image;n.image=a,n.request=null;var r=function(o){if(!a){s.finish(null,n.request,"Image load failed: undefined Image instance.");return}a.onload=a.onerror=a.onabort=null,s.finish(o?null:a,n.request,o)};a.onload=function(){r()},a.onabort=a.onerror=function(){r("Image load aborted.")},s.loadWithAjax?n.request=e.makeAjaxRequest({url:s.src,withCredentials:s.ajaxWithCredentials,headers:s.ajaxHeaders,responseType:"arraybuffer",postData:s.postData,success:function(o){var l;try{l=new window.Blob([o.response])}catch(d){var c=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(d.name==="TypeError"&&c){var h=new c;h.append(o.response),l=h.getBlob()}}l.size===0?r("Empty image response."):a.src=(window.URL||window.webkitURL).createObjectURL(l)},error:function(o){r("Image load aborted - XHR error")}}):(s.crossOriginPolicy!==!1&&(a.crossOrigin=s.crossOriginPolicy),a.src=s.src)},downloadTileAbort:function(s){s.userData.request&&s.userData.request.abort();var n=s.userData.image;s.userData.image&&(n.onload=n.onerror=n.onabort=null)},createTileCache:function(s,n,a){s._data=n},destroyTileCache:function(s){s._data=null,s._renderedContext=null},getTileCacheData:function(s){return s._data},getTileCacheDataAsImage:function(s){return s._data},getTileCacheDataAsContext2D:function(s){if(!s._renderedContext){var n=document.createElement("canvas");n.width=s._data.width,n.height=s._data.height,s._renderedContext=n.getContext("2d"),s._renderedContext.drawImage(s._data,0,0),s._data=null}return s._renderedContext}},e.extend(!0,e.TileSource.prototype,e.EventSource.prototype);function i(s){var n=s.responseText,a=s.status,r,o;if(s){if(s.status!==200&&s.status!==0)throw a=s.status,r=a===404?"Not Found":s.statusText,new Error(e.getString("Errors.Status",a,r))}else throw new Error(e.getString("Errors.Security"));if(n.match(/^\s*<.*/))try{o=s.responseXML&&s.responseXML.documentElement?s.responseXML:e.parseXml(n)}catch{o=s.responseText}else if(n.match(/\s*[{[].*/))try{o=e.parseJSON(n)}catch{o=n}else o=n;return o}e.TileSource.determineType=function(s,n,a){var r;for(r in t)if(r.match(/.+TileSource$/)&&e.isFunction(t[r])&&e.isFunction(t[r].prototype.supports)&&t[r].prototype.supports.call(s,n,a))return t[r];return e.console.error("No TileSource was able to open %s %s",a,n),null}})(t),(function(e){e.DziTileSource=function(n,a,r,o,l,c,h,d,f){var p,m,v,w;if(e.isPlainObject(n)?w=n:w={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=w.tilesUrl,this.fileFormat=w.fileFormat,this.displayRects=w.displayRects,this.displayRects)for(p=this.displayRects.length-1;p>=0;p--)for(m=this.displayRects[p],v=m.minLevel;v<=m.maxLevel;v++)this._levelRects[v]||(this._levelRects[v]=[]),this._levelRects[v].push(m);e.TileSource.apply(this,[w])},e.extend(e.DziTileSource.prototype,e.TileSource.prototype,{supports:function(n,a){var r;return n.Image?r=n.Image.xmlns:n.documentElement&&(n.documentElement.localName==="Image"||n.documentElement.tagName==="Image")&&(r=n.documentElement.namespaceURI),r=(r||"").toLowerCase(),r.indexOf("schemas.microsoft.com/deepzoom/2008")!==-1||r.indexOf("schemas.microsoft.com/deepzoom/2009")!==-1},configure:function(n,a,r){var o;return e.isPlainObject(n)?o=s(this,n):o=i(this,n),a&&!o.tilesUrl&&(o.tilesUrl=a.replace(/([^/]+?)(\.(dzi|xml|js)?(\?[^/]*)?)?\/?$/,"$1_files/"),a.search(/\.(dzi|xml|js)\?/)!==-1?o.queryParams=a.match(/\?.*/):o.queryParams=""),o},getTileUrl:function(n,a,r){return[this.tilesUrl,n,"/",a,"_",r,".",this.fileFormat,this.queryParams].join("")},tileExists:function(n,a,r){var o=this._levelRects[n],l,c,h,d,f,p,m;if(this.minLevel&&n<this.minLevel||this.maxLevel&&n>this.maxLevel)return!1;if(!o||!o.length)return!0;for(m=o.length-1;m>=0;m--)if(l=o[m],!(n<l.minLevel||n>l.maxLevel)&&(c=this.getLevelScale(n),h=l.x*c,d=l.y*c,f=h+l.width*c,p=d+l.height*c,h=Math.floor(h/this._tileWidth),d=Math.floor(d/this._tileWidth),f=Math.ceil(f/this._tileWidth),p=Math.ceil(p/this._tileWidth),h<=a&&a<f&&d<=r&&r<p))return!0;return!1}});function i(n,a){if(!a||!a.documentElement)throw new Error(e.getString("Errors.Xml"));var r=a.documentElement,o=r.localName||r.tagName,l=a.documentElement.namespaceURI,c=null,h=[],d,f,p,m,v;if(o==="Image")try{if(m=r.getElementsByTagName("Size")[0],m===void 0&&(m=r.getElementsByTagNameNS(l,"Size")[0]),c={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:r.getAttribute("Url"),Format:r.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(r.getAttribute("Overlap"),10),TileSize:parseInt(r.getAttribute("TileSize"),10),Size:{Height:parseInt(m.getAttribute("Height"),10),Width:parseInt(m.getAttribute("Width"),10)}}},!e.imageFormatSupported(c.Image.Format))throw new Error(e.getString("Errors.ImageFormat",c.Image.Format.toUpperCase()));for(d=r.getElementsByTagName("DisplayRect"),d===void 0&&(d=r.getElementsByTagNameNS(l,"DisplayRect")[0]),v=0;v<d.length;v++)f=d[v],p=f.getElementsByTagName("Rect")[0],p===void 0&&(p=f.getElementsByTagNameNS(l,"Rect")[0]),h.push({Rect:{X:parseInt(p.getAttribute("X"),10),Y:parseInt(p.getAttribute("Y"),10),Width:parseInt(p.getAttribute("Width"),10),Height:parseInt(p.getAttribute("Height"),10),MinLevel:parseInt(f.getAttribute("MinLevel"),10),MaxLevel:parseInt(f.getAttribute("MaxLevel"),10)}});return h.length&&(c.Image.DisplayRect=h),s(n,c)}catch(_){throw _ instanceof Error?_:new Error(e.getString("Errors.Dzi"))}else{if(o==="Collection")throw new Error(e.getString("Errors.Dzc"));if(o==="Error"){var w=r.getElementsByTagName("Message")[0],S=w.firstChild.nodeValue;throw new Error(S)}}throw new Error(e.getString("Errors.Dzi"))}function s(n,a){var r=a.Image,o=r.Url,l=r.Format,c=r.Size,h=r.DisplayRect||[],d=parseInt(c.Width,10),f=parseInt(c.Height,10),p=parseInt(r.TileSize,10),m=parseInt(r.Overlap,10),v=[],w,S;for(S=0;S<h.length;S++)w=h[S].Rect,v.push(new e.DisplayRect(parseInt(w.X,10),parseInt(w.Y,10),parseInt(w.Width,10),parseInt(w.Height,10),parseInt(w.MinLevel,10),parseInt(w.MaxLevel,10)));return e.extend(!0,{width:d,height:f,tileSize:p,tileOverlap:m,minLevel:null,maxLevel:null,tilesUrl:o,fileFormat:l,displayRects:v},a)}})(t),(function(e){e.IIIFTileSource=function(r){if(e.extend(!0,this,r),this._id=this["@id"]||this.id||this.identifier||null,!(this.height&&this.width&&this._id))throw new Error("IIIF required parameters (width, height, or id) not provided.");if(r.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=r.version,this.tile_width&&this.tile_height)r.tileWidth=this.tile_width,r.tileHeight=this.tile_height;else if(this.tile_width)r.tileSize=this.tile_width;else if(this.tile_height)r.tileSize=this.tile_height;else if(this.tiles)if(this.tiles.length===1)r.tileWidth=this.tiles[0].width,r.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var o=0;o<this.tiles.length;o++)for(var l=0;l<this.tiles[o].scaleFactors.length;l++){var c=this.tiles[o].scaleFactors[l];this.scale_factors.push(c),r.tileSizePerScaleFactor[c]={width:this.tiles[o].width,height:this.tiles[o].height||this.tiles[o].width}}}else if(i(r)){for(var h=Math.min(this.height,this.width),d=[256,512,1024],f=[],p=0;p<d.length;p++)d[p]<=h&&f.push(d[p]);f.length>0?r.tileSize=Math.max.apply(null,f):r.tileSize=h}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,r.levels=s(this),e.extend(!0,r,{width:r.levels[r.levels.length-1].width,height:r.levels[r.levels.length-1].height,tileSize:Math.max(r.height,r.width),tileOverlap:0,minLevel:0,maxLevel:r.levels.length-1}),this.levels=r.levels):e.console.error("Nothing in the info.json to construct image pyramids from");if(!r.maxLevel&&!this.emulateLegacyImagePyramid)if(!this.scale_factors)r.maxLevel=Number(Math.round(Math.log(Math.max(this.width,this.height),2)));else{var m=Math.max.apply(null,this.scale_factors);r.maxLevel=Math.round(Math.log(m)*Math.LOG2E)}if(this.sizes){var v=this.sizes.length;(v===r.maxLevel||v===r.maxLevel+1)&&(this.levelSizes=this.sizes.slice().sort(function(w,S){return w.width-S.width}),v===r.maxLevel&&this.levelSizes.push({width:this.width,height:this.height}))}e.TileSource.apply(this,[r])},e.extend(e.IIIFTileSource.prototype,e.TileSource.prototype,{supports:function(r,o){return r.protocol&&r.protocol==="http://iiif.io/api/image"||r["@context"]&&(r["@context"]==="http://library.stanford.edu/iiif/image-api/1.1/context.json"||r["@context"]==="http://iiif.io/api/image/1/context.json")||r.profile&&r.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")===0||r.identifier&&r.width&&r.height?!0:!!(r.documentElement&&r.documentElement.tagName==="info"&&r.documentElement.namespaceURI==="http://library.stanford.edu/iiif/image-api/ns/")},configure:function(r,o,l){if(e.isPlainObject(r)){if(!r["@context"])r["@context"]="http://iiif.io/api/image/1.0/context.json",r["@id"]=o.replace("/info.json",""),r.version=1;else{var h=r["@context"];if(Array.isArray(h)){for(var d=0;d<h.length;d++)if(typeof h[d]=="string"&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(h[d])||h[d]==="http://library.stanford.edu/iiif/image-api/1.1/context.json")){h=h[d];break}}switch(h){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":r.version=1;break;case"http://iiif.io/api/image/2/context.json":r.version=2;break;case"http://iiif.io/api/image/3/context.json":r.version=3;break;default:e.console.error("Data has a @context property which contains no known IIIF context URI.")}}if(r.preferredFormats){for(var f=0;f<r.preferredFormats.length;f++)if(t.imageFormatSupported(r.preferredFormats[f])){r.tileFormat=r.preferredFormats[f];break}}return r}else{var c=n(r);return c["@context"]="http://iiif.io/api/image/1.0/context.json",c["@id"]=o.replace("/info.xml",""),c.version=1,c}},getTileWidth:function(r){if(this.emulateLegacyImagePyramid)return e.TileSource.prototype.getTileWidth.call(this,r);var o=Math.pow(2,this.maxLevel-r);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[o]?this.tileSizePerScaleFactor[o].width:this._tileWidth},getTileHeight:function(r){if(this.emulateLegacyImagePyramid)return e.TileSource.prototype.getTileHeight.call(this,r);var o=Math.pow(2,this.maxLevel-r);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[o]?this.tileSizePerScaleFactor[o].height:this._tileHeight},getLevelScale:function(r){if(this.emulateLegacyImagePyramid){var o=NaN;return this.levels.length>0&&r>=this.minLevel&&r<=this.maxLevel&&(o=this.levels[r].width/this.levels[this.maxLevel].width),o}return e.TileSource.prototype.getLevelScale.call(this,r)},getNumTiles:function(r){if(this.emulateLegacyImagePyramid){var o=this.getLevelScale(r);return o?new e.Point(1,1):new e.Point(0,0)}if(this.levelSizes){var l=this.levelSizes[r],c=Math.ceil(l.width/this.getTileWidth(r)),h=Math.ceil(l.height/this.getTileHeight(r));return new e.Point(c,h)}else return e.TileSource.prototype.getNumTiles.call(this,r)},getTileAtPoint:function(r,o){if(this.emulateLegacyImagePyramid)return new e.Point(0,0);if(this.levelSizes){var l=o.x>=0&&o.x<=1&&o.y>=0&&o.y<=1/this.aspectRatio;e.console.assert(l,"[TileSource.getTileAtPoint] must be called with a valid point.");var c=this.levelSizes[r].width,h=o.x*c,d=o.y*c,f=Math.floor(h/this.getTileWidth(r)),p=Math.floor(d/this.getTileHeight(r));o.x>=1&&(f=this.getNumTiles(r).x-1);var m=1e-15;return o.y>=1/this.aspectRatio-m&&(p=this.getNumTiles(r).y-1),new e.Point(f,p)}return e.TileSource.prototype.getTileAtPoint.call(this,r,o)},getTileUrl:function(r,o,l){if(this.emulateLegacyImagePyramid){var c=null;return this.levels.length>0&&r>=this.minLevel&&r<=this.maxLevel&&(c=this.levels[r].url),c}var h="0",d=Math.pow(.5,this.maxLevel-r),f,p,m,v,w,S,_,A,P,k,N,O,j,U,G,R;return this.levelSizes?(f=this.levelSizes[r].width,p=this.levelSizes[r].height):(f=Math.ceil(this.width*d),p=Math.ceil(this.height*d)),m=this.getTileWidth(r),v=this.getTileHeight(r),w=Math.round(m/d),S=Math.round(v/d),this.version===1?G="native."+this.tileFormat:G="default."+this.tileFormat,f<m&&p<v?(this.version===2&&f===this.width?O="full":this.version===3&&f===this.width&&p===this.height?O="max":this.version===3?O=f+","+p:O=f+",",_="full"):(A=o*w,P=l*S,k=Math.min(w,this.width-A),N=Math.min(S,this.height-P),o===0&&l===0&&k===this.width&&N===this.height?_="full":_=[A,P,k,N].join(","),j=Math.min(m,f-o*m),U=Math.min(v,p-l*v),this.version===2&&j===this.width?O="full":this.version===3&&j===this.width&&U===this.height?O="max":this.version===3?O=j+","+U:O=j+","),R=[this._id,_,O,h,G].join("/"),R},__testonly__:{canBeTiled:i,constructLevels:s}});function i(r){var o=["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"],l=Array.isArray(r.profile)?r.profile[0]:r.profile,c=o.indexOf(l)!==-1,h=!1;return r.version===2&&r.profile.length>1&&r.profile[1].supports&&(h=r.profile[1].supports.indexOf("sizeByW")!==-1),r.version===3&&r.extraFeatures&&(h=r.extraFeatures.indexOf("sizeByWh")!==-1),!c||h}function s(r){for(var o=[],l=0;l<r.sizes.length;l++)o.push({url:r._id+"/full/"+r.sizes[l].width+","+(r.version===3?r.sizes[l].height:"")+"/0/default."+r.tileFormat,width:r.sizes[l].width,height:r.sizes[l].height});return o.sort(function(c,h){return c.width-h.width})}function n(r){if(!r||!r.documentElement)throw new Error(e.getString("Errors.Xml"));var o=r.documentElement,l=o.tagName,c=null;if(l==="info")try{return c={},a(o,c),c}catch(h){throw h instanceof Error?h:new Error(e.getString("Errors.IIIF"))}throw new Error(e.getString("Errors.IIIF"))}function a(r,o,l){var c,h;if(r.nodeType===3&&l)h=r.nodeValue.trim(),h.match(/^\d*$/)&&(h=Number(h)),o[l]?(e.isArray(o[l])||(o[l]=[o[l]]),o[l].push(h)):o[l]=h;else if(r.nodeType===1)for(c=0;c<r.childNodes.length;c++)a(r.childNodes[c],o,r.nodeName)}})(t),(function(e){e.OsmTileSource=function(i,s,n,a,r){var o;e.isPlainObject(i)?o=i:o={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]},(!o.width||!o.height)&&(o.width=65572864,o.height=65572864),o.tileSize||(o.tileSize=256,o.tileOverlap=0),o.tilesUrl||(o.tilesUrl="http://tile.openstreetmap.org/"),o.minLevel=8,e.TileSource.apply(this,[o])},e.extend(e.OsmTileSource.prototype,e.TileSource.prototype,{supports:function(i,s){return i.type&&i.type==="openstreetmaps"},configure:function(i,s,n){return i},getTileUrl:function(i,s,n){return this.tilesUrl+(i-8)+"/"+s+"/"+n+".png"}})})(t),(function(e){e.TmsTileSource=function(i,s,n,a,r){var o;e.isPlainObject(i)?o=i:o={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var l=Math.ceil(o.width/256)*256,c=Math.ceil(o.height/256)*256,h;l>c?h=l/256:h=c/256,o.maxLevel=Math.ceil(Math.log(h)/Math.log(2))-1,o.tileSize=256,o.width=l,o.height=c,e.TileSource.apply(this,[o])},e.extend(e.TmsTileSource.prototype,e.TileSource.prototype,{supports:function(i,s){return i.type&&i.type==="tiledmapservice"},configure:function(i,s,n){return i},getTileUrl:function(i,s,n){var a=this.getNumTiles(i).y-1;return this.tilesUrl+i+"/"+s+"/"+(a-n)+".png"}})})(t),(function(e){e.ZoomifyTileSource=function(i){typeof i.tileSize>"u"&&(i.tileSize=256),typeof i.fileFormat>"u"&&(i.fileFormat="jpg",this.fileFormat=i.fileFormat);var s={x:i.width,y:i.height};for(i.imageSizes=[{x:i.width,y:i.height}],i.gridSize=[this._getGridSize(i.width,i.height,i.tileSize)];parseInt(s.x,10)>i.tileSize||parseInt(s.y,10)>i.tileSize;)s.x=Math.floor(s.x/2),s.y=Math.floor(s.y/2),i.imageSizes.push({x:s.x,y:s.y}),i.gridSize.push(this._getGridSize(s.x,s.y,i.tileSize));i.imageSizes.reverse(),i.gridSize.reverse(),i.minLevel=0,i.maxLevel=i.gridSize.length-1,t.TileSource.apply(this,[i])},e.extend(e.ZoomifyTileSource.prototype,e.TileSource.prototype,{_getGridSize:function(i,s,n){return{x:Math.ceil(i/n),y:Math.ceil(s/n)}},_calculateAbsoluteTileNumber:function(i,s,n){for(var a=0,r={},o=0;o<i;o++)r=this.gridSize[o],a+=r.x*r.y;return r=this.gridSize[i],a+=r.x*n+s,a},supports:function(i,s){return i.type&&i.type==="zoomifytileservice"},configure:function(i,s,n){return i},getTileUrl:function(i,s,n){var a=0,r=this._calculateAbsoluteTileNumber(i,s,n);return a=Math.floor(r/256),this.tilesUrl+"TileGroup"+a+"/"+i+"-"+s+"-"+n+"."+this.fileFormat}})})(t),(function(e){e.LegacyTileSource=function(a){var r,o,l;e.isArray(a)&&(r={type:"legacy-image-pyramid",levels:a}),r.levels=i(r.levels),r.levels.length>0?(o=r.levels[r.levels.length-1].width,l=r.levels[r.levels.length-1].height):(o=0,l=0,e.console.error("No supported image formats found")),e.extend(!0,r,{width:o,height:l,tileSize:Math.max(l,o),tileOverlap:0,minLevel:0,maxLevel:r.levels.length>0?r.levels.length-1:0}),e.TileSource.apply(this,[r]),this.levels=r.levels},e.extend(e.LegacyTileSource.prototype,e.TileSource.prototype,{supports:function(a,r){return a.type&&a.type==="legacy-image-pyramid"||a.documentElement&&a.documentElement.getAttribute("type")==="legacy-image-pyramid"},configure:function(a,r,o){var l;return e.isPlainObject(a)?l=n(this,a):l=s(this,a),l},getLevelScale:function(a){var r=NaN;return this.levels.length>0&&a>=this.minLevel&&a<=this.maxLevel&&(r=this.levels[a].width/this.levels[this.maxLevel].width),r},getNumTiles:function(a){var r=this.getLevelScale(a);return r?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(a,r,o){var l=null;return this.levels.length>0&&a>=this.minLevel&&a<=this.maxLevel&&(l=this.levels[a].url),l}});function i(a){var r=[],o,l;for(l=0;l<a.length;l++)o=a[l],o.height&&o.width&&o.url?r.push({url:o.url,width:Number(o.width),height:Number(o.height)}):e.console.error("Unsupported image format: %s",o.url?o.url:"<no URL>");return r.sort(function(c,h){return c.height-h.height})}function s(a,r){if(!r||!r.documentElement)throw new Error(e.getString("Errors.Xml"));var o=r.documentElement,l=o.tagName,c=null,h=[],d,f;if(l==="image")try{for(c={type:o.getAttribute("type"),levels:[]},h=o.getElementsByTagName("level"),f=0;f<h.length;f++)d=h[f],c.levels.push({url:d.getAttribute("url"),width:parseInt(d.getAttribute("width"),10),height:parseInt(d.getAttribute("height"),10)});return n(a,c)}catch(p){throw p instanceof Error?p:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if(l==="collection")throw new Error("Legacy Image Pyramid Collections not yet supported.");if(l==="error")throw new Error("Error: "+r)}throw new Error("Unknown element "+l)}function n(a,r){return r.levels}})(t),(function(e){e.ImageTileSource=function(i){i=e.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},i),e.TileSource.apply(this,[i])},e.extend(e.ImageTileSource.prototype,e.TileSource.prototype,{supports:function(i,s){return i.type&&i.type==="image"},configure:function(i,s,n){return i},getImageInfo:function(i){var s=this._image=new Image,n=this;this.crossOriginPolicy&&(s.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(s.useCredentials=this.ajaxWithCredentials),e.addEvent(s,"load",function(){n.width=s.naturalWidth,n.height=s.naturalHeight,n.aspectRatio=n.width/n.height,n.dimensions=new e.Point(n.width,n.height),n._tileWidth=n.width,n._tileHeight=n.height,n.tileOverlap=0,n.minLevel=0,n.levels=n._buildLevels(),n.maxLevel=n.levels.length-1,n.ready=!0,n.raiseEvent("ready",{tileSource:n})}),e.addEvent(s,"error",function(){n.raiseEvent("open-failed",{message:"Error loading image at "+i,source:i})}),s.src=i},getLevelScale:function(i){var s=NaN;return i>=this.minLevel&&i<=this.maxLevel&&(s=this.levels[i].width/this.levels[this.maxLevel].width),s},getNumTiles:function(i){var s=this.getLevelScale(i);return s?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(i,s,n){var a=null;return i>=this.minLevel&&i<=this.maxLevel&&(a=this.levels[i].url),a},getContext2D:function(i,s,n){var a=null;return i>=this.minLevel&&i<=this.maxLevel&&(a=this.levels[i].context2D),a},destroy:function(){this._freeupCanvasMemory()},_buildLevels:function(){var i=[{url:this._image.src,width:this._image.naturalWidth,height:this._image.naturalHeight}];if(!this.buildPyramid||!e.supportsCanvas||!this.useCanvas)return delete this._image,i;var s=this._image.naturalWidth,n=this._image.naturalHeight,a=document.createElement("canvas"),r=a.getContext("2d");if(a.width=s,a.height=n,r.drawImage(this._image,0,0,s,n),i[0].context2D=r,delete this._image,e.isCanvasTainted(a))return i;for(;s>=2&&n>=2;){s=Math.floor(s/2),n=Math.floor(n/2);var o=document.createElement("canvas"),l=o.getContext("2d");o.width=s,o.height=n,l.drawImage(a,0,0,s,n),i.splice(0,0,{context2D:l,width:s,height:n}),a=o,r=l}return i},_freeupCanvasMemory:function(){for(var i=0;i<this.levels.length;i++)this.levels[i].context2D&&(this.levels[i].context2D.canvas.height=0,this.levels[i].context2D.canvas.width=0)}})})(t),(function(e){e.TileSourceCollection=function(i,s,n,a){e.console.error("TileSourceCollection is deprecated; use World instead")}})(t),(function(e){e.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},e.Button=function(l){var c=this;e.EventSource.call(this),e.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null,userData:null},l),this.element=l.element||e.makeNeutralElement("div"),l.element||(this.imgRest=e.makeTransparentImage(this.srcRest),this.imgGroup=e.makeTransparentImage(this.srcGroup),this.imgHover=e.makeTransparentImage(this.srcHover),this.imgDown=e.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,e.setElementPointerEventsNone(this.imgRest),e.setElementPointerEventsNone(this.imgGroup),e.setElementPointerEventsNone(this.imgHover),e.setElementPointerEventsNone(this.imgDown),this.element.style.position="relative",e.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",e.Browser.vendor===e.BROWSERS.FIREFOX&&e.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=e.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new e.MouseTracker({userData:"Button.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(h){h.insideElementPressed?(r(c,e.ButtonState.DOWN),c.raiseEvent("enter",{originalEvent:h.originalEvent})):h.buttonDownAny||r(c,e.ButtonState.HOVER)},focusHandler:function(h){c.tracker.enterHandler(h),c.raiseEvent("focus",{originalEvent:h.originalEvent})},leaveHandler:function(h){o(c,e.ButtonState.GROUP),h.insideElementPressed&&c.raiseEvent("exit",{originalEvent:h.originalEvent})},blurHandler:function(h){c.tracker.leaveHandler(h),c.raiseEvent("blur",{originalEvent:h.originalEvent})},pressHandler:function(h){r(c,e.ButtonState.DOWN),c.raiseEvent("press",{originalEvent:h.originalEvent})},releaseHandler:function(h){h.insideElementPressed&&h.insideElementReleased?(o(c,e.ButtonState.HOVER),c.raiseEvent("release",{originalEvent:h.originalEvent})):h.insideElementPressed?o(c,e.ButtonState.GROUP):r(c,e.ButtonState.HOVER)},clickHandler:function(h){h.quick&&c.raiseEvent("click",{originalEvent:h.originalEvent})},keyHandler:function(h){h.keyCode===13?(c.raiseEvent("click",{originalEvent:h.originalEvent}),c.raiseEvent("release",{originalEvent:h.originalEvent}),h.preventDefault=!0):h.preventDefault=!1}}),o(this,e.ButtonState.REST)},e.extend(e.Button.prototype,e.EventSource.prototype,{notifyGroupEnter:function(){r(this,e.ButtonState.GROUP)},notifyGroupExit:function(){o(this,e.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,this.tracker.setTracking(!1),e.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,this.tracker.setTracking(!0),e.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()},destroy:function(){this.imgRest&&(this.element.removeChild(this.imgRest),this.imgRest=null),this.imgGroup&&(this.element.removeChild(this.imgGroup),this.imgGroup=null),this.imgHover&&(this.element.removeChild(this.imgHover),this.imgHover=null),this.imgDown&&(this.element.removeChild(this.imgDown),this.imgDown=null),this.removeAllHandlers(),this.tracker.destroy(),this.element=null}});function i(l){e.requestAnimationFrame(function(){s(l)})}function s(l){var c,h,d;l.shouldFade&&(c=e.now(),h=c-l.fadeBeginTime,d=1-h/l.fadeLength,d=Math.min(1,d),d=Math.max(0,d),l.imgGroup&&e.setElementOpacity(l.imgGroup,d,!0),d>0&&i(l))}function n(l){l.shouldFade=!0,l.fadeBeginTime=e.now()+l.fadeDelay,window.setTimeout(function(){i(l)},l.fadeDelay)}function a(l){l.shouldFade=!1,l.imgGroup&&e.setElementOpacity(l.imgGroup,1,!0)}function r(l,c){l.element.disabled||(c>=e.ButtonState.GROUP&&l.currentState===e.ButtonState.REST&&(a(l),l.currentState=e.ButtonState.GROUP),c>=e.ButtonState.HOVER&&l.currentState===e.ButtonState.GROUP&&(l.imgHover&&(l.imgHover.style.visibility=""),l.currentState=e.ButtonState.HOVER),c>=e.ButtonState.DOWN&&l.currentState===e.ButtonState.HOVER&&(l.imgDown&&(l.imgDown.style.visibility=""),l.currentState=e.ButtonState.DOWN))}function o(l,c){l.element.disabled||(c<=e.ButtonState.HOVER&&l.currentState===e.ButtonState.DOWN&&(l.imgDown&&(l.imgDown.style.visibility="hidden"),l.currentState=e.ButtonState.HOVER),c<=e.ButtonState.GROUP&&l.currentState===e.ButtonState.HOVER&&(l.imgHover&&(l.imgHover.style.visibility="hidden"),l.currentState=e.ButtonState.GROUP),c<=e.ButtonState.REST&&l.currentState===e.ButtonState.GROUP&&(n(l),l.currentState=e.ButtonState.REST))}})(t),(function(e){e.ButtonGroup=function(i){e.extend(!0,this,{buttons:[],clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},i);var s=this.buttons.concat([]),n=this,a;if(this.element=i.element||e.makeNeutralElement("div"),!i.group)for(this.element.style.display="inline-block",a=0;a<s.length;a++)this.element.appendChild(s[a].element);e.setElementTouchActionNone(this.element),this.tracker=new e.MouseTracker({userData:"ButtonGroup.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(r){var o;for(o=0;o<n.buttons.length;o++)n.buttons[o].notifyGroupEnter()},leaveHandler:function(r){var o;if(!r.insideElementPressed)for(o=0;o<n.buttons.length;o++)n.buttons[o].notifyGroupExit()}})},e.ButtonGroup.prototype={addButton:function(i){this.buttons.push(i),this.element.appendChild(i.element)},emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateLeave:function(){this.tracker.leaveHandler({eventSource:this.tracker})},destroy:function(){for(;this.buttons.length;){var i=this.buttons.pop();this.element.removeChild(i.element),i.destroy()}this.tracker.destroy(),this.element=null}}})(t),(function(e){e.Rect=function(i,s,n,a,r){this.x=typeof i=="number"?i:0,this.y=typeof s=="number"?s:0,this.width=typeof n=="number"?n:0,this.height=typeof a=="number"?a:0,this.degrees=typeof r=="number"?r:0,this.degrees=e.positiveModulo(this.degrees,360);var o,l;this.degrees>=270?(o=this.getTopRight(),this.x=o.x,this.y=o.y,l=this.height,this.height=this.width,this.width=l,this.degrees-=270):this.degrees>=180?(o=this.getBottomRight(),this.x=o.x,this.y=o.y,this.degrees-=180):this.degrees>=90&&(o=this.getBottomLeft(),this.x=o.x,this.y=o.y,l=this.height,this.height=this.width,this.width=l,this.degrees-=90)},e.Rect.fromSummits=function(i,s,n){var a=i.distanceTo(s),r=i.distanceTo(n),o=s.minus(i),l=Math.atan(o.y/o.x);return o.x<0?l+=Math.PI:o.y<0&&(l+=2*Math.PI),new e.Rect(i.x,i.y,a,r,l/Math.PI*180)},e.Rect.prototype={clone:function(){return new e.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new e.Point(this.x,this.y)},getBottomRight:function(){return new e.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new e.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new e.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new e.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new e.Point(this.width,this.height)},equals:function(i){return i instanceof e.Rect&&this.x===i.x&&this.y===i.y&&this.width===i.width&&this.height===i.height&&this.degrees===i.degrees},times:function(i){return new e.Rect(this.x*i,this.y*i,this.width*i,this.height*i,this.degrees)},translate:function(i){return new e.Rect(this.x+i.x,this.y+i.y,this.width,this.height,this.degrees)},union:function(i){var s=this.getBoundingBox(),n=i.getBoundingBox(),a=Math.min(s.x,n.x),r=Math.min(s.y,n.y),o=Math.max(s.x+s.width,n.x+n.width),l=Math.max(s.y+s.height,n.y+n.height);return new e.Rect(a,r,o-a,l-r)},intersection:function(i){var s=1e-10,n=[],a=this.getTopLeft();i.containsPoint(a,s)&&n.push(a);var r=this.getTopRight();i.containsPoint(r,s)&&n.push(r);var o=this.getBottomLeft();i.containsPoint(o,s)&&n.push(o);var l=this.getBottomRight();i.containsPoint(l,s)&&n.push(l);var c=i.getTopLeft();this.containsPoint(c,s)&&n.push(c);var h=i.getTopRight();this.containsPoint(h,s)&&n.push(h);var d=i.getBottomLeft();this.containsPoint(d,s)&&n.push(d);var f=i.getBottomRight();this.containsPoint(f,s)&&n.push(f);for(var p=this._getSegments(),m=i._getSegments(),v=0;v<p.length;v++)for(var w=p[v],S=0;S<m.length;S++){var _=m[S],A=P(w[0],w[1],_[0],_[1]);A&&n.push(A)}function P(R,D,I,W){var z=D.minus(R),B=W.minus(I),H=-B.x*z.y+z.x*B.y;if(H===0)return null;var $=(z.x*(R.y-I.y)-z.y*(R.x-I.x))/H,J=(B.x*(R.y-I.y)-B.y*(R.x-I.x))/H;return-s<=$&&$<=1-s&&-s<=J&&J<=1-s?new e.Point(R.x+J*z.x,R.y+J*z.y):null}if(n.length===0)return null;for(var k=n[0].x,N=n[0].x,O=n[0].y,j=n[0].y,U=1;U<n.length;U++){var G=n[U];G.x<k&&(k=G.x),G.x>N&&(N=G.x),G.y<O&&(O=G.y),G.y>j&&(j=G.y)}return new e.Rect(k,O,N-k,j-O)},_getSegments:function(){var i=this.getTopLeft(),s=this.getTopRight(),n=this.getBottomLeft(),a=this.getBottomRight();return[[i,s],[s,a],[a,n],[n,i]]},rotate:function(i,s){if(i=e.positiveModulo(i,360),i===0)return this.clone();s=s||this.getCenter();var n=this.getTopLeft().rotate(i,s),a=this.getTopRight().rotate(i,s),r=a.minus(n);r=r.apply(function(l){var c=1e-15;return Math.abs(l)<c?0:l});var o=Math.atan(r.y/r.x);return r.x<0?o+=Math.PI:r.y<0&&(o+=2*Math.PI),new e.Rect(n.x,n.y,this.width,this.height,o/Math.PI*180)},getBoundingBox:function(){if(this.degrees===0)return this.clone();var i=this.getTopLeft(),s=this.getTopRight(),n=this.getBottomLeft(),a=this.getBottomRight(),r=Math.min(i.x,s.x,n.x,a.x),o=Math.max(i.x,s.x,n.x,a.x),l=Math.min(i.y,s.y,n.y,a.y),c=Math.max(i.y,s.y,n.y,a.y);return new e.Rect(r,l,o-r,c-l)},getIntegerBoundingBox:function(){var i=this.getBoundingBox(),s=Math.floor(i.x),n=Math.floor(i.y),a=Math.ceil(i.width+i.x-s),r=Math.ceil(i.height+i.y-n);return new e.Rect(s,n,a,r)},containsPoint:function(i,s){s=s||0;var n=this.getTopLeft(),a=this.getTopRight(),r=this.getBottomLeft(),o=a.minus(n),l=r.minus(n);return(i.x-n.x)*o.x+(i.y-n.y)*o.y>=-s&&(i.x-a.x)*o.x+(i.y-a.y)*o.y<=s&&(i.x-n.x)*l.x+(i.y-n.y)*l.y>=-s&&(i.x-r.x)*l.x+(i.y-r.y)*l.y<=s},toString:function(){return"["+Math.round(this.x*100)/100+", "+Math.round(this.y*100)/100+", "+Math.round(this.width*100)/100+"x"+Math.round(this.height*100)/100+", "+Math.round(this.degrees*100)/100+"deg]"}}})(t),(function(e){var i={};e.ReferenceStrip=function(d){var f=this,p=d.viewer,m=e.getElementSize(p.element),v,w,S;for(d.id||(d.id="referencestrip-"+e.now(),this.element=e.makeNeutralElement("div"),this.element.id=d.id,this.element.className="referencestrip"),d=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.referenceStripSizeRatio,position:e.DEFAULT_SETTINGS.referenceStripPosition,scroll:e.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold},d,{element:this.element}),e.extend(this,d),i[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,this.element.tabIndex=0,w=this.element.style,w.marginTop="0px",w.marginRight="0px",w.marginBottom="0px",w.marginLeft="0px",w.left="0px",w.bottom="0px",w.border="0px",w.background="#000",w.position="relative",e.setElementTouchActionNone(this.element),e.setElementOpacity(this.element,.8),this.viewer=p,this.tracker=new e.MouseTracker({userData:"ReferenceStrip.tracker",element:this.element,clickHandler:e.delegate(this,s),dragHandler:e.delegate(this,n),scrollHandler:e.delegate(this,a),enterHandler:e.delegate(this,o),leaveHandler:e.delegate(this,l),keyDownHandler:e.delegate(this,c),keyHandler:e.delegate(this,h),preProcessEventHandler:function(_){_.eventType==="wheel"&&(_.preventDefault=!0)}}),d.width&&d.height?(this.element.style.width=d.width+"px",this.element.style.height=d.height+"px",p.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):d.scroll==="horizontal"?(this.element.style.width=m.x*d.sizeRatio*p.tileSources.length+12*p.tileSources.length+"px",this.element.style.height=m.y*d.sizeRatio+"px",p.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=m.y*d.sizeRatio*p.tileSources.length+12*p.tileSources.length+"px",this.element.style.width=m.x*d.sizeRatio+"px",p.addControl(this.element,{anchor:e.ControlAnchor.TOP_LEFT})),this.panelWidth=m.x*this.sizeRatio+8,this.panelHeight=m.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},S=0;S<p.tileSources.length;S++)v=e.makeNeutralElement("div"),v.id=this.element.id+"-"+S,v.style.width=f.panelWidth+"px",v.style.height=f.panelHeight+"px",v.style.display="inline",v.style.float="left",v.style.cssFloat="left",v.style.styleFloat="left",v.style.padding="2px",e.setElementTouchActionNone(v),e.setElementPointerEventsNone(v),this.element.appendChild(v),v.activePanel=!1,this.panels.push(v);r(this,this.scroll==="vertical"?m.y:m.x,0),this.setFocus(0)},e.ReferenceStrip.prototype={setFocus:function(d){var f=this.element.querySelector("#"+this.element.id+"-"+d),p=e.getElementSize(this.viewer.canvas),m=Number(this.element.style.width.replace("px","")),v=Number(this.element.style.height.replace("px","")),w=-Number(this.element.style.marginLeft.replace("px","")),S=-Number(this.element.style.marginTop.replace("px","")),_;this.currentSelected!==f&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=f,this.currentSelected.style.background="#999",this.scroll==="horizontal"?(_=Number(d)*(this.panelWidth+3),_>w+p.x-this.panelWidth?(_=Math.min(_,m-p.x),this.element.style.marginLeft=-_+"px",r(this,p.x,-_)):_<w&&(_=Math.max(0,_-p.x/2),this.element.style.marginLeft=-_+"px",r(this,p.x,-_))):(_=Number(d)*(this.panelHeight+3),_>S+p.y-this.panelHeight?(_=Math.min(_,v-p.y),this.element.style.marginTop=-_+"px",r(this,p.y,-_)):_<S&&(_=Math.max(0,_-p.y/2),this.element.style.marginTop=-_+"px",r(this,p.y,-_))),this.currentPage=d,o.call(this,{eventSource:this.tracker}))},update:function(){return!!i[this.id].animating},destroy:function(){if(this.miniViewers)for(var d in this.miniViewers)this.miniViewers[d].destroy();this.tracker.destroy(),this.element&&this.viewer.removeControl(this.element)}};function s(d){if(d.quick){var f;this.scroll==="horizontal"?f=Math.floor(d.position.x/(this.panelWidth+4)):f=Math.floor(d.position.y/this.panelHeight),this.viewer.goToPage(f)}this.element.focus()}function n(d){if(this.dragging=!0,this.element){var f=Number(this.element.style.marginLeft.replace("px","")),p=Number(this.element.style.marginTop.replace("px","")),m=Number(this.element.style.width.replace("px","")),v=Number(this.element.style.height.replace("px","")),w=e.getElementSize(this.viewer.canvas);this.scroll==="horizontal"?-d.delta.x>0?f>-(m-w.x)&&(this.element.style.marginLeft=f+d.delta.x*2+"px",r(this,w.x,f+d.delta.x*2)):-d.delta.x<0&&f<0&&(this.element.style.marginLeft=f+d.delta.x*2+"px",r(this,w.x,f+d.delta.x*2)):-d.delta.y>0?p>-(v-w.y)&&(this.element.style.marginTop=p+d.delta.y*2+"px",r(this,w.y,p+d.delta.y*2)):-d.delta.y<0&&p<0&&(this.element.style.marginTop=p+d.delta.y*2+"px",r(this,w.y,p+d.delta.y*2))}}function a(d){if(this.element){var f=Number(this.element.style.marginLeft.replace("px","")),p=Number(this.element.style.marginTop.replace("px","")),m=Number(this.element.style.width.replace("px","")),v=Number(this.element.style.height.replace("px","")),w=e.getElementSize(this.viewer.canvas);this.scroll==="horizontal"?d.scroll>0?f>-(m-w.x)&&(this.element.style.marginLeft=f-d.scroll*60+"px",r(this,w.x,f-d.scroll*60)):d.scroll<0&&f<0&&(this.element.style.marginLeft=f-d.scroll*60+"px",r(this,w.x,f-d.scroll*60)):d.scroll<0?p>w.y-v&&(this.element.style.marginTop=p+d.scroll*60+"px",r(this,w.y,p+d.scroll*60)):d.scroll>0&&p<0&&(this.element.style.marginTop=p+d.scroll*60+"px",r(this,w.y,p+d.scroll*60)),d.preventDefault=!0}}function r(d,f,p){var m,v,w,S,_,A;for(d.scroll==="horizontal"?m=d.panelWidth:m=d.panelHeight,v=Math.ceil(f/m)+5,w=Math.ceil((Math.abs(p)+f)/m)+1,v=w-v,v=v<0?0:v,_=v;_<w&&_<d.panels.length;_++)if(A=d.panels[_],!A.activePanel){var P,k=d.viewer.tileSources[_];k.referenceStripThumbnailUrl?P={type:"image",url:k.referenceStripThumbnailUrl}:P=k,S=new e.Viewer({id:A.id,tileSources:[P],element:A,navigatorSizeRatio:d.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:d.viewer.loadTilesWithAjax,ajaxHeaders:d.viewer.ajaxHeaders,useCanvas:d.useCanvas}),e.setElementPointerEventsNone(S.canvas),e.setElementPointerEventsNone(S.container),S.innerTracker.setTracking(!1),S.outerTracker.setTracking(!1),d.miniViewers[A.id]=S,A.activePanel=!0}}function o(d){var f=d.eventSource.element;this.scroll==="horizontal"?f.style.marginBottom="0px":f.style.marginLeft="0px"}function l(d){var f=d.eventSource.element;this.scroll==="horizontal"?f.style.marginBottom="-"+e.getElementSize(f).y/2+"px":f.style.marginLeft="-"+e.getElementSize(f).x/2+"px"}function c(d){if(!d.ctrl&&!d.alt&&!d.meta)switch(d.keyCode){case 38:a.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),d.preventDefault=!0;break;case 40:a.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),d.preventDefault=!0;break;case 37:a.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),d.preventDefault=!0;break;case 39:a.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),d.preventDefault=!0;break;default:d.preventDefault=!1;break}else d.preventDefault=!1}function h(d){if(!d.ctrl&&!d.alt&&!d.meta)switch(d.keyCode){case 61:a.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),d.preventDefault=!0;break;case 45:a.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),d.preventDefault=!0;break;case 48:case 119:case 87:a.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),d.preventDefault=!0;break;case 115:case 83:a.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),d.preventDefault=!0;break;case 97:a.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),d.preventDefault=!0;break;case 100:a.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),d.preventDefault=!0;break;default:d.preventDefault=!1;break}else d.preventDefault=!1}})(t),(function(e){e.DisplayRect=function(i,s,n,a,r,o){e.Rect.apply(this,[i,s,n,a]),this.minLevel=r,this.maxLevel=o},e.extend(e.DisplayRect.prototype,e.Rect.prototype)})(t),(function(e){e.Spring=function(s){var n=arguments;typeof s!="object"&&(s={initial:n.length&&typeof n[0]=="number"?n[0]:void 0,springStiffness:n.length>1?n[1].springStiffness:5,animationTime:n.length>1?n[1].animationTime:1.5}),e.console.assert(typeof s.springStiffness=="number"&&s.springStiffness!==0,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),e.console.assert(typeof s.animationTime=="number"&&s.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),s.exponential&&(this._exponential=!0,delete s.exponential),e.extend(!0,this,s),this.current={value:typeof this.initial=="number"?this.initial:this._exponential?0:1,time:e.now()},e.console.assert(!this._exponential||this.current.value!==0,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},e.Spring.prototype={resetTo:function(s){e.console.assert(!this._exponential||s!==0,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=s,this.start.time=this.target.time=this.current.time=e.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(s){e.console.assert(!this._exponential||s!==0,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=s,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(s){this.start.value+=s,this.target.value+=s,this._exponential&&(e.console.assert(this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(s){this._exponential=s,this._exponential&&(e.console.assert(this.current.value!==0&&this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){this.current.time=e.now();var s,n;this._exponential?(s=this.start._logValue,n=this.target._logValue):(s=this.start.value,n=this.target.value);var a=this.current.time>=this.target.time?n:s+(n-s)*i(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time)),r=this.current.value;return this._exponential?this.current.value=Math.exp(a):this.current.value=a,r!==this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}};function i(s,n){return(1-Math.exp(s*-n))/(1-Math.exp(-s))}})(t),(function(e){e.ImageJob=function(s){e.extend(!0,this,{timeout:e.DEFAULT_SETTINGS.timeout,jobId:null,tries:0},s),this.data=null,this.userData={},this.errorMsg=null},e.ImageJob.prototype={start:function(){this.tries++;var s=this,n=this.abort;this.jobId=window.setTimeout(function(){s.finish(null,null,"Image load exceeded timeout ("+s.timeout+" ms)")},this.timeout),this.abort=function(){s.source.downloadTileAbort(s),typeof n=="function"&&n()},this.source.downloadTileStart(this)},finish:function(s,n,a){this.data=s,this.request=n,this.errorMsg=a,this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},e.ImageLoader=function(s){e.extend(!0,this,{jobLimit:e.DEFAULT_SETTINGS.imageLoaderLimit,timeout:e.DEFAULT_SETTINGS.timeout,jobQueue:[],failedTiles:[],jobsInProgress:0},s)},e.ImageLoader.prototype={addJob:function(s){if(!s.source){e.console.error("ImageLoader.prototype.addJob() requires [options.source]. TileSource since new API defines how images are fetched. Creating a dummy TileSource.");var n=e.TileSource.prototype;s.source={downloadTileStart:n.downloadTileStart,downloadTileAbort:n.downloadTileAbort}}var a=this,r=function(c){i(a,c,s.callback)},o={src:s.src,tile:s.tile||{},source:s.source,loadWithAjax:s.loadWithAjax,ajaxHeaders:s.loadWithAjax?s.ajaxHeaders:null,crossOriginPolicy:s.crossOriginPolicy,ajaxWithCredentials:s.ajaxWithCredentials,postData:s.postData,callback:r,abort:s.abort,timeout:this.timeout},l=new e.ImageJob(o);!this.jobLimit||this.jobsInProgress<this.jobLimit?(l.start(),this.jobsInProgress++):this.jobQueue.push(l)},clear:function(){for(var s=0;s<this.jobQueue.length;s++){var n=this.jobQueue[s];typeof n.abort=="function"&&n.abort()}this.jobQueue=[]}};function i(s,n,a){n.errorMsg!==""&&(n.data===null||n.data===void 0)&&n.tries<1+s.tileRetryMax&&s.failedTiles.push(n);var r;s.jobsInProgress--,(!s.jobLimit||s.jobsInProgress<s.jobLimit)&&s.jobQueue.length>0&&(r=s.jobQueue.shift(),r.start(),s.jobsInProgress++),s.tileRetryMax>0&&s.jobQueue.length===0&&(!s.jobLimit||s.jobsInProgress<s.jobLimit)&&s.failedTiles.length>0&&(r=s.failedTiles.shift(),setTimeout(function(){r.start()},s.tileRetryDelay),s.jobsInProgress++),a(n.data,n.errorMsg,n.request)}})(t),(function(e){e.Tile=function(i,s,n,a,r,o,l,c,h,d,f,p){this.level=i,this.x=s,this.y=n,this.bounds=a,this.sourceBounds=d,this.exists=r,this._url=o,this.postData=f,this.context2D=l,this.loadWithAjax=c,this.ajaxHeaders=h,p===void 0&&(e.console.warn("Tile constructor needs 'cacheKey' variable: creation tile cache in Tile class is deprecated. TileSource.prototype.getTileHashKey will be used."),p=e.TileSource.prototype.getTileHashKey(i,s,n,o,h,f)),this.cacheKey=p,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.style=null,this.position=null,this.size=null,this.flipped=!1,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.hasTransparency=!1,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},e.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return console.warn("Tile.prototype._hasTransparencyChannel() has been deprecated and will be removed in the future. Use TileSource.prototype.hasTransparency() instead."),!!this.context2D||this.getUrl().match(".png")},drawHTML:function(i){if(!this.cacheImageRecord){e.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString());return}if(!this.loaded){e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}if(!this.element){var s=this.getImage();if(!s)return;this.element=e.makeNeutralElement("div"),this.imgElement=s.cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"}this.element.parentNode!==i&&i.appendChild(this.element),this.imgElement.parentNode!==this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",this.flipped&&(this.style.transform="scaleX(-1)"),e.setElementOpacity(this.element,this.opacity)},get image(){return e.console.error("[Tile.image] property has been deprecated. Use [Tile.prototype.getImage] instead."),this.getImage()},get url(){return e.console.error("[Tile.url] property has been deprecated. Use [Tile.prototype.getUrl] instead."),this.getUrl()},getImage:function(){return this.cacheImageRecord.getImage()},getUrl:function(){return typeof this._url=="function"?this._url():this._url},getCanvasContext:function(){return this.context2D||this.cacheImageRecord.getRenderedContext()},drawCanvas:function(i,s,n,a,r,o){var l=this.position.times(e.pixelDensityRatio),c=this.size.times(e.pixelDensityRatio),h;if(!this.context2D&&!this.cacheImageRecord){e.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString());return}if(h=this.getCanvasContext(),!this.loaded||!h){e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}i.save(),i.globalAlpha=this.opacity,typeof n=="number"&&n!==1&&(l=l.times(n),c=c.times(n)),a instanceof e.Point&&(l=l.plus(a)),i.globalAlpha===1&&this.hasTransparency&&(r&&(l.x=Math.round(l.x),l.y=Math.round(l.y),c.x=Math.round(c.x),c.y=Math.round(c.y)),i.clearRect(l.x,l.y,c.x,c.y)),s({context:i,tile:this,rendered:h});var d,f;this.sourceBounds?(d=Math.min(this.sourceBounds.width,h.canvas.width),f=Math.min(this.sourceBounds.height,h.canvas.height)):(d=h.canvas.width,f=h.canvas.height),i.translate(l.x+c.x/2,0),this.flipped&&i.scale(-1,1),i.drawImage(h.canvas,0,0,d,f,-c.x/2,l.y,c.x,c.y),i.restore()},getScaleForEdgeSmoothing:function(){var i;if(this.cacheImageRecord)i=this.cacheImageRecord.getRenderedContext();else if(this.context2D)i=this.context2D;else return e.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;return i.canvas.width/(this.size.x*e.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(i,s,n){var a=Math.max(1,Math.ceil((n.x-s.x)/2)),r=Math.max(1,Math.ceil((n.y-s.y)/2));return new e.Point(a,r).minus(this.position.times(e.pixelDensityRatio).times(i||1).apply(function(o){return o%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}})(t),(function(e){e.OverlayPlacement=e.Placement,e.OverlayRotationMode=e.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),e.Overlay=function(i,s,n){var a;e.isPlainObject(i)?a=i:a={element:i,location:s,placement:n},this.element=a.element,this.style=a.element.style,this._init(a)},e.Overlay.prototype={_init:function(i){this.location=i.location,this.placement=i.placement===void 0?e.Placement.TOP_LEFT:i.placement,this.onDraw=i.onDraw,this.checkResize=i.checkResize===void 0?!0:i.checkResize,this.width=i.width===void 0?null:i.width,this.height=i.height===void 0?null:i.height,this.rotationMode=i.rotationMode||e.OverlayRotationMode.EXACT,this.location instanceof e.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=e.Placement.TOP_LEFT),this.scales=this.width!==null&&this.height!==null,this.bounds=new e.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(i,s){var n=e.Placement.properties[this.placement];n&&(n.isHorizontallyCentered?i.x-=s.x/2:n.isRight&&(i.x-=s.x),n.isVerticallyCentered?i.y-=s.y/2:n.isBottom&&(i.y-=s.y))},destroy:function(){var i=this.element,s=this.style;i.parentNode&&(i.parentNode.removeChild(i),i.prevElementParent&&(s.display="none",document.body.appendChild(i))),this.onDraw=null,s.top="",s.left="",s.position="",this.width!==null&&(s.width=""),this.height!==null&&(s.height="");var n=e.getCssPropertyWithVendorPrefix("transformOrigin"),a=e.getCssPropertyWithVendorPrefix("transform");n&&a&&(s[n]="",s[a]="")},drawHTML:function(i,s){var n=this.element;n.parentNode!==i&&(n.prevElementParent=n.parentNode,n.prevNextSibling=n.nextSibling,i.appendChild(n),this.style.position="absolute",this.size=e.getElementSize(n));var a=this._getOverlayPositionAndSize(s),r=a.position,o=this.size=a.size,l=a.rotate;if(this.onDraw)this.onDraw(r,o,this.element);else{var c=this.style;c.left=r.x+"px",c.top=r.y+"px",this.width!==null&&(c.width=o.x+"px"),this.height!==null&&(c.height=o.y+"px");var h=e.getCssPropertyWithVendorPrefix("transformOrigin"),d=e.getCssPropertyWithVendorPrefix("transform");h&&d&&(l?(c[h]=this._getTransformOrigin(),c[d]="rotate("+l+"deg)"):(c[h]="",c[d]="")),c.display="block"}},_getOverlayPositionAndSize:function(i){var s=i.pixelFromPoint(this.location,!0),n=this._getSizeInPixels(i);this.adjust(s,n);var a=0;if(i.getRotation(!0)&&this.rotationMode!==e.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===e.OverlayRotationMode.BOUNDING_BOX&&this.width!==null&&this.height!==null){var r=new e.Rect(s.x,s.y,n.x,n.y),o=this._getBoundingBox(r,i.getRotation(!0));s=o.getTopLeft(),n=o.getSize()}else a=i.getRotation(!0);return{position:s,size:n,rotate:a}},_getSizeInPixels:function(i){var s=this.size.x,n=this.size.y;if(this.width!==null||this.height!==null){var a=i.deltaPixelsFromPointsNoRotate(new e.Point(this.width||0,this.height||0),!0);this.width!==null&&(s=a.x),this.height!==null&&(n=a.y)}if(this.checkResize&&(this.width===null||this.height===null)){var r=this.size=e.getElementSize(this.element);this.width===null&&(s=r.x),this.height===null&&(n=r.y)}return new e.Point(s,n)},_getBoundingBox:function(i,s){var n=this._getPlacementPoint(i);return i.rotate(s,n).getBoundingBox()},_getPlacementPoint:function(i){var s=new e.Point(i.x,i.y),n=e.Placement.properties[this.placement];return n&&(n.isHorizontallyCentered?s.x+=i.width/2:n.isRight&&(s.x+=i.width),n.isVerticallyCentered?s.y+=i.height/2:n.isBottom&&(s.y+=i.height)),s},_getTransformOrigin:function(){var i="",s=e.Placement.properties[this.placement];return s&&(s.isLeft?i="left":s.isRight&&(i="right"),s.isTop?i+=" top":s.isBottom&&(i+=" bottom")),i},update:function(i,s){var n=e.isPlainObject(i)?i:{location:i,placement:s};this._init({location:n.location||this.location,placement:n.placement!==void 0?n.placement:this.placement,onDraw:n.onDraw||this.onDraw,checkResize:n.checkResize||this.checkResize,width:n.width!==void 0?n.width:this.width,height:n.height!==void 0?n.height:this.height,rotationMode:n.rotationMode||this.rotationMode})},getBounds:function(i){e.console.assert(i,"A viewport must now be passed to Overlay.getBounds.");var s=this.width,n=this.height;if(s===null||n===null){var a=i.deltaPointsFromPixelsNoRotate(this.size,!0);s===null&&(s=a.x),n===null&&(n=a.y)}var r=this.location.clone();return this.adjust(r,new e.Point(s,n)),this._adjustBoundsForRotation(i,new e.Rect(r.x,r.y,s,n))},_adjustBoundsForRotation:function(i,s){if(!i||i.getRotation(!0)===0||this.rotationMode===e.OverlayRotationMode.EXACT)return s;if(this.rotationMode===e.OverlayRotationMode.BOUNDING_BOX){if(this.width===null||this.height===null)return s;var n=this._getOverlayPositionAndSize(i);return i.viewerElementToViewportRectangle(new e.Rect(n.position.x,n.position.y,n.size.x,n.size.y))}return s.rotate(-i.getRotation(!0),this._getPlacementPoint(s))}}})(t),(function(e){e.Drawer=function(i){e.console.assert(i.viewer,"[Drawer] options.viewer is required");var s=arguments;if(e.isPlainObject(i)||(i={source:s[0],viewport:s[1],element:s[2]}),e.console.assert(i.viewport,"[Drawer] options.viewport is required"),e.console.assert(i.element,"[Drawer] options.element is required"),i.source&&e.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=i.viewer,this.viewport=i.viewport,this.debugGridColor=typeof i.debugGridColor=="string"?[i.debugGridColor]:i.debugGridColor||e.DEFAULT_SETTINGS.debugGridColor,i.opacity&&e.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=e.supportsCanvas&&(this.viewer?this.viewer.useCanvas:!0),this.container=e.getElement(i.element),this.canvas=e.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var n=this._calculateCanvasSize();this.canvas.width=n.x,this.canvas.height=n.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",e.setElementOpacity(this.canvas,this.opacity,!0),e.setElementPointerEventsNone(this.canvas),e.setElementTouchActionNone(this.canvas),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},e.Drawer.prototype={addOverlay:function(i,s,n,a){return e.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(i,s,n,a),this},updateOverlay:function(i,s,n){return e.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(i,s,n),this},removeOverlay:function(i){return e.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(i),this},clearOverlays:function(){return e.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(i){var s=this.viewport.pixelFromPointNoRotate(i,!0);return new e.Point(s.x*e.pixelDensityRatio,s.y*e.pixelDensityRatio)},clipWithPolygons:function(i,s){if(this.useCanvas){var n=this._getContext(s);n.beginPath(),i.forEach(function(a){a.forEach(function(r,o){n[o===0?"moveTo":"lineTo"](r.x,r.y)})}),n.clip()}},setOpacity:function(i){e.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var s=this.viewer.world,n=0;n<s.getItemCount();n++)s.getItemAt(n).setOpacity(i);return this},getOpacity:function(){e.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var i=this.viewer.world,s=0,n=0;n<i.getItemCount();n++){var a=i.getItemAt(n).getOpacity();a>s&&(s=a)}return s},needsUpdate:function(){return e.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return e.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return e.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return e.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var i=this._calculateCanvasSize();if((this.canvas.width!==i.x||this.canvas.height!==i.y)&&(this.canvas.width=i.x,this.canvas.height=i.y,this._updateImageSmoothingEnabled(this.context),this.sketchCanvas!==null)){var s=this._calculateSketchCanvasSize();this.sketchCanvas.width=s.x,this.sketchCanvas.height=s.y,this._updateImageSmoothingEnabled(this.sketchContext)}this._clear()}},_clear:function(i,s){if(this.useCanvas){var n=this._getContext(i);if(s)n.clearRect(s.x,s.y,s.width,s.height);else{var a=n.canvas;n.clearRect(0,0,a.width,a.height)}}},viewportToDrawerRectangle:function(i){var s=this.viewport.pixelFromPointNoRotate(i.getTopLeft(),!0),n=this.viewport.deltaPixelsFromPointsNoRotate(i.getSize(),!0);return new e.Rect(s.x*e.pixelDensityRatio,s.y*e.pixelDensityRatio,n.x*e.pixelDensityRatio,n.y*e.pixelDensityRatio)},drawTile:function(i,s,n,a,r,o,l){if(e.console.assert(i,"[Drawer.drawTile] tile is required"),e.console.assert(s,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var c=this._getContext(n);a=a||1,i.drawCanvas(c,s,a,r,o,l)}else i.drawHTML(this.canvas)},_getContext:function(i){var s=this.context;if(i){if(this.sketchCanvas===null){this.sketchCanvas=document.createElement("canvas");var n=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=n.x,this.sketchCanvas.height=n.y,this.sketchContext=this.sketchCanvas.getContext("2d"),this.viewport.getRotation()===0){var a=this;this.viewer.addHandler("rotate",function r(){if(a.viewport.getRotation()!==0){a.viewer.removeHandler("rotate",r);var o=a._calculateSketchCanvasSize();a.sketchCanvas.width=o.x,a.sketchCanvas.height=o.y}})}this._updateImageSmoothingEnabled(this.sketchContext)}s=this.sketchContext}return s},saveContext:function(i){this.useCanvas&&this._getContext(i).save()},restoreContext:function(i){this.useCanvas&&this._getContext(i).restore()},setClip:function(i,s){if(this.useCanvas){var n=this._getContext(s);n.beginPath(),n.rect(i.x,i.y,i.width,i.height),n.clip()}},drawRectangle:function(i,s,n){if(this.useCanvas){var a=this._getContext(n);a.save(),a.fillStyle=s,a.fillRect(i.x,i.y,i.width,i.height),a.restore()}},blendSketch:function(i,s,n,a){var r=i;if(e.isPlainObject(r)||(r={opacity:i,scale:s,translate:n,compositeOperation:a}),!(!this.useCanvas||!this.sketchCanvas)){i=r.opacity,a=r.compositeOperation;var o=r.bounds;if(this.context.save(),this.context.globalAlpha=i,a&&(this.context.globalCompositeOperation=a),o)o.x<0&&(o.width+=o.x,o.x=0),o.x+o.width>this.canvas.width&&(o.width=this.canvas.width-o.x),o.y<0&&(o.height+=o.y,o.y=0),o.y+o.height>this.canvas.height&&(o.height=this.canvas.height-o.y),this.context.drawImage(this.sketchCanvas,o.x,o.y,o.width,o.height,o.x,o.y,o.width,o.height);else{s=r.scale||1,n=r.translate;var l=n instanceof e.Point?n:new e.Point(0,0),c=0,h=0;if(n){var d=this.sketchCanvas.width-this.canvas.width,f=this.sketchCanvas.height-this.canvas.height;c=Math.round(d/2),h=Math.round(f/2)}this.context.drawImage(this.sketchCanvas,l.x-c*s,l.y-h*s,(this.canvas.width+2*c)*s,(this.canvas.height+2*h)*s,-c,-h,this.canvas.width+2*c,this.canvas.height+2*h)}this.context.restore()}},drawDebugInfo:function(i,s,n,a){if(this.useCanvas){var r=this.viewer.world.getIndexOfItem(a)%this.debugGridColor.length,o=this.context;o.save(),o.lineWidth=2*e.pixelDensityRatio,o.font="small-caps bold "+13*e.pixelDensityRatio+"px arial",o.strokeStyle=this.debugGridColor[r],o.fillStyle=this.debugGridColor[r],this.viewport.getRotation(!0)%360!==0&&this._offsetForRotation({degrees:this.viewport.getRotation(!0)}),a.getRotation(!0)%360!==0&&this._offsetForRotation({degrees:a.getRotation(!0),point:a.viewport.pixelFromPointNoRotate(a._getRotationPoint(!0),!0)}),a.viewport.getRotation(!0)%360===0&&a.getRotation(!0)%360===0&&a._drawer.viewer.viewport.getFlip()&&a._drawer._flip(),o.strokeRect(i.position.x*e.pixelDensityRatio,i.position.y*e.pixelDensityRatio,i.size.x*e.pixelDensityRatio,i.size.y*e.pixelDensityRatio);var l=(i.position.x+i.size.x/2)*e.pixelDensityRatio,c=(i.position.y+i.size.y/2)*e.pixelDensityRatio;o.translate(l,c),o.rotate(Math.PI/180*-this.viewport.getRotation(!0)),o.translate(-l,-c),i.x===0&&i.y===0&&(o.fillText("Zoom: "+this.viewport.getZoom(),i.position.x*e.pixelDensityRatio,(i.position.y-30)*e.pixelDensityRatio),o.fillText("Pan: "+this.viewport.getBounds().toString(),i.position.x*e.pixelDensityRatio,(i.position.y-20)*e.pixelDensityRatio)),o.fillText("Level: "+i.level,(i.position.x+10)*e.pixelDensityRatio,(i.position.y+20)*e.pixelDensityRatio),o.fillText("Column: "+i.x,(i.position.x+10)*e.pixelDensityRatio,(i.position.y+30)*e.pixelDensityRatio),o.fillText("Row: "+i.y,(i.position.x+10)*e.pixelDensityRatio,(i.position.y+40)*e.pixelDensityRatio),o.fillText("Order: "+n+" of "+s,(i.position.x+10)*e.pixelDensityRatio,(i.position.y+50)*e.pixelDensityRatio),o.fillText("Size: "+i.size.toString(),(i.position.x+10)*e.pixelDensityRatio,(i.position.y+60)*e.pixelDensityRatio),o.fillText("Position: "+i.position.toString(),(i.position.x+10)*e.pixelDensityRatio,(i.position.y+70)*e.pixelDensityRatio),this.viewport.getRotation(!0)%360!==0&&this._restoreRotationChanges(),a.getRotation(!0)%360!==0&&this._restoreRotationChanges(),a.viewport.getRotation(!0)%360===0&&a.getRotation(!0)%360===0&&a._drawer.viewer.viewport.getFlip()&&a._drawer._flip(),o.restore()}},debugRect:function(i){if(this.useCanvas){var s=this.context;s.save(),s.lineWidth=2*e.pixelDensityRatio,s.strokeStyle=this.debugGridColor[0],s.fillStyle=this.debugGridColor[0],s.strokeRect(i.x*e.pixelDensityRatio,i.y*e.pixelDensityRatio,i.width*e.pixelDensityRatio,i.height*e.pixelDensityRatio),s.restore()}},setImageSmoothingEnabled:function(i){this.useCanvas&&(this._imageSmoothingEnabled=i,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(i){i.msImageSmoothingEnabled=this._imageSmoothingEnabled,i.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(i){var s=this._getContext(i).canvas;return new e.Point(s.width,s.height)},getCanvasCenter:function(){return new e.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(i){var s=i.point?i.point.times(e.pixelDensityRatio):this.getCanvasCenter(),n=this._getContext(i.useSketch);n.save(),n.translate(s.x,s.y),this.viewer.viewport.flipped?(n.rotate(Math.PI/180*-i.degrees),n.scale(-1,1)):n.rotate(Math.PI/180*i.degrees),n.translate(-s.x,-s.y)},_flip:function(i){i=i||{};var s=i.point?i.point.times(e.pixelDensityRatio):this.getCanvasCenter(),n=this._getContext(i.useSketch);n.translate(s.x,0),n.scale(-1,1),n.translate(-s.x,0)},_restoreRotationChanges:function(i){var s=this._getContext(i);s.restore()},_calculateCanvasSize:function(){var i=e.pixelDensityRatio,s=this.viewport.getContainerSize();return{x:Math.round(s.x*i),y:Math.round(s.y*i)}},_calculateSketchCanvasSize:function(){var i=this._calculateCanvasSize();if(this.viewport.getRotation()===0)return i;var s=Math.ceil(Math.sqrt(i.x*i.x+i.y*i.y));return{x:s,y:s}}}})(t),(function(e){e.Viewport=function(i){var s=arguments;s.length&&s[0]instanceof e.Point&&(i={containerSize:s[0],contentSize:s[1],config:s[2]}),i.config&&(e.extend(!0,i,i.config),delete i.config),this._margins=e.extend({left:0,top:0,right:0,bottom:0},i.margins||{}),delete i.margins,i.initialDegrees=i.degrees,delete i.degrees,e.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,rotationPivot:null,viewer:null,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:e.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:e.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:e.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:e.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:e.DEFAULT_SETTINGS.maxZoomLevel,initialDegrees:e.DEFAULT_SETTINGS.degrees,flipped:e.DEFAULT_SETTINGS.flipped,homeFillsViewer:e.DEFAULT_SETTINGS.homeFillsViewer,silenceMultiImageWarnings:e.DEFAULT_SETTINGS.silenceMultiImageWarnings},i),this._updateContainerInnerSize(),this.centerSpringX=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new e.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.degreesSpring=new e.Spring({initial:i.initialDegrees,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._oldDegrees=this.degreesSpring.current.value,this._setContentBounds(new e.Rect(0,0,1,1),1),this.goHome(!0),this.update()},e.Viewport.prototype={get degrees(){return e.console.warn("Accessing [Viewport.degrees] is deprecated. Use viewport.getRotation instead."),this.getRotation()},set degrees(i){e.console.warn("Setting [Viewport.degrees] is deprecated. Use viewport.rotateTo, viewport.rotateBy, or viewport.setRotation instead."),this.rotateTo(i)},resetContentSize:function(i){return e.console.assert(i,"[Viewport.resetContentSize] contentSize is required"),e.console.assert(i instanceof e.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),e.console.assert(i.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),e.console.assert(i.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new e.Rect(0,0,1,i.y/i.x),i.x),this},setHomeBounds:function(i,s){e.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(i,s)},_setContentBounds:function(i,s){e.console.assert(i,"[Viewport._setContentBounds] bounds is required"),e.console.assert(i instanceof e.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),e.console.assert(i.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),e.console.assert(i.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=i.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(s),this._contentBounds=i.rotate(this.getRotation()).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(s),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:s,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var i=this._contentAspectRatio/this.getAspectRatio(),s;return this.homeFillsViewer?s=i>=1?i:1:s=i>=1?1:i,s/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var i=this._contentBounds.getCenter(),s=1/this.getHomeZoom(),n=s/this.getAspectRatio();return new e.Rect(i.x-s/2,i.y-n/2,s,n)},goHome:function(i){return this.viewer&&this.viewer.raiseEvent("home",{immediately:i}),this.fitBounds(this.getHomeBounds(),i)},getMinZoom:function(){var i=this.getHomeZoom(),s=this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*i;return s},getMaxZoom:function(){var i=this.maxZoomLevel;return i||(i=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,i/=this._contentBounds.width),Math.max(i,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new e.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return e.extend({},this._margins)},setMargins:function(i){e.console.assert(e.type(i)==="object","[Viewport.setMargins] margins must be an object"),this._margins=e.extend({left:0,top:0,right:0,bottom:0},i),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(i){return this.getBoundsNoRotate(i).rotate(-this.getRotation(i))},getBoundsNoRotate:function(i){var s=this.getCenter(i),n=1/this.getZoom(i),a=n/this.getAspectRatio();return new e.Rect(s.x-n/2,s.y-a/2,n,a)},getBoundsWithMargins:function(i){return this.getBoundsNoRotateWithMargins(i).rotate(-this.getRotation(i),this.getCenter(i))},getBoundsNoRotateWithMargins:function(i){var s=this.getBoundsNoRotate(i),n=this._containerInnerSize.x*this.getZoom(i);return s.x-=this._margins.left/n,s.y-=this._margins.top/n,s.width+=(this._margins.left+this._margins.right)/n,s.height+=(this._margins.top+this._margins.bottom)/n,s},getCenter:function(i){var s=new e.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),n=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value),a,r,o,l,c,h,d,f;return i?s:this.zoomPoint?(a=this.pixelFromPoint(this.zoomPoint,!0),r=this.getZoom(),o=1/r,l=o/this.getAspectRatio(),c=new e.Rect(s.x-o/2,s.y-l/2,o,l),h=this._pixelFromPoint(this.zoomPoint,c),d=h.minus(a).rotate(-this.getRotation(!0)),f=d.divide(this._containerInnerSize.x*r),n.plus(f)):n},getZoom:function(i){return i?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(i){return Math.max(Math.min(i,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(i){var s=this.viewportToViewerElementRectangle(i).getBoundingBox(),n=this.viewportToViewerElementRectangle(this._contentBoundsNoRotate).getBoundingBox(),a=!1,r=!1;if(!this.wrapHorizontal){var o=s.x+s.width,l=n.x+n.width,c,h,d;s.width>n.width?c=this.visibilityRatio*n.width:c=this.visibilityRatio*s.width,h=n.x-o+c,d=l-s.x-c,c>n.width?(s.x+=(h+d)/2,a=!0):d<0?(s.x+=d,a=!0):h>0&&(s.x+=h,a=!0)}if(!this.wrapVertical){var f=s.y+s.height,p=n.y+n.height,m,v,w;s.height>n.height?m=this.visibilityRatio*n.height:m=this.visibilityRatio*s.height,v=n.y-f+m,w=p-s.y-m,m>n.height?(s.y+=(v+w)/2,r=!0):w<0?(s.y+=w,r=!0):v>0&&(s.y+=v,r=!0)}var S=a||r,_=S?this.viewerElementToViewportRectangle(s):i.clone();return _.xConstrained=a,_.yConstrained=r,_.constraintApplied=S,_},_raiseConstraintsEvent:function(i){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:i})},applyConstraints:function(i){var s=this.getZoom(),n=this._applyZoomConstraints(s);s!==n&&this.zoomTo(n,this.zoomPoint,i);var a=this.getConstrainedBounds(!1);return a.constraintApplied&&(this.fitBounds(a,i),this._raiseConstraintsEvent(i)),this},ensureVisible:function(i){return this.applyConstraints(i)},_fitBounds:function(i,s){s=s||{};var n=s.immediately||!1,a=s.constraints||!1,r=this.getAspectRatio(),o=i.getCenter(),l=new e.Rect(i.x,i.y,i.width,i.height,i.degrees+this.getRotation()).getBoundingBox();l.getAspectRatio()>=r?l.height=l.width/r:l.width=l.height*r,l.x=o.x-l.width/2,l.y=o.y-l.height/2;var c=1/l.width;if(n)return this.panTo(o,!0),this.zoomTo(c,null,!0),a&&this.applyConstraints(!0),this;var h=this.getCenter(!0),d=this.getZoom(!0);this.panTo(h,!0),this.zoomTo(d,null,!0);var f=this.getBounds(),p=this.getZoom();if(p===0||Math.abs(c/p-1)<1e-8)return this.zoomTo(c,null,!0),this.panTo(o,n),a&&this.applyConstraints(!1),this;if(a){this.panTo(o,!1),c=this._applyZoomConstraints(c),this.zoomTo(c,null,!1);var m=this.getConstrainedBounds();this.panTo(h,!0),this.zoomTo(d,null,!0),this.fitBounds(m)}else{var v=l.rotate(-this.getRotation()),w=v.getTopLeft().times(c).minus(f.getTopLeft().times(p)).divide(c-p);this.zoomTo(c,w,n)}return this},fitBounds:function(i,s){return this._fitBounds(i,{immediately:s,constraints:!1})},fitBoundsWithConstraints:function(i,s){return this._fitBounds(i,{immediately:s,constraints:!0})},fitVertically:function(i){var s=new e.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(s,i)},fitHorizontally:function(i){var s=new e.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(s,i)},getConstrainedBounds:function(i){var s,n;return s=this.getBounds(i),n=this._applyBoundaryConstraints(s),n},panBy:function(i,s){var n=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(n.plus(i),s)},panTo:function(i,s){return s?(this.centerSpringX.resetTo(i.x),this.centerSpringY.resetTo(i.y)):(this.centerSpringX.springTo(i.x),this.centerSpringY.springTo(i.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:i,immediately:s}),this},zoomBy:function(i,s,n){return this.zoomTo(this.zoomSpring.target.value*i,s,n)},zoomTo:function(i,s,n){var a=this;return this.zoomPoint=s instanceof e.Point&&!isNaN(s.x)&&!isNaN(s.y)?s:null,n?this._adjustCenterSpringsForZoomPoint(function(){a.zoomSpring.resetTo(i)}):this.zoomSpring.springTo(i),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:i,refPoint:s,immediately:n}),this},setRotation:function(i,s){return this.rotateTo(i,null,s)},getRotation:function(i){return i?this.degreesSpring.current.value:this.degreesSpring.target.value},setRotationWithPivot:function(i,s,n){return this.rotateTo(i,s,n)},rotateTo:function(i,s,n){if(!this.viewer||!this.viewer.drawer.canRotate())return this;if(this.degreesSpring.target.value===i&&this.degreesSpring.isAtTargetValue())return this;if(this.rotationPivot=s instanceof e.Point&&!isNaN(s.x)&&!isNaN(s.y)?s:null,n)if(this.rotationPivot){var a=i-this._oldDegrees;if(!a)return this.rotationPivot=null,this;this._rotateAboutPivot(i)}else this.degreesSpring.resetTo(i);else{var r=e.positiveModulo(this.degreesSpring.current.value,360),o=e.positiveModulo(i,360),l=o-r;l>180?o-=360:l<-180&&(o+=360);var c=r-o;this.degreesSpring.resetTo(i+c),this.degreesSpring.springTo(i)}return this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:i,immediately:!!n,pivot:this.rotationPivot||this.getCenter()}),this},rotateBy:function(i,s,n){return this.rotateTo(this.degreesSpring.target.value+i,s,n)},resize:function(i,s){var n=this.getBoundsNoRotate(),a=n,r;this.containerSize.x=i.x,this.containerSize.y=i.y,this._updateContainerInnerSize(),s&&(r=i.x/this.containerSize.x,a.width=n.width*r,a.height=a.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:i,maintain:s});var o=this.fitBounds(a,!0);return this.viewer&&this.viewer.raiseEvent("after-resize",{newContainerSize:i,maintain:s}),o},_updateContainerInnerSize:function(){this._containerInnerSize=new e.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var i=this;this._adjustCenterSpringsForZoomPoint(function(){i.zoomSpring.update()}),this.degreesSpring.isAtTargetValue()&&(this.rotationPivot=null),this.centerSpringX.update(),this.centerSpringY.update(),this.rotationPivot?this._rotateAboutPivot(!0):this.degreesSpring.update();var s=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom||this.degreesSpring.current.value!==this._oldDegrees;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._oldDegrees=this.degreesSpring.current.value,s},_rotateAboutPivot:function(i){var s=i===!0,n=this.rotationPivot.minus(this.getCenter());this.centerSpringX.shiftBy(n.x),this.centerSpringY.shiftBy(n.y),s?this.degreesSpring.update():this.degreesSpring.resetTo(i);var a=this.degreesSpring.current.value-this._oldDegrees,r=n.rotate(a*-1).times(-1);this.centerSpringX.shiftBy(r.x),this.centerSpringY.shiftBy(r.y)},_adjustCenterSpringsForZoomPoint:function(i){if(this.zoomPoint){var s=this.pixelFromPoint(this.zoomPoint,!0);i();var n=this.pixelFromPoint(this.zoomPoint,!0),a=n.minus(s),r=this.deltaPointsFromPixels(a,!0);this.centerSpringX.shiftBy(r.x),this.centerSpringY.shiftBy(r.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else i()},deltaPixelsFromPointsNoRotate:function(i,s){return i.times(this._containerInnerSize.x*this.getZoom(s))},deltaPixelsFromPoints:function(i,s){return this.deltaPixelsFromPointsNoRotate(i.rotate(this.getRotation(s)),s)},deltaPointsFromPixelsNoRotate:function(i,s){return i.divide(this._containerInnerSize.x*this.getZoom(s))},deltaPointsFromPixels:function(i,s){return this.deltaPointsFromPixelsNoRotate(i,s).rotate(-this.getRotation(s))},pixelFromPointNoRotate:function(i,s){return this._pixelFromPointNoRotate(i,this.getBoundsNoRotate(s))},pixelFromPoint:function(i,s){return this._pixelFromPoint(i,this.getBoundsNoRotate(s))},_pixelFromPointNoRotate:function(i,s){return i.minus(s.getTopLeft()).times(this._containerInnerSize.x/s.width).plus(new e.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(i,s){return this._pixelFromPointNoRotate(i.rotate(this.getRotation(!0),this.getCenter(!0)),s)},pointFromPixelNoRotate:function(i,s){var n=this.getBoundsNoRotate(s);return i.minus(new e.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/n.width).plus(n.getTopLeft())},pointFromPixel:function(i,s){return this.pointFromPixelNoRotate(i,s).rotate(-this.getRotation(s),this.getCenter(s))},_viewportToImageDelta:function(i,s){var n=this._contentBoundsNoRotate.width;return new e.Point(i*this._contentSizeNoRotate.x/n,s*this._contentSizeNoRotate.x/n)},viewportToImageCoordinates:function(i,s){if(i instanceof e.Point)return this.viewportToImageCoordinates(i.x,i.y);if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)this.silenceMultiImageWarnings||e.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(n===1){var a=this.viewer.world.getItemAt(0);return a.viewportToImageCoordinates(i,s,!0)}}return this._viewportToImageDelta(i-this._contentBoundsNoRotate.x,s-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(i,s){var n=this._contentBoundsNoRotate.width;return new e.Point(i/this._contentSizeNoRotate.x*n,s/this._contentSizeNoRotate.x*n)},imageToViewportCoordinates:function(i,s){if(i instanceof e.Point)return this.imageToViewportCoordinates(i.x,i.y);if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)this.silenceMultiImageWarnings||e.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(n===1){var a=this.viewer.world.getItemAt(0);return a.imageToViewportCoordinates(i,s,!0)}}var r=this._imageToViewportDelta(i,s);return r.x+=this._contentBoundsNoRotate.x,r.y+=this._contentBoundsNoRotate.y,r},imageToViewportRectangle:function(i,s,n,a){var r=i;if(r instanceof e.Rect||(r=new e.Rect(i,s,n,a)),this.viewer){var o=this.viewer.world.getItemCount();if(o>1)this.silenceMultiImageWarnings||e.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(o===1){var l=this.viewer.world.getItemAt(0);return l.imageToViewportRectangle(i,s,n,a,!0)}}var c=this.imageToViewportCoordinates(r.x,r.y),h=this._imageToViewportDelta(r.width,r.height);return new e.Rect(c.x,c.y,h.x,h.y,r.degrees)},viewportToImageRectangle:function(i,s,n,a){var r=i;if(r instanceof e.Rect||(r=new e.Rect(i,s,n,a)),this.viewer){var o=this.viewer.world.getItemCount();if(o>1)this.silenceMultiImageWarnings||e.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(o===1){var l=this.viewer.world.getItemAt(0);return l.viewportToImageRectangle(i,s,n,a,!0)}}var c=this.viewportToImageCoordinates(r.x,r.y),h=this._viewportToImageDelta(r.width,r.height);return new e.Rect(c.x,c.y,h.x,h.y,r.degrees)},viewerElementToImageCoordinates:function(i){var s=this.pointFromPixel(i,!0);return this.viewportToImageCoordinates(s)},imageToViewerElementCoordinates:function(i){var s=this.imageToViewportCoordinates(i);return this.pixelFromPoint(s,!0)},windowToImageCoordinates:function(i){e.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var s=i.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(s)},imageToWindowCoordinates:function(i){e.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer.");var s=this.imageToViewerElementCoordinates(i);return s.plus(e.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(i){return this.pointFromPixel(i,!0)},viewportToViewerElementCoordinates:function(i){return this.pixelFromPoint(i,!0)},viewerElementToViewportRectangle:function(i){return e.Rect.fromSummits(this.pointFromPixel(i.getTopLeft(),!0),this.pointFromPixel(i.getTopRight(),!0),this.pointFromPixel(i.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(i){return e.Rect.fromSummits(this.pixelFromPoint(i.getTopLeft(),!0),this.pixelFromPoint(i.getTopRight(),!0),this.pixelFromPoint(i.getBottomLeft(),!0))},windowToViewportCoordinates:function(i){e.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var s=i.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(s)},viewportToWindowCoordinates:function(i){e.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer.");var s=this.viewportToViewerElementCoordinates(i);return s.plus(e.getElementPosition(this.viewer.element))},viewportToImageZoom:function(i){if(this.viewer){var s=this.viewer.world.getItemCount();if(s>1)this.silenceMultiImageWarnings||e.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(s===1){var n=this.viewer.world.getItemAt(0);return n.viewportToImageZoom(i)}}var a=this._contentSizeNoRotate.x,r=this._containerInnerSize.x,o=this._contentBoundsNoRotate.width,l=r/a*o;return i*l},imageToViewportZoom:function(i){if(this.viewer){var s=this.viewer.world.getItemCount();if(s>1)this.silenceMultiImageWarnings||e.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(s===1){var n=this.viewer.world.getItemAt(0);return n.imageToViewportZoom(i)}}var a=this._contentSizeNoRotate.x,r=this._containerInnerSize.x,o=this._contentBoundsNoRotate.width,l=a/r/o;return i*l},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(i){return this.flipped===i?this:(this.flipped=i,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:i}),this)}}})(t),(function(e){e.TiledImage=function(r){var o=this;e.console.assert(r.tileCache,"[TiledImage] options.tileCache is required"),e.console.assert(r.drawer,"[TiledImage] options.drawer is required"),e.console.assert(r.viewer,"[TiledImage] options.viewer is required"),e.console.assert(r.imageLoader,"[TiledImage] options.imageLoader is required"),e.console.assert(r.source,"[TiledImage] options.source is required"),e.console.assert(!r.clip||r.clip instanceof e.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),e.EventSource.call(this),this._tileCache=r.tileCache,delete r.tileCache,this._drawer=r.drawer,delete r.drawer,this._imageLoader=r.imageLoader,delete r.imageLoader,r.clip instanceof e.Rect&&(this._clip=r.clip.clone()),delete r.clip;var l=r.x||0;delete r.x;var c=r.y||0;delete r.y,this.normHeight=r.source.dimensions.y/r.source.dimensions.x,this.contentAspectX=r.source.dimensions.x/r.source.dimensions.y;var h=1;r.width?(h=r.width,delete r.width,r.height&&(e.console.error("specifying both width and height to a tiledImage is not supported"),delete r.height)):r.height&&(h=r.height/this.normHeight,delete r.height);var d=r.fitBounds;delete r.fitBounds;var f=r.fitBoundsPlacement||t.Placement.CENTER;delete r.fitBoundsPlacement;var p=r.degrees||0;delete r.degrees;var m=r.ajaxHeaders;delete r.ajaxHeaders,e.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,immediateRender:e.DEFAULT_SETTINGS.immediateRender,blendTime:e.DEFAULT_SETTINGS.blendTime,alwaysBlend:e.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:e.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:e.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:e.DEFAULT_SETTINGS.iOSDevice,debugMode:e.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:e.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:e.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:e.DEFAULT_SETTINGS.placeholderFillStyle,opacity:e.DEFAULT_SETTINGS.opacity,preload:e.DEFAULT_SETTINGS.preload,compositeOperation:e.DEFAULT_SETTINGS.compositeOperation,subPixelRoundingForTransparency:e.DEFAULT_SETTINGS.subPixelRoundingForTransparency},r),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new e.Spring({initial:l,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new e.Spring({initial:c,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new e.Spring({initial:h,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new e.Spring({initial:p,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),d&&this.fitBounds(d,f,!0),this._drawingHandler=function(v){o.viewer.raiseEvent("tile-drawing",e.extend({tiledImage:o},v))},this._ownAjaxHeaders={},this.setAjaxHeaders(m,!1)},e.extend(e.TiledImage.prototype,e.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(r){r!==this._fullyLoaded&&(this._fullyLoaded=r,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=e.now(),this._needsDraw=!0},update:function(){var r=this._xSpring.update(),o=this._ySpring.update(),l=this._scaleSpring.update(),c=this._degreesSpring.update();return r||o||l||c?(this._updateForScale(),this._needsDraw=!0,!0):!1},draw:function(){this.opacity!==0||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset(),this.source.destroy&&this.source.destroy()},getBounds:function(r){return this.getBoundsNoRotate(r).rotate(this.getRotation(r),this._getRotationPoint(r))},getBoundsNoRotate:function(r){return r?new e.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new e.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return e.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(r){var o=this.getBoundsNoRotate(r);if(this._clip){var l=r?this._worldWidthCurrent:this._worldWidthTarget,c=l/this.source.dimensions.x,h=this._clip.times(c);o=new e.Rect(o.x+h.x,o.y+h.y,h.width,h.height)}return o.rotate(this.getRotation(r),this._getRotationPoint(r))},getTileBounds:function(r,o,l){var c=this.source.getNumTiles(r),h=(c.x+o%c.x)%c.x,d=(c.y+l%c.y)%c.y,f=this.source.getTileBounds(r,h,d);return this.getFlip()&&(f.x=1-f.x-f.width),f.x+=(o-h)/c.x,f.y+=this._worldHeightCurrent/this._worldWidthCurrent*((l-d)/c.y),f},getContentSize:function(){return new e.Point(this.source.dimensions.x,this.source.dimensions.y)},getSizeInWindowCoordinates:function(){var r=this.imageToWindowCoordinates(new e.Point(0,0)),o=this.imageToWindowCoordinates(this.getContentSize());return new e.Point(o.x-r.x,o.y-r.y)},_viewportToImageDelta:function(r,o,l){var c=l?this._scaleSpring.current.value:this._scaleSpring.target.value;return new e.Point(r*(this.source.dimensions.x/c),o*(this.source.dimensions.y*this.contentAspectX/c))},viewportToImageCoordinates:function(r,o,l){var c;return r instanceof e.Point?(l=o,c=r):c=new e.Point(r,o),c=c.rotate(-this.getRotation(l),this._getRotationPoint(l)),l?this._viewportToImageDelta(c.x-this._xSpring.current.value,c.y-this._ySpring.current.value):this._viewportToImageDelta(c.x-this._xSpring.target.value,c.y-this._ySpring.target.value)},_imageToViewportDelta:function(r,o,l){var c=l?this._scaleSpring.current.value:this._scaleSpring.target.value;return new e.Point(r/this.source.dimensions.x*c,o/this.source.dimensions.y/this.contentAspectX*c)},imageToViewportCoordinates:function(r,o,l){r instanceof e.Point&&(l=o,o=r.y,r=r.x);var c=this._imageToViewportDelta(r,o);return l?(c.x+=this._xSpring.current.value,c.y+=this._ySpring.current.value):(c.x+=this._xSpring.target.value,c.y+=this._ySpring.target.value),c.rotate(this.getRotation(l),this._getRotationPoint(l))},imageToViewportRectangle:function(r,o,l,c,h){var d=r;d instanceof e.Rect?h=o:d=new e.Rect(r,o,l,c);var f=this.imageToViewportCoordinates(d.getTopLeft(),h),p=this._imageToViewportDelta(d.width,d.height,h);return new e.Rect(f.x,f.y,p.x,p.y,d.degrees+this.getRotation(h))},viewportToImageRectangle:function(r,o,l,c,h){var d=r;r instanceof e.Rect?h=o:d=new e.Rect(r,o,l,c);var f=this.viewportToImageCoordinates(d.getTopLeft(),h),p=this._viewportToImageDelta(d.width,d.height,h);return new e.Rect(f.x,f.y,p.x,p.y,d.degrees-this.getRotation(h))},viewerElementToImageCoordinates:function(r){var o=this.viewport.pointFromPixel(r,!0);return this.viewportToImageCoordinates(o)},imageToViewerElementCoordinates:function(r){var o=this.imageToViewportCoordinates(r);return this.viewport.pixelFromPoint(o,!0)},windowToImageCoordinates:function(r){var o=r.minus(t.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(o)},imageToWindowCoordinates:function(r){var o=this.imageToViewerElementCoordinates(r);return o.plus(t.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(r){var o=this._scaleSpring.current.value;return r=r.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new e.Rect((r.x-this._xSpring.current.value)/o,(r.y-this._ySpring.current.value)/o,r.width/o,r.height/o,r.degrees)},viewportToImageZoom:function(r){var o=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return o*r},imageToViewportZoom:function(r){var o=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return r/o},setPosition:function(r,o){var l=this._xSpring.target.value===r.x&&this._ySpring.target.value===r.y;if(o){if(l&&this._xSpring.current.value===r.x&&this._ySpring.current.value===r.y)return;this._xSpring.resetTo(r.x),this._ySpring.resetTo(r.y),this._needsDraw=!0}else{if(l)return;this._xSpring.springTo(r.x),this._ySpring.springTo(r.y),this._needsDraw=!0}l||this._raiseBoundsChange()},setWidth:function(r,o){this._setScale(r,o)},setHeight:function(r,o){this._setScale(r/this.normHeight,o)},setCroppingPolygons:function(r){var o=function(c){return c instanceof e.Point||typeof c.x=="number"&&typeof c.y=="number"},l=function(c){return c.map(function(h){try{if(o(h))return{x:h.x,y:h.y};throw new Error}catch{throw new Error("A Provided cropping polygon point is not supported")}})};try{if(!e.isArray(r))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=r.map(function(c){return l(c)})}catch(c){e.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),e.console.error(c),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(r,o,l){o=o||e.Placement.CENTER;var c=e.Placement.properties[o],h=this.contentAspectX,d=0,f=0,p=1,m=1;if(this._clip&&(h=this._clip.getAspectRatio(),p=this._clip.width/this.source.dimensions.x,m=this._clip.height/this.source.dimensions.y,r.getAspectRatio()>h?(d=this._clip.x/this._clip.height*r.height,f=this._clip.y/this._clip.height*r.height):(d=this._clip.x/this._clip.width*r.width,f=this._clip.y/this._clip.width*r.width)),r.getAspectRatio()>h){var v=r.height/m,w=0;c.isHorizontallyCentered?w=(r.width-r.height*h)/2:c.isRight&&(w=r.width-r.height*h),this.setPosition(new e.Point(r.x-d+w,r.y-f),l),this.setHeight(v,l)}else{var S=r.width/p,_=0;c.isVerticallyCentered?_=(r.height-r.width/h)/2:c.isBottom&&(_=r.height-r.width/h),this.setPosition(new e.Point(r.x-d,r.y-f+_),l),this.setWidth(S,l)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(r){e.console.assert(!r||r instanceof e.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),r instanceof e.Rect?this._clip=r.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getFlip:function(){return!!this.flipped},setFlip:function(r){this.flipped=!!r,this._needsDraw=!0,this._raiseBoundsChange()},getOpacity:function(){return this.opacity},setOpacity:function(r){r!==this.opacity&&(this.opacity=r,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(r){this._preload=!!r,this._needsDraw=!0},getRotation:function(r){return r?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(r,o){this._degreesSpring.target.value===r&&this._degreesSpring.isAtTargetValue()||(o?this._degreesSpring.resetTo(r):this._degreesSpring.springTo(r),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(r){return this.getBoundsNoRotate(r).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(r){r!==this.compositeOperation&&(this.compositeOperation=r,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},setAjaxHeaders:function(r,o){if(r===null&&(r={}),!e.isPlainObject(r)){console.error("[TiledImage.setAjaxHeaders] Ignoring invalid headers, must be a plain object");return}this._ownAjaxHeaders=r,this._updateAjaxHeaders(o)},_updateAjaxHeaders:function(r){if(r===void 0&&(r=!0),e.isPlainObject(this.viewer.ajaxHeaders)?this.ajaxHeaders=e.extend({},this.viewer.ajaxHeaders,this._ownAjaxHeaders):this.ajaxHeaders=this._ownAjaxHeaders,r){var o,l,c,h;for(var d in this.tilesMatrix){o=this.source.getNumTiles(d);for(var f in this.tilesMatrix[d]){l=(o.x+f%o.x)%o.x;for(var p in this.tilesMatrix[d][f])if(c=(o.y+p%o.y)%o.y,h=this.tilesMatrix[d][f][p],h.loadWithAjax=this.loadTilesWithAjax,h.loadWithAjax){var m=this.source.getTileAjaxHeaders(d,l,c);h.ajaxHeaders=e.extend({},this.ajaxHeaders,m)}else h.ajaxHeaders=null}}for(var v=0;v<this._imageLoader.jobQueue.length;v++){var w=this._imageLoader.jobQueue[v];w.loadWithAjax=w.tile.loadWithAjax,w.ajaxHeaders=w.tile.loadWithAjax?w.tile.ajaxHeaders:null}}},_setScale:function(r,o){var l=this._scaleSpring.target.value===r;if(o){if(l&&this._scaleSpring.current.value===r)return;this._scaleSpring.resetTo(r),this._updateForScale(),this._needsDraw=!0}else{if(l)return;this._scaleSpring.springTo(r),this._updateForScale(),this._needsDraw=!0}l||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var r=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),o=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,l=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(o/this.minPixelRatio)/Math.log(2))));return l=Math.max(l,this.source.minLevel||0),r=Math.min(r,l),{lowestLevel:r,highestLevel:l}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};this.lastDrawn.length>0;){var r=this.lastDrawn.pop();r.beingDrawn=!1}var o=this.viewport,l=this._viewportToTiledImageRectangle(o.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var c=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(l=l.intersection(c),l===null)return}for(var h=this._getLevelsInterval(),d=h.lowestLevel,f=h.highestLevel,p=null,m=!1,v=e.now(),w=f;w>=d;w--){var S=!1,_=o.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(w),!0).x*this._scaleSpring.current.value;if(w===d||!m&&_>=this.minPixelRatio)S=!0,m=!0;else if(!m)continue;var A=o.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(w),!1).x*this._scaleSpring.current.value,P=o.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,k=this.immediateRender?1:P,N=Math.min(1,(_-.5)/.5),O=k/Math.abs(k-A);if(p=this._updateLevel(m,S,w,N,O,l,v,p),this._providesCoverage(this.coverage,w))break}this._drawTiles(this.lastDrawn),p&&!p.context2D?(this._loadTile(p,v),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(this._tilesLoading===0)},_getCornerTiles:function(r,o,l){var c,h;this.wrapHorizontal?(c=e.positiveModulo(o.x,1),h=e.positiveModulo(l.x,1)):(c=Math.max(0,o.x),h=Math.min(1,l.x));var d,f,p=1/this.source.aspectRatio;this.wrapVertical?(d=e.positiveModulo(o.y,p),f=e.positiveModulo(l.y,p)):(d=Math.max(0,o.y),f=Math.min(p,l.y));var m=this.source.getTileAtPoint(r,new e.Point(c,d)),v=this.source.getTileAtPoint(r,new e.Point(h,f)),w=this.source.getNumTiles(r);return this.wrapHorizontal&&(m.x+=w.x*Math.floor(o.x),v.x+=w.x*Math.floor(l.x)),this.wrapVertical&&(m.y+=w.y*Math.floor(o.y/p),v.y+=w.y*Math.floor(l.y/p)),{topLeft:m,bottomRight:v}},_updateLevel:function(r,o,l,c,h,d,f,p){var m=d.getBoundingBox().getTopLeft(),v=d.getBoundingBox().getBottomRight();this.viewer&&this.viewer.raiseEvent("update-level",{tiledImage:this,havedrawn:r,level:l,opacity:c,visibility:h,drawArea:d,topleft:m,bottomright:v,currenttime:f,best:p}),this._resetCoverage(this.coverage,l),this._resetCoverage(this.loadingCoverage,l);var w=this._getCornerTiles(l,m,v),S=w.topLeft,_=w.bottomRight,A=this.source.getNumTiles(l),P=this.viewport.pixelFromPoint(this.viewport.getCenter());this.getFlip()&&(_.x+=1,this.wrapHorizontal||(_.x=Math.min(_.x,A.x-1)));for(var k=S.x;k<=_.x;k++)for(var N=S.y;N<=_.y;N++){var O;if(this.getFlip()){var j=(A.x+k%A.x)%A.x;O=k+A.x-j-j-1}else O=k;d.intersection(this.getTileBounds(l,O,N))!==null&&(p=this._updateTile(o,r,O,N,l,c,h,P,A,f,p))}return p},_updateTile:function(r,o,l,c,h,d,f,p,m,v,w){var S=this._getTile(l,c,h,v,m,this._worldWidthCurrent,this._worldHeightCurrent),_=o;this.viewer&&this.viewer.raiseEvent("update-tile",{tiledImage:this,tile:S}),this._setCoverage(this.coverage,h,l,c,!1);var A=S.loaded||S.loading||this._isCovered(this.loadingCoverage,h,l,c);if(this._setCoverage(this.loadingCoverage,h,l,c,A),!S.exists||(r&&!_&&(this._isCovered(this.coverage,h,l,c)?this._setCoverage(this.coverage,h,l,c,!0):_=!0),!_))return w;if(this._positionTile(S,this.source.tileOverlap,this.viewport,p,f),!S.loaded)if(S.context2D)this._setTileLoaded(S);else{var P=this._tileCache.getImageRecord(S.cacheKey);P&&this._setTileLoaded(S,P.getData())}if(S.loaded){var k=this._blendTile(S,l,c,h,d,v);k&&(this._needsDraw=!0)}else S.loading?this._tilesLoading++:A||(w=this._compareTiles(w,S));return w},_getTile:function(r,o,l,c,h,d,f){var p,m,v,w,S,_,A,P,k,N,O=this.tilesMatrix,j=this.source;return O[l]||(O[l]={}),O[l][r]||(O[l][r]={}),(!O[l][r][o]||!O[l][r][o].flipped!=!this.flipped)&&(p=(h.x+r%h.x)%h.x,m=(h.y+o%h.y)%h.y,v=this.getTileBounds(l,r,o),w=j.getTileBounds(l,p,m,!0),S=j.tileExists(l,p,m),_=j.getTileUrl(l,p,m),A=j.getTilePostData(l,p,m),this.loadTilesWithAjax?(P=j.getTileAjaxHeaders(l,p,m),e.isPlainObject(this.ajaxHeaders)&&(P=e.extend({},this.ajaxHeaders,P))):P=null,k=j.getContext2D?j.getContext2D(l,p,m):void 0,N=new e.Tile(l,r,o,v,S,_,k,this.loadTilesWithAjax,P,w,A,j.getTileHashKey(l,p,m,_,P,A)),this.getFlip()?p===0&&(N.isRightMost=!0):p===h.x-1&&(N.isRightMost=!0),m===h.y-1&&(N.isBottomMost=!0),N.flipped=this.flipped,O[l][r][o]=N),N=O[l][r][o],N.lastTouchTime=c,N},_loadTile:function(r,o){var l=this;r.loading=!0,this._imageLoader.addJob({src:r.getUrl(),tile:r,source:this.source,postData:r.postData,loadWithAjax:r.loadWithAjax,ajaxHeaders:r.ajaxHeaders,crossOriginPolicy:this.crossOriginPolicy,ajaxWithCredentials:this.ajaxWithCredentials,callback:function(c,h,d){l._onTileLoad(r,o,c,h,d)},abort:function(){r.loading=!1}})},_onTileLoad:function(r,o,l,c,h){if(l)r.exists=!0;else{e.console.error("Tile %s failed to load: %s - error: %s",r,r.getUrl(),c),this.viewer.raiseEvent("tile-load-failed",{tile:r,tiledImage:this,time:o,message:c,tileRequest:h}),r.loading=!1,r.exists=!1;return}if(o<this.lastResetTime){e.console.warn("Ignoring tile %s loaded before reset: %s",r,r.getUrl()),r.loading=!1;return}var d=this,f=function(){var p=d.source,m=p.getClosestLevel();d._setTileLoaded(r,l,m,h)};this._midDraw?window.setTimeout(f,1):f()},_setTileLoaded:function(r,o,l,c){var h=0,d=!1,f=this;function p(){return d&&e.console.error("Event 'tile-loaded' argument getCompletionCallback must be called synchronously. Its return value should be called asynchronously."),h++,m}function m(){h--,h===0&&(r.loading=!1,r.loaded=!0,r.hasTransparency=f.source.hasTransparency(r.context2D,r.getUrl(),r.ajaxHeaders,r.postData),r.context2D||f._tileCache.cacheTile({data:o,tile:r,cutoff:l,tiledImage:f}),f._needsDraw=!0)}var v=p();this.viewer.raiseEvent("tile-loaded",{tile:r,tiledImage:this,tileRequest:c,get image(){return e.console.error("[tile-loaded] event 'image' has been deprecated. Use 'data' property instead."),o},data:o,getCompletionCallback:p}),d=!0,v()},_positionTile:function(r,o,l,c,h){var d=r.bounds.getTopLeft();d.x*=this._scaleSpring.current.value,d.y*=this._scaleSpring.current.value,d.x+=this._xSpring.current.value,d.y+=this._ySpring.current.value;var f=r.bounds.getSize();f.x*=this._scaleSpring.current.value,f.y*=this._scaleSpring.current.value;var p=l.pixelFromPointNoRotate(d,!0),m=l.pixelFromPointNoRotate(d,!1),v=l.deltaPixelsFromPointsNoRotate(f,!0),w=l.deltaPixelsFromPointsNoRotate(f,!1),S=m.plus(w.divide(2)),_=c.squaredDistanceTo(S);o||(v=v.plus(new e.Point(1,1))),r.isRightMost&&this.wrapHorizontal&&(v.x+=.75),r.isBottomMost&&this.wrapVertical&&(v.y+=.75),r.position=p,r.size=v,r.squaredDistance=_,r.visibility=h},_blendTile:function(r,o,l,c,h,d){var f=1e3*this.blendTime,p,m;if(r.blendStart||(r.blendStart=d),p=d-r.blendStart,m=f?Math.min(1,p/f):1,this.alwaysBlend&&(m*=h),r.opacity=m,this.lastDrawn.push(r),m===1)this._setCoverage(this.coverage,c,o,l,!0),this._hasOpaqueTile=!0;else if(p<f)return!0;return!1},_compareTiles:function(r,o){return!r||o.visibility>r.visibility||o.visibility===r.visibility&&o.squaredDistance<r.squaredDistance?o:r},_drawTiles:function(r){if(!(this.opacity===0||r.length===0&&!this.placeholderFillStyle)){var o=r[0],l;o&&(l=this.opacity<1||this.compositeOperation&&this.compositeOperation!=="source-over"||!this._isBottomItem()&&this.source.hasTransparency(o.context2D,o.getUrl(),o.ajaxHeaders,o.postData));var c,h,d=this.viewport.getZoom(!0),f=this.viewportToImageZoom(d);r.length>1&&f>this.smoothTileEdgesMinZoom&&!this.iOSDevice&&this.getRotation(!0)%360===0&&e.supportsCanvas&&this.viewer.useCanvas&&(l=!0,c=o.getScaleForEdgeSmoothing(),h=o.getTranslationForEdgeSmoothing(c,this._drawer.getCanvasSize(!1),this._drawer.getCanvasSize(!0)));var p;l&&(c||(p=this.viewport.viewportToViewerElementRectangle(this.getClippedBounds(!0)).getIntegerBoundingBox(),this._drawer.viewer.viewport.getFlip()&&(this.viewport.getRotation(!0)%360!==0||this.getRotation(!0)%360!==0)&&(p.x=this._drawer.viewer.container.clientWidth-(p.x+p.width)),p=p.times(e.pixelDensityRatio)),this._drawer._clear(!0,p)),c||(this.viewport.getRotation(!0)%360!==0&&this._drawer._offsetForRotation({degrees:this.viewport.getRotation(!0),useSketch:l}),this.getRotation(!0)%360!==0&&this._drawer._offsetForRotation({degrees:this.getRotation(!0),point:this.viewport.pixelFromPointNoRotate(this._getRotationPoint(!0),!0),useSketch:l}),this.viewport.getRotation(!0)%360===0&&this.getRotation(!0)%360===0&&this._drawer.viewer.viewport.getFlip()&&this._drawer._flip());var m=!1;if(this._clip){this._drawer.saveContext(l);var v=this.imageToViewportRectangle(this._clip,!0);v=v.rotate(-this.getRotation(!0),this._getRotationPoint(!0));var w=this._drawer.viewportToDrawerRectangle(v);c&&(w=w.times(c)),h&&(w=w.translate(h)),this._drawer.setClip(w,l),m=!0}if(this._croppingPolygons){var S=this;this._drawer.saveContext(l);try{var _=this._croppingPolygons.map(function(U){return U.map(function(G){var R=S.imageToViewportCoordinates(G.x,G.y,!0).rotate(-S.getRotation(!0),S._getRotationPoint(!0)),D=S._drawer.viewportCoordToDrawerCoord(R);return c&&(D=D.times(c)),h&&(D=D.plus(h)),D})});this._drawer.clipWithPolygons(_,l)}catch(U){e.console.error(U)}m=!0}if(this.placeholderFillStyle&&this._hasOpaqueTile===!1){var A=this._drawer.viewportToDrawerRectangle(this.getBounds(!0));c&&(A=A.times(c)),h&&(A=A.translate(h));var P=null;typeof this.placeholderFillStyle=="function"?P=this.placeholderFillStyle(this,this._drawer.context):P=this.placeholderFillStyle,this._drawer.drawRectangle(A,P,l)}var k=a(this.subPixelRoundingForTransparency),N=!1;if(k===e.SUBPIXEL_ROUNDING_OCCURRENCES.ALWAYS)N=!0;else if(k===e.SUBPIXEL_ROUNDING_OCCURRENCES.ONLY_AT_REST){var O=this.viewer&&this.viewer.isAnimating();N=!O}for(var j=r.length-1;j>=0;j--)o=r[j],this._drawer.drawTile(o,this._drawingHandler,l,c,h,N,this.source),o.beingDrawn=!0,this.viewer&&this.viewer.raiseEvent("tile-drawn",{tiledImage:this,tile:o});m&&this._drawer.restoreContext(l),c||(this.getRotation(!0)%360!==0&&this._drawer._restoreRotationChanges(l),this.viewport.getRotation(!0)%360!==0&&this._drawer._restoreRotationChanges(l)),l&&(c&&(this.viewport.getRotation(!0)%360!==0&&this._drawer._offsetForRotation({degrees:this.viewport.getRotation(!0),useSketch:!1}),this.getRotation(!0)%360!==0&&this._drawer._offsetForRotation({degrees:this.getRotation(!0),point:this.viewport.pixelFromPointNoRotate(this._getRotationPoint(!0),!0),useSketch:!1})),this._drawer.blendSketch({opacity:this.opacity,scale:c,translate:h,compositeOperation:this.compositeOperation,bounds:p}),c&&(this.getRotation(!0)%360!==0&&this._drawer._restoreRotationChanges(!1),this.viewport.getRotation(!0)%360!==0&&this._drawer._restoreRotationChanges(!1))),c||this.viewport.getRotation(!0)%360===0&&this.getRotation(!0)%360===0&&this._drawer.viewer.viewport.getFlip()&&this._drawer._flip(),this._drawDebugInfo(r)}},_drawDebugInfo:function(r){if(this.debugMode)for(var o=r.length-1;o>=0;o--){var l=r[o];try{this._drawer.drawDebugInfo(l,r.length,o,this)}catch(c){e.console.error(c)}}},_providesCoverage:function(r,o,l,c){var h,d,f,p;if(!r[o])return!1;if(l===void 0||c===void 0){h=r[o];for(f in h)if(Object.prototype.hasOwnProperty.call(h,f)){d=h[f];for(p in d)if(Object.prototype.hasOwnProperty.call(d,p)&&!d[p])return!1}return!0}return r[o][l]===void 0||r[o][l][c]===void 0||r[o][l][c]===!0},_isCovered:function(r,o,l,c){return l===void 0||c===void 0?this._providesCoverage(r,o+1):this._providesCoverage(r,o+1,2*l,2*c)&&this._providesCoverage(r,o+1,2*l,2*c+1)&&this._providesCoverage(r,o+1,2*l+1,2*c)&&this._providesCoverage(r,o+1,2*l+1,2*c+1)},_setCoverage:function(r,o,l,c,h){if(!r[o]){e.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",o);return}r[o][l]||(r[o][l]={}),r[o][l][c]=h},_resetCoverage:function(r,o){r[o]={}}});var i=e.SUBPIXEL_ROUNDING_OCCURRENCES.NEVER;function s(r){return r!==e.SUBPIXEL_ROUNDING_OCCURRENCES.ALWAYS&&r!==e.SUBPIXEL_ROUNDING_OCCURRENCES.ONLY_AT_REST&&r!==e.SUBPIXEL_ROUNDING_OCCURRENCES.NEVER}function n(r){return s(r)?i:r}function a(r){if(typeof r=="number")return n(r);if(!r||!e.Browser)return i;var o=r[e.Browser.vendor];return s(o)&&(o=r["*"]),n(o)}})(t),(function(e){var i=function(n){e.console.assert(n,"[TileCache.cacheTile] options is required"),e.console.assert(n.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(n.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=n.tile,this.tiledImage=n.tiledImage},s=function(n){e.console.assert(n,"[ImageRecord] options is required"),e.console.assert(n.data,"[ImageRecord] options.data is required"),this._tiles=[],n.create.apply(null,[this,n.data,n.ownerTile]),this._destroyImplementation=n.destroy.bind(null,this),this.getImage=n.getImage.bind(null,this),this.getData=n.getData.bind(null,this),this.getRenderedContext=n.getRenderedContext.bind(null,this)};s.prototype={destroy:function(){this._destroyImplementation(),this._tiles=null},addTile:function(n){e.console.assert(n,"[ImageRecord.addTile] tile is required"),this._tiles.push(n)},removeTile:function(n){for(var a=0;a<this._tiles.length;a++)if(this._tiles[a]===n){this._tiles.splice(a,1);return}e.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",n)},getTileCount:function(){return this._tiles.length}},e.TileCache=function(n){n=n||{},this._maxImageCacheCount=n.maxImageCacheCount||e.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},e.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(n){e.console.assert(n,"[TileCache.cacheTile] options is required"),e.console.assert(n.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(n.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),e.console.assert(n.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var a=n.cutoff||0,r=this._tilesLoaded.length,o=this._imagesLoaded[n.tile.cacheKey];if(o||(n.data||(e.console.error("[TileCache.cacheTile] options.image was renamed to options.data. '.image' attribute has been deprecated and will be removed in the future."),n.data=n.image),e.console.assert(n.data,"[TileCache.cacheTile] options.data is required to create an ImageRecord"),o=this._imagesLoaded[n.tile.cacheKey]=new s({data:n.data,ownerTile:n.tile,create:n.tiledImage.source.createTileCache,destroy:n.tiledImage.source.destroyTileCache,getImage:n.tiledImage.source.getTileCacheDataAsImage,getData:n.tiledImage.source.getTileCacheData,getRenderedContext:n.tiledImage.source.getTileCacheDataAsContext2D}),this._imagesLoadedCount++),o.addTile(n.tile),n.tile.cacheImageRecord=o,this._imagesLoadedCount>this._maxImageCacheCount){for(var l=null,c=-1,h=null,d,f,p,m,v,w,S=this._tilesLoaded.length-1;S>=0;S--)if(w=this._tilesLoaded[S],d=w.tile,!(d.level<=a||d.beingDrawn)){if(!l){l=d,c=S,h=w;continue}m=d.lastTouchTime,f=l.lastTouchTime,v=d.level,p=l.level,(m<f||m===f&&v>p)&&(l=d,c=S,h=w)}l&&c>=0&&(this._unloadTile(h),r=c)}this._tilesLoaded[r]=new i({tile:n.tile,tiledImage:n.tiledImage})},clearTilesFor:function(n){e.console.assert(n,"[TileCache.clearTilesFor] tiledImage is required");for(var a,r=0;r<this._tilesLoaded.length;++r)a=this._tilesLoaded[r],a.tiledImage===n&&(this._unloadTile(a),this._tilesLoaded.splice(r,1),r--)},getImageRecord:function(n){return e.console.assert(n,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[n]},_unloadTile:function(n){e.console.assert(n,"[TileCache._unloadTile] tileRecord is required");var a=n.tile,r=n.tiledImage;a.unload(),a.cacheImageRecord=null;var o=this._imagesLoaded[a.cacheKey];o.removeTile(a),o.getTileCount()||(o.destroy(),delete this._imagesLoaded[a.cacheKey],this._imagesLoadedCount--),r.viewer.raiseEvent("tile-unloaded",{tile:a,tiledImage:r})}}})(t),(function(e){e.World=function(i){var s=this;e.console.assert(i.viewer,"[World] options.viewer is required"),e.EventSource.call(this),this.viewer=i.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(n){s._autoRefigureSizes?s._figureSizes():s._needsSizesFigured=!0},this._figureSizes()},e.extend(e.World.prototype,e.EventSource.prototype,{addItem:function(i,s){if(e.console.assert(i,"[World.addItem] item is required"),e.console.assert(i instanceof e.TiledImage,"[World.addItem] only TiledImages supported at this time"),s=s||{},s.index!==void 0){var n=Math.max(0,Math.min(this._items.length,s.index));this._items.splice(n,0,i)}else this._items.push(i);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,i.addHandler("bounds-change",this._delegatedFigureSizes),i.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:i})},getItemAt:function(i){return e.console.assert(i!==void 0,"[World.getItemAt] index is required"),this._items[i]},getIndexOfItem:function(i){return e.console.assert(i,"[World.getIndexOfItem] item is required"),e.indexOf(this._items,i)},getItemCount:function(){return this._items.length},setItemIndex:function(i,s){e.console.assert(i,"[World.setItemIndex] item is required"),e.console.assert(s!==void 0,"[World.setItemIndex] index is required");var n=this.getIndexOfItem(i);if(s>=this._items.length)throw new Error("Index bigger than number of layers.");s===n||n===-1||(this._items.splice(n,1),this._items.splice(s,0,i),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:i,previousIndex:n,newIndex:s}))},removeItem:function(i){e.console.assert(i,"[World.removeItem] item is required");var s=e.indexOf(this._items,i);s!==-1&&(i.removeHandler("bounds-change",this._delegatedFigureSizes),i.removeHandler("clip-change",this._delegatedFigureSizes),i.destroy(),this._items.splice(s,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(i))},removeAll:function(){this.viewer._cancelPendingImages();var i,s;for(s=0;s<this._items.length;s++)i=this._items[s],i.removeHandler("bounds-change",this._delegatedFigureSizes),i.removeHandler("clip-change",this._delegatedFigureSizes),i.destroy();var n=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,s=0;s<n.length;s++)i=n[s],this._raiseRemoveItem(i)},resetItems:function(){for(var i=0;i<this._items.length;i++)this._items[i].reset()},update:function(){for(var i=!1,s=0;s<this._items.length;s++)i=this._items[s].update()||i;return i},draw:function(){for(var i=0;i<this._items.length;i++)this._items[i].draw();this._needsDraw=!1},needsDraw:function(){for(var i=0;i<this._items.length;i++)if(this._items[i].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(i){this._autoRefigureSizes=i,i&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(i){i=i||{};var s=i.immediately||!1,n=i.layout||e.DEFAULT_SETTINGS.collectionLayout,a=i.rows||e.DEFAULT_SETTINGS.collectionRows,r=i.columns||e.DEFAULT_SETTINGS.collectionColumns,o=i.tileSize||e.DEFAULT_SETTINGS.collectionTileSize,l=i.tileMargin||e.DEFAULT_SETTINGS.collectionTileMargin,c=o+l,h;!i.rows&&r?h=r:h=Math.ceil(this._items.length/a);var d=0,f=0,p,m,v,w,S;this.setAutoRefigureSizes(!1);for(var _=0;_<this._items.length;_++)_&&_%h===0&&(n==="horizontal"?(f+=c,d=0):(d+=c,f=0)),p=this._items[_],m=p.getBounds(),m.width>m.height?v=o:v=o*(m.width/m.height),w=v*(m.height/m.width),S=new e.Point(d+(o-v)/2,f+(o-w)/2),p.setPosition(S,s),p.setWidth(v,s),n==="horizontal"?d+=c:f+=c;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var i=this._homeBounds?this._homeBounds.clone():null,s=this._contentSize?this._contentSize.clone():null,n=this._contentFactor||0;if(!this._items.length)this._homeBounds=new e.Rect(0,0,1,1),this._contentSize=new e.Point(1,1),this._contentFactor=1;else{var a=this._items[0],r=a.getBounds();this._contentFactor=a.getContentSize().x/r.width;for(var o=a.getClippedBounds().getBoundingBox(),l=o.x,c=o.y,h=o.x+o.width,d=o.y+o.height,f=1;f<this._items.length;f++)a=this._items[f],r=a.getBounds(),this._contentFactor=Math.max(this._contentFactor,a.getContentSize().x/r.width),o=a.getClippedBounds().getBoundingBox(),l=Math.min(l,o.x),c=Math.min(c,o.y),h=Math.max(h,o.x+o.width),d=Math.max(d,o.y+o.height);this._homeBounds=new e.Rect(l,c,h-l,d-c),this._contentSize=new e.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}(this._contentFactor!==n||!this._homeBounds.equals(i)||!this._contentSize.equals(s))&&this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(i){this.raiseEvent("remove-item",{item:i})}})})(t)})(Ii)),Ii.exports}var k3=D3();const I3=zs(k3);function M3({image:u}){const t=L.useRef(null),[e,i]=L.useState(!1),s=Et(o=>o.setErrorData),[n,a]=L.useState("Please build your flow");L.useEffect(()=>{try{if(t.current){const o=I3({element:t.current,prefixUrl:"https://cdnjs.cloudflare.com/ajax/libs/openseadragon/2.4.2/images/",tileSources:{type:"image",url:u},defaultZoomLevel:1,maxZoomPixelRatio:4,showNavigationControl:!1}),l=document.getElementById("zoom-in-button"),c=document.getElementById("zoom-out-button"),h=document.getElementById("home-button"),d=document.getElementById("full-page-button");return l.addEventListener("click",()=>o.viewport.zoomBy(1.2)),c.addEventListener("click",()=>o.viewport.zoomBy(.8)),h.addEventListener("click",()=>o.viewport.goHome()),d.addEventListener("click",()=>o.setFullScreen(!0)),()=>{o.destroy(),l.removeEventListener("click",()=>o.viewport.zoomBy(1.2)),c.removeEventListener("click",()=>o.viewport.zoomBy(.8)),h.removeEventListener("click",()=>o.viewport.goHome()),d.removeEventListener("click",()=>o.setFullScreen(!0))}}}catch(o){console.error("Error initializing OpenSeadragon:",o)}},[u]);function r(){fetch(u).then(l=>l.blob()).then(l=>{R3.saveAs(l,"image.jpg")}).catch(l=>{s({title:"There was an error downloading your image"}),console.error("Error downloading image:",l)})}return u===""?g.jsxs("div",{className:"align-center flex h-full w-full flex-col justify-center gap-5 rounded-md border border-border bg-muted",children:[g.jsxs("div",{className:"align-center flex justify-center gap-2",children:[g.jsx(ie,{name:"Image"}),ra]}),g.jsx("div",{className:"align-center flex justify-center",children:g.jsx("div",{className:"vetrai-chat-desc align-center flex justify-center",children:g.jsx("div",{className:"vetrai-chat-desc-span",children:oa})})})]}):g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"align-center my-2 mb-4 flex w-full justify-center",children:g.jsxs("div",{className:"shadow-round-btn-shadow hover:shadow-round-btn-shadow flex w-[50%] items-center justify-center rounded-sm border bg-muted shadow-md transition-all",children:[g.jsx("button",{id:"zoom-in-button",className:"relative inline-flex w-full items-center justify-center px-3 py-3 text-sm font-semibold transition-all duration-500 ease-in-out hover:bg-hover",children:g.jsx(ie,{name:"ZoomIn",className:"h-5 w-5 text-secondary-foreground"})}),g.jsx("div",{children:g.jsx(Yt,{orientation:"vertical"})}),g.jsx("button",{id:"zoom-out-button",className:"relative inline-flex w-full items-center justify-center px-3 py-3 text-sm font-semibold transition-all duration-500 ease-in-out hover:bg-hover",children:g.jsx(ie,{name:"ZoomOut",className:"h-5 w-5 text-secondary-foreground"})}),g.jsx("div",{children:g.jsx(Yt,{orientation:"vertical"})}),g.jsx("button",{id:"home-button",className:"relative inline-flex w-full items-center justify-center px-3 py-3 text-sm font-semibold transition-all duration-500 ease-in-out hover:bg-hover",children:g.jsx(ie,{name:"RotateCcw",className:"h-5 w-5 text-secondary-foreground"})}),g.jsx("div",{children:g.jsx(Yt,{orientation:"vertical"})}),g.jsx("button",{id:"full-page-button",className:"relative inline-flex w-full items-center justify-center px-3 py-3 text-sm font-semibold transition-all duration-500 ease-in-out hover:bg-hover",children:g.jsx(ie,{name:"Maximize2",className:"h-5 w-5 text-secondary-foreground"})}),g.jsx("div",{children:g.jsx(Yt,{orientation:"vertical"})}),g.jsx("button",{onClick:r,className:"relative inline-flex w-full items-center justify-center px-3 py-3 text-sm font-semibold transition-all duration-500 ease-in-out hover:bg-hover",children:g.jsx(ie,{name:"ArrowDownToLine",className:"h-5 w-5 text-secondary-foreground"})})]})}),g.jsx("div",{id:"canvas",ref:t,className:"h-[90%] w-full"})]})}const N3=(u,t)=>{const e=u.data.trim().split(`
`),i=e[0].trim().split(t),s=[],n=i.map(a=>({field:a.trim(),wrapText:!0,autoHeight:!0,height:"100%"}));for(let a=1;a<e.length;a++){const r=e[a].trim().split(t),o={};for(let l=0;l<i.length;l++){const c=isNaN(r[l])?r[l]:parseFloat(r[l]);o[i[l].trim()]=c}s.push(o)}return{rowData:s,colDefs:n}};function F3({csvNode:u,flowPool:t}){const i=t?.data?.artifacts?.repr?.replace(/'/g,'"');let s=null;try{s=JSON?.parse(i)||""}catch{console.error("Error parsing JSON")}if(!s)return g.jsxs("div",{className:"align-center flex h-full w-full flex-col items-center justify-center gap-5",children:[g.jsxs("div",{className:"align-center flex w-full justify-center gap-2",children:[g.jsx(ie,{name:"Table"}),ls]}),g.jsx("div",{className:"align-center flex w-full justify-center",children:g.jsx("div",{className:"vetrai-chat-desc align-center flex justify-center px-6 py-8",children:g.jsx("div",{className:"vetrai-chat-desc-span",children:Sn})})})]});const n=u?.data?.node?.template?.separator?.value||",",a=aa.getState().dark,[r,o]=L.useState([]),[l,c]=L.useState([]),[h,d]=L.useState("loading"),f=L.useMemo(()=>({width:200,editable:!0,filter:!0}),[]);return L.useEffect(()=>{if(d("loading"),s){const{rowData:p,colDefs:m}=N3(s,n);o(p),c(m),setTimeout(()=>{d("loaded")},1e3)}else d("nodata")},[n]),g.jsxs("div",{className:"h-full rounded-md border bg-muted",children:[h==="nodata"&&g.jsxs("div",{className:"align-center flex h-full w-full flex-col items-center justify-center gap-5",children:[g.jsxs("div",{className:"align-center flex w-full justify-center gap-2",children:[g.jsx(ie,{name:"Table"}),ls]}),g.jsx("div",{className:"align-center flex w-full justify-center",children:g.jsx("div",{className:"vetrai-chat-desc align-center flex justify-center px-6 py-8",children:g.jsx("div",{className:"vetrai-chat-desc-span",children:la})})})]}),h==="error"&&g.jsxs("div",{className:"align-center flex h-full w-full flex-col items-center justify-center gap-5",children:[g.jsxs("div",{className:"align-center flex w-full justify-center gap-2",children:[g.jsx(ie,{name:"Table"}),ls]}),g.jsx("div",{className:"align-center flex w-full justify-center",children:g.jsx("div",{className:"vetrai-chat-desc align-center flex justify-center px-6 py-8",children:g.jsx("div",{className:"vetrai-chat-desc-span",children:Sn})})})]}),h==="loaded"&&g.jsx("div",{className:`${a?"ag-theme-balham-dark":"ag-theme-balham"}`,style:{height:"100%",width:"100%"},children:g.jsx(ca,{rowData:r,columnDefs:l,defaultColDef:f,scrollbarWidth:8,overlayNoRowsTemplate:"No data available"},"csv-output")}),h==="loading"&&g.jsx("div",{className:"flex h-full w-full items-center justify-center align-middle",children:g.jsx(zi,{})})]})}var di={};di.d=(u,t)=>{for(var e in t)di.o(t,e)&&!di.o(u,e)&&Object.defineProperty(u,e,{enumerable:!0,get:t[e]})};di.o=(u,t)=>Object.prototype.hasOwnProperty.call(u,t);var ue=globalThis.pdfjsLib={};di.d(ue,{AbortException:()=>Bt,AnnotationEditorLayer:()=>wt,AnnotationEditorParamsType:()=>he,AnnotationEditorType:()=>fe,AnnotationEditorUIManager:()=>Pt,AnnotationLayer:()=>M8,AnnotationMode:()=>Ct,ColorPicker:()=>lt,DOMSVGFactory:()=>on,DrawLayer:()=>Ke,FeatureTest:()=>et,GlobalWorkerOptions:()=>pi,ImageKind:()=>Mi,InvalidPDFException:()=>Or,MissingPDFException:()=>Ht,OPS:()=>ft,OutputScale:()=>As,PDFDataRangeTransport:()=>to,PDFDateString:()=>Hr,PDFWorker:()=>Jt,PasswordResponses:()=>B3,PermissionFlag:()=>H3,PixelsPerInch:()=>ii,RenderingCancelledException:()=>Xs,TextLayer:()=>Ds,UnexpectedResponseException:()=>Ji,Util:()=>ne,VerbosityLevel:()=>Yi,XfaLayer:()=>so,build:()=>p8,createValidAbsoluteUrl:()=>q3,fetchData:()=>$i,getDocument:()=>r8,getFilenameFromUrl:()=>$3,getPdfFilenameFromUrl:()=>e5,getXfaPageViewport:()=>t5,isDataScheme:()=>es,isPdfFile:()=>Ys,noContextMenu:()=>ht,normalizeUnicode:()=>Z3,setLayerDimensions:()=>Ft,shadow:()=>xe,version:()=>f8});const Je=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),Fr=[1,0,0,1,0,0],Es=[.001,0,0,.001,0,0],O3=1e7,fs=1.35,nt={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Ct={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},j3="pdfjs_internal_editor_",fe={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},he={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35},H3={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},Ye={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Mi={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},He={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,WIDGET:20},oi={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},Yi={ERRORS:0,WARNINGS:1,INFOS:5},ft={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},B3={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let Ki=Yi.WARNINGS;function z3(u){Number.isInteger(u)&&(Ki=u)}function U3(){return Ki}function Zi(u){Ki>=Yi.INFOS&&console.log(`Info: ${u}`)}function pe(u){Ki>=Yi.WARNINGS&&console.log(`Warning: ${u}`)}function ke(u){throw new Error(u)}function ze(u,t){u||ke(t)}function V3(u){switch(u?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function q3(u,t=null,e=null){if(!u)return null;try{if(e&&typeof u=="string"&&(e.addDefaultProtocol&&u.startsWith("www.")&&u.match(/\./g)?.length>=2&&(u=`http://${u}`),e.tryConvertEncoding))try{u=K3(u)}catch{}const i=t?new URL(u,t):new URL(u);if(V3(i))return i}catch{}return null}function xe(u,t,e,i=!1){return Object.defineProperty(u,t,{value:e,enumerable:!i,configurable:!0,writable:!1}),e}const Lt=(function(){function t(e,i){this.message=e,this.name=i}return t.prototype=new Error,t.constructor=t,t})();class Ts extends Lt{constructor(t,e){super(t,"PasswordException"),this.code=e}}class _s extends Lt{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}}class Or extends Lt{constructor(t){super(t,"InvalidPDFException")}}class Ht extends Lt{constructor(t){super(t,"MissingPDFException")}}class Ji extends Lt{constructor(t,e){super(t,"UnexpectedResponseException"),this.status=e}}class G3 extends Lt{constructor(t){super(t,"FormatError")}}class Bt extends Lt{constructor(t){super(t,"AbortException")}}function jr(u){(typeof u!="object"||u?.length===void 0)&&ke("Invalid argument for bytesToString");const t=u.length,e=8192;if(t<e)return String.fromCharCode.apply(null,u);const i=[];for(let s=0;s<t;s+=e){const n=Math.min(s+e,t),a=u.subarray(s,n);i.push(String.fromCharCode.apply(null,a))}return i.join("")}function Qi(u){typeof u!="string"&&ke("Invalid argument for stringToBytes");const t=u.length,e=new Uint8Array(t);for(let i=0;i<t;++i)e[i]=u.charCodeAt(i)&255;return e}function W3(u){return String.fromCharCode(u>>24&255,u>>16&255,u>>8&255,u&255)}function Gs(u){const t=Object.create(null);for(const[e,i]of u)t[e]=i;return t}function X3(){const u=new Uint8Array(4);return u[0]=1,new Uint32Array(u.buffer,0,1)[0]===1}function Y3(){try{return new Function(""),!0}catch{return!1}}class et{static get isLittleEndian(){return xe(this,"isLittleEndian",X3())}static get isEvalSupported(){return xe(this,"isEvalSupported",Y3())}static get isOffscreenCanvasSupported(){return xe(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator<"u"&&typeof navigator?.platform=="string"?xe(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:typeof navigator?.userAgent=="string"&&navigator.userAgent.includes("Firefox")}):xe(this,"platform",{isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){return xe(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const ps=Array.from(Array(256).keys(),u=>u.toString(16).padStart(2,"0"));class ne{static makeHexColor(t,e,i){return`#${ps[t]}${ps[e]}${ps[i]}`}static scaleMinMax(t,e){let i;t[0]?(t[0]<0&&(i=e[0],e[0]=e[2],e[2]=i),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(i=e[1],e[1]=e[3],e[3]=i),e[1]*=t[3],e[3]*=t[3]):(i=e[0],e[0]=e[1],e[1]=i,i=e[2],e[2]=e[3],e[3]=i,t[1]<0&&(i=e[1],e[1]=e[3],e[3]=i),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(i=e[0],e[0]=e[2],e[2]=i),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static applyTransform(t,e){const i=t[0]*e[0]+t[1]*e[2]+e[4],s=t[0]*e[1]+t[1]*e[3]+e[5];return[i,s]}static applyInverseTransform(t,e){const i=e[0]*e[3]-e[1]*e[2],s=(t[0]*e[3]-t[1]*e[2]+e[2]*e[5]-e[4]*e[3])/i,n=(-t[0]*e[1]+t[1]*e[0]+e[4]*e[1]-e[5]*e[0])/i;return[s,n]}static getAxialAlignedBoundingBox(t,e){const i=this.applyTransform(t,e),s=this.applyTransform(t.slice(2,4),e),n=this.applyTransform([t[0],t[3]],e),a=this.applyTransform([t[2],t[1]],e);return[Math.min(i[0],s[0],n[0],a[0]),Math.min(i[1],s[1],n[1],a[1]),Math.max(i[0],s[0],n[0],a[0]),Math.max(i[1],s[1],n[1],a[1])]}static inverseTransform(t){const e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t){const e=[t[0],t[2],t[1],t[3]],i=t[0]*e[0]+t[1]*e[2],s=t[0]*e[1]+t[1]*e[3],n=t[2]*e[0]+t[3]*e[2],a=t[2]*e[1]+t[3]*e[3],r=(i+a)/2,o=Math.sqrt((i+a)**2-4*(i*a-n*s))/2,l=r+o||1,c=r-o||1;return[Math.sqrt(l),Math.sqrt(c)]}static normalizeRect(t){const e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){const i=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),s=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(i>s)return null;const n=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),a=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return n>a?null:[i,n,s,a]}static#e(t,e,i,s,n,a,r,o,l,c){if(l<=0||l>=1)return;const h=1-l,d=l*l,f=d*l,p=h*(h*(h*t+3*l*e)+3*d*i)+f*s,m=h*(h*(h*n+3*l*a)+3*d*r)+f*o;c[0]=Math.min(c[0],p),c[1]=Math.min(c[1],m),c[2]=Math.max(c[2],p),c[3]=Math.max(c[3],m)}static#t(t,e,i,s,n,a,r,o,l,c,h,d){if(Math.abs(l)<1e-12){Math.abs(c)>=1e-12&&this.#e(t,e,i,s,n,a,r,o,-h/c,d);return}const f=c**2-4*h*l;if(f<0)return;const p=Math.sqrt(f),m=2*l;this.#e(t,e,i,s,n,a,r,o,(-c+p)/m,d),this.#e(t,e,i,s,n,a,r,o,(-c-p)/m,d)}static bezierBoundingBox(t,e,i,s,n,a,r,o,l){return l?(l[0]=Math.min(l[0],t,r),l[1]=Math.min(l[1],e,o),l[2]=Math.max(l[2],t,r),l[3]=Math.max(l[3],e,o)):l=[Math.min(t,r),Math.min(e,o),Math.max(t,r),Math.max(e,o)],this.#t(t,i,n,r,e,s,a,o,3*(-t+3*(i-n)+r),6*(t-2*i+n),3*(i-t),l),this.#t(t,i,n,r,e,s,a,o,3*(-e+3*(s-a)+o),6*(e-2*s+a),3*(s-e),l),l}}function K3(u){return decodeURIComponent(escape(u))}let gs=null,Vn=null;function Z3(u){return gs||(gs=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Vn=new Map([["ï¬…","Å¿t"]])),u.replaceAll(gs,(t,e,i)=>e?e.normalize("NFKC"):Vn.get(i))}function J3(){if(typeof crypto<"u"&&typeof crypto?.randomUUID=="function")return crypto.randomUUID();const u=new Uint8Array(32);if(typeof crypto<"u"&&typeof crypto?.getRandomValues=="function")crypto.getRandomValues(u);else for(let t=0;t<32;t++)u[t]=Math.floor(Math.random()*255);return jr(u)}const Ws="pdfjs_internal_id_",mt={BEZIER_CURVE_TO:0,MOVE_TO:1,LINE_TO:2,QUADRATIC_CURVE_TO:3,RESTORE:4,SAVE:5,SCALE:6,TRANSFORM:7,TRANSLATE:8};function Q3(u){return Uint8Array.prototype.toBase64?u.toBase64():btoa(jr(u))}const yt="http://www.w3.org/2000/svg";class ii{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function $i(u,t="text"){if(ci(u,document.baseURI)){const e=await fetch(u);if(!e.ok)throw new Error(e.statusText);switch(t){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json()}return e.text()}return new Promise((e,i)=>{const s=new XMLHttpRequest;s.open("GET",u,!0),s.responseType=t,s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE){if(s.status===200||s.status===0){switch(t){case"arraybuffer":case"blob":case"json":e(s.response);return}e(s.responseText);return}i(new Error(s.statusText))}},s.send(null)})}class vi{constructor({viewBox:t,scale:e,rotation:i,offsetX:s=0,offsetY:n=0,dontFlip:a=!1}){this.viewBox=t,this.scale=e,this.rotation=i,this.offsetX=s,this.offsetY=n;const r=(t[2]+t[0])/2,o=(t[3]+t[1])/2;let l,c,h,d;switch(i%=360,i<0&&(i+=360),i){case 180:l=-1,c=0,h=0,d=1;break;case 90:l=0,c=1,h=1,d=0;break;case 270:l=0,c=-1,h=-1,d=0;break;case 0:l=1,c=0,h=0,d=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(h=-h,d=-d);let f,p,m,v;l===0?(f=Math.abs(o-t[1])*e+s,p=Math.abs(r-t[0])*e+n,m=(t[3]-t[1])*e,v=(t[2]-t[0])*e):(f=Math.abs(r-t[0])*e+s,p=Math.abs(o-t[1])*e+n,m=(t[2]-t[0])*e,v=(t[3]-t[1])*e),this.transform=[l*e,c*e,h*e,d*e,f-l*e*r-h*e*o,p-c*e*r-d*e*o],this.width=m,this.height=v}get rawDims(){const{viewBox:t}=this;return xe(this,"rawDims",{pageWidth:t[2]-t[0],pageHeight:t[3]-t[1],pageX:t[0],pageY:t[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:i=this.offsetX,offsetY:s=this.offsetY,dontFlip:n=!1}={}){return new vi({viewBox:this.viewBox.slice(),scale:t,rotation:e,offsetX:i,offsetY:s,dontFlip:n})}convertToViewportPoint(t,e){return ne.applyTransform([t,e],this.transform)}convertToViewportRectangle(t){const e=ne.applyTransform([t[0],t[1]],this.transform),i=ne.applyTransform([t[2],t[3]],this.transform);return[e[0],e[1],i[0],i[1]]}convertToPdfPoint(t,e){return ne.applyInverseTransform([t,e],this.transform)}}class Xs extends Lt{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}}function es(u){const t=u.length;let e=0;for(;e<t&&u[e].trim()==="";)e++;return u.substring(e,e+5).toLowerCase()==="data:"}function Ys(u){return typeof u=="string"&&/\.pdf$/i.test(u)}function $3(u){return[u]=u.split(/[#?]/,1),u.substring(u.lastIndexOf("/")+1)}function e5(u,t="document.pdf"){if(typeof u!="string")return t;if(es(u))return pe('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const e=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,i=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,s=e.exec(u);let n=i.exec(s[1])||i.exec(s[2])||i.exec(s[3]);if(n&&(n=n[0],n.includes("%")))try{n=i.exec(decodeURIComponent(n))[0]}catch{}return n||t}class qn{started=Object.create(null);times=[];time(t){t in this.started&&pe(`Timer is already running for ${t}`),this.started[t]=Date.now()}timeEnd(t){t in this.started||pe(`Timer has not been started for ${t}`),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){const t=[];let e=0;for(const{name:i}of this.times)e=Math.max(i.length,e);for(const{name:i,start:s,end:n}of this.times)t.push(`${i.padEnd(e)} ${n-s}ms
`);return t.join("")}}function ci(u,t){try{const{protocol:e}=t?new URL(u,t):new URL(u);return e==="http:"||e==="https:"}catch{return!1}}function ht(u){u.preventDefault()}function Gn(u){console.log("Deprecated API usage: "+u)}class Hr{static#e;static toDateObject(t){if(!t||typeof t!="string")return null;this.#e||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const e=this.#e.exec(t);if(!e)return null;const i=parseInt(e[1],10);let s=parseInt(e[2],10);s=s>=1&&s<=12?s-1:0;let n=parseInt(e[3],10);n=n>=1&&n<=31?n:1;let a=parseInt(e[4],10);a=a>=0&&a<=23?a:0;let r=parseInt(e[5],10);r=r>=0&&r<=59?r:0;let o=parseInt(e[6],10);o=o>=0&&o<=59?o:0;const l=e[7]||"Z";let c=parseInt(e[8],10);c=c>=0&&c<=23?c:0;let h=parseInt(e[9],10)||0;return h=h>=0&&h<=59?h:0,l==="-"?(a+=c,r+=h):l==="+"&&(a-=c,r-=h),new Date(Date.UTC(i,s,n,a,r,o))}}function t5(u,{scale:t=1,rotation:e=0}){const{width:i,height:s}=u.attributes.style,n=[0,0,parseInt(i),parseInt(s)];return new vi({viewBox:n,scale:t,rotation:e})}function Ks(u){if(u.startsWith("#")){const t=parseInt(u.slice(1),16);return[(t&16711680)>>16,(t&65280)>>8,t&255]}return u.startsWith("rgb(")?u.slice(4,-1).split(",").map(t=>parseInt(t)):u.startsWith("rgba(")?u.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):(pe(`Not a valid color format: "${u}"`),[0,0,0])}function i5(u){const t=document.createElement("span");t.style.visibility="hidden",document.body.append(t);for(const e of u.keys()){t.style.color=e;const i=window.getComputedStyle(t).color;u.set(e,Ks(i))}t.remove()}function Me(u){const{a:t,b:e,c:i,d:s,e:n,f:a}=u.getTransform();return[t,e,i,s,n,a]}function vt(u){const{a:t,b:e,c:i,d:s,e:n,f:a}=u.getTransform().invertSelf();return[t,e,i,s,n,a]}function Ft(u,t,e=!1,i=!0){if(t instanceof vi){const{pageWidth:s,pageHeight:n}=t.rawDims,{style:a}=u,r=et.isCSSRoundSupported,o=`var(--scale-factor) * ${s}px`,l=`var(--scale-factor) * ${n}px`,c=r?`round(down, ${o}, var(--scale-round-x, 1px))`:`calc(${o})`,h=r?`round(down, ${l}, var(--scale-round-y, 1px))`:`calc(${l})`;!e||t.rotation%180===0?(a.width=c,a.height=h):(a.width=h,a.height=c)}i&&u.setAttribute("data-main-rotation",t.rotation)}class As{constructor(){const t=window.devicePixelRatio||1;this.sx=t,this.sy=t}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}}class fi{#e=null;#t=null;#i;#n=null;#r=null;static#s=null;constructor(t){this.#i=t,fi.#s||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"})}render(){const t=this.#e=document.createElement("div");t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");const e=this.#i._uiManager._signal;t.addEventListener("contextmenu",ht,{signal:e}),t.addEventListener("pointerdown",fi.#l,{signal:e});const i=this.#n=document.createElement("div");i.className="buttons",t.append(i);const s=this.#i.toolbarPosition;if(s){const{style:n}=t,a=this.#i._uiManager.direction==="ltr"?1-s[0]:s[0];n.insetInlineEnd=`${100*a}%`,n.top=`calc(${100*s[1]}% + var(--editor-toolbar-vert-offset))`}return this.#u(),t}get div(){return this.#e}static#l(t){t.stopPropagation()}#c(t){this.#i._focusEventsAllowed=!1,t.preventDefault(),t.stopPropagation()}#h(t){this.#i._focusEventsAllowed=!0,t.preventDefault(),t.stopPropagation()}#a(t){const e=this.#i._uiManager._signal;t.addEventListener("focusin",this.#c.bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",this.#h.bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",ht,{signal:e})}hide(){this.#e.classList.add("hidden"),this.#t?.hideDropdown()}show(){this.#e.classList.remove("hidden"),this.#r?.shown()}#u(){const{editorType:t,_uiManager:e}=this.#i,i=document.createElement("button");i.className="delete",i.tabIndex=0,i.setAttribute("data-l10n-id",fi.#s[t]),this.#a(i),i.addEventListener("click",s=>{e.delete()},{signal:e._signal}),this.#n.append(i)}get#o(){const t=document.createElement("div");return t.className="divider",t}async addAltText(t){const e=await t.render();this.#a(e),this.#n.prepend(e,this.#o),this.#r=t}addColorPicker(t){this.#t=t;const e=t.renderButton();this.#a(e),this.#n.prepend(e,this.#o)}remove(){this.#e.remove(),this.#t?.destroy(),this.#t=null}}class s5{#e=null;#t=null;#i;constructor(t){this.#i=t}#n(){const t=this.#t=document.createElement("div");t.className="editToolbar",t.setAttribute("role","toolbar"),t.addEventListener("contextmenu",ht,{signal:this.#i._signal});const e=this.#e=document.createElement("div");return e.className="buttons",t.append(e),this.#s(),t}#r(t,e){let i=0,s=0;for(const n of t){const a=n.y+n.height;if(a<i)continue;const r=n.x+(e?n.width:0);if(a>i){s=r,i=a;continue}e?r>s&&(s=r):r<s&&(s=r)}return[e?1-s:s,i]}show(t,e,i){const[s,n]=this.#r(e,i),{style:a}=this.#t||=this.#n();t.append(this.#t),a.insetInlineEnd=`${100*s}%`,a.top=`calc(${100*n}% + var(--editor-toolbar-vert-offset))`}hide(){this.#t.remove()}#s(){const t=document.createElement("button");t.className="highlightButton",t.tabIndex=0,t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const e=document.createElement("span");t.append(e),e.className="visuallyHidden",e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const i=this.#i._signal;t.addEventListener("contextmenu",ht,{signal:i}),t.addEventListener("click",()=>{this.#i.highlightSelection("floating_button")},{signal:i}),this.#e.append(t)}}function Hi(u,t,e){for(const i of e)t.addEventListener(i,u[i].bind(u))}function n5(u){return Math.round(Math.min(255,Math.max(1,255*u))).toString(16).padStart(2,"0")}class r5{#e=0;get id(){return`${j3}${this.#e++}`}}class Zs{#e=J3();#t=0;#i=null;static get _isSVGFittingCanvas(){const t='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',i=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),s=new Image;s.src=t;const n=s.decode().then(()=>(i.drawImage(s,0,0,1,1,0,0,1,3),new Uint32Array(i.getImageData(0,0,1,1).data.buffer)[0]===0));return xe(this,"_isSVGFittingCanvas",n)}async#n(t,e){this.#i||=new Map;let i=this.#i.get(t);if(i===null)return null;if(i?.bitmap)return i.refCounter+=1,i;try{i||={bitmap:null,id:`image_${this.#e}_${this.#t++}`,refCounter:0,isSvg:!1};let s;if(typeof e=="string"?(i.url=e,s=await $i(e,"blob")):e instanceof File?s=i.file=e:e instanceof Blob&&(s=e),s.type==="image/svg+xml"){const n=Zs._isSVGFittingCanvas,a=new FileReader,r=new Image,o=new Promise((l,c)=>{r.onload=()=>{i.bitmap=r,i.isSvg=!0,l()},a.onload=async()=>{const h=i.svgUrl=a.result;r.src=await n?`${h}#svgView(preserveAspectRatio(none))`:h},r.onerror=a.onerror=c});a.readAsDataURL(s),await o}else i.bitmap=await createImageBitmap(s);i.refCounter=1}catch(s){console.error(s),i=null}return this.#i.set(t,i),i&&this.#i.set(i.id,i),i}async getFromFile(t){const{lastModified:e,name:i,size:s,type:n}=t;return this.#n(`${e}_${i}_${s}_${n}`,t)}async getFromUrl(t){return this.#n(t,t)}async getFromBlob(t,e){const i=await e;return this.#n(t,i)}async getFromId(t){this.#i||=new Map;const e=this.#i.get(t);if(!e)return null;if(e.bitmap)return e.refCounter+=1,e;if(e.file)return this.getFromFile(e.file);if(e.blobPromise){const{blobPromise:i}=e;return delete e.blobPromise,this.getFromBlob(e.id,i)}return this.getFromUrl(e.url)}getFromCanvas(t,e){this.#i||=new Map;let i=this.#i.get(t);if(i?.bitmap)return i.refCounter+=1,i;const s=new OffscreenCanvas(e.width,e.height);return s.getContext("2d").drawImage(e,0,0),i={bitmap:s.transferToImageBitmap(),id:`image_${this.#e}_${this.#t++}`,refCounter:1,isSvg:!1},this.#i.set(t,i),this.#i.set(i.id,i),i}getSvgUrl(t){const e=this.#i.get(t);return e?.isSvg?e.svgUrl:null}deleteId(t){this.#i||=new Map;const e=this.#i.get(t);if(!e||(e.refCounter-=1,e.refCounter!==0))return;const{bitmap:i}=e;if(!e.url&&!e.file){const s=new OffscreenCanvas(i.width,i.height);s.getContext("bitmaprenderer").transferFromImageBitmap(i),e.blobPromise=s.convertToBlob()}i.close?.(),e.bitmap=null}isValidId(t){return t.startsWith(`image_${this.#e}_`)}}class o5{#e=[];#t=!1;#i;#n=-1;constructor(t=128){this.#i=t}add({cmd:t,undo:e,post:i,mustExec:s,type:n=NaN,overwriteIfSameType:a=!1,keepUndo:r=!1}){if(s&&t(),this.#t)return;const o={cmd:t,undo:e,post:i,type:n};if(this.#n===-1){this.#e.length>0&&(this.#e.length=0),this.#n=0,this.#e.push(o);return}if(a&&this.#e[this.#n].type===n){r&&(o.undo=this.#e[this.#n].undo),this.#e[this.#n]=o;return}const l=this.#n+1;l===this.#i?this.#e.splice(0,1):(this.#n=l,l<this.#e.length&&this.#e.splice(l)),this.#e.push(o)}undo(){if(this.#n===-1)return;this.#t=!0;const{undo:t,post:e}=this.#e[this.#n];t(),e?.(),this.#t=!1,this.#n-=1}redo(){if(this.#n<this.#e.length-1){this.#n+=1,this.#t=!0;const{cmd:t,post:e}=this.#e[this.#n];t(),e?.(),this.#t=!1}}hasSomethingToUndo(){return this.#n!==-1}hasSomethingToRedo(){return this.#n<this.#e.length-1}destroy(){this.#e=null}}class yi{constructor(t){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:e}=et.platform;for(const[i,s,n={}]of t)for(const a of i){const r=a.startsWith("mac+");e&&r?(this.callbacks.set(a.slice(4),{callback:s,options:n}),this.allKeys.add(a.split("+").at(-1))):!e&&!r&&(this.callbacks.set(a,{callback:s,options:n}),this.allKeys.add(a.split("+").at(-1)))}}#e(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);const e=this.buffer.join("+");return this.buffer.length=0,e}exec(t,e){if(!this.allKeys.has(e.key))return;const i=this.callbacks.get(this.#e(e));if(!i)return;const{callback:s,options:{bubbles:n=!1,args:a=[],checker:r=null}}=i;r&&!r(t,e)||(s.bind(t,...a,e)(),n||(e.stopPropagation(),e.preventDefault()))}}class Js{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const t=new Map([["CanvasText",null],["Canvas",null]]);return i5(t),xe(this,"_colors",t)}convert(t){const e=Ks(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(const[i,s]of this._colors)if(s.every((n,a)=>n===e[a]))return Js._colorsMapping.get(i);return e}getHexCode(t){const e=this._colors.get(t);return e?ne.makeHexColor(...e):t}}class Pt{#e=new AbortController;#t=null;#i=new Map;#n=new Map;#r=null;#s=null;#l=null;#c=new o5;#h=null;#a=0;#u=new Set;#o=null;#d=null;#p=new Set;#f=!1;#v=!1;#m=!1;#g=null;#y=null;#b=null;#A=null;#E=!1;#T=null;#N=new r5;#C=!1;#x=!1;#_=null;#P=null;#R=null;#k=null;#S=fe.NONE;#w=new Set;#I=null;#M=null;#F=null;#U={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#H=[0,0];#O=null;#j=null;#z=null;#L=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const t=Pt.prototype,e=a=>a.#j.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&a.hasSomethingToControl(),i=(a,{target:r})=>{if(r instanceof HTMLInputElement){const{type:o}=r;return o!=="text"&&o!=="number"}return!0},s=this.TRANSLATE_SMALL,n=this.TRANSLATE_BIG;return xe(this,"_keyboardManager",new yi([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:i}],[["ctrl+z","mac+meta+z"],t.undo,{checker:i}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:i}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:i}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(a,{target:r})=>!(r instanceof HTMLButtonElement)&&a.#j.contains(r)&&!a.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(a,{target:r})=>!(r instanceof HTMLButtonElement)&&a.#j.contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-s,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-n,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[s,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[n,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-s],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-n],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,s],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,n],checker:e}]]))}constructor(t,e,i,s,n,a,r,o,l,c,h){const d=this._signal=this.#e.signal;this.#j=t,this.#z=e,this.#r=i,this._eventBus=s,s._on("editingaction",this.onEditingAction.bind(this),{signal:d}),s._on("pagechanging",this.onPageChanging.bind(this),{signal:d}),s._on("scalechanging",this.onScaleChanging.bind(this),{signal:d}),s._on("rotationchanging",this.onRotationChanging.bind(this),{signal:d}),s._on("setpreference",this.onSetPreference.bind(this),{signal:d}),s._on("switchannotationeditorparams",f=>this.updateParams(f.type,f.value),{signal:d}),this.#ee(),this.#ne(),this.#X(),this.#s=n.annotationStorage,this.#g=n.filterFactory,this.#M=a,this.#A=r||null,this.#f=o,this.#v=l,this.#m=c,this.#k=h||null,this.viewParameters={realScale:ii.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1}destroy(){this.#L?.resolve(),this.#L=null,this.#e?.abort(),this.#e=null,this._signal=null;for(const t of this.#n.values())t.destroy();this.#n.clear(),this.#i.clear(),this.#p.clear(),this.#t=null,this.#w.clear(),this.#c.destroy(),this.#r?.destroy(),this.#T?.hide(),this.#T=null,this.#y&&(clearTimeout(this.#y),this.#y=null),this.#O&&(clearTimeout(this.#O),this.#O=null)}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return this.#k}get useNewAltTextFlow(){return this.#v}get useNewAltTextWhenAddingImage(){return this.#m}get hcmFilter(){return xe(this,"hcmFilter",this.#M?this.#g.addHCMFilter(this.#M.foreground,this.#M.background):"none")}get direction(){return xe(this,"direction",getComputedStyle(this.#j).direction)}get highlightColors(){return xe(this,"highlightColors",this.#A?new Map(this.#A.split(",").map(t=>t.split("=").map(e=>e.trim()))):null)}get highlightColorNames(){return xe(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}setMainHighlightColorPicker(t){this.#R=t}editAltText(t,e=!1){this.#r?.editAltText(this,t,e)}switchToMode(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}onSetPreference({name:t,value:e}){t==="enableNewAltTextWhenAddingImage"&&(this.#m=e)}onPageChanging({pageNumber:t}){this.#a=t-1}focusMainContainer(){this.#j.focus()}findParent(t,e){for(const i of this.#n.values()){const{x:s,y:n,width:a,height:r}=i.div.getBoundingClientRect();if(t>=s&&t<=s+a&&e>=n&&e<=n+r)return i}return null}disableUserSelect(t=!1){this.#z.classList.toggle("noUserSelect",t)}addShouldRescale(t){this.#p.add(t)}removeShouldRescale(t){this.#p.delete(t)}onScaleChanging({scale:t}){this.commitOrRemove(),this.viewParameters.realScale=t*ii.PDF_TO_CSS_UNITS;for(const e of this.#p)e.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}#q({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t}#W(t){const{currentLayer:e}=this;if(e.hasTextLayer(t))return e;for(const i of this.#n.values())if(i.hasTextLayer(t))return i;return null}highlightSelection(t=""){const e=document.getSelection();if(!e||e.isCollapsed)return;const{anchorNode:i,anchorOffset:s,focusNode:n,focusOffset:a}=e,r=e.toString(),l=this.#q(e).closest(".textLayer"),c=this.getSelectionBoxes(l);if(!c)return;e.empty();const h=this.#W(l),d=this.#S===fe.NONE,f=()=>{h?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:c,anchorNode:i,anchorOffset:s,focusNode:n,focusOffset:a,text:r}),d&&this.showAllEditors("highlight",!0,!0)};if(d){this.switchToMode(fe.HIGHLIGHT,f);return}f()}#Q(){const t=document.getSelection();if(!t||t.isCollapsed)return;const i=this.#q(t).closest(".textLayer"),s=this.getSelectionBoxes(i);s&&(this.#T||=new s5(this),this.#T.show(i,s,this.direction==="ltr"))}addToAnnotationStorage(t){!t.isEmpty()&&this.#s&&!this.#s.has(t.id)&&this.#s.setValue(t.id,t)}#$(){const t=document.getSelection();if(!t||t.isCollapsed){this.#I&&(this.#T?.hide(),this.#I=null,this.#D({hasSelectedText:!1}));return}const{anchorNode:e}=t;if(e===this.#I)return;const s=this.#q(t).closest(".textLayer");if(!s){this.#I&&(this.#T?.hide(),this.#I=null,this.#D({hasSelectedText:!1}));return}if(this.#T?.hide(),this.#I=e,this.#D({hasSelectedText:!0}),!(this.#S!==fe.HIGHLIGHT&&this.#S!==fe.NONE)&&(this.#S===fe.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#E=this.isShiftKeyDown,!this.isShiftKeyDown)){const n=this.#S===fe.HIGHLIGHT?this.#W(s):null;n?.toggleDrawing();const a=new AbortController,r=this.combinedSignal(a),o=l=>{l.type==="pointerup"&&l.button!==0||(a.abort(),n?.toggleDrawing(!0),l.type==="pointerup"&&this.#G("main_toolbar"))};window.addEventListener("pointerup",o,{signal:r}),window.addEventListener("blur",o,{signal:r})}}#G(t=""){this.#S===fe.HIGHLIGHT?this.highlightSelection(t):this.#f&&this.#Q()}#ee(){document.addEventListener("selectionchange",this.#$.bind(this),{signal:this._signal})}#te(){if(this.#b)return;this.#b=new AbortController;const t=this.combinedSignal(this.#b);window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})}#ie(){this.#b?.abort(),this.#b=null}blur(){if(this.isShiftKeyDown=!1,this.#E&&(this.#E=!1,this.#G("main_toolbar")),!this.hasSelection)return;const{activeElement:t}=document;for(const e of this.#w)if(e.div.contains(t)){this.#P=[e,t],e._focusEventsAllowed=!1;break}}focus(){if(!this.#P)return;const[t,e]=this.#P;this.#P=null,e.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),e.focus()}#X(){if(this.#_)return;this.#_=new AbortController;const t=this.combinedSignal(this.#_);window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})}#se(){this.#_?.abort(),this.#_=null}#Y(){if(this.#h)return;this.#h=new AbortController;const t=this.combinedSignal(this.#h);document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})}#K(){this.#h?.abort(),this.#h=null}#ne(){const t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})}addEditListeners(){this.#X(),this.#Y()}removeEditListeners(){this.#se(),this.#K()}dragOver(t){for(const{type:e}of t.dataTransfer.items)for(const i of this.#d)if(i.isHandlingMimeForPasting(e)){t.dataTransfer.dropEffect="copy",t.preventDefault();return}}drop(t){for(const e of t.dataTransfer.items)for(const i of this.#d)if(i.isHandlingMimeForPasting(e.type)){i.paste(e,this.currentLayer),t.preventDefault();return}}copy(t){if(t.preventDefault(),this.#t?.commitOrRemove(),!this.hasSelection)return;const e=[];for(const i of this.#w){const s=i.serialize(!0);s&&e.push(s)}e.length!==0&&t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}cut(t){this.copy(t),this.delete()}async paste(t){t.preventDefault();const{clipboardData:e}=t;for(const n of e.items)for(const a of this.#d)if(a.isHandlingMimeForPasting(n.type)){a.paste(n,this.currentLayer);return}let i=e.getData("application/pdfjs");if(!i)return;try{i=JSON.parse(i)}catch(n){pe(`paste: "${n.message}".`);return}if(!Array.isArray(i))return;this.unselectAll();const s=this.currentLayer;try{const n=[];for(const o of i){const l=await s.deserialize(o);if(!l)return;n.push(l)}const a=()=>{for(const o of n)this.#Z(o);this.#J(n)},r=()=>{for(const o of n)o.remove()};this.addCommands({cmd:a,undo:r,mustExec:!0})}catch(n){pe(`paste: "${n.message}".`)}}keydown(t){!this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!0),this.#S!==fe.NONE&&!this.isEditorHandlingKeyboard&&Pt._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!1,this.#E&&(this.#E=!1,this.#G("main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}#D(t){Object.entries(t).some(([i,s])=>this.#U[i]!==s)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#U,t)}),this.#S===fe.HIGHLIGHT&&t.hasSelectedEditor===!1&&this.#B([[he.HIGHLIGHT_FREE,!0]]))}#B(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})}setEditingState(t){t?(this.#te(),this.#Y(),this.#D({isEditing:this.#S!==fe.NONE,isEmpty:this.#V(),hasSomethingToUndo:this.#c.hasSomethingToUndo(),hasSomethingToRedo:this.#c.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#ie(),this.#K(),this.#D({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!this.#d){this.#d=t;for(const e of this.#d)this.#B(e.defaultPropertiesToUpdate)}}getId(){return this.#N.id}get currentLayer(){return this.#n.get(this.#a)}getLayer(t){return this.#n.get(t)}get currentPageIndex(){return this.#a}addLayer(t){this.#n.set(t.pageIndex,t),this.#C?t.enable():t.disable()}removeLayer(t){this.#n.delete(t.pageIndex)}async updateMode(t,e=null,i=!1){if(this.#S!==t&&!(this.#L&&(await this.#L.promise,!this.#L))){if(this.#L=Promise.withResolvers(),this.#S=t,t===fe.NONE){this.setEditingState(!1),this.#oe(),this.#L.resolve();return}this.setEditingState(!0),await this.#re(),this.unselectAll();for(const s of this.#n.values())s.updateMode(t);if(!e){i&&this.addNewEditorFromKeyboard(),this.#L.resolve();return}for(const s of this.#i.values())s.annotationElementId===e?(this.setSelected(s),s.enterInEditMode()):s.unselect();this.#L.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t!==this.#S&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:t})}updateParams(t,e){if(this.#d){switch(t){case he.CREATE:this.currentLayer.addNewEditor();return;case he.HIGHLIGHT_DEFAULT_COLOR:this.#R?.updateColor(e);break;case he.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#F||=new Map).set(t,e),this.showAllEditors("highlight",e);break}for(const i of this.#w)i.updateParams(t,e);for(const i of this.#d)i.updateDefaultParams(t,e)}}showAllEditors(t,e,i=!1){for(const n of this.#i.values())n.editorType===t&&n.show(e);(this.#F?.get(he.HIGHLIGHT_SHOW_ALL)??!0)!==e&&this.#B([[he.HIGHLIGHT_SHOW_ALL,e]])}enableWaiting(t=!1){if(this.#x!==t){this.#x=t;for(const e of this.#n.values())t?e.disableClick():e.enableClick(),e.div.classList.toggle("waiting",t)}}async#re(){if(!this.#C){this.#C=!0;const t=[];for(const e of this.#n.values())t.push(e.enable());await Promise.all(t);for(const e of this.#i.values())e.enable()}}#oe(){if(this.unselectAll(),this.#C){this.#C=!1;for(const t of this.#n.values())t.disable();for(const t of this.#i.values())t.disable()}}getEditors(t){const e=[];for(const i of this.#i.values())i.pageIndex===t&&e.push(i);return e}getEditor(t){return this.#i.get(t)}addEditor(t){this.#i.set(t.id,t)}removeEditor(t){t.div.contains(document.activeElement)&&(this.#y&&clearTimeout(this.#y),this.#y=setTimeout(()=>{this.focusMainContainer(),this.#y=null},0)),this.#i.delete(t.id),this.unselect(t),(!t.annotationElementId||!this.#u.has(t.annotationElementId))&&this.#s?.remove(t.id)}addDeletedAnnotationElement(t){this.#u.add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return this.#u.has(t)}removeDeletedAnnotationElement(t){this.#u.delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}#Z(t){const e=this.#n.get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))}setActiveEditor(t){this.#t!==t&&(this.#t=t,t&&this.#B(t.propertiesToUpdate))}get#ae(){let t=null;for(t of this.#w);return t}updateUI(t){this.#ae===t&&this.#B(t.propertiesToUpdate)}toggleSelected(t){if(this.#w.has(t)){this.#w.delete(t),t.unselect(),this.#D({hasSelectedEditor:this.hasSelection});return}this.#w.add(t),t.select(),this.#B(t.propertiesToUpdate),this.#D({hasSelectedEditor:!0})}setSelected(t){for(const e of this.#w)e!==t&&e.unselect();this.#w.clear(),this.#w.add(t),t.select(),this.#B(t.propertiesToUpdate),this.#D({hasSelectedEditor:!0})}isSelected(t){return this.#w.has(t)}get firstSelectedEditor(){return this.#w.values().next().value}unselect(t){t.unselect(),this.#w.delete(t),this.#D({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#w.size!==0}get isEnterHandled(){return this.#w.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#c.undo(),this.#D({hasSomethingToUndo:this.#c.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#V()})}redo(){this.#c.redo(),this.#D({hasSomethingToUndo:!0,hasSomethingToRedo:this.#c.hasSomethingToRedo(),isEmpty:this.#V()})}addCommands(t){this.#c.add(t),this.#D({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#V()})}#V(){if(this.#i.size===0)return!0;if(this.#i.size===1)for(const t of this.#i.values())return t.isEmpty();return!1}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const t=[...this.#w],e=()=>{for(const s of t)s.remove()},i=()=>{for(const s of t)this.#Z(s)};this.addCommands({cmd:e,undo:i,mustExec:!0})}commitOrRemove(){this.#t?.commitOrRemove()}hasSomethingToControl(){return this.#t||this.hasSelection}#J(t){for(const e of this.#w)e.unselect();this.#w.clear();for(const e of t)e.isEmpty()||(this.#w.add(e),e.select());this.#D({hasSelectedEditor:this.hasSelection})}selectAll(){for(const t of this.#w)t.commit();this.#J(this.#i.values())}unselectAll(){if(!(this.#t&&(this.#t.commitOrRemove(),this.#S!==fe.NONE))&&this.hasSelection){for(const t of this.#w)t.unselect();this.#w.clear(),this.#D({hasSelectedEditor:!1})}}translateSelectedEditors(t,e,i=!1){if(i||this.commitOrRemove(),!this.hasSelection)return;this.#H[0]+=t,this.#H[1]+=e;const[s,n]=this.#H,a=[...this.#w],r=1e3;this.#O&&clearTimeout(this.#O),this.#O=setTimeout(()=>{this.#O=null,this.#H[0]=this.#H[1]=0,this.addCommands({cmd:()=>{for(const o of a)this.#i.has(o.id)&&o.translateInPage(s,n)},undo:()=>{for(const o of a)this.#i.has(o.id)&&o.translateInPage(-s,-n)},mustExec:!1})},r);for(const o of a)o.translateInPage(t,e)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#o=new Map;for(const t of this.#w)this.#o.set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#o)return!1;this.disableUserSelect(!1);const t=this.#o;this.#o=null;let e=!1;for(const[{x:s,y:n,pageIndex:a},r]of t)r.newX=s,r.newY=n,r.newPageIndex=a,e||=s!==r.savedX||n!==r.savedY||a!==r.savedPageIndex;if(!e)return!1;const i=(s,n,a,r)=>{if(this.#i.has(s.id)){const o=this.#n.get(r);o?s._setParentAndPosition(o,n,a):(s.pageIndex=r,s.x=n,s.y=a)}};return this.addCommands({cmd:()=>{for(const[s,{newX:n,newY:a,newPageIndex:r}]of t)i(s,n,a,r)},undo:()=>{for(const[s,{savedX:n,savedY:a,savedPageIndex:r}]of t)i(s,n,a,r)},mustExec:!0}),!0}dragSelectedEditors(t,e){if(this.#o)for(const i of this.#o.keys())i.drag(t,e)}rebuild(t){if(t.parent===null){const e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#w.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return this.#t===t}getActive(){return this.#t}getMode(){return this.#S}get imageManager(){return xe(this,"imageManager",new Zs)}getSelectionBoxes(t){if(!t)return null;const e=document.getSelection();for(let l=0,c=e.rangeCount;l<c;l++)if(!t.contains(e.getRangeAt(l).commonAncestorContainer))return null;const{x:i,y:s,width:n,height:a}=t.getBoundingClientRect();let r;switch(t.getAttribute("data-main-rotation")){case"90":r=(l,c,h,d)=>({x:(c-s)/a,y:1-(l+h-i)/n,width:d/a,height:h/n});break;case"180":r=(l,c,h,d)=>({x:1-(l+h-i)/n,y:1-(c+d-s)/a,width:h/n,height:d/a});break;case"270":r=(l,c,h,d)=>({x:1-(c+d-s)/a,y:(l-i)/n,width:d/a,height:h/n});break;default:r=(l,c,h,d)=>({x:(l-i)/n,y:(c-s)/a,width:h/n,height:d/a});break}const o=[];for(let l=0,c=e.rangeCount;l<c;l++){const h=e.getRangeAt(l);if(!h.collapsed)for(const{x:d,y:f,width:p,height:m}of h.getClientRects())p===0||m===0||o.push(r(d,f,p,m))}return o.length===0?null:o}addChangedExistingAnnotation({annotationElementId:t,id:e}){(this.#l||=new Map).set(t,e)}removeChangedExistingAnnotation({annotationElementId:t}){this.#l?.delete(t)}renderAnnotationElement(t){const e=this.#l?.get(t.data.id);if(!e)return;const i=this.#s.getRawValue(e);i&&(this.#S===fe.NONE&&!i.hasBeenModified||i.renderAnnotationElement(t))}}class gt{#e=null;#t=!1;#i=null;#n=null;#r=null;#s=null;#l=!1;#c=null;#h=null;#a=null;#u=null;#o=!1;static#d=null;static _l10n=null;constructor(t){this.#h=t,this.#o=t._uiManager.useNewAltTextFlow,gt.#d||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(t){gt._l10n??=t}async render(){const t=this.#i=document.createElement("button");t.className="altText",t.tabIndex="0";const e=this.#n=document.createElement("span");t.append(e),this.#o?(t.classList.add("new"),t.setAttribute("data-l10n-id",gt.#d.missing),e.setAttribute("data-l10n-id",gt.#d["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const i=this.#h._uiManager._signal;t.addEventListener("contextmenu",ht,{signal:i}),t.addEventListener("pointerdown",n=>n.stopPropagation(),{signal:i});const s=n=>{n.preventDefault(),this.#h._uiManager.editAltText(this.#h),this.#o&&this.#h._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#p}})};return t.addEventListener("click",s,{capture:!0,signal:i}),t.addEventListener("keydown",n=>{n.target===t&&n.key==="Enter"&&(this.#l=!0,s(n))},{signal:i}),await this.#f(),t}get#p(){return this.#e&&"added"||this.#e===null&&this.guessedText&&"review"||"missing"}finish(){this.#i&&(this.#i.focus({focusVisible:this.#l}),this.#l=!1)}isEmpty(){return this.#o?this.#e===null:!this.#e&&!this.#t}hasData(){return this.#o?this.#e!==null||!!this.#a:this.isEmpty()}get guessedText(){return this.#a}async setGuessedText(t){this.#e===null&&(this.#a=t,this.#u=await gt._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t}),this.#f())}toggleAltTextBadge(t=!1){if(!this.#o||this.#e){this.#c?.remove(),this.#c=null;return}if(!this.#c){const e=this.#c=document.createElement("div");e.className="noAltTextBadge",this.#h.div.append(e)}this.#c.classList.toggle("hidden",!t)}serialize(t){let e=this.#e;return!t&&this.#a===e&&(e=this.#u),{altText:e,decorative:this.#t,guessedText:this.#a,textWithDisclaimer:this.#u}}get data(){return{altText:this.#e,decorative:this.#t}}set data({altText:t,decorative:e,guessedText:i,textWithDisclaimer:s,cancel:n=!1}){i&&(this.#a=i,this.#u=s),!(this.#e===t&&this.#t===e)&&(n||(this.#e=t,this.#t=e),this.#f())}toggle(t=!1){this.#i&&(!t&&this.#s&&(clearTimeout(this.#s),this.#s=null),this.#i.disabled=!t)}shown(){this.#h._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#p}})}destroy(){this.#i?.remove(),this.#i=null,this.#n=null,this.#r=null,this.#c?.remove(),this.#c=null}async#f(){const t=this.#i;if(!t)return;if(this.#o){if(t.classList.toggle("done",!!this.#e),t.setAttribute("data-l10n-id",gt.#d[this.#p]),this.#n?.setAttribute("data-l10n-id",gt.#d[`${this.#p}-label`]),!this.#e){this.#r?.remove();return}}else{if(!this.#e&&!this.#t){t.classList.remove("done"),this.#r?.remove();return}t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let e=this.#r;if(!e){this.#r=e=document.createElement("span"),e.className="tooltip",e.setAttribute("role","tooltip"),e.id=`alt-text-tooltip-${this.#h.id}`;const s=100,n=this.#h._uiManager._signal;n.addEventListener("abort",()=>{clearTimeout(this.#s),this.#s=null},{once:!0}),t.addEventListener("mouseenter",()=>{this.#s=setTimeout(()=>{this.#s=null,this.#r.classList.add("show"),this.#h._reportTelemetry({action:"alt_text_tooltip"})},s)},{signal:n}),t.addEventListener("mouseleave",()=>{this.#s&&(clearTimeout(this.#s),this.#s=null),this.#r?.classList.remove("show")},{signal:n})}this.#t?e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(e.removeAttribute("data-l10n-id"),e.textContent=this.#e),e.parentNode||t.append(e),this.#h.getImageForAltText()?.setAttribute("aria-describedby",e.id)}}class ce{#e=null;#t=null;#i=null;#n=!1;#r=!1;#s=null;#l=null;#c=null;#h="";#a=!1;#u=null;#o=!1;#d=!1;#p=!1;#f=null;#v=0;#m=0;#g=null;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#y=!1;#b=ce._zIndex++;static _borderLineWidth=-1;static _colorManager=new Js;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const t=ce.prototype._resizeWithKeyboard,e=Pt.TRANSLATE_SMALL,i=Pt.TRANSLATE_BIG;return xe(this,"_resizerKeyboardManager",new yi([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-i,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[i,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-i]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,i]}],[["Escape","mac+Escape"],ce.prototype._stopResizingWithKeyboard]]))}constructor(t){this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null;const{rotation:e,rawDims:{pageWidth:i,pageHeight:s,pageX:n,pageY:a}}=this.parent.viewport;this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[i,s],this.pageTranslation=[n,a];const[r,o]=this.parentDimensions;this.x=t.x/r,this.y=t.y/o,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return xe(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){const e=new a5({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e){if(ce._l10n??=t,ce._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),ce._borderLineWidth!==-1)return;const i=getComputedStyle(document.documentElement);ce._borderLineWidth=parseFloat(i.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){ke("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#y}set _isDraggable(t){this.#y=t,this.div?.classList.toggle("draggable",t)}get isEnterHandled(){return!0}center(){const[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(t*2),this.y+=this.width*t/(e*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(t*2),this.y-=this.width*t/(e*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#b}setParent(t){t!==null?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):this.#F(),this.parent=t}focusin(t){this._focusEventsAllowed&&(this.#a?this.#a=!1:this.parent.setSelected(this))}focusout(t){!this._focusEventsAllowed||!this.isAttachedToDOM||t.relatedTarget?.closest(`#${this.id}`)||(t.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,i,s){const[n,a]=this.parentDimensions;[i,s]=this.screenToPageTranslation(i,s),this.x=(t+i)/n,this.y=(e+s)/a,this.fixAndSetPosition()}#A([t,e],i,s){[i,s]=this.screenToPageTranslation(i,s),this.x+=i/t,this.y+=s/e,this.fixAndSetPosition()}translate(t,e){this.#A(this.parentDimensions,t,e)}translateInPage(t,e){this.#u||=[this.x,this.y],this.#A(this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}drag(t,e){this.#u||=[this.x,this.y];const[i,s]=this.parentDimensions;if(this.x+=t/i,this.y+=e/s,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:l,y:c}=this.div.getBoundingClientRect();this.parent.findNewParent(this,l,c)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:n,y:a}=this;const[r,o]=this.getBaseTranslation();n+=r,a+=o,this.div.style.left=`${(100*n).toFixed(2)}%`,this.div.style.top=`${(100*a).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}get _hasBeenMoved(){return!!this.#u&&(this.#u[0]!==this.x||this.#u[1]!==this.y)}getBaseTranslation(){const[t,e]=this.parentDimensions,{_borderLineWidth:i}=ce,s=i/t,n=i/e;switch(this.rotation){case 90:return[-s,n];case 180:return[s,n];case 270:return[s,-n];default:return[-s,-n]}}get _mustFixPosition(){return!0}fixAndSetPosition(t=this.rotation){const[e,i]=this.pageDimensions;let{x:s,y:n,width:a,height:r}=this;if(a*=e,r*=i,s*=e,n*=i,this._mustFixPosition)switch(t){case 0:s=Math.max(0,Math.min(e-a,s)),n=Math.max(0,Math.min(i-r,n));break;case 90:s=Math.max(0,Math.min(e-r,s)),n=Math.min(i,Math.max(a,n));break;case 180:s=Math.min(e,Math.max(a,s)),n=Math.min(i,Math.max(r,n));break;case 270:s=Math.min(e,Math.max(r,s)),n=Math.max(0,Math.min(i-a,n));break}this.x=s/=e,this.y=n/=i;const[o,l]=this.getBaseTranslation();s+=o,n+=l;const{style:c}=this.div;c.left=`${(100*s).toFixed(2)}%`,c.top=`${(100*n).toFixed(2)}%`,this.moveInDOM()}static#E(t,e,i){switch(i){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}}screenToPageTranslation(t,e){return ce.#E(t,e,this.parentRotation)}pageTranslationToScreen(t,e){return ce.#E(t,e,360-this.parentRotation)}#T(t){switch(t){case 90:{const[e,i]=this.pageDimensions;return[0,-e/i,i/e,0]}case 180:return[-1,0,0,-1];case 270:{const[e,i]=this.pageDimensions;return[0,e/i,-i/e,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:t,pageDimensions:[e,i]}=this;return[e*t,i*t]}setDims(t,e){const[i,s]=this.parentDimensions;this.div.style.width=`${(100*t/i).toFixed(2)}%`,this.#r||(this.div.style.height=`${(100*e/s).toFixed(2)}%`)}fixDims(){const{style:t}=this.div,{height:e,width:i}=t,s=i.endsWith("%"),n=!this.#r&&e.endsWith("%");if(s&&n)return;const[a,r]=this.parentDimensions;s||(t.width=`${(100*parseFloat(i)/a).toFixed(2)}%`),!this.#r&&!n&&(t.height=`${(100*parseFloat(e)/r).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#N(){if(this.#s)return;this.#s=document.createElement("div"),this.#s.classList.add("resizers");const t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal;for(const i of t){const s=document.createElement("div");this.#s.append(s),s.classList.add("resizer",i),s.setAttribute("data-resizer-name",i),s.addEventListener("pointerdown",this.#C.bind(this,i),{signal:e}),s.addEventListener("contextmenu",ht,{signal:e}),s.tabIndex=-1}this.div.prepend(this.#s)}#C(t,e){e.preventDefault();const{isMac:i}=et.platform;if(e.button!==0||e.ctrlKey&&i)return;this.#i?.toggle(!1);const s=this._isDraggable;this._isDraggable=!1;const n=new AbortController,a=this._uiManager.combinedSignal(n);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#_.bind(this,t),{passive:!0,capture:!0,signal:a}),window.addEventListener("contextmenu",ht,{signal:a});const r=this.x,o=this.y,l=this.width,c=this.height,h=this.parent.div.style.cursor,d=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;const f=()=>{n.abort(),this.parent.togglePointerEvents(!0),this.#i?.toggle(!0),this._isDraggable=s,this.parent.div.style.cursor=h,this.div.style.cursor=d,this.#x(r,o,l,c)};window.addEventListener("pointerup",f,{signal:a}),window.addEventListener("blur",f,{signal:a})}#x(t,e,i,s){const n=this.x,a=this.y,r=this.width,o=this.height;n===t&&a===e&&r===i&&o===s||this.addCommands({cmd:()=>{this.width=r,this.height=o,this.x=n,this.y=a;const[l,c]=this.parentDimensions;this.setDims(l*r,c*o),this.fixAndSetPosition()},undo:()=>{this.width=i,this.height=s,this.x=t,this.y=e;const[l,c]=this.parentDimensions;this.setDims(l*i,c*s),this.fixAndSetPosition()},mustExec:!0})}#_(t,e){const[i,s]=this.parentDimensions,n=this.x,a=this.y,r=this.width,o=this.height,l=ce.MIN_SIZE/i,c=ce.MIN_SIZE/s,h=B=>Math.round(B*1e4)/1e4,d=this.#T(this.rotation),f=(B,H)=>[d[0]*B+d[2]*H,d[1]*B+d[3]*H],p=this.#T(360-this.rotation),m=(B,H)=>[p[0]*B+p[2]*H,p[1]*B+p[3]*H];let v,w,S=!1,_=!1;switch(t){case"topLeft":S=!0,v=(B,H)=>[0,0],w=(B,H)=>[B,H];break;case"topMiddle":v=(B,H)=>[B/2,0],w=(B,H)=>[B/2,H];break;case"topRight":S=!0,v=(B,H)=>[B,0],w=(B,H)=>[0,H];break;case"middleRight":_=!0,v=(B,H)=>[B,H/2],w=(B,H)=>[0,H/2];break;case"bottomRight":S=!0,v=(B,H)=>[B,H],w=(B,H)=>[0,0];break;case"bottomMiddle":v=(B,H)=>[B/2,H],w=(B,H)=>[B/2,0];break;case"bottomLeft":S=!0,v=(B,H)=>[0,H],w=(B,H)=>[B,0];break;case"middleLeft":_=!0,v=(B,H)=>[0,H/2],w=(B,H)=>[B,H/2];break}const A=v(r,o),P=w(r,o);let k=f(...P);const N=h(n+k[0]),O=h(a+k[1]);let j=1,U=1,[G,R]=this.screenToPageTranslation(e.movementX,e.movementY);if([G,R]=m(G/i,R/s),S){const B=Math.hypot(r,o);j=U=Math.max(Math.min(Math.hypot(P[0]-A[0]-G,P[1]-A[1]-R)/B,1/r,1/o),l/r,c/o)}else _?j=Math.max(l,Math.min(1,Math.abs(P[0]-A[0]-G)))/r:U=Math.max(c,Math.min(1,Math.abs(P[1]-A[1]-R)))/o;const D=h(r*j),I=h(o*U);k=f(...w(D,I));const W=N-k[0],z=O-k[1];this.width=D,this.height=I,this.x=W,this.y=z,this.setDims(i*D,s*I),this.fixAndSetPosition()}altTextFinish(){this.#i?.finish()}async addEditToolbar(){return this._editToolbar||this.#d?this._editToolbar:(this._editToolbar=new fi(this),this.div.append(this._editToolbar.render()),this.#i&&await this._editToolbar.addAltText(this.#i),this._editToolbar)}removeEditToolbar(){this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,this.#i?.destroy())}addContainer(t){const e=this._editToolbar?.div;e?e.before(t):this.div.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){this.#i||(gt.initialize(ce._l10n),this.#i=new gt(this),this.#e&&(this.#i.data=this.#e,this.#e=null),await this.addEditToolbar())}get altTextData(){return this.#i?.data}set altTextData(t){this.#i&&(this.#i.data=t)}get guessedAltText(){return this.#i?.guessedText}async setGuessedAltText(t){await this.#i?.setGuessedText(t)}serializeAltText(t){return this.#i?.serialize(t)}hasAltText(){return!!this.#i&&!this.#i.isEmpty()}hasAltTextData(){return this.#i?.hasData()??!1}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=this.#n?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),this.#k();const[t,e]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*e/t).toFixed(2)}%`,this.div.style.maxHeight=`${(100*t/e).toFixed(2)}%`);const[i,s]=this.getInitialTranslation();return this.translate(i,s),Hi(this,this.div,["pointerdown"]),this.div}pointerdown(t){const{isMac:e}=et.platform;if(t.button!==0||t.ctrlKey&&e){t.preventDefault();return}if(this.#a=!0,this._isDraggable){this.#R(t);return}this.#P(t)}get isSelected(){return this._uiManager.isSelected(this)}#P(t){const{isMac:e}=et.platform;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)}#R(t){const{isSelected:e}=this;this._uiManager.setUpDragSession();const i=new AbortController,s=this._uiManager.combinedSignal(i);if(e){this.div.classList.add("moving"),this.#v=t.clientX,this.#m=t.clientY;const a=r=>{const{clientX:o,clientY:l}=r,[c,h]=this.screenToPageTranslation(o-this.#v,l-this.#m);this.#v=o,this.#m=l,this._uiManager.dragSelectedEditors(c,h)};window.addEventListener("pointermove",a,{passive:!0,capture:!0,signal:s})}const n=()=>{i.abort(),e&&this.div.classList.remove("moving"),this.#a=!1,this._uiManager.endDragSession()||this.#P(t)};window.addEventListener("pointerup",n,{signal:s}),window.addEventListener("blur",n,{signal:s})}moveInDOM(){this.#f&&clearTimeout(this.#f),this.#f=setTimeout(()=>{this.#f=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(t,e,i){t.changeParent(this),this.x=e,this.y=i,this.fixAndSetPosition()}getRect(t,e,i=this.rotation){const s=this.parentScale,[n,a]=this.pageDimensions,[r,o]=this.pageTranslation,l=t/s,c=e/s,h=this.x*n,d=this.y*a,f=this.width*n,p=this.height*a;switch(i){case 0:return[h+l+r,a-d-c-p+o,h+l+f+r,a-d-c+o];case 90:return[h+c+r,a-d+l+o,h+c+p+r,a-d+l+f+o];case 180:return[h-l-f+r,a-d+c+o,h-l+r,a-d+c+p+o];case 270:return[h-c-p+r,a-d-l-f+o,h-c+r,a-d-l+o];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){const[i,s,n,a]=t,r=n-i,o=a-s;switch(this.rotation){case 0:return[i,e-a,r,o];case 90:return[i,e-s,o,r];case 180:return[n,e-s,r,o];case 270:return[n,e-a,o,r];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){this.#d=!0}disableEditMode(){this.#d=!1}isInEditMode(){return this.#d}shouldGetKeyboardEvents(){return this.#p}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}#k(){if(this.#c||!this.div)return;this.#c=new AbortController;const t=this._uiManager.combinedSignal(this.#c);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})}rebuild(){this.#k()}rotate(t){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(t=!1,e=null){ke("An editor must be serializable")}static async deserialize(t,e,i){const s=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:i});s.rotation=t.rotation,s.#e=t.accessibilityData;const[n,a]=s.pageDimensions,[r,o,l,c]=s.getRectInCurrentCoords(t.rect,a);return s.x=r/n,s.y=o/a,s.width=l/n,s.height=c/a,s}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#c?.abort(),this.#c=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#f&&(clearTimeout(this.#f),this.#f=null),this.#F(),this.removeEditToolbar(),this.#g){for(const t of this.#g.values())clearTimeout(t);this.#g=null}this.parent=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#N(),this.#s.classList.remove("hidden"),Hi(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!=="Enter")return;this._uiManager.setSelected(this),this.#l={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const e=this.#s.children;if(!this.#t){this.#t=Array.from(e);const a=this.#S.bind(this),r=this.#w.bind(this),o=this._uiManager._signal;for(const l of this.#t){const c=l.getAttribute("data-resizer-name");l.setAttribute("role","spinbutton"),l.addEventListener("keydown",a,{signal:o}),l.addEventListener("blur",r,{signal:o}),l.addEventListener("focus",this.#I.bind(this,c),{signal:o}),l.setAttribute("data-l10n-id",ce._l10nResizer[c])}}const i=this.#t[0];let s=0;for(const a of e){if(a===i)break;s++}const n=(360-this.rotation+this.parentRotation)%360/90*(this.#t.length/4);if(n!==s){if(n<s)for(let r=0;r<s-n;r++)this.#s.append(this.#s.firstChild);else if(n>s)for(let r=0;r<n-s;r++)this.#s.firstChild.before(this.#s.lastChild);let a=0;for(const r of e){const l=this.#t[a++].getAttribute("data-resizer-name");r.setAttribute("data-l10n-id",ce._l10nResizer[l])}}this.#M(0),this.#p=!0,this.#s.firstChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}#S(t){ce._resizerKeyboardManager.exec(this,t)}#w(t){this.#p&&t.relatedTarget?.parentNode!==this.#s&&this.#F()}#I(t){this.#h=this.#p?t:""}#M(t){if(this.#t)for(const e of this.#t)e.tabIndex=t}_resizeWithKeyboard(t,e){this.#p&&this.#_(this.#h,{movementX:t,movementY:e})}#F(){if(this.#p=!1,this.#M(-1),this.#l){const{savedX:t,savedY:e,savedWidth:i,savedHeight:s}=this.#l;this.#x(t,e,i,s),this.#l=null}}_stopResizingWithKeyboard(){this.#F(),this.div.focus()}select(){if(this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#i?.toggleAltTextBadge(!1)}unselect(){this.#s?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#i?.toggleAltTextBadge(!0)}updateParams(t,e){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return this.#o}set isEditing(t){this.#o=t,this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(t,e){this.#r=!0;const i=t/e,{style:s}=this.div;s.aspectRatio=i,s.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=!1){if(e){this.#g||=new Map;const{action:i}=t;let s=this.#g.get(i);s&&clearTimeout(s),s=setTimeout(()=>{this._reportTelemetry(t),this.#g.delete(i),this.#g.size===0&&(this.#g=null)},ce._telemetryTimeout),this.#g.set(i,s);return}t.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),this.#n=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#n=!0}renderAnnotationElement(t){let e=t.container.querySelector(".annotationContent");if(!e)e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.container.prepend(e);else if(e.nodeName==="CANVAS"){const i=e;e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),i.before(e)}return e}resetAnnotationElement(t){const{firstChild:e}=t.container;e?.nodeName==="DIV"&&e.classList.contains("annotationContent")&&e.remove()}}class a5 extends ce{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const Wn=3285377520,ot=4294901760,pt=65535;class Br{constructor(t){this.h1=t?t&4294967295:Wn,this.h2=t?t&4294967295:Wn}update(t){let e,i;if(typeof t=="string"){e=new Uint8Array(t.length*2),i=0;for(let m=0,v=t.length;m<v;m++){const w=t.charCodeAt(m);w<=255?e[i++]=w:(e[i++]=w>>>8,e[i++]=w&255)}}else if(ArrayBuffer.isView(t))e=t.slice(),i=e.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const s=i>>2,n=i-s*4,a=new Uint32Array(e.buffer,0,s);let r=0,o=0,l=this.h1,c=this.h2;const h=3432918353,d=461845907,f=h&pt,p=d&pt;for(let m=0;m<s;m++)m&1?(r=a[m],r=r*h&ot|r*f&pt,r=r<<15|r>>>17,r=r*d&ot|r*p&pt,l^=r,l=l<<13|l>>>19,l=l*5+3864292196):(o=a[m],o=o*h&ot|o*f&pt,o=o<<15|o>>>17,o=o*d&ot|o*p&pt,c^=o,c=c<<13|c>>>19,c=c*5+3864292196);switch(r=0,n){case 3:r^=e[s*4+2]<<16;case 2:r^=e[s*4+1]<<8;case 1:r^=e[s*4],r=r*h&ot|r*f&pt,r=r<<15|r>>>17,r=r*d&ot|r*p&pt,s&1?l^=r:c^=r}this.h1=l,this.h2=c}hexdigest(){let t=this.h1,e=this.h2;return t^=e>>>1,t=t*3981806797&ot|t*36045&pt,e=e*4283543511&ot|((e<<16|t>>>16)*2950163797&ot)>>>16,t^=e>>>1,t=t*444984403&ot|t*60499&pt,e=e*3301882366&ot|((e<<16|t>>>16)*3120437893&ot)>>>16,t^=e>>>1,(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}const Cs=Object.freeze({map:null,hash:"",transfer:void 0});class Qs{#e=!1;#t=null;#i=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){const i=this.#i.get(t);return i===void 0?e:Object.assign(e,i)}getRawValue(t){return this.#i.get(t)}remove(t){if(this.#i.delete(t),this.#i.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const e of this.#i.values())if(e instanceof ce)return;this.onAnnotationEditor(null)}}setValue(t,e){const i=this.#i.get(t);let s=!1;if(i!==void 0)for(const[n,a]of Object.entries(e))i[n]!==a&&(s=!0,i[n]=a);else s=!0,this.#i.set(t,e);s&&this.#n(),e instanceof ce&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(e.constructor._type)}has(t){return this.#i.has(t)}getAll(){return this.#i.size>0?Gs(this.#i):null}setAll(t){for(const[e,i]of Object.entries(t))this.setValue(e,i)}get size(){return this.#i.size}#n(){this.#e||(this.#e=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#e&&(this.#e=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new zr(this)}get serializable(){if(this.#i.size===0)return Cs;const t=new Map,e=new Br,i=[],s=Object.create(null);let n=!1;for(const[a,r]of this.#i){const o=r instanceof ce?r.serialize(!1,s):r;o&&(t.set(a,o),e.update(`${a}:${JSON.stringify(o)}`),n||=!!o.bitmap)}if(n)for(const a of t.values())a.bitmap&&i.push(a.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:i}:Cs}get editorStats(){let t=null;const e=new Map;for(const i of this.#i.values()){if(!(i instanceof ce))continue;const s=i.telemetryFinalData;if(!s)continue;const{type:n}=s;e.has(n)||e.set(n,Object.getPrototypeOf(i).constructor),t||=Object.create(null);const a=t[n]||=new Map;for(const[r,o]of Object.entries(s)){if(r==="type")continue;let l=a.get(r);l||(l=new Map,a.set(r,l));const c=l.get(o)??0;l.set(o,c+1)}}for(const[i,s]of e)t[i]=s.computeTelemetryFinalData(t[i]);return t}resetModifiedIds(){this.#t=null}get modifiedIds(){if(this.#t)return this.#t;const t=[];for(const e of this.#i.values())!(e instanceof ce)||!e.annotationElementId||!e.serialize()||t.push(e.annotationElementId);return this.#t={ids:new Set(t),hash:t.join(",")}}}class zr extends Qs{#e;constructor(t){super();const{map:e,hash:i,transfer:s}=t.serializable,n=structuredClone(e,s?{transfer:s}:null);this.#e={map:n,hash:i,transfer:s}}get print(){ke("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#e}get modifiedIds(){return xe(this,"modifiedIds",{ids:new Set,hash:""})}}class l5{#e=new Set;constructor({ownerDocument:t=globalThis.document,styleElement:e=null}){this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(const t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),this.#e.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:t,_inspectFont:e}){if(!(!t||this.#e.has(t.loadedName))){if(ze(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:i,src:s,style:n}=t,a=new FontFace(i,s,n);this.addNativeFontFace(a);try{await a.load(),this.#e.add(i),e?.(t)}catch{pe(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(a)}return}ke("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo)return;if(t.attached=!0,t.systemFontInfo){await this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){const i=t.createNativeFontFace();if(i){this.addNativeFontFace(i);try{await i.loaded}catch(s){throw pe(`Failed to load font '${i.family}': '${s}'.`),t.disableFontFace=!0,s}}return}const e=t.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;await new Promise(i=>{const s=this._queueLoadingCallback(i);this._prepareFontLoadEvent(t,s)})}}get isFontLoadingAPISupported(){const t=!!this._document?.fonts;return xe(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){let t=!1;return(Je||typeof navigator<"u"&&typeof navigator?.userAgent=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(t=!0),xe(this,"isSyncFontLoadingSupported",t)}_queueLoadingCallback(t){function e(){for(ze(!s.done,"completeRequest() cannot be called twice."),s.done=!0;i.length>0&&i[0].done;){const n=i.shift();setTimeout(n.callback,0)}}const{loadingRequests:i}=this,s={done:!1,complete:e,callback:t};return i.push(s),s}get _loadTestFont(){const t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return xe(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,e){function i(A,P){return A.charCodeAt(P)<<24|A.charCodeAt(P+1)<<16|A.charCodeAt(P+2)<<8|A.charCodeAt(P+3)&255}function s(A,P,k,N){const O=A.substring(0,P),j=A.substring(P+k);return O+N+j}let n,a;const r=this._document.createElement("canvas");r.width=1,r.height=1;const o=r.getContext("2d");let l=0;function c(A,P){if(++l>30){pe("Load test font never loaded."),P();return}if(o.font="30px "+A,o.fillText(".",0,20),o.getImageData(0,0,1,1).data[3]>0){P();return}setTimeout(c.bind(null,A,P))}const h=`lt${Date.now()}${this.loadTestFontId++}`;let d=this._loadTestFont;d=s(d,976,h.length,h);const p=16,m=1482184792;let v=i(d,p);for(n=0,a=h.length-3;n<a;n+=4)v=v-m+i(h,n)|0;n<h.length&&(v=v-m+i(h+"XXX",n)|0),d=s(d,p,4,W3(v));const w=`url(data:font/opentype;base64,${btoa(d)});`,S=`@font-face {font-family:"${h}";src:${w}}`;this.insertRule(S);const _=this._document.createElement("div");_.style.visibility="hidden",_.style.width=_.style.height="10px",_.style.position="absolute",_.style.top=_.style.left="0px";for(const A of[t.loadedName,h]){const P=this._document.createElement("span");P.textContent="Hi",P.style.fontFamily=A,_.append(P)}this._document.body.append(_),c(h,()=>{_.remove(),e.complete()})}}class c5{constructor(t,{disableFontFace:e=!1,inspectFont:i=null}){this.compiledGlyphs=Object.create(null);for(const s in t)this[s]=t[s];this.disableFontFace=e===!0,this._inspectFont=i}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let t;if(!this.cssFontInfo)t=new FontFace(this.loadedName,this.data,{});else{const e={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(e.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,e)}return this._inspectFont?.(this),t}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const t=`url(data:${this.mimetype};base64,${Q3(this.data)});`;let e;if(!this.cssFontInfo)e=`@font-face {font-family:"${this.loadedName}";src:${t}}`;else{let i=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(i+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${i}src:${t}}`}return this._inspectFont?.(this,t),e}getPathGenerator(t,e){if(this.compiledGlyphs[e]!==void 0)return this.compiledGlyphs[e];let i;try{i=t.get(this.loadedName+"_path_"+e)}catch(n){pe(`getPathGenerator - ignoring character: "${n}".`)}if(!Array.isArray(i)||i.length===0)return this.compiledGlyphs[e]=function(n,a){};const s=[];for(let n=0,a=i.length;n<a;)switch(i[n++]){case mt.BEZIER_CURVE_TO:{const[r,o,l,c,h,d]=i.slice(n,n+6);s.push(f=>f.bezierCurveTo(r,o,l,c,h,d)),n+=6}break;case mt.MOVE_TO:{const[r,o]=i.slice(n,n+2);s.push(l=>l.moveTo(r,o)),n+=2}break;case mt.LINE_TO:{const[r,o]=i.slice(n,n+2);s.push(l=>l.lineTo(r,o)),n+=2}break;case mt.QUADRATIC_CURVE_TO:{const[r,o,l,c]=i.slice(n,n+4);s.push(h=>h.quadraticCurveTo(r,o,l,c)),n+=4}break;case mt.RESTORE:s.push(r=>r.restore());break;case mt.SAVE:s.push(r=>r.save());break;case mt.SCALE:ze(s.length===2,"Scale command is only valid at the third position.");break;case mt.TRANSFORM:{const[r,o,l,c,h,d]=i.slice(n,n+6);s.push(f=>f.transform(r,o,l,c,h,d)),n+=6}break;case mt.TRANSLATE:{const[r,o]=i.slice(n,n+2);s.push(l=>l.translate(r,o)),n+=2}break}return this.compiledGlyphs[e]=function(a,r){s[0](a),s[1](a),a.scale(r,-r);for(let o=2,l=s.length;o<l;o++)s[o](a)}}}class Ur{#e=!1;constructor({enableHWA:t=!1}){this.#e=t}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");const i=this._createCanvas(t,e);return{canvas:i,context:i.getContext("2d",{willReadFrequently:!this.#e})}}reset(t,e,i){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||i<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=i}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){ke("Abstract method `_createCanvas` called.")}}class h5 extends Ur{constructor({ownerDocument:t=globalThis.document,enableHWA:e=!1}){super({enableHWA:e}),this._document=t}_createCanvas(t,e){const i=this._document.createElement("canvas");return i.width=t,i.height=e,i}}class Vr{constructor({baseUrl:t=null,isCompressed:e=!0}){this.baseUrl=t,this.isCompressed=e}async fetch({name:t}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");const e=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(e).then(i=>({cMapData:i,isCompressed:this.isCompressed})).catch(i=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${e}`)})}async _fetch(t){ke("Abstract method `_fetch` called.")}}class qr extends Vr{async _fetch(t){const e=await $i(t,this.isCompressed?"arraybuffer":"text");return e instanceof ArrayBuffer?new Uint8Array(e):Qi(e)}}class Gr{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,i,s,n){return"none"}destroy(t=!1){}}class u5 extends Gr{#e;#t;#i;#n;#r;#s;#l=0;constructor({docId:t,ownerDocument:e=globalThis.document}){super(),this.#n=t,this.#r=e}get#c(){return this.#t||=new Map}get#h(){return this.#s||=new Map}get#a(){if(!this.#i){const t=this.#r.createElement("div"),{style:e}=t;e.visibility="hidden",e.contain="strict",e.width=e.height=0,e.position="absolute",e.top=e.left=0,e.zIndex=-1;const i=this.#r.createElementNS(yt,"svg");i.setAttribute("width",0),i.setAttribute("height",0),this.#i=this.#r.createElementNS(yt,"defs"),t.append(i),i.append(this.#i),this.#r.body.append(t)}return this.#i}#u(t){if(t.length===1){const o=t[0],l=new Array(256);for(let h=0;h<256;h++)l[h]=o[h]/255;const c=l.join(",");return[c,c,c]}const[e,i,s]=t,n=new Array(256),a=new Array(256),r=new Array(256);for(let o=0;o<256;o++)n[o]=e[o]/255,a[o]=i[o]/255,r[o]=s[o]/255;return[n.join(","),a.join(","),r.join(",")]}#o(t){if(this.#e===void 0){this.#e="";const e=this.#r.URL;e!==this.#r.baseURI&&(es(e)?pe('#createUrl: ignore "data:"-URL for performance reasons.'):this.#e=e.split("#",1)[0])}return`url(${this.#e}#${t})`}addFilter(t){if(!t)return"none";let e=this.#c.get(t);if(e)return e;const[i,s,n]=this.#u(t),a=t.length===1?i:`${i}${s}${n}`;if(e=this.#c.get(a),e)return this.#c.set(t,e),e;const r=`g_${this.#n}_transfer_map_${this.#l++}`,o=this.#o(r);this.#c.set(t,o),this.#c.set(a,o);const l=this.#f(r);return this.#m(i,s,n,l),o}addHCMFilter(t,e){const i=`${t}-${e}`,s="base";let n=this.#h.get(s);if(n?.key===i||(n?(n.filter?.remove(),n.key=i,n.url="none",n.filter=null):(n={key:i,url:"none",filter:null},this.#h.set(s,n)),!t||!e))return n.url;const a=this.#y(t);t=ne.makeHexColor(...a);const r=this.#y(e);if(e=ne.makeHexColor(...r),this.#a.style.color="",t==="#000000"&&e==="#ffffff"||t===e)return n.url;const o=new Array(256);for(let f=0;f<=255;f++){const p=f/255;o[f]=p<=.03928?p/12.92:((p+.055)/1.055)**2.4}const l=o.join(","),c=`g_${this.#n}_hcm_filter`,h=n.filter=this.#f(c);this.#m(l,l,l,h),this.#p(h);const d=(f,p)=>{const m=a[f]/255,v=r[f]/255,w=new Array(p+1);for(let S=0;S<=p;S++)w[S]=m+S/p*(v-m);return w.join(",")};return this.#m(d(0,5),d(1,5),d(2,5),h),n.url=this.#o(c),n.url}addAlphaFilter(t){let e=this.#c.get(t);if(e)return e;const[i]=this.#u([t]),s=`alpha_${i}`;if(e=this.#c.get(s),e)return this.#c.set(t,e),e;const n=`g_${this.#n}_alpha_map_${this.#l++}`,a=this.#o(n);this.#c.set(t,a),this.#c.set(s,a);const r=this.#f(n);return this.#g(i,r),a}addLuminosityFilter(t){let e=this.#c.get(t||"luminosity");if(e)return e;let i,s;if(t?([i]=this.#u([t]),s=`luminosity_${i}`):s="luminosity",e=this.#c.get(s),e)return this.#c.set(t,e),e;const n=`g_${this.#n}_luminosity_map_${this.#l++}`,a=this.#o(n);this.#c.set(t,a),this.#c.set(s,a);const r=this.#f(n);return this.#d(r),t&&this.#g(i,r),a}addHighlightHCMFilter(t,e,i,s,n){const a=`${e}-${i}-${s}-${n}`;let r=this.#h.get(t);if(r?.key===a||(r?(r.filter?.remove(),r.key=a,r.url="none",r.filter=null):(r={key:a,url:"none",filter:null},this.#h.set(t,r)),!e||!i))return r.url;const[o,l]=[e,i].map(this.#y.bind(this));let c=Math.round(.2126*o[0]+.7152*o[1]+.0722*o[2]),h=Math.round(.2126*l[0]+.7152*l[1]+.0722*l[2]),[d,f]=[s,n].map(this.#y.bind(this));h<c&&([c,h,d,f]=[h,c,f,d]),this.#a.style.color="";const p=(w,S,_)=>{const A=new Array(256),P=(h-c)/_,k=w/255,N=(S-w)/(255*_);let O=0;for(let j=0;j<=_;j++){const U=Math.round(c+j*P),G=k+j*N;for(let R=O;R<=U;R++)A[R]=G;O=U+1}for(let j=O;j<256;j++)A[j]=A[O-1];return A.join(",")},m=`g_${this.#n}_hcm_${t}_filter`,v=r.filter=this.#f(m);return this.#p(v),this.#m(p(d[0],f[0],5),p(d[1],f[1],5),p(d[2],f[2],5),v),r.url=this.#o(m),r.url}destroy(t=!1){t&&this.#h.size!==0||(this.#i&&(this.#i.parentNode.parentNode.remove(),this.#i=null),this.#t&&(this.#t.clear(),this.#t=null),this.#l=0)}#d(t){const e=this.#r.createElementNS(yt,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(e)}#p(t){const e=this.#r.createElementNS(yt,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(e)}#f(t){const e=this.#r.createElementNS(yt,"filter");return e.setAttribute("color-interpolation-filters","sRGB"),e.setAttribute("id",t),this.#a.append(e),e}#v(t,e,i){const s=this.#r.createElementNS(yt,e);s.setAttribute("type","discrete"),s.setAttribute("tableValues",i),t.append(s)}#m(t,e,i,s){const n=this.#r.createElementNS(yt,"feComponentTransfer");s.append(n),this.#v(n,"feFuncR",t),this.#v(n,"feFuncG",e),this.#v(n,"feFuncB",i)}#g(t,e){const i=this.#r.createElementNS(yt,"feComponentTransfer");e.append(i),this.#v(i,"feFuncA",t)}#y(t){return this.#a.style.color=t,Ks(getComputedStyle(this.#a).getPropertyValue("color"))}}class Wr{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(i=>{throw new Error(`Unable to load font data at: ${e}`)})}async _fetch(t){ke("Abstract method `_fetch` called.")}}class Xr extends Wr{async _fetch(t){const e=await $i(t,"arraybuffer");return new Uint8Array(e)}}if(Je){var Ps=Promise.withResolvers(),Rs=null;(async()=>{const t=await Ei(()=>import("./__vite-browser-external-BIHI7g3E.js"),[],import.meta.url),e=await Ei(()=>import("./__vite-browser-external-BIHI7g3E.js"),[],import.meta.url),i=await Ei(()=>import("./__vite-browser-external-BIHI7g3E.js"),[],import.meta.url),s=await Ei(()=>import("./__vite-browser-external-BIHI7g3E.js"),[],import.meta.url);let n,a;return new Map(Object.entries({fs:t,http:e,https:i,url:s,canvas:n,path2d:a}))})().then(t=>{Rs=t,Ps.resolve()},t=>{pe(`loadPackages: ${t}`),Rs=new Map,Ps.resolve()})}class Rt{static get promise(){return Ps.promise}static get(t){return Rs?.get(t)}}async function Yr(u){const e=await Rt.get("fs").promises.readFile(u);return new Uint8Array(e)}class d5 extends Gr{}class f5 extends Ur{_createCanvas(t,e){return Rt.get("canvas").createCanvas(t,e)}}class p5 extends Vr{async _fetch(t){return Yr(t)}}class g5 extends Wr{async _fetch(t){return Yr(t)}}const $e={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function Ls(u,t){if(!t)return;const e=t[2]-t[0],i=t[3]-t[1],s=new Path2D;s.rect(t[0],t[1],e,i),u.clip(s)}class $s{getPattern(){ke("Abstract method `getPattern` called.")}}class m5 extends $s{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}_createGradient(t){let e;this._type==="axial"?e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const i of this._colorStops)e.addColorStop(i[0],i[1]);return e}getPattern(t,e,i,s){let n;if(s===$e.STROKE||s===$e.FILL){const a=e.current.getClippedPathBoundingBox(s,Me(t))||[0,0,0,0],r=Math.ceil(a[2]-a[0])||1,o=Math.ceil(a[3]-a[1])||1,l=e.cachedCanvases.getCanvas("pattern",r,o),c=l.context;c.clearRect(0,0,c.canvas.width,c.canvas.height),c.beginPath(),c.rect(0,0,c.canvas.width,c.canvas.height),c.translate(-a[0],-a[1]),i=ne.transform(i,[1,0,0,1,a[0],a[1]]),c.transform(...e.baseTransform),this.matrix&&c.transform(...this.matrix),Ls(c,this._bbox),c.fillStyle=this._createGradient(c),c.fill(),n=t.createPattern(l.canvas,"no-repeat");const h=new DOMMatrix(i);n.setTransform(h)}else Ls(t,this._bbox),n=this._createGradient(t);return n}}function ms(u,t,e,i,s,n,a,r){const o=t.coords,l=t.colors,c=u.data,h=u.width*4;let d;o[e+1]>o[i+1]&&(d=e,e=i,i=d,d=n,n=a,a=d),o[i+1]>o[s+1]&&(d=i,i=s,s=d,d=a,a=r,r=d),o[e+1]>o[i+1]&&(d=e,e=i,i=d,d=n,n=a,a=d);const f=(o[e]+t.offsetX)*t.scaleX,p=(o[e+1]+t.offsetY)*t.scaleY,m=(o[i]+t.offsetX)*t.scaleX,v=(o[i+1]+t.offsetY)*t.scaleY,w=(o[s]+t.offsetX)*t.scaleX,S=(o[s+1]+t.offsetY)*t.scaleY;if(p>=S)return;const _=l[n],A=l[n+1],P=l[n+2],k=l[a],N=l[a+1],O=l[a+2],j=l[r],U=l[r+1],G=l[r+2],R=Math.round(p),D=Math.round(S);let I,W,z,B,H,$,J,re;for(let me=R;me<=D;me++){if(me<v){const ae=me<p?0:(p-me)/(p-v);I=f-(f-m)*ae,W=_-(_-k)*ae,z=A-(A-N)*ae,B=P-(P-O)*ae}else{let ae;me>S?ae=1:v===S?ae=0:ae=(v-me)/(v-S),I=m-(m-w)*ae,W=k-(k-j)*ae,z=N-(N-U)*ae,B=O-(O-G)*ae}let Q;me<p?Q=0:me>S?Q=1:Q=(p-me)/(p-S),H=f-(f-w)*Q,$=_-(_-j)*Q,J=A-(A-U)*Q,re=P-(P-G)*Q;const Te=Math.round(Math.min(I,H)),Ae=Math.round(Math.max(I,H));let ge=h*me+Te*4;for(let ae=Te;ae<=Ae;ae++)Q=(I-ae)/(I-H),Q<0?Q=0:Q>1&&(Q=1),c[ge++]=W-(W-$)*Q|0,c[ge++]=z-(z-J)*Q|0,c[ge++]=B-(B-re)*Q|0,c[ge++]=255}}function v5(u,t,e){const i=t.coords,s=t.colors;let n,a;switch(t.type){case"lattice":const r=t.verticesPerRow,o=Math.floor(i.length/r)-1,l=r-1;for(n=0;n<o;n++){let c=n*r;for(let h=0;h<l;h++,c++)ms(u,e,i[c],i[c+1],i[c+r],s[c],s[c+1],s[c+r]),ms(u,e,i[c+r+1],i[c+1],i[c+r],s[c+r+1],s[c+1],s[c+r])}break;case"triangles":for(n=0,a=i.length;n<a;n+=3)ms(u,e,i[n],i[n+1],i[n+2],s[n],s[n+1],s[n+2]);break;default:throw new Error("illegal figure")}}class y5 extends $s{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[7],this._background=t[8],this.matrix=null}_createMeshCanvas(t,e,i){const r=Math.floor(this._bounds[0]),o=Math.floor(this._bounds[1]),l=Math.ceil(this._bounds[2])-r,c=Math.ceil(this._bounds[3])-o,h=Math.min(Math.ceil(Math.abs(l*t[0]*1.1)),3e3),d=Math.min(Math.ceil(Math.abs(c*t[1]*1.1)),3e3),f=l/h,p=c/d,m={coords:this._coords,colors:this._colors,offsetX:-r,offsetY:-o,scaleX:1/f,scaleY:1/p},v=h+4,w=d+4,S=i.getCanvas("mesh",v,w),_=S.context,A=_.createImageData(h,d);if(e){const k=A.data;for(let N=0,O=k.length;N<O;N+=4)k[N]=e[0],k[N+1]=e[1],k[N+2]=e[2],k[N+3]=255}for(const k of this._figures)v5(A,k,m);return _.putImageData(A,2,2),{canvas:S.canvas,offsetX:r-2*f,offsetY:o-2*p,scaleX:f,scaleY:p}}getPattern(t,e,i,s){Ls(t,this._bbox);let n;if(s===$e.SHADING)n=ne.singularValueDecompose2dScale(Me(t));else if(n=ne.singularValueDecompose2dScale(e.baseTransform),this.matrix){const r=ne.singularValueDecompose2dScale(this.matrix);n=[n[0]*r[0],n[1]*r[1]]}const a=this._createMeshCanvas(n,s===$e.SHADING?null:this._background,e.cachedCanvases);return s!==$e.SHADING&&(t.setTransform(...e.baseTransform),this.matrix&&t.transform(...this.matrix)),t.translate(a.offsetX,a.offsetY),t.scale(a.scaleX,a.scaleY),t.createPattern(a.canvas,"no-repeat")}}class w5 extends $s{getPattern(){return"hotpink"}}function b5(u){switch(u[0]){case"RadialAxial":return new m5(u);case"Mesh":return new y5(u);case"Dummy":return new w5}throw new Error(`Unknown IR type: ${u[0]}`)}const Xn={COLORED:1,UNCOLORED:2};class en{static MAX_PATTERN_SIZE=3e3;constructor(t,e,i,s,n){this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.color=e,this.ctx=i,this.canvasGraphicsFactory=s,this.baseTransform=n}createPatternCanvas(t){const{bbox:e,operatorList:i,paintType:s,tilingType:n,color:a,canvasGraphicsFactory:r}=this;let{xstep:o,ystep:l}=this;o=Math.abs(o),l=Math.abs(l),Zi("TilingType: "+n);const c=e[0],h=e[1],d=e[2],f=e[3],p=d-c,m=f-h,v=ne.singularValueDecompose2dScale(this.matrix),w=ne.singularValueDecompose2dScale(this.baseTransform),S=v[0]*w[0],_=v[1]*w[1];let A=p,P=m,k=!1,N=!1;const O=Math.ceil(o*S),j=Math.ceil(l*_),U=Math.ceil(p*S),G=Math.ceil(m*_);O>=U?A=o:k=!0,j>=G?P=l:N=!0;const R=this.getSizeAndScale(A,this.ctx.canvas.width,S),D=this.getSizeAndScale(P,this.ctx.canvas.height,_),I=t.cachedCanvases.getCanvas("pattern",R.size,D.size),W=I.context,z=r.createCanvasGraphics(W);if(z.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(z,s,a),W.translate(-R.scale*c,-D.scale*h),z.transform(R.scale,0,0,D.scale,0,0),W.save(),this.clipBbox(z,c,h,d,f),z.baseTransform=Me(z.ctx),z.executeOperatorList(i),z.endDrawing(),W.restore(),k||N){const B=I.canvas;k&&(A=o),N&&(P=l);const H=this.getSizeAndScale(A,this.ctx.canvas.width,S),$=this.getSizeAndScale(P,this.ctx.canvas.height,_),J=H.size,re=$.size,me=t.cachedCanvases.getCanvas("pattern-workaround",J,re),Q=me.context,Te=k?Math.floor(p/o):0,Ae=N?Math.floor(m/l):0;for(let ge=0;ge<=Te;ge++)for(let ae=0;ae<=Ae;ae++)Q.drawImage(B,J*ge,re*ae,J,re,0,0,J,re);return{canvas:me.canvas,scaleX:H.scale,scaleY:$.scale,offsetX:c,offsetY:h}}return{canvas:I.canvas,scaleX:R.scale,scaleY:D.scale,offsetX:c,offsetY:h}}getSizeAndScale(t,e,i){const s=Math.max(en.MAX_PATTERN_SIZE,e);let n=Math.ceil(t*i);return n>=s?n=s:i=n/t,{scale:i,size:n}}clipBbox(t,e,i,s,n){const a=s-e,r=n-i;t.ctx.rect(e,i,a,r),t.current.updateRectMinMax(Me(t.ctx),[e,i,s,n]),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,e,i){const s=t.ctx,n=t.current;switch(e){case Xn.COLORED:const a=this.ctx;s.fillStyle=a.fillStyle,s.strokeStyle=a.strokeStyle,n.fillColor=a.fillStyle,n.strokeColor=a.strokeStyle;break;case Xn.UNCOLORED:const r=ne.makeHexColor(i[0],i[1],i[2]);s.fillStyle=r,s.strokeStyle=r,n.fillColor=r,n.strokeColor=r;break;default:throw new G3(`Unsupported paint type: ${e}`)}}getPattern(t,e,i,s){let n=i;s!==$e.SHADING&&(n=ne.transform(n,e.baseTransform),this.matrix&&(n=ne.transform(n,this.matrix)));const a=this.createPatternCanvas(e);let r=new DOMMatrix(n);r=r.translate(a.offsetX,a.offsetY),r=r.scale(1/a.scaleX,1/a.scaleY);const o=t.createPattern(a.canvas,"repeat");return o.setTransform(r),o}}function x5({src:u,srcPos:t=0,dest:e,width:i,height:s,nonBlackColor:n=4294967295,inverseDecode:a=!1}){const r=et.isLittleEndian?4278190080:255,[o,l]=a?[n,r]:[r,n],c=i>>3,h=i&7,d=u.length;e=new Uint32Array(e.buffer);let f=0;for(let p=0;p<s;p++){for(const v=t+c;t<v;t++){const w=t<d?u[t]:255;e[f++]=w&128?l:o,e[f++]=w&64?l:o,e[f++]=w&32?l:o,e[f++]=w&16?l:o,e[f++]=w&8?l:o,e[f++]=w&4?l:o,e[f++]=w&2?l:o,e[f++]=w&1?l:o}if(h===0)continue;const m=t<d?u[t++]:255;for(let v=0;v<h;v++)e[f++]=m&1<<7-v?l:o}return{srcPos:t,destPos:f}}const Yn=16,Kn=100,S5=15,Zn=10,Jn=1e3,it=16;function E5(u,t){if(u._removeMirroring)throw new Error("Context is already forwarding operations.");u.__originalSave=u.save,u.__originalRestore=u.restore,u.__originalRotate=u.rotate,u.__originalScale=u.scale,u.__originalTranslate=u.translate,u.__originalTransform=u.transform,u.__originalSetTransform=u.setTransform,u.__originalResetTransform=u.resetTransform,u.__originalClip=u.clip,u.__originalMoveTo=u.moveTo,u.__originalLineTo=u.lineTo,u.__originalBezierCurveTo=u.bezierCurveTo,u.__originalRect=u.rect,u.__originalClosePath=u.closePath,u.__originalBeginPath=u.beginPath,u._removeMirroring=()=>{u.save=u.__originalSave,u.restore=u.__originalRestore,u.rotate=u.__originalRotate,u.scale=u.__originalScale,u.translate=u.__originalTranslate,u.transform=u.__originalTransform,u.setTransform=u.__originalSetTransform,u.resetTransform=u.__originalResetTransform,u.clip=u.__originalClip,u.moveTo=u.__originalMoveTo,u.lineTo=u.__originalLineTo,u.bezierCurveTo=u.__originalBezierCurveTo,u.rect=u.__originalRect,u.closePath=u.__originalClosePath,u.beginPath=u.__originalBeginPath,delete u._removeMirroring},u.save=function(){t.save(),this.__originalSave()},u.restore=function(){t.restore(),this.__originalRestore()},u.translate=function(i,s){t.translate(i,s),this.__originalTranslate(i,s)},u.scale=function(i,s){t.scale(i,s),this.__originalScale(i,s)},u.transform=function(i,s,n,a,r,o){t.transform(i,s,n,a,r,o),this.__originalTransform(i,s,n,a,r,o)},u.setTransform=function(i,s,n,a,r,o){t.setTransform(i,s,n,a,r,o),this.__originalSetTransform(i,s,n,a,r,o)},u.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},u.rotate=function(i){t.rotate(i),this.__originalRotate(i)},u.clip=function(i){t.clip(i),this.__originalClip(i)},u.moveTo=function(e,i){t.moveTo(e,i),this.__originalMoveTo(e,i)},u.lineTo=function(e,i){t.lineTo(e,i),this.__originalLineTo(e,i)},u.bezierCurveTo=function(e,i,s,n,a,r){t.bezierCurveTo(e,i,s,n,a,r),this.__originalBezierCurveTo(e,i,s,n,a,r)},u.rect=function(e,i,s,n){t.rect(e,i,s,n),this.__originalRect(e,i,s,n)},u.closePath=function(){t.closePath(),this.__originalClosePath()},u.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}class T5{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,i){let s;return this.cache[t]!==void 0?(s=this.cache[t],this.canvasFactory.reset(s,e,i)):(s=this.canvasFactory.create(e,i),this.cache[t]=s),s}delete(t){delete this.cache[t]}clear(){for(const t in this.cache){const e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}}function Ci(u,t,e,i,s,n,a,r,o,l){const[c,h,d,f,p,m]=Me(u);if(h===0&&d===0){const S=a*c+p,_=Math.round(S),A=r*f+m,P=Math.round(A),k=(a+o)*c+p,N=Math.abs(Math.round(k)-_)||1,O=(r+l)*f+m,j=Math.abs(Math.round(O)-P)||1;return u.setTransform(Math.sign(c),0,0,Math.sign(f),_,P),u.drawImage(t,e,i,s,n,0,0,N,j),u.setTransform(c,h,d,f,p,m),[N,j]}if(c===0&&f===0){const S=r*d+p,_=Math.round(S),A=a*h+m,P=Math.round(A),k=(r+l)*d+p,N=Math.abs(Math.round(k)-_)||1,O=(a+o)*h+m,j=Math.abs(Math.round(O)-P)||1;return u.setTransform(0,Math.sign(h),Math.sign(d),0,_,P),u.drawImage(t,e,i,s,n,0,0,j,N),u.setTransform(c,h,d,f,p,m),[j,N]}u.drawImage(t,e,i,s,n,a,r,o,l);const v=Math.hypot(c,h),w=Math.hypot(d,f);return[v*o,w*l]}function _5(u){const{width:t,height:e}=u;if(t>Jn||e>Jn)return null;const i=1e3,s=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),n=t+1;let a=new Uint8Array(n*(e+1)),r,o,l;const c=t+7&-8;let h=new Uint8Array(c*e),d=0;for(const w of u.data){let S=128;for(;S>0;)h[d++]=w&S?0:255,S>>=1}let f=0;for(d=0,h[d]!==0&&(a[0]=1,++f),o=1;o<t;o++)h[d]!==h[d+1]&&(a[o]=h[d]?2:1,++f),d++;for(h[d]!==0&&(a[o]=2,++f),r=1;r<e;r++){d=r*c,l=r*n,h[d-c]!==h[d]&&(a[l]=h[d]?1:8,++f);let w=(h[d]?4:0)+(h[d-c]?8:0);for(o=1;o<t;o++)w=(w>>2)+(h[d+1]?4:0)+(h[d-c+1]?8:0),s[w]&&(a[l+o]=s[w],++f),d++;if(h[d-c]!==h[d]&&(a[l+o]=h[d]?2:4,++f),f>i)return null}for(d=c*(e-1),l=r*n,h[d]!==0&&(a[l]=8,++f),o=1;o<t;o++)h[d]!==h[d+1]&&(a[l+o]=h[d]?4:8,++f),d++;if(h[d]!==0&&(a[l+o]=4,++f),f>i)return null;const p=new Int32Array([0,n,-1,0,-n,0,0,0,1]),m=new Path2D;for(r=0;f&&r<=e;r++){let w=r*n;const S=w+t;for(;w<S&&!a[w];)w++;if(w===S)continue;m.moveTo(w%n,r);const _=w;let A=a[w];do{const P=p[A];do w+=P;while(!a[w]);const k=a[w];k!==5&&k!==10?(A=k,a[w]=0):(A=k&51*A>>4,a[w]&=A>>2|A<<2),m.lineTo(w%n,w/n|0),a[w]||--f}while(_!==w);--r}return h=null,a=null,function(w){w.save(),w.scale(1/t,-1/e),w.translate(0,-e),w.fill(m),w.beginPath(),w.restore()}}class Qn{constructor(t,e){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=Fr,this.textMatrixScale=1,this.fontMatrix=Es,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=Ye.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,t,e])}clone(){const t=Object.create(this);return t.clipBox=this.clipBox.slice(),t}setCurrentPoint(t,e){this.x=t,this.y=e}updatePathMinMax(t,e,i){[e,i]=ne.applyTransform([e,i],t),this.minX=Math.min(this.minX,e),this.minY=Math.min(this.minY,i),this.maxX=Math.max(this.maxX,e),this.maxY=Math.max(this.maxY,i)}updateRectMinMax(t,e){const i=ne.applyTransform(e,t),s=ne.applyTransform(e.slice(2),t),n=ne.applyTransform([e[0],e[3]],t),a=ne.applyTransform([e[2],e[1]],t);this.minX=Math.min(this.minX,i[0],s[0],n[0],a[0]),this.minY=Math.min(this.minY,i[1],s[1],n[1],a[1]),this.maxX=Math.max(this.maxX,i[0],s[0],n[0],a[0]),this.maxY=Math.max(this.maxY,i[1],s[1],n[1],a[1])}updateScalingPathMinMax(t,e){ne.scaleMinMax(t,e),this.minX=Math.min(this.minX,e[0]),this.minY=Math.min(this.minY,e[1]),this.maxX=Math.max(this.maxX,e[2]),this.maxY=Math.max(this.maxY,e[3])}updateCurvePathMinMax(t,e,i,s,n,a,r,o,l,c){const h=ne.bezierBoundingBox(e,i,s,n,a,r,o,l,c);c||this.updateRectMinMax(t,h)}getPathBoundingBox(t=$e.FILL,e=null){const i=[this.minX,this.minY,this.maxX,this.maxY];if(t===$e.STROKE){e||ke("Stroke bounding box must include transform.");const s=ne.singularValueDecompose2dScale(e),n=s[0]*this.lineWidth/2,a=s[1]*this.lineWidth/2;i[0]-=n,i[1]-=a,i[2]+=n,i[3]+=a}return i}updateClipFromPath(){const t=ne.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(t){this.clipBox=t,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(t=$e.FILL,e=null){return ne.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}function $n(u,t){if(typeof ImageData<"u"&&t instanceof ImageData){u.putImageData(t,0,0);return}const e=t.height,i=t.width,s=e%it,n=(e-s)/it,a=s===0?n:n+1,r=u.createImageData(i,it);let o=0,l;const c=t.data,h=r.data;let d,f,p,m;if(t.kind===Mi.GRAYSCALE_1BPP){const v=c.byteLength,w=new Uint32Array(h.buffer,0,h.byteLength>>2),S=w.length,_=i+7>>3,A=4294967295,P=et.isLittleEndian?4278190080:255;for(d=0;d<a;d++){for(p=d<n?it:s,l=0,f=0;f<p;f++){const k=v-o;let N=0;const O=k>_?i:k*8-7,j=O&-8;let U=0,G=0;for(;N<j;N+=8)G=c[o++],w[l++]=G&128?A:P,w[l++]=G&64?A:P,w[l++]=G&32?A:P,w[l++]=G&16?A:P,w[l++]=G&8?A:P,w[l++]=G&4?A:P,w[l++]=G&2?A:P,w[l++]=G&1?A:P;for(;N<O;N++)U===0&&(G=c[o++],U=128),w[l++]=G&U?A:P,U>>=1}for(;l<S;)w[l++]=0;u.putImageData(r,0,d*it)}}else if(t.kind===Mi.RGBA_32BPP){for(f=0,m=i*it*4,d=0;d<n;d++)h.set(c.subarray(o,o+m)),o+=m,u.putImageData(r,0,f),f+=it;d<a&&(m=i*s*4,h.set(c.subarray(o,o+m)),u.putImageData(r,0,f))}else if(t.kind===Mi.RGB_24BPP)for(p=it,m=i*p,d=0;d<a;d++){for(d>=n&&(p=s,m=i*p),l=0,f=m;f--;)h[l++]=c[o++],h[l++]=c[o++],h[l++]=c[o++],h[l++]=255;u.putImageData(r,0,d*it)}else throw new Error(`bad image kind: ${t.kind}`)}function er(u,t){if(t.bitmap){u.drawImage(t.bitmap,0,0);return}const e=t.height,i=t.width,s=e%it,n=(e-s)/it,a=s===0?n:n+1,r=u.createImageData(i,it);let o=0;const l=t.data,c=r.data;for(let h=0;h<a;h++){const d=h<n?it:s;({srcPos:o}=x5({src:l,srcPos:o,dest:c,width:i,height:d,nonBlackColor:0})),u.putImageData(r,0,h*it)}}function ai(u,t){const e=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const i of e)u[i]!==void 0&&(t[i]=u[i]);u.setLineDash!==void 0&&(t.setLineDash(u.getLineDash()),t.lineDashOffset=u.lineDashOffset)}function Pi(u){if(u.strokeStyle=u.fillStyle="#000000",u.fillRule="nonzero",u.globalAlpha=1,u.lineWidth=1,u.lineCap="butt",u.lineJoin="miter",u.miterLimit=10,u.globalCompositeOperation="source-over",u.font="10px sans-serif",u.setLineDash!==void 0&&(u.setLineDash([]),u.lineDashOffset=0),!Je){const{filter:t}=u;t!=="none"&&t!==""&&(u.filter="none")}}function tr(u,t){if(t)return!0;const e=ne.singularValueDecompose2dScale(u);e[0]=Math.fround(e[0]),e[1]=Math.fround(e[1]);const i=Math.fround((globalThis.devicePixelRatio||1)*ii.PDF_TO_CSS_UNITS);return e[0]<=i&&e[1]<=i}const A5=["butt","round","square"],C5=["miter","round","bevel"],P5={},ir={};class Zt{constructor(t,e,i,s,n,{optionalContentConfig:a,markedContentStack:r=null},o,l){this.ctx=t,this.current=new Qn(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=i,this.canvasFactory=s,this.filterFactory=n,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=r||[],this.optionalContentConfig=a,this.cachedCanvases=new T5(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=o,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=l,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(t,e=null){return typeof t=="string"?t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t):e}beginDrawing({transform:t,viewport:e,transparency:i=!1,background:s=null}){const n=this.ctx.canvas.width,a=this.ctx.canvas.height,r=this.ctx.fillStyle;if(this.ctx.fillStyle=s||"#ffffff",this.ctx.fillRect(0,0,n,a),this.ctx.fillStyle=r,i){const o=this.cachedCanvases.getCanvas("transparent",n,a);this.compositeCtx=this.ctx,this.transparentCanvas=o.canvas,this.ctx=o.context,this.ctx.save(),this.ctx.transform(...Me(this.compositeCtx))}this.ctx.save(),Pi(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=Me(this.ctx)}executeOperatorList(t,e,i,s){const n=t.argsArray,a=t.fnArray;let r=e||0;const o=n.length;if(o===r)return r;const l=o-r>Zn&&typeof i=="function",c=l?Date.now()+S5:0;let h=0;const d=this.commonObjs,f=this.objs;let p;for(;;){if(s!==void 0&&r===s.nextBreakPoint)return s.breakIt(r,i),r;if(p=a[r],p!==ft.dependency)this[p].apply(this,n[r]);else for(const m of n[r]){const v=m.startsWith("g_")?d:f;if(!v.has(m))return v.get(m,i),r}if(r++,r===o)return r;if(l&&++h>Zn){if(Date.now()>c)return i(),r;h=0}}}#e(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#e(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const e of t.values())typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),this.#t()}#t(){if(this.pageColors){const t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(t!=="none"){const e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}}_scaleImage(t,e){const i=t.width??t.displayWidth,s=t.height??t.displayHeight;let n=Math.max(Math.hypot(e[0],e[1]),1),a=Math.max(Math.hypot(e[2],e[3]),1),r=i,o=s,l="prescale1",c,h;for(;n>2&&r>1||a>2&&o>1;){let d=r,f=o;n>2&&r>1&&(d=r>=16384?Math.floor(r/2)-1||1:Math.ceil(r/2),n/=r/d),a>2&&o>1&&(f=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o)/2,a/=o/f),c=this.cachedCanvases.getCanvas(l,d,f),h=c.context,h.clearRect(0,0,d,f),h.drawImage(t,0,0,r,o,0,0,d,f),t=c.canvas,r=d,o=f,l=l==="prescale1"?"prescale2":"prescale1"}return{img:t,paintWidth:r,paintHeight:o}}_createMaskCanvas(t){const e=this.ctx,{width:i,height:s}=t,n=this.current.fillColor,a=this.current.patternFill,r=Me(e);let o,l,c,h;if((t.bitmap||t.data)&&t.count>1){const O=t.bitmap||t.data.buffer;l=JSON.stringify(a?r:[r.slice(0,4),n]),o=this._cachedBitmapsMap.get(O),o||(o=new Map,this._cachedBitmapsMap.set(O,o));const j=o.get(l);if(j&&!a){const U=Math.round(Math.min(r[0],r[2])+r[4]),G=Math.round(Math.min(r[1],r[3])+r[5]);return{canvas:j,offsetX:U,offsetY:G}}c=j}c||(h=this.cachedCanvases.getCanvas("maskCanvas",i,s),er(h.context,t));let d=ne.transform(r,[1/i,0,0,-1/s,0,0]);d=ne.transform(d,[1,0,0,1,0,-s]);const[f,p,m,v]=ne.getAxialAlignedBoundingBox([0,0,i,s],d),w=Math.round(m-f)||1,S=Math.round(v-p)||1,_=this.cachedCanvases.getCanvas("fillCanvas",w,S),A=_.context,P=f,k=p;A.translate(-P,-k),A.transform(...d),c||(c=this._scaleImage(h.canvas,vt(A)),c=c.img,o&&a&&o.set(l,c)),A.imageSmoothingEnabled=tr(Me(A),t.interpolate),Ci(A,c,0,0,c.width,c.height,0,0,i,s),A.globalCompositeOperation="source-in";const N=ne.transform(vt(A),[1,0,0,1,-P,-k]);return A.fillStyle=a?n.getPattern(e,this,N,$e.FILL):n,A.fillRect(0,0,i,s),o&&!a&&(this.cachedCanvases.delete("fillCanvas"),o.set(l,_.canvas)),{canvas:_.canvas,offsetX:Math.round(P),offsetY:Math.round(k)}}setLineWidth(t){t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(t){this.ctx.lineCap=A5[t]}setLineJoin(t){this.ctx.lineJoin=C5[t]}setMiterLimit(t){this.ctx.miterLimit=t}setDash(t,e){const i=this.ctx;i.setLineDash!==void 0&&(i.setLineDash(t),i.lineDashOffset=e)}setRenderingIntent(t){}setFlatness(t){}setGState(t){for(const[e,i]of t)switch(e){case"LW":this.setLineWidth(i);break;case"LC":this.setLineCap(i);break;case"LJ":this.setLineJoin(i);break;case"ML":this.setMiterLimit(i);break;case"D":this.setDash(i[0],i[1]);break;case"RI":this.setRenderingIntent(i);break;case"FL":this.setFlatness(i);break;case"Font":this.setFont(i[0],i[1]);break;case"CA":this.current.strokeAlpha=i;break;case"ca":this.current.fillAlpha=i,this.ctx.globalAlpha=i;break;case"BM":this.ctx.globalCompositeOperation=i;break;case"SMask":this.current.activeSMask=i?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(i);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const t=this.ctx.canvas.width,e=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,s=this.cachedCanvases.getCanvas(i,t,e);this.suspendedCtx=this.ctx,this.ctx=s.context;const n=this.ctx;n.setTransform(...Me(this.suspendedCtx)),ai(this.suspendedCtx,n),E5(n,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),ai(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const e=this.current.activeSMask,i=this.suspendedCtx;this.composeSMask(i,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(t,e,i,s){const n=s[0],a=s[1],r=s[2]-n,o=s[3]-a;r===0||o===0||(this.genericComposeSMask(e.context,i,r,o,e.subtype,e.backdrop,e.transferMap,n,a,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(i.canvas,0,0),t.restore())}genericComposeSMask(t,e,i,s,n,a,r,o,l,c,h){let d=t.canvas,f=o-c,p=l-h;if(a){const v=ne.makeHexColor(...a);if(f<0||p<0||f+i>d.width||p+s>d.height){const w=this.cachedCanvases.getCanvas("maskExtension",i,s),S=w.context;S.drawImage(d,-f,-p),S.globalCompositeOperation="destination-atop",S.fillStyle=v,S.fillRect(0,0,i,s),S.globalCompositeOperation="source-over",d=w.canvas,f=p=0}else{t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);const w=new Path2D;w.rect(f,p,i,s),t.clip(w),t.globalCompositeOperation="destination-atop",t.fillStyle=v,t.fillRect(f,p,i,s),t.restore()}}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),n==="Alpha"&&r?e.filter=this.filterFactory.addAlphaFilter(r):n==="Luminosity"&&(e.filter=this.filterFactory.addLuminosityFilter(r));const m=new Path2D;m.rect(o,l,i,s),e.clip(m),e.globalCompositeOperation="destination-in",e.drawImage(d,f,p,i,s,o,l,i,s),e.restore()}save(){this.inSMaskMode?(ai(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const t=this.current;this.stateStack.push(t),this.current=t.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),ai(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(t,e,i,s,n,a){this.ctx.transform(t,e,i,s,n,a),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,i){const s=this.ctx,n=this.current;let a=n.x,r=n.y,o,l;const c=Me(s),h=c[0]===0&&c[3]===0||c[1]===0&&c[2]===0,d=h?i.slice(0):null;for(let f=0,p=0,m=t.length;f<m;f++)switch(t[f]|0){case ft.rectangle:a=e[p++],r=e[p++];const v=e[p++],w=e[p++],S=a+v,_=r+w;s.moveTo(a,r),v===0||w===0?s.lineTo(S,_):(s.lineTo(S,r),s.lineTo(S,_),s.lineTo(a,_)),h||n.updateRectMinMax(c,[a,r,S,_]),s.closePath();break;case ft.moveTo:a=e[p++],r=e[p++],s.moveTo(a,r),h||n.updatePathMinMax(c,a,r);break;case ft.lineTo:a=e[p++],r=e[p++],s.lineTo(a,r),h||n.updatePathMinMax(c,a,r);break;case ft.curveTo:o=a,l=r,a=e[p+4],r=e[p+5],s.bezierCurveTo(e[p],e[p+1],e[p+2],e[p+3],a,r),n.updateCurvePathMinMax(c,o,l,e[p],e[p+1],e[p+2],e[p+3],a,r,d),p+=6;break;case ft.curveTo2:o=a,l=r,s.bezierCurveTo(a,r,e[p],e[p+1],e[p+2],e[p+3]),n.updateCurvePathMinMax(c,o,l,a,r,e[p],e[p+1],e[p+2],e[p+3],d),a=e[p+2],r=e[p+3],p+=4;break;case ft.curveTo3:o=a,l=r,a=e[p+2],r=e[p+3],s.bezierCurveTo(e[p],e[p+1],a,r,a,r),n.updateCurvePathMinMax(c,o,l,e[p],e[p+1],a,r,a,r,d),p+=4;break;case ft.closePath:s.closePath();break}h&&n.updateScalingPathMinMax(c,d),n.setCurrentPoint(a,r)}closePath(){this.ctx.closePath()}stroke(t=!0){const e=this.ctx,i=this.current.strokeColor;e.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof i=="object"&&i?.getPattern?(e.save(),e.strokeStyle=i.getPattern(e,this,vt(e),$e.STROKE),this.rescaleAndStroke(!1),e.restore()):this.rescaleAndStroke(!0)),t&&this.consumePath(this.current.getClippedPathBoundingBox()),e.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(t=!0){const e=this.ctx,i=this.current.fillColor,s=this.current.patternFill;let n=!1;s&&(e.save(),e.fillStyle=i.getPattern(e,this,vt(e),$e.FILL),n=!0);const a=this.current.getClippedPathBoundingBox();this.contentVisible&&a!==null&&(this.pendingEOFill?(e.fill("evenodd"),this.pendingEOFill=!1):e.fill()),n&&e.restore(),t&&this.consumePath(a)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=P5}eoClip(){this.pendingClip=ir}beginText(){this.current.textMatrix=Fr,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const t=this.pendingTextPaths,e=this.ctx;if(t===void 0){e.beginPath();return}e.save(),e.beginPath();for(const i of t)e.setTransform(...i.transform),e.translate(i.x,i.y),i.addToPath(e,i.fontSize);e.restore(),e.clip(),e.beginPath(),delete this.pendingTextPaths}setCharSpacing(t){this.current.charSpacing=t}setWordSpacing(t){this.current.wordSpacing=t}setHScale(t){this.current.textHScale=t/100}setLeading(t){this.current.leading=-t}setFont(t,e){const i=this.commonObjs.get(t),s=this.current;if(!i)throw new Error(`Can't find font for ${t}`);if(s.fontMatrix=i.fontMatrix||Es,(s.fontMatrix[0]===0||s.fontMatrix[3]===0)&&pe("Invalid font matrix for font "+t),e<0?(e=-e,s.fontDirection=-1):s.fontDirection=1,this.current.font=i,this.current.fontSize=e,i.isType3Font)return;const n=i.loadedName||"sans-serif",a=i.systemFontInfo?.css||`"${n}", ${i.fallbackName}`;let r="normal";i.black?r="900":i.bold&&(r="bold");const o=i.italic?"italic":"normal";let l=e;e<Yn?l=Yn:e>Kn&&(l=Kn),this.current.fontSizeScale=e/l,this.ctx.font=`${o} ${r} ${l}px ${a}`}setTextRenderingMode(t){this.current.textRenderingMode=t}setTextRise(t){this.current.textRise=t}moveText(t,e){this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=e}setLeadingMoveText(t,e){this.setLeading(-e),this.moveText(t,e)}setTextMatrix(t,e,i,s,n,a){this.current.textMatrix=[t,e,i,s,n,a],this.current.textMatrixScale=Math.hypot(t,e),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(t,e,i,s){const n=this.ctx,a=this.current,r=a.font,o=a.textRenderingMode,l=a.fontSize/a.fontSizeScale,c=o&Ye.FILL_STROKE_MASK,h=!!(o&Ye.ADD_TO_PATH_FLAG),d=a.patternFill&&!r.missingFile;let f;(r.disableFontFace||h||d)&&(f=r.getPathGenerator(this.commonObjs,t)),r.disableFontFace||d?(n.save(),n.translate(e,i),n.beginPath(),f(n,l),s&&n.setTransform(...s),(c===Ye.FILL||c===Ye.FILL_STROKE)&&n.fill(),(c===Ye.STROKE||c===Ye.FILL_STROKE)&&n.stroke(),n.restore()):((c===Ye.FILL||c===Ye.FILL_STROKE)&&n.fillText(t,e,i),(c===Ye.STROKE||c===Ye.FILL_STROKE)&&n.strokeText(t,e,i)),h&&(this.pendingTextPaths||=[]).push({transform:Me(n),x:e,y:i,fontSize:l,addToPath:f})}get isFontSubpixelAAEnabled(){const{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1),t.fillText("I",0,10);const e=t.getImageData(0,0,10,10).data;let i=!1;for(let s=3;s<e.length;s+=4)if(e[s]>0&&e[s]<255){i=!0;break}return xe(this,"isFontSubpixelAAEnabled",i)}showText(t){const e=this.current,i=e.font;if(i.isType3Font)return this.showType3Text(t);const s=e.fontSize;if(s===0)return;const n=this.ctx,a=e.fontSizeScale,r=e.charSpacing,o=e.wordSpacing,l=e.fontDirection,c=e.textHScale*l,h=t.length,d=i.vertical,f=d?1:-1,p=i.defaultVMetrics,m=s*e.fontMatrix[0],v=e.textRenderingMode===Ye.FILL&&!i.disableFontFace&&!e.patternFill;n.save(),n.transform(...e.textMatrix),n.translate(e.x,e.y+e.textRise),l>0?n.scale(c,-1):n.scale(c,1);let w;if(e.patternFill){n.save();const k=e.fillColor.getPattern(n,this,vt(n),$e.FILL);w=Me(n),n.restore(),n.fillStyle=k}let S=e.lineWidth;const _=e.textMatrixScale;if(_===0||S===0){const k=e.textRenderingMode&Ye.FILL_STROKE_MASK;(k===Ye.STROKE||k===Ye.FILL_STROKE)&&(S=this.getSinglePixelWidth())}else S/=_;if(a!==1&&(n.scale(a,a),S/=a),n.lineWidth=S,i.isInvalidPDFjsFont){const k=[];let N=0;for(const O of t)k.push(O.unicode),N+=O.width;n.fillText(k.join(""),0,0),e.x+=N*m*c,n.restore(),this.compose();return}let A=0,P;for(P=0;P<h;++P){const k=t[P];if(typeof k=="number"){A+=f*k*s/1e3;continue}let N=!1;const O=(k.isSpace?o:0)+r,j=k.fontChar,U=k.accent;let G,R,D=k.width;if(d){const W=k.vmetric||p,z=-(k.vmetric?W[1]:D*.5)*m,B=W[2]*m;D=W?-W[0]:D,G=z/a,R=(A+B)/a}else G=A/a,R=0;if(i.remeasure&&D>0){const W=n.measureText(j).width*1e3/s*a;if(D<W&&this.isFontSubpixelAAEnabled){const z=D/W;N=!0,n.save(),n.scale(z,1),G/=z}else D!==W&&(G+=(D-W)/2e3*s/a)}if(this.contentVisible&&(k.isInFont||i.missingFile)){if(v&&!U)n.fillText(j,G,R);else if(this.paintChar(j,G,R,w),U){const W=G+s*U.offset.x/a,z=R-s*U.offset.y/a;this.paintChar(U.fontChar,W,z,w)}}const I=d?D*m-O*l:D*m+O*l;A+=I,N&&n.restore()}d?e.y-=A:e.x+=A*c,n.restore(),this.compose()}showType3Text(t){const e=this.ctx,i=this.current,s=i.font,n=i.fontSize,a=i.fontDirection,r=s.vertical?1:-1,o=i.charSpacing,l=i.wordSpacing,c=i.textHScale*a,h=i.fontMatrix||Es,d=t.length,f=i.textRenderingMode===Ye.INVISIBLE;let p,m,v,w;if(!(f||n===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,e.save(),e.transform(...i.textMatrix),e.translate(i.x,i.y),e.scale(c,a),p=0;p<d;++p){if(m=t[p],typeof m=="number"){w=r*m*n/1e3,this.ctx.translate(w,0),i.x+=w*c;continue}const S=(m.isSpace?l:0)+o,_=s.charProcOperatorList[m.operatorListId];if(!_){pe(`Type3 character "${m.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=m,this.save(),e.scale(n,n),e.transform(...h),this.executeOperatorList(_),this.restore()),v=ne.applyTransform([m.width,0],h)[0]*n+S,e.translate(v,0),i.x+=v*c}e.restore(),this.processingType3=null}}setCharWidth(t,e){}setCharWidthAndBounds(t,e,i,s,n,a){this.ctx.rect(i,s,n-i,a-s),this.ctx.clip(),this.endPath()}getColorN_Pattern(t){let e;if(t[0]==="TilingPattern"){const i=t[1],s=this.baseTransform||Me(this.ctx),n={createCanvasGraphics:a=>new Zt(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};e=new en(t,i,this.ctx,n,s)}else e=this._getPattern(t[1],t[2]);return e}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(t,e,i){this.ctx.strokeStyle=this.current.strokeColor=ne.makeHexColor(t,e,i)}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent"}setFillRGBColor(t,e,i){this.ctx.fillStyle=this.current.fillColor=ne.makeHexColor(t,e,i),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t,e=null){let i;return this.cachedPatterns.has(t)?i=this.cachedPatterns.get(t):(i=b5(this.getObject(t)),this.cachedPatterns.set(t,i)),e&&(i.matrix=e),i}shadingFill(t){if(!this.contentVisible)return;const e=this.ctx;this.save();const i=this._getPattern(t);e.fillStyle=i.getPattern(e,this,vt(e),$e.SHADING);const s=vt(e);if(s){const{width:n,height:a}=e.canvas,[r,o,l,c]=ne.getAxialAlignedBoundingBox([0,0,n,a],s);this.ctx.fillRect(r,o,l-r,c-o)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){ke("Should not call beginInlineImage")}beginImageData(){ke("Should not call beginImageData")}paintFormXObjectBegin(t,e){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),t&&this.transform(...t),this.baseTransform=Me(this.ctx),e)){const i=e[2]-e[0],s=e[3]-e[1];this.ctx.rect(e[0],e[1],i,s),this.current.updateRectMinMax(Me(this.ctx),e),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const e=this.ctx;t.isolated||Zi("TODO: Support non-isolated groups."),t.knockout&&pe("Knockout groups not supported.");const i=Me(e);if(t.matrix&&e.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let s=ne.getAxialAlignedBoundingBox(t.bbox,Me(e));const n=[0,0,e.canvas.width,e.canvas.height];s=ne.intersect(s,n)||[0,0,0,0];const a=Math.floor(s[0]),r=Math.floor(s[1]),o=Math.max(Math.ceil(s[2])-a,1),l=Math.max(Math.ceil(s[3])-r,1);this.current.startNewPathAndClipBox([0,0,o,l]);let c="groupAt"+this.groupLevel;t.smask&&(c+="_smask_"+this.smaskCounter++%2);const h=this.cachedCanvases.getCanvas(c,o,l),d=h.context;d.translate(-a,-r),d.transform(...i),t.smask?this.smaskStack.push({canvas:h.canvas,context:d,offsetX:a,offsetY:r,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}):(e.setTransform(1,0,0,1,0,0),e.translate(a,r),e.save()),ai(e,d),this.ctx=d,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(e),this.groupLevel++}endGroup(t){if(!this.contentVisible)return;this.groupLevel--;const e=this.ctx,i=this.groupStack.pop();if(this.ctx=i,this.ctx.imageSmoothingEnabled=!1,t.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const s=Me(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...s);const n=ne.getAxialAlignedBoundingBox([0,0,e.canvas.width,e.canvas.height],s);this.ctx.drawImage(e.canvas,0,0),this.ctx.restore(),this.compose(n)}}beginAnnotation(t,e,i,s,n){if(this.#e(),Pi(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),e){const a=e[2]-e[0],r=e[3]-e[1];if(n&&this.annotationCanvasMap){i=i.slice(),i[4]-=e[0],i[5]-=e[1],e=e.slice(),e[0]=e[1]=0,e[2]=a,e[3]=r;const[o,l]=ne.singularValueDecompose2dScale(Me(this.ctx)),{viewportScale:c}=this,h=Math.ceil(a*this.outputScaleX*c),d=Math.ceil(r*this.outputScaleY*c);this.annotationCanvas=this.canvasFactory.create(h,d);const{canvas:f,context:p}=this.annotationCanvas;this.annotationCanvasMap.set(t,f),this.annotationCanvas.savedCtx=this.ctx,this.ctx=p,this.ctx.save(),this.ctx.setTransform(o,0,0,-l,0,r*l),Pi(this.ctx)}else Pi(this.ctx),this.endPath(),this.ctx.rect(e[0],e[1],a,r),this.ctx.clip(),this.ctx.beginPath()}this.current=new Qn(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...i),this.transform(...s)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),this.#t(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t){if(!this.contentVisible)return;const e=t.count;t=this.getObject(t.data,t),t.count=e;const i=this.ctx,s=this.processingType3;if(s&&(s.compiled===void 0&&(s.compiled=_5(t)),s.compiled)){s.compiled(i);return}const n=this._createMaskCanvas(t),a=n.canvas;i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(a,n.offsetX,n.offsetY),i.restore(),this.compose()}paintImageMaskXObjectRepeat(t,e,i=0,s=0,n,a){if(!this.contentVisible)return;t=this.getObject(t.data,t);const r=this.ctx;r.save();const o=Me(r);r.transform(e,i,s,n,0,0);const l=this._createMaskCanvas(t);r.setTransform(1,0,0,1,l.offsetX-o[4],l.offsetY-o[5]);for(let c=0,h=a.length;c<h;c+=2){const d=ne.transform(o,[e,i,s,n,a[c],a[c+1]]),[f,p]=ne.applyTransform([0,0],d);r.drawImage(l.canvas,f,p)}r.restore(),this.compose()}paintImageMaskXObjectGroup(t){if(!this.contentVisible)return;const e=this.ctx,i=this.current.fillColor,s=this.current.patternFill;for(const n of t){const{data:a,width:r,height:o,transform:l}=n,c=this.cachedCanvases.getCanvas("maskCanvas",r,o),h=c.context;h.save();const d=this.getObject(a,n);er(h,d),h.globalCompositeOperation="source-in",h.fillStyle=s?i.getPattern(h,this,vt(e),$e.FILL):i,h.fillRect(0,0,r,o),h.restore(),e.save(),e.transform(...l),e.scale(1,-1),Ci(e,c.canvas,0,0,r,o,0,-1,1,1),e.restore()}this.compose()}paintImageXObject(t){if(!this.contentVisible)return;const e=this.getObject(t);if(!e){pe("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e)}paintImageXObjectRepeat(t,e,i,s){if(!this.contentVisible)return;const n=this.getObject(t);if(!n){pe("Dependent image isn't ready yet");return}const a=n.width,r=n.height,o=[];for(let l=0,c=s.length;l<c;l+=2)o.push({transform:[e,0,0,i,s[l],s[l+1]],x:0,y:0,w:a,h:r});this.paintInlineImageXObjectGroup(n,o)}applyTransferMapsToCanvas(t){return this.current.transferMaps!=="none"&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){if(this.current.transferMaps==="none")return t.bitmap;const{bitmap:e,width:i,height:s}=t,n=this.cachedCanvases.getCanvas("inlineImage",i,s),a=n.context;return a.filter=this.current.transferMaps,a.drawImage(e,0,0),a.filter="none",n.canvas}paintInlineImageXObject(t){if(!this.contentVisible)return;const e=t.width,i=t.height,s=this.ctx;if(this.save(),!Je){const{filter:r}=s;r!=="none"&&r!==""&&(s.filter="none")}s.scale(1/e,-1/i);let n;if(t.bitmap)n=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement=="function"&&t instanceof HTMLElement||!t.data)n=t;else{const o=this.cachedCanvases.getCanvas("inlineImage",e,i).context;$n(o,t),n=this.applyTransferMapsToCanvas(o)}const a=this._scaleImage(n,vt(s));s.imageSmoothingEnabled=tr(Me(s),t.interpolate),Ci(s,a.img,0,0,a.paintWidth,a.paintHeight,0,-i,e,i),this.compose(),this.restore()}paintInlineImageXObjectGroup(t,e){if(!this.contentVisible)return;const i=this.ctx;let s;if(t.bitmap)s=t.bitmap;else{const n=t.width,a=t.height,o=this.cachedCanvases.getCanvas("inlineImage",n,a).context;$n(o,t),s=this.applyTransferMapsToCanvas(o)}for(const n of e)i.save(),i.transform(...n.transform),i.scale(1,-1),Ci(i,s,n.x,n.y,n.w,n.h,0,-1,1,1),i.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t){}markPointProps(t,e){}beginMarkedContent(t){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e){t==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(e)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(t){const e=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(t);const i=this.ctx;this.pendingClip&&(e||(this.pendingClip===ir?i.clip("evenodd"):i.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),i.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const t=Me(this.ctx);if(t[1]===0&&t[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{const e=Math.abs(t[0]*t[3]-t[2]*t[1]),i=Math.hypot(t[0],t[2]),s=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(i,s)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:t}=this.current,{a:e,b:i,c:s,d:n}=this.ctx.getTransform();let a,r;if(i===0&&s===0){const o=Math.abs(e),l=Math.abs(n);if(o===l)if(t===0)a=r=1/o;else{const c=o*t;a=r=c<1?1/c:1}else if(t===0)a=1/o,r=1/l;else{const c=o*t,h=l*t;a=c<1?1/c:1,r=h<1?1/h:1}}else{const o=Math.abs(e*n-i*s),l=Math.hypot(e,i),c=Math.hypot(s,n);if(t===0)a=c/o,r=l/o;else{const h=t*o;a=c>h?c/h:1,r=l>h?l/h:1}}this._cachedScaleForStroking[0]=a,this._cachedScaleForStroking[1]=r}return this._cachedScaleForStroking}rescaleAndStroke(t){const{ctx:e}=this,{lineWidth:i}=this.current,[s,n]=this.getScaleForStroking();if(e.lineWidth=i||1,s===1&&n===1){e.stroke();return}const a=e.getLineDash();if(t&&e.save(),e.scale(s,n),a.length>0){const r=Math.max(s,n);e.setLineDash(a.map(o=>o/r)),e.lineDashOffset/=r}e.stroke(),t&&e.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}}for(const u in ft)Zt.prototype[u]!==void 0&&(Zt.prototype[ft[u]]=Zt.prototype[u]);class pi{static#e=null;static#t="";static get workerPort(){return this.#e}static set workerPort(t){if(!(typeof Worker<"u"&&t instanceof Worker)&&t!==null)throw new Error("Invalid `workerPort` type.");this.#e=t}static get workerSrc(){return this.#t}static set workerSrc(t){if(typeof t!="string")throw new Error("Invalid `workerSrc` type.");this.#t=t}}const Ri={DATA:1,ERROR:2},Oe={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function st(u){switch(u instanceof Error||typeof u=="object"&&u!==null||ke('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),u.name){case"AbortException":return new Bt(u.message);case"MissingPDFException":return new Ht(u.message);case"PasswordException":return new Ts(u.message,u.code);case"UnexpectedResponseException":return new Ji(u.message,u.status);case"UnknownErrorException":return new _s(u.message,u.details);default:return new _s(u.message,u.toString())}}class hi{#e=new AbortController;constructor(t,e,i){this.sourceName=t,this.targetName=e,this.comObj=i,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),i.addEventListener("message",this.#t.bind(this),{signal:this.#e.signal})}#t({data:t}){if(t.targetName!==this.sourceName)return;if(t.stream){this.#n(t);return}if(t.callback){const i=t.callbackId,s=this.callbackCapabilities[i];if(!s)throw new Error(`Cannot resolve callback ${i}`);if(delete this.callbackCapabilities[i],t.callback===Ri.DATA)s.resolve(t.data);else if(t.callback===Ri.ERROR)s.reject(st(t.reason));else throw new Error("Unexpected callback case");return}const e=this.actionHandler[t.action];if(!e)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){const i=this.sourceName,s=t.sourceName,n=this.comObj;new Promise(function(a){a(e(t.data))}).then(function(a){n.postMessage({sourceName:i,targetName:s,callback:Ri.DATA,callbackId:t.callbackId,data:a})},function(a){n.postMessage({sourceName:i,targetName:s,callback:Ri.ERROR,callbackId:t.callbackId,reason:st(a)})});return}if(t.streamId){this.#i(t);return}e(t.data)}on(t,e){const i=this.actionHandler;if(i[t])throw new Error(`There is already an actionName called "${t}"`);i[t]=e}send(t,e,i){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},i)}sendWithPromise(t,e,i){const s=this.callbackId++,n=Promise.withResolvers();this.callbackCapabilities[s]=n;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:s,data:e},i)}catch(a){n.reject(a)}return n.promise}sendWithStream(t,e,i,s){const n=this.streamId++,a=this.sourceName,r=this.targetName,o=this.comObj;return new ReadableStream({start:l=>{const c=Promise.withResolvers();return this.streamControllers[n]={controller:l,startCall:c,pullCall:null,cancelCall:null,isClosed:!1},o.postMessage({sourceName:a,targetName:r,action:t,streamId:n,data:e,desiredSize:l.desiredSize},s),c.promise},pull:l=>{const c=Promise.withResolvers();return this.streamControllers[n].pullCall=c,o.postMessage({sourceName:a,targetName:r,stream:Oe.PULL,streamId:n,desiredSize:l.desiredSize}),c.promise},cancel:l=>{ze(l instanceof Error,"cancel must have a valid reason");const c=Promise.withResolvers();return this.streamControllers[n].cancelCall=c,this.streamControllers[n].isClosed=!0,o.postMessage({sourceName:a,targetName:r,stream:Oe.CANCEL,streamId:n,reason:st(l)}),c.promise}},i)}#i(t){const e=t.streamId,i=this.sourceName,s=t.sourceName,n=this.comObj,a=this,r=this.actionHandler[t.action],o={enqueue(l,c=1,h){if(this.isCancelled)return;const d=this.desiredSize;this.desiredSize-=c,d>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),n.postMessage({sourceName:i,targetName:s,stream:Oe.ENQUEUE,streamId:e,chunk:l},h)},close(){this.isCancelled||(this.isCancelled=!0,n.postMessage({sourceName:i,targetName:s,stream:Oe.CLOSE,streamId:e}),delete a.streamSinks[e])},error(l){ze(l instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,n.postMessage({sourceName:i,targetName:s,stream:Oe.ERROR,streamId:e,reason:st(l)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};o.sinkCapability.resolve(),o.ready=o.sinkCapability.promise,this.streamSinks[e]=o,new Promise(function(l){l(r(t.data,o))}).then(function(){n.postMessage({sourceName:i,targetName:s,stream:Oe.START_COMPLETE,streamId:e,success:!0})},function(l){n.postMessage({sourceName:i,targetName:s,stream:Oe.START_COMPLETE,streamId:e,reason:st(l)})})}#n(t){const e=t.streamId,i=this.sourceName,s=t.sourceName,n=this.comObj,a=this.streamControllers[e],r=this.streamSinks[e];switch(t.stream){case Oe.START_COMPLETE:t.success?a.startCall.resolve():a.startCall.reject(st(t.reason));break;case Oe.PULL_COMPLETE:t.success?a.pullCall.resolve():a.pullCall.reject(st(t.reason));break;case Oe.PULL:if(!r){n.postMessage({sourceName:i,targetName:s,stream:Oe.PULL_COMPLETE,streamId:e,success:!0});break}r.desiredSize<=0&&t.desiredSize>0&&r.sinkCapability.resolve(),r.desiredSize=t.desiredSize,new Promise(function(o){o(r.onPull?.())}).then(function(){n.postMessage({sourceName:i,targetName:s,stream:Oe.PULL_COMPLETE,streamId:e,success:!0})},function(o){n.postMessage({sourceName:i,targetName:s,stream:Oe.PULL_COMPLETE,streamId:e,reason:st(o)})});break;case Oe.ENQUEUE:if(ze(a,"enqueue should have stream controller"),a.isClosed)break;a.controller.enqueue(t.chunk);break;case Oe.CLOSE:if(ze(a,"close should have stream controller"),a.isClosed)break;a.isClosed=!0,a.controller.close(),this.#r(a,e);break;case Oe.ERROR:ze(a,"error should have stream controller"),a.controller.error(st(t.reason)),this.#r(a,e);break;case Oe.CANCEL_COMPLETE:t.success?a.cancelCall.resolve():a.cancelCall.reject(st(t.reason)),this.#r(a,e);break;case Oe.CANCEL:if(!r)break;new Promise(function(o){o(r.onCancel?.(st(t.reason)))}).then(function(){n.postMessage({sourceName:i,targetName:s,stream:Oe.CANCEL_COMPLETE,streamId:e,success:!0})},function(o){n.postMessage({sourceName:i,targetName:s,stream:Oe.CANCEL_COMPLETE,streamId:e,reason:st(o)})}),r.sinkCapability.reject(st(t.reason)),r.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}}async#r(t,e){await Promise.allSettled([t.startCall?.promise,t.pullCall?.promise,t.cancelCall?.promise]),delete this.streamControllers[e]}destroy(){this.#e?.abort(),this.#e=null}}class R5{#e;#t;constructor({parsedData:t,rawData:e}){this.#e=t,this.#t=e}getRaw(){return this.#t}get(t){return this.#e.get(t)??null}getAll(){return Gs(this.#e)}has(t){return this.#e.has(t)}}const Wt=Symbol("INTERNAL");class L5{#e=!1;#t=!1;#i=!1;#n=!0;constructor(t,{name:e,intent:i,usage:s,rbGroups:n}){this.#e=!!(t&nt.DISPLAY),this.#t=!!(t&nt.PRINT),this.name=e,this.intent=i,this.usage=s,this.rbGroups=n}get visible(){if(this.#i)return this.#n;if(!this.#n)return!1;const{print:t,view:e}=this.usage;return this.#e?e?.viewState!=="OFF":this.#t?t?.printState!=="OFF":!0}_setVisible(t,e,i=!1){t!==Wt&&ke("Internal method `_setVisible` called."),this.#i=i,this.#n=e}}class D5{#e=null;#t=new Map;#i=null;#n=null;constructor(t,e=nt.DISPLAY){if(this.renderingIntent=e,this.name=null,this.creator=null,t!==null){this.name=t.name,this.creator=t.creator,this.#n=t.order;for(const i of t.groups)this.#t.set(i.id,new L5(e,i));if(t.baseState==="OFF")for(const i of this.#t.values())i._setVisible(Wt,!1);for(const i of t.on)this.#t.get(i)._setVisible(Wt,!0);for(const i of t.off)this.#t.get(i)._setVisible(Wt,!1);this.#i=this.getHash()}}#r(t){const e=t.length;if(e<2)return!0;const i=t[0];for(let s=1;s<e;s++){const n=t[s];let a;if(Array.isArray(n))a=this.#r(n);else if(this.#t.has(n))a=this.#t.get(n).visible;else return pe(`Optional content group not found: ${n}`),!0;switch(i){case"And":if(!a)return!1;break;case"Or":if(a)return!0;break;case"Not":return!a;default:return!0}}return i==="And"}isVisible(t){if(this.#t.size===0)return!0;if(!t)return Zi("Optional content group not defined."),!0;if(t.type==="OCG")return this.#t.has(t.id)?this.#t.get(t.id).visible:(pe(`Optional content group not found: ${t.id}`),!0);if(t.type==="OCMD"){if(t.expression)return this.#r(t.expression);if(!t.policy||t.policy==="AnyOn"){for(const e of t.ids){if(!this.#t.has(e))return pe(`Optional content group not found: ${e}`),!0;if(this.#t.get(e).visible)return!0}return!1}else if(t.policy==="AllOn"){for(const e of t.ids){if(!this.#t.has(e))return pe(`Optional content group not found: ${e}`),!0;if(!this.#t.get(e).visible)return!1}return!0}else if(t.policy==="AnyOff"){for(const e of t.ids){if(!this.#t.has(e))return pe(`Optional content group not found: ${e}`),!0;if(!this.#t.get(e).visible)return!0}return!1}else if(t.policy==="AllOff"){for(const e of t.ids){if(!this.#t.has(e))return pe(`Optional content group not found: ${e}`),!0;if(this.#t.get(e).visible)return!1}return!0}return pe(`Unknown optional content policy ${t.policy}.`),!0}return pe(`Unknown group type ${t.type}.`),!0}setVisibility(t,e=!0,i=!0){const s=this.#t.get(t);if(!s){pe(`Optional content group not found: ${t}`);return}if(i&&e&&s.rbGroups.length)for(const n of s.rbGroups)for(const a of n)a!==t&&this.#t.get(a)?._setVisible(Wt,!1,!0);s._setVisible(Wt,!!e,!0),this.#e=null}setOCGState({state:t,preserveRB:e}){let i;for(const s of t){switch(s){case"ON":case"OFF":case"Toggle":i=s;continue}const n=this.#t.get(s);if(n)switch(i){case"ON":this.setVisibility(s,!0,e);break;case"OFF":this.setVisibility(s,!1,e);break;case"Toggle":this.setVisibility(s,!n.visible,e);break}}this.#e=null}get hasInitialVisibility(){return this.#i===null||this.getHash()===this.#i}getOrder(){return this.#t.size?this.#n?this.#n.slice():[...this.#t.keys()]:null}getGroups(){return this.#t.size>0?Gs(this.#t):null}getGroup(t){return this.#t.get(t)||null}getHash(){if(this.#e!==null)return this.#e;const t=new Br;for(const[e,i]of this.#t)t.update(`${e}:${i.visible}`);return this.#e=t.hexdigest()}}class k5{constructor(t,{disableRange:e=!1,disableStream:i=!1}){ze(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:s,initialData:n,progressiveDone:a,contentDispositionFilename:r}=t;if(this._queuedChunks=[],this._progressiveDone=a,this._contentDispositionFilename=r,n?.length>0){const o=n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer;this._queuedChunks.push(o)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!i,this._isRangeSupported=!e,this._contentLength=s,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener((o,l)=>{this._onReceiveData({begin:o,chunk:l})}),t.addProgressListener((o,l)=>{this._onProgress({loaded:o,total:l})}),t.addProgressiveReadListener(o=>{this._onReceiveData({chunk:o})}),t.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),t.transportReady()}_onReceiveData({begin:t,chunk:e}){const i=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;if(t===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(i):this._queuedChunks.push(i);else{const s=this._rangeReaders.some(function(n){return n._begin!==t?!1:(n._enqueue(i),!0)});ze(s,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(t){t.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:t.loaded}):this._fullRequestReader?.onProgress?.({loaded:t.loaded,total:t.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){const e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}getFullReader(){ze(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const t=this._queuedChunks;return this._queuedChunks=null,new I5(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const i=new M5(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(i),i}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeReaders.slice(0))e.cancel(t);this._pdfDataRangeTransport.abort()}}class I5{constructor(t,e,i=!1,s=null){this._stream=t,this._done=i||!1,this._filename=Ys(s)?s:null,this._queuedChunks=e||[],this._loaded=0;for(const n of this._queuedChunks)this._loaded+=n.byteLength;this._requests=[],this._headersReady=Promise.resolve(),t._fullRequestReader=this,this.onProgress=null}_enqueue(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class M5{constructor(t,e,i){this._stream=t,this._begin=e,this._end=i,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(this._requests.length===0)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function N5(u){let t=!0,e=i("filename\\*","i").exec(u);if(e){e=e[1];let c=r(e);return c=unescape(c),c=o(c),c=l(c),n(c)}if(e=a(u),e){const c=l(e);return n(c)}if(e=i("filename","i").exec(u),e){e=e[1];let c=r(e);return c=l(c),n(c)}function i(c,h){return new RegExp("(?:^|;)\\s*"+c+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',h)}function s(c,h){if(c){if(!/^[\x00-\xFF]+$/.test(h))return h;try{const d=new TextDecoder(c,{fatal:!0}),f=Qi(h);h=d.decode(f),t=!1}catch{}}return h}function n(c){return t&&/[\x80-\xff]/.test(c)&&(c=s("utf-8",c),t&&(c=s("iso-8859-1",c))),c}function a(c){const h=[];let d;const f=i("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(d=f.exec(c))!==null;){let[,m,v,w]=d;if(m=parseInt(m,10),m in h){if(m===0)break;continue}h[m]=[v,w]}const p=[];for(let m=0;m<h.length&&m in h;++m){let[v,w]=h[m];w=r(w),v&&(w=unescape(w),m===0&&(w=o(w))),p.push(w)}return p.join("")}function r(c){if(c.startsWith('"')){const h=c.slice(1).split('\\"');for(let d=0;d<h.length;++d){const f=h[d].indexOf('"');f!==-1&&(h[d]=h[d].slice(0,f),h.length=d+1),h[d]=h[d].replaceAll(/\\(.)/g,"$1")}c=h.join('"')}return c}function o(c){const h=c.indexOf("'");if(h===-1)return c;const d=c.slice(0,h),p=c.slice(h+1).replace(/^[^']*'/,"");return s(d,p)}function l(c){return!c.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(c)?c:c.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(h,d,f,p){if(f==="q"||f==="Q")return p=p.replaceAll("_"," "),p=p.replaceAll(/=([0-9a-fA-F]{2})/g,function(m,v){return String.fromCharCode(parseInt(v,16))}),s(d,p);try{p=atob(p)}catch{}return s(d,p)})}return""}function tn(u,t){const e=new Headers;if(!u||!t||typeof t!="object")return e;for(const i in t){const s=t[i];s!==void 0&&e.append(i,s)}return e}function sn({responseHeaders:u,isHttp:t,rangeChunkSize:e,disableRange:i}){const s={allowRangeRequests:!1,suggestedLength:void 0},n=parseInt(u.get("Content-Length"),10);return!Number.isInteger(n)||(s.suggestedLength=n,n<=2*e)||i||!t||u.get("Accept-Ranges")!=="bytes"||(u.get("Content-Encoding")||"identity")!=="identity"||(s.allowRangeRequests=!0),s}function nn(u){const t=u.get("Content-Disposition");if(t){let e=N5(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if(Ys(e))return e}return null}function ts(u,t){return u===404||u===0&&t.startsWith("file:")?new Ht('Missing PDF "'+t+'".'):new Ji(`Unexpected server response (${u}) while retrieving PDF "${t}".`,u)}function Kr(u){return u===200||u===206}function Zr(u,t,e){return{method:"GET",headers:u,signal:e.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function Jr(u){return u instanceof Uint8Array?u.buffer:u instanceof ArrayBuffer?u:(pe(`getArrayBuffer - unexpected data format: ${u}`),new Uint8Array(u).buffer)}class sr{constructor(t){this.source=t,this.isHttp=/^https?:/i.test(t.url),this.headers=tn(this.isHttp,t.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return ze(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new F5(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const i=new O5(this,t,e);return this._rangeRequestReaders.push(i),i}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class F5{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null;const e=t.source;this._withCredentials=e.withCredentials||!1,this._contentLength=e.length,this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange;const i=new Headers(t.headers),s=e.url;fetch(s,Zr(i,this._withCredentials,this._abortController)).then(n=>{if(!Kr(n.status))throw ts(n.status,s);this._reader=n.body.getReader(),this._headersCapability.resolve();const a=n.headers,{allowRangeRequests:r,suggestedLength:o}=sn({responseHeaders:a,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=r,this._contentLength=o||this._contentLength,this._filename=nn(a),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Bt("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:Jr(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}class O5{constructor(t,e,i){this._stream=t,this._reader=null,this._loaded=0;const s=t.source;this._withCredentials=s.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!s.disableStream,this._abortController=new AbortController;const n=new Headers(t.headers);n.append("Range",`bytes=${e}-${i-1}`);const a=s.url;fetch(a,Zr(n,this._withCredentials,this._abortController)).then(r=>{if(!Kr(r.status))throw ts(r.status,a);this._readCapability.resolve(),this._reader=r.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded}),{value:Jr(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}const vs=200,ys=206;function j5(u){const t=u.response;return typeof t!="string"?t:Qi(t).buffer}class H5{constructor({url:t,httpHeaders:e,withCredentials:i}){this.url=t,this.isHttp=/^https?:/i.test(t),this.headers=tn(this.isHttp,e),this.withCredentials=i||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(t,e,i){const s={begin:t,end:e};for(const n in i)s[n]=i[n];return this.request(s)}requestFull(t){return this.request(t)}request(t){const e=new XMLHttpRequest,i=this.currXhrId++,s=this.pendingRequests[i]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const[n,a]of this.headers)e.setRequestHeader(n,a);return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),s.expectedStatus=ys):s.expectedStatus=vs,e.responseType="arraybuffer",t.onError&&(e.onerror=function(n){t.onError(e.status)}),e.onreadystatechange=this.onStateChange.bind(this,i),e.onprogress=this.onProgress.bind(this,i),s.onHeadersReceived=t.onHeadersReceived,s.onDone=t.onDone,s.onError=t.onError,s.onProgress=t.onProgress,e.send(null),i}onProgress(t,e){const i=this.pendingRequests[t];i&&i.onProgress?.(e)}onStateChange(t,e){const i=this.pendingRequests[t];if(!i)return;const s=i.xhr;if(s.readyState>=2&&i.onHeadersReceived&&(i.onHeadersReceived(),delete i.onHeadersReceived),s.readyState!==4||!(t in this.pendingRequests))return;if(delete this.pendingRequests[t],s.status===0&&this.isHttp){i.onError?.(s.status);return}const n=s.status||vs;if(!(n===vs&&i.expectedStatus===ys)&&n!==i.expectedStatus){i.onError?.(s.status);return}const r=j5(s);if(n===ys){const o=s.getResponseHeader("Content-Range"),l=/bytes (\d+)-(\d+)\/(\d+)/.exec(o);i.onDone({begin:parseInt(l[1],10),chunk:r})}else r?i.onDone({begin:0,chunk:r}):i.onError?.(s.status)}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){const e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}}class B5{constructor(t){this._source=t,this._manager=new H5(t),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){const e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return ze(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new z5(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){const i=new U5(this._manager,t,e);return i.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(i),i}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class z5{constructor(t,e){this._manager=t;const i={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=e.url,this._fullRequestId=t.requestFull(i),this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const t=this._fullRequestId,e=this._manager.getRequestXhr(t),i=new Headers(e.getAllResponseHeaders().trim().split(/[\r\n]+/).map(a=>{const[r,...o]=a.split(": ");return[r,o.join(": ")]})),{allowRangeRequests:s,suggestedLength:n}=sn({responseHeaders:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});s&&(this._isRangeSupported=!0),this._contentLength=n||this._contentLength,this._filename=nn(i),this._isRangeSupported&&this._manager.abortRequest(t),this._headersCapability.resolve()}_onDone(t){if(t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=ts(t,this._url),this._headersCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){this.onProgress?.({loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0,this._headersCapability.reject(t);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class U5{constructor(t,e,i){this._manager=t;const s={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=t.url,this._requestId=t.requestRange(e,i,s),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){this.onClosed?.(this)}_onDone(t){const e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){this._storedError=ts(t,this._url);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){this.isStreamingSupported||this.onProgress?.({loaded:t.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const V5=/^[a-z][a-z0-9\-+.]+:/i;function q5(u){if(V5.test(u))return new URL(u);const t=Rt.get("url");return new URL(t.pathToFileURL(u))}function Qr(u,t,e){return u.protocol==="http:"?Rt.get("http").request(u,{headers:t},e):Rt.get("https").request(u,{headers:t},e)}class G5{constructor(t){this.source=t,this.url=q5(t.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.headers=tn(this.isHttp,t.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return ze(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new Y5(this):new W5(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const i=this.isFsUrl?new K5(this,t,e):new X5(this,t,e);return this._rangeRequestReaders.push(i),i}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class $r{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;const e=t.source;this._contentLength=e.length,this._loaded=0,this._filename=null,this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers()}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Bt("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class eo{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const e=t.source;this._isStreamingSupported=!e.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}}class W5 extends $r{constructor(t){super(t);const e=Object.fromEntries(t.headers),i=s=>{if(s.statusCode===404){const o=new Ht(`Missing PDF "${this._url}".`);this._storedError=o,this._headersCapability.reject(o);return}this._headersCapability.resolve(),this._setReadableStream(s);const n=new Headers(this._readableStream.headers),{allowRangeRequests:a,suggestedLength:r}=sn({responseHeaders:n,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=r||this._contentLength,this._filename=nn(n)};this._request=Qr(this._url,e,i),this._request.on("error",s=>{this._storedError=s,this._headersCapability.reject(s)}),this._request.end()}}class X5 extends eo{constructor(t,e,i){super(t);const s=Object.fromEntries(t.headers);s.Range=`bytes=${e}-${i-1}`;const n=a=>{if(a.statusCode===404){const r=new Ht(`Missing PDF "${this._url}".`);this._storedError=r;return}this._setReadableStream(a)};this._request=Qr(this._url,s,n),this._request.on("error",a=>{this._storedError=a}),this._request.end()}}class Y5 extends $r{constructor(t){super(t);const e=Rt.get("fs");e.promises.lstat(this._url).then(i=>{this._contentLength=i.size,this._setReadableStream(e.createReadStream(this._url)),this._headersCapability.resolve()},i=>{i.code==="ENOENT"&&(i=new Ht(`Missing PDF "${this._url}".`)),this._storedError=i,this._headersCapability.reject(i)})}}class K5 extends eo{constructor(t,e,i){super(t);const s=Rt.get("fs");this._setReadableStream(s.createReadStream(this._url,{start:e,end:i-1}))}}const Z5=1e5,tt=30,J5=.8;let Ds=class at{#e=Promise.withResolvers();#t=null;#i=!1;#n=!!globalThis.FontInspector?.enabled;#r=null;#s=null;#l=0;#c=0;#h=null;#a=null;#u=0;#o=0;#d=Object.create(null);#p=[];#f=null;#v=[];#m=new WeakMap;#g=null;static#y=new Map;static#b=new Map;static#A=new WeakMap;static#E=null;static#T=new Set;constructor({textContentSource:t,container:e,viewport:i}){if(t instanceof ReadableStream)this.#f=t;else if(typeof t=="object")this.#f=new ReadableStream({start(o){o.enqueue(t),o.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#t=this.#a=e,this.#o=i.scale*(globalThis.devicePixelRatio||1),this.#u=i.rotation,this.#s={div:null,properties:null,ctx:null};const{pageWidth:s,pageHeight:n,pageX:a,pageY:r}=i.rawDims;this.#g=[1,0,0,-1,-a,r+n],this.#c=s,this.#l=n,at.#R(),Ft(e,i),this.#e.promise.finally(()=>{at.#T.delete(this),this.#s=null,this.#d=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:t,isFirefox:e}=et.platform;return xe(this,"fontFamilyMap",new Map([["sans-serif",`${t&&e?"Calibri, ":""}sans-serif`],["monospace",`${t&&e?"Lucida Console, ":""}monospace`]]))}render(){const t=()=>{this.#h.read().then(({value:e,done:i})=>{if(i){this.#e.resolve();return}this.#r??=e.lang,Object.assign(this.#d,e.styles),this.#N(e.items),t()},this.#e.reject)};return this.#h=this.#f.getReader(),at.#T.add(this),t(),this.#e.promise}update({viewport:t,onBefore:e=null}){const i=t.scale*(globalThis.devicePixelRatio||1),s=t.rotation;if(s!==this.#u&&(e?.(),this.#u=s,Ft(this.#a,{rotation:s})),i!==this.#o){e?.(),this.#o=i;const n={div:null,properties:null,ctx:at.#_(this.#r)};for(const a of this.#v)n.properties=this.#m.get(a),n.div=a,this.#x(n)}}cancel(){const t=new Bt("TextLayer task cancelled.");this.#h?.cancel(t).catch(()=>{}),this.#h=null,this.#e.reject(t)}get textDivs(){return this.#v}get textContentItemsStr(){return this.#p}#N(t){if(this.#i)return;this.#s.ctx??=at.#_(this.#r);const e=this.#v,i=this.#p;for(const s of t){if(e.length>Z5){pe("Ignoring additional textDivs for performance reasons."),this.#i=!0;return}if(s.str===void 0){if(s.type==="beginMarkedContentProps"||s.type==="beginMarkedContent"){const n=this.#t;this.#t=document.createElement("span"),this.#t.classList.add("markedContent"),s.id!==null&&this.#t.setAttribute("id",`${s.id}`),n.append(this.#t)}else s.type==="endMarkedContent"&&(this.#t=this.#t.parentNode);continue}i.push(s.str),this.#C(s)}}#C(t){const e=document.createElement("span"),i={angle:0,canvasWidth:0,hasText:t.str!=="",hasEOL:t.hasEOL,fontSize:0};this.#v.push(e);const s=ne.transform(this.#g,t.transform);let n=Math.atan2(s[1],s[0]);const a=this.#d[t.fontName];a.vertical&&(n+=Math.PI/2);let r=this.#n&&a.fontSubstitution||a.fontFamily;r=at.fontFamilyMap.get(r)||r;const o=Math.hypot(s[2],s[3]),l=o*at.#k(r,this.#r);let c,h;n===0?(c=s[4],h=s[5]-l):(c=s[4]+l*Math.sin(n),h=s[5]-l*Math.cos(n));const d="calc(var(--scale-factor)*",f=e.style;this.#t===this.#a?(f.left=`${(100*c/this.#c).toFixed(2)}%`,f.top=`${(100*h/this.#l).toFixed(2)}%`):(f.left=`${d}${c.toFixed(2)}px)`,f.top=`${d}${h.toFixed(2)}px)`),f.fontSize=`${d}${(at.#E*o).toFixed(2)}px)`,f.fontFamily=r,i.fontSize=o,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,this.#n&&(e.dataset.fontName=a.fontSubstitutionLoadedName||t.fontName),n!==0&&(i.angle=n*(180/Math.PI));let p=!1;if(t.str.length>1)p=!0;else if(t.str!==" "&&t.transform[0]!==t.transform[3]){const m=Math.abs(t.transform[0]),v=Math.abs(t.transform[3]);m!==v&&Math.max(m,v)/Math.min(m,v)>1.5&&(p=!0)}if(p&&(i.canvasWidth=a.vertical?t.height:t.width),this.#m.set(e,i),this.#s.div=e,this.#s.properties=i,this.#x(this.#s),i.hasText&&this.#t.append(e),i.hasEOL){const m=document.createElement("br");m.setAttribute("role","presentation"),this.#t.append(m)}}#x(t){const{div:e,properties:i,ctx:s}=t,{style:n}=e;let a="";if(at.#E>1&&(a=`scale(${1/at.#E})`),i.canvasWidth!==0&&i.hasText){const{fontFamily:r}=n,{canvasWidth:o,fontSize:l}=i;at.#P(s,l*this.#o,r);const{width:c}=s.measureText(e.textContent);c>0&&(a=`scaleX(${o*this.#o/c}) ${a}`)}i.angle!==0&&(a=`rotate(${i.angle}deg) ${a}`),a.length>0&&(n.transform=a)}static cleanup(){if(!(this.#T.size>0)){this.#y.clear();for(const{canvas:t}of this.#b.values())t.remove();this.#b.clear()}}static#_(t=null){let e=this.#b.get(t||="");if(!e){const i=document.createElement("canvas");i.className="hiddenCanvasElement",i.lang=t,document.body.append(i),e=i.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#b.set(t,e),this.#A.set(e,{size:0,family:""})}return e}static#P(t,e,i){const s=this.#A.get(t);e===s.size&&i===s.family||(t.font=`${e}px ${i}`,s.size=e,s.family=i)}static#R(){if(this.#E!==null)return;const t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),this.#E=t.getBoundingClientRect().height,t.remove()}static#k(t,e){const i=this.#y.get(t);if(i)return i;const s=this.#_(e);s.canvas.width=s.canvas.height=tt,this.#P(s,tt,t);const n=s.measureText("");let a=n.fontBoundingBoxAscent,r=Math.abs(n.fontBoundingBoxDescent);if(a){const c=a/(a+r);return this.#y.set(t,c),s.canvas.width=s.canvas.height=0,c}s.strokeStyle="red",s.clearRect(0,0,tt,tt),s.strokeText("g",0,0);let o=s.getImageData(0,0,tt,tt).data;r=0;for(let c=o.length-1-3;c>=0;c-=4)if(o[c]>0){r=Math.ceil(c/4/tt);break}s.clearRect(0,0,tt,tt),s.strokeText("A",0,tt),o=s.getImageData(0,0,tt,tt).data,a=0;for(let c=0,h=o.length;c<h;c+=4)if(o[c]>0){a=tt-Math.floor(c/4/tt);break}s.canvas.width=s.canvas.height=0;const l=a?a/(a+r):J5;return this.#y.set(t,l),l}};class mi{static textContent(t){const e=[],i={items:e,styles:Object.create(null)};function s(n){if(!n)return;let a=null;const r=n.name;if(r==="#text")a=n.value;else if(mi.shouldBuildText(r))n?.attributes?.textContent?a=n.attributes.textContent:n.value&&(a=n.value);else return;if(a!==null&&e.push({str:a}),!!n.children)for(const o of n.children)s(o)}return s(t),i}static shouldBuildText(t){return!(t==="textarea"||t==="input"||t==="option"||t==="select")}}const Q5=65536,$5=100,e8=5e3,t8=Je?f5:h5,i8=Je?p5:qr,s8=Je?d5:u5,n8=Je?g5:Xr;function r8(u={}){typeof u=="string"||u instanceof URL?u={url:u}:(u instanceof ArrayBuffer||ArrayBuffer.isView(u))&&(u={data:u});const t=new rn,{docId:e}=t,i=u.url?o8(u.url):null,s=u.data?a8(u.data):null,n=u.httpHeaders||null,a=u.withCredentials===!0,r=u.password??null,o=u.range instanceof to?u.range:null,l=Number.isInteger(u.rangeChunkSize)&&u.rangeChunkSize>0?u.rangeChunkSize:Q5;let c=u.worker instanceof Jt?u.worker:null;const h=u.verbosity,d=typeof u.docBaseUrl=="string"&&!es(u.docBaseUrl)?u.docBaseUrl:null,f=typeof u.cMapUrl=="string"?u.cMapUrl:null,p=u.cMapPacked!==!1,m=u.CMapReaderFactory||i8,v=typeof u.standardFontDataUrl=="string"?u.standardFontDataUrl:null,w=u.StandardFontDataFactory||n8,S=u.stopAtErrors!==!0,_=Number.isInteger(u.maxImageSize)&&u.maxImageSize>-1?u.maxImageSize:-1,A=u.isEvalSupported!==!1,P=typeof u.isOffscreenCanvasSupported=="boolean"?u.isOffscreenCanvasSupported:!Je,k=typeof u.isChrome=="boolean"?u.isChrome:!et.platform.isFirefox&&typeof window<"u"&&!!window?.chrome,N=Number.isInteger(u.canvasMaxAreaInBytes)?u.canvasMaxAreaInBytes:-1,O=typeof u.disableFontFace=="boolean"?u.disableFontFace:Je,j=u.fontExtraProperties===!0,U=u.enableXfa===!0,G=u.ownerDocument||globalThis.document,R=u.disableRange===!0,D=u.disableStream===!0,I=u.disableAutoFetch===!0,W=u.pdfBug===!0,z=u.CanvasFactory||t8,B=u.FilterFactory||s8,H=u.enableHWA===!0,$=o?o.length:u.length??NaN,J=typeof u.useSystemFonts=="boolean"?u.useSystemFonts:!Je&&!O,re=typeof u.useWorkerFetch=="boolean"?u.useWorkerFetch:m===qr&&w===Xr&&f&&v&&ci(f,document.baseURI)&&ci(v,document.baseURI);u.canvasFactory&&Gn("`canvasFactory`-instance option, please use `CanvasFactory` instead."),u.filterFactory&&Gn("`filterFactory`-instance option, please use `FilterFactory` instead.");const me=null;z3(h);const Q={canvasFactory:new z({ownerDocument:G,enableHWA:H}),filterFactory:new B({docId:e,ownerDocument:G}),cMapReaderFactory:re?null:new m({baseUrl:f,isCompressed:p}),standardFontDataFactory:re?null:new w({baseUrl:v})};if(!c){const ge={verbosity:h,port:pi.workerPort};c=ge.port?Jt.fromPort(ge):new Jt(ge),t._worker=c}const Te={docId:e,apiVersion:"4.8.69",data:s,password:r,disableAutoFetch:I,rangeChunkSize:l,length:$,docBaseUrl:d,enableXfa:U,evaluatorOptions:{maxImageSize:_,disableFontFace:O,ignoreErrors:S,isEvalSupported:A,isOffscreenCanvasSupported:P,isChrome:k,canvasMaxAreaInBytes:N,fontExtraProperties:j,useSystemFonts:J,cMapUrl:re?f:null,standardFontDataUrl:re?v:null}},Ae={disableFontFace:O,fontExtraProperties:j,ownerDocument:G,pdfBug:W,styleElement:me,loadingParams:{disableAutoFetch:I,enableXfa:U}};return c.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");if(c.destroyed)throw new Error("Worker was destroyed");const ge=c.messageHandler.sendWithPromise("GetDocRequest",Te,s?[s.buffer]:null);let ae;if(o)ae=new k5(o,{disableRange:R,disableStream:D});else if(!s){if(!i)throw new Error("getDocument - no `url` parameter provided.");let Re;Je?Re=typeof fetch<"u"&&typeof Response<"u"&&"body"in Response.prototype&&ci(i)?sr:G5:Re=ci(i)?sr:B5,ae=new Re({url:i,length:$,httpHeaders:n,withCredentials:a,rangeChunkSize:l,disableRange:R,disableStream:D})}return ge.then(Re=>{if(t.destroyed)throw new Error("Loading aborted");if(c.destroyed)throw new Error("Worker was destroyed");const Ce=new hi(e,Re,c.port),de=new u8(Ce,t,ae,Ae,Q);t._transport=de,Ce.send("Ready",null)})}).catch(t._capability.reject),t}function o8(u){if(u instanceof URL)return u.href;try{return new URL(u,window.location).href}catch{if(Je&&typeof u=="string")return u}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function a8(u){if(Je&&typeof Buffer<"u"&&u instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(u instanceof Uint8Array&&u.byteLength===u.buffer.byteLength)return u;if(typeof u=="string")return Qi(u);if(u instanceof ArrayBuffer||ArrayBuffer.isView(u)||typeof u=="object"&&!isNaN(u?.length))return new Uint8Array(u);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function nr(u){return typeof u=="object"&&Number.isInteger(u?.num)&&u.num>=0&&Number.isInteger(u?.gen)&&u.gen>=0}class rn{static#e=0;constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${rn.#e++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(t){throw this._worker?.port&&delete this._worker._pendingDestroy,t}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}}let to=class{constructor(t,e,i=!1,s=null){this.length=t,this.initialData=e,this.progressiveDone=i,this.contentDispositionFilename=s,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(t){this._rangeListeners.push(t)}addProgressListener(t){this._progressListeners.push(t)}addProgressiveReadListener(t){this._progressiveReadListeners.push(t)}addProgressiveDoneListener(t){this._progressiveDoneListeners.push(t)}onDataRange(t,e){for(const i of this._rangeListeners)i(t,e)}onDataProgress(t,e){this._readyCapability.promise.then(()=>{for(const i of this._progressListeners)i(t,e)})}onDataProgressiveRead(t){this._readyCapability.promise.then(()=>{for(const e of this._progressiveReadListeners)e(t)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const t of this._progressiveDoneListeners)t()})}transportReady(){this._readyCapability.resolve()}requestDataRange(t,e){ke("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}};class l8{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return xe(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class c8{#e=null;#t=!1;constructor(t,e,i,s=!1){this._pageIndex=t,this._pageInfo=e,this._transport=i,this._stats=s?new qn:null,this._pdfBug=s,this.commonObjs=i.commonObjs,this.objs=new io,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:i=0,offsetY:s=0,dontFlip:n=!1}={}){return new vi({viewBox:this.view,scale:t,rotation:e,offsetX:i,offsetY:s,dontFlip:n})}getAnnotations({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return xe(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:t,viewport:e,intent:i="display",annotationMode:s=Ct.ENABLE,transform:n=null,background:a=null,optionalContentConfigPromise:r=null,annotationCanvasMap:o=null,pageColors:l=null,printAnnotationStorage:c=null,isEditing:h=!1}){this._stats?.time("Overall");const d=this._transport.getRenderingIntent(i,s,c,h),{renderingIntent:f,cacheKey:p}=d;this.#t=!1,this.#n(),r||=this._transport.getOptionalContentConfig(f);let m=this._intentStates.get(p);m||(m=Object.create(null),this._intentStates.set(p,m)),m.streamReaderCancelTimeout&&(clearTimeout(m.streamReaderCancelTimeout),m.streamReaderCancelTimeout=null);const v=!!(f&nt.PRINT);m.displayReadyCapability||(m.displayReadyCapability=Promise.withResolvers(),m.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(d));const w=A=>{m.renderTasks.delete(S),(this._maybeCleanupAfterRender||v)&&(this.#t=!0),this.#i(!v),A?(S.capability.reject(A),this._abortOperatorList({intentState:m,reason:A instanceof Error?A:new Error(A)})):S.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},S=new Kt({callback:w,params:{canvasContext:t,viewport:e,transform:n,background:a},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:o,operatorList:m.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!v,pdfBug:this._pdfBug,pageColors:l});(m.renderTasks||=new Set).add(S);const _=S.task;return Promise.all([m.displayReadyCapability.promise,r]).then(([A,P])=>{if(this.destroyed){w();return}if(this._stats?.time("Rendering"),!(P.renderingIntent&f))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");S.initializeGraphics({transparency:A,optionalContentConfig:P}),S.operatorListChanged()}).catch(w),_}getOperatorList({intent:t="display",annotationMode:e=Ct.ENABLE,printAnnotationStorage:i=null,isEditing:s=!1}={}){function n(){r.operatorList.lastChunk&&(r.opListReadCapability.resolve(r.operatorList),r.renderTasks.delete(o))}const a=this._transport.getRenderingIntent(t,e,i,s,!0);let r=this._intentStates.get(a.cacheKey);r||(r=Object.create(null),this._intentStates.set(a.cacheKey,r));let o;return r.opListReadCapability||(o=Object.create(null),o.operatorListChanged=n,r.opListReadCapability=Promise.withResolvers(),(r.renderTasks||=new Set).add(o),r.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(a)),r.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===!0,disableNormalization:e===!0},{highWaterMark:100,size(s){return s.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(i=>mi.textContent(i));const e=this.streamTextContent(t);return new Promise(function(i,s){function n(){a.read().then(function({value:o,done:l}){if(l){i(r);return}r.lang??=o.lang,Object.assign(r.styles,o.styles),r.items.push(...o.items),n()},s)}const a=e.getReader(),r={items:[],styles:Object.create(null),lang:null};n()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const t=[];for(const e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(const i of e.renderTasks)t.push(i.completed),i.cancel();return this.objs.clear(),this.#t=!1,this.#n(),Promise.all(t)}cleanup(t=!1){this.#t=!0;const e=this.#i(!1);return t&&e&&(this._stats&&=new qn),e}#i(t=!1){if(this.#n(),!this.#t||this.destroyed)return!1;if(t)return this.#e=setTimeout(()=>{this.#e=null,this.#i(!1)},e8),!1;for(const{renderTasks:e,operatorList:i}of this._intentStates.values())if(e.size>0||!i.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#t=!1,!0}#n(){this.#e&&(clearTimeout(this.#e),this.#e=null)}_startRenderPage(t,e){const i=this._intentStates.get(e);i&&(this._stats?.timeEnd("Page Request"),i.displayReadyCapability?.resolve(t))}_renderPageChunk(t,e){for(let i=0,s=t.length;i<s;i++)e.operatorList.fnArray.push(t.fnArray[i]),e.operatorList.argsArray.push(t.argsArray[i]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(const i of e.renderTasks)i.operatorListChanged();t.lastChunk&&this.#i(!0)}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:i,modifiedIds:s}){const{map:n,transfer:a}=i,o=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:n,modifiedIds:s},a).getReader(),l=this._intentStates.get(e);l.streamReader=o;const c=()=>{o.read().then(({value:h,done:d})=>{if(d){l.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(h,l),c())},h=>{if(l.streamReader=null,!this._transport.destroyed){if(l.operatorList){l.operatorList.lastChunk=!0;for(const d of l.renderTasks)d.operatorListChanged();this.#i(!0)}if(l.displayReadyCapability)l.displayReadyCapability.reject(h);else if(l.opListReadCapability)l.opListReadCapability.reject(h);else throw h}})};c()}_abortOperatorList({intentState:t,reason:e,force:i=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!i){if(t.renderTasks.size>0)return;if(e instanceof Xs){let s=$5;e.extraDelay>0&&e.extraDelay<1e3&&(s+=e.extraDelay),t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:e,force:!0})},s);return}}if(t.streamReader.cancel(new Bt(e.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[s,n]of this._intentStates)if(n===t){this._intentStates.delete(s);break}this.cleanup()}}}get stats(){return this._stats}}class h8{#e=new Map;#t=Promise.resolve();postMessage(t,e){const i={data:structuredClone(t,e?{transfer:e}:null)};this.#t.then(()=>{for(const[s]of this.#e)s.call(this,i)})}addEventListener(t,e,i=null){let s=null;if(i?.signal instanceof AbortSignal){const{signal:n}=i;if(n.aborted){pe("LoopbackPort - cannot use an `aborted` signal.");return}const a=()=>this.removeEventListener(t,e);s=()=>n.removeEventListener("abort",a),n.addEventListener("abort",a)}this.#e.set(e,s)}removeEventListener(t,e){this.#e.get(e)?.(),this.#e.delete(e)}terminate(){for(const[,t]of this.#e)t?.();this.#e.clear()}}var Bi,It,Mt,ei,Ni,ti,Fi;const Ie=class Ie{constructor({name:t=null,port:e=null,verbosity:i=U3()}={}){Vt(this,ei);if(this.name=t,this.destroyed=!1,this.verbosity=i,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,e){if(ut(Ie,Mt)?.has(e))throw new Error("Cannot use more than one PDFWorker per port.");(ut(Ie,Mt)||ni(Ie,Mt,new WeakMap)).set(e,this),this._initializeFromPort(e);return}this._initialize()}get promise(){return Je?Promise.all([Rt.promise,this._readyCapability.promise]):this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(t){this._port=t,this._messageHandler=new hi("main","worker",t),this._messageHandler.on("ready",function(){}),xi(this,ei,Ni).call(this)}_initialize(){if(ut(Ie,It)||ut(Ie,ti,Fi)){this._setupFakeWorker();return}let{workerSrc:t}=Ie;try{Ie._isSameOrigin(window.location.href,t)||(t=Ie._createCDNWrapper(new URL(t,window.location).href));const e=new Worker(t,{type:"module"}),i=new hi("main","worker",e),s=()=>{n.abort(),i.destroy(),e.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},n=new AbortController;e.addEventListener("error",()=>{this._webWorker||s()},{signal:n.signal}),i.on("test",r=>{if(n.abort(),this.destroyed||!r){s();return}this._messageHandler=i,this._port=e,this._webWorker=e,xi(this,ei,Ni).call(this)}),i.on("ready",r=>{if(n.abort(),this.destroyed){s();return}try{a()}catch{this._setupFakeWorker()}});const a=()=>{const r=new Uint8Array;i.send("test",r,[r.buffer])};a();return}catch{Zi("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){ut(Ie,It)||(pe("Setting up fake worker."),ni(Ie,It,!0)),Ie._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const e=new h8;this._port=e;const i=`fake${pn(Ie,Bi)._++}`,s=new hi(i+"_worker",i,e);t.setup(s,e),this._messageHandler=new hi(i,i+"_worker",e),xi(this,ei,Ni).call(this)}).catch(t=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${t.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),ut(Ie,Mt)?.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(t){if(!t?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");const e=ut(this,Mt)?.get(t.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new Ie(t)}static get workerSrc(){if(pi.workerSrc)return pi.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return xe(this,"_setupFakeWorkerGlobal",(async()=>ut(this,ti,Fi)?ut(this,ti,Fi):(await import(this.workerSrc)).WorkerMessageHandler)())}};Bi=new WeakMap,It=new WeakMap,Mt=new WeakMap,ei=new WeakSet,Ni=function(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})},ti=new WeakSet,Fi=function(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}},Vt(Ie,ti),Vt(Ie,Bi,0),Vt(Ie,It,!1),Vt(Ie,Mt),Je&&(ni(Ie,It,!0),pi.workerSrc||="./pdf.worker.mjs"),Ie._isSameOrigin=(t,e)=>{let i;try{if(i=new URL(t),!i.origin||i.origin==="null")return!1}catch{return!1}const s=new URL(e,i);return i.origin===s.origin},Ie._createCDNWrapper=t=>{const e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))};let Jt=Ie;class u8{#e=new Map;#t=new Map;#i=new Map;#n=new Map;#r=null;constructor(t,e,i,s,n){this.messageHandler=t,this.loadingTask=e,this.commonObjs=new io,this.fontLoader=new l5({ownerDocument:s.ownerDocument,styleElement:s.styleElement}),this.loadingParams=s.loadingParams,this._params=s,this.canvasFactory=n.canvasFactory,this.filterFactory=n.filterFactory,this.cMapReaderFactory=n.cMapReaderFactory,this.standardFontDataFactory=n.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=i,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}#s(t,e=null){const i=this.#e.get(t);if(i)return i;const s=this.messageHandler.sendWithPromise(t,e);return this.#e.set(t,s),s}get annotationStorage(){return xe(this,"annotationStorage",new Qs)}getRenderingIntent(t,e=Ct.ENABLE,i=null,s=!1,n=!1){let a=nt.DISPLAY,r=Cs;switch(t){case"any":a=nt.ANY;break;case"display":break;case"print":a=nt.PRINT;break;default:pe(`getRenderingIntent - invalid intent: ${t}`)}const o=a&nt.PRINT&&i instanceof zr?i:this.annotationStorage;switch(e){case Ct.DISABLE:a+=nt.ANNOTATIONS_DISABLE;break;case Ct.ENABLE:break;case Ct.ENABLE_FORMS:a+=nt.ANNOTATIONS_FORMS;break;case Ct.ENABLE_STORAGE:a+=nt.ANNOTATIONS_STORAGE,r=o.serializable;break;default:pe(`getRenderingIntent - invalid annotationMode: ${e}`)}s&&(a+=nt.IS_EDITING),n&&(a+=nt.OPLIST);const{ids:l,hash:c}=o.modifiedIds,h=[a,r.hash,c];return{renderingIntent:a,cacheKey:h.join("_"),annotationStorageSerializable:r,modifiedIds:l}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#r?.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const i of this.#t.values())t.push(i._destroy());this.#t.clear(),this.#i.clear(),this.#n.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const e=this.messageHandler.sendWithPromise("Terminate",null);return t.push(e),Promise.all(t).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#e.clear(),this.filterFactory.destroy(),Ds.cleanup(),this._networkStream?.cancelAllRequests(new Bt("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(i,s)=>{ze(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=n=>{this._lastProgress={loaded:n.loaded,total:n.total}},s.onPull=()=>{this._fullReader.read().then(function({value:n,done:a}){if(a){s.close();return}ze(n instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(n),1,[n])}).catch(n=>{s.error(n)})},s.onCancel=n=>{this._fullReader.cancel(n),s.ready.catch(a=>{if(!this.destroyed)throw a})}}),t.on("ReaderHeadersReady",async i=>{await this._fullReader.headersReady;const{isStreamingSupported:s,isRangeSupported:n,contentLength:a}=this._fullReader;return(!s||!n)&&(this._lastProgress&&e.onProgress?.(this._lastProgress),this._fullReader.onProgress=r=>{e.onProgress?.({loaded:r.loaded,total:r.total})}),{isStreamingSupported:s,isRangeSupported:n,contentLength:a}}),t.on("GetRangeReader",(i,s)=>{ze(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const n=this._networkStream.getRangeReader(i.begin,i.end);if(!n){s.close();return}s.onPull=()=>{n.read().then(function({value:a,done:r}){if(r){s.close();return}ze(a instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(a),1,[a])}).catch(a=>{s.error(a)})},s.onCancel=a=>{n.cancel(a),s.ready.catch(r=>{if(!this.destroyed)throw r})}}),t.on("GetDoc",({pdfInfo:i})=>{this._numPages=i.numPages,this._htmlForXfa=i.htmlForXfa,delete i.htmlForXfa,e._capability.resolve(new l8(i,this))}),t.on("DocException",function(i){let s;switch(i.name){case"PasswordException":s=new Ts(i.message,i.code);break;case"InvalidPDFException":s=new Or(i.message);break;case"MissingPDFException":s=new Ht(i.message);break;case"UnexpectedResponseException":s=new Ji(i.message,i.status);break;case"UnknownErrorException":s=new _s(i.message,i.details);break;default:ke("DocException - expected a valid Error.")}e._capability.reject(s)}),t.on("PasswordRequest",i=>{if(this.#r=Promise.withResolvers(),e.onPassword){const s=n=>{n instanceof Error?this.#r.reject(n):this.#r.resolve({password:n})};try{e.onPassword(s,i.code)}catch(n){this.#r.reject(n)}}else this.#r.reject(new Ts(i.message,i.code));return this.#r.promise}),t.on("DataLoaded",i=>{e.onProgress?.({loaded:i.length,total:i.length}),this.downloadInfoCapability.resolve(i)}),t.on("StartRenderPage",i=>{if(this.destroyed)return;this.#t.get(i.pageIndex)._startRenderPage(i.transparency,i.cacheKey)}),t.on("commonobj",([i,s,n])=>{if(this.destroyed||this.commonObjs.has(i))return null;switch(s){case"Font":const{disableFontFace:a,fontExtraProperties:r,pdfBug:o}=this._params;if("error"in n){const d=n.error;pe(`Error during font loading: ${d}`),this.commonObjs.resolve(i,d);break}const l=o&&globalThis.FontInspector?.enabled?(d,f)=>globalThis.FontInspector.fontAdded(d,f):null,c=new c5(n,{disableFontFace:a,inspectFont:l});this.fontLoader.bind(c).catch(()=>t.sendWithPromise("FontFallback",{id:i})).finally(()=>{!r&&c.data&&(c.data=null),this.commonObjs.resolve(i,c)});break;case"CopyLocalImage":const{imageRef:h}=n;ze(h,"The imageRef must be defined.");for(const d of this.#t.values())for(const[,f]of d.objs)if(f?.ref===h)return f.dataLen?(this.commonObjs.resolve(i,structuredClone(f)),f.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(i,n);break;default:throw new Error(`Got unknown common object type ${s}`)}return null}),t.on("obj",([i,s,n,a])=>{if(this.destroyed)return;const r=this.#t.get(s);if(!r.objs.has(i)){if(r._intentStates.size===0){a?.bitmap?.close();return}switch(n){case"Image":r.objs.resolve(i,a),a?.dataLen>O3&&(r._maybeCleanupAfterRender=!0);break;case"Pattern":r.objs.resolve(i,a);break;default:throw new Error(`Got unknown object type ${n}`)}}}),t.on("DocProgress",i=>{this.destroyed||e.onProgress?.({loaded:i.loaded,total:i.total})}),t.on("FetchBuiltInCMap",async i=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.cMapReaderFactory)throw new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.");return this.cMapReaderFactory.fetch(i)}),t.on("FetchStandardFontData",async i=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.standardFontDataFactory)throw new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.");return this.standardFontDataFactory.fetch(i)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&pe("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:this._fullReader?.filename??null},e).finally(()=>{this.annotationStorage.resetModified()})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const e=t-1,i=this.#i.get(e);if(i)return i;const s=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(n=>{if(this.destroyed)throw new Error("Transport destroyed");n.refStr&&this.#n.set(n.refStr,t);const a=new c8(e,n,this,this._params.pdfBug);return this.#t.set(e,a),a});return this.#i.set(e,s),s}getPageIndex(t){return nr(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return this.#s("GetFieldObjects")}hasJSActions(){return this.#s("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#s("GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return this.#s("GetOptionalContentConfig").then(e=>new D5(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",e=this.#e.get(t);if(e)return e;const i=this.messageHandler.sendWithPromise(t,null).then(s=>({info:s[0],metadata:s[1]?new R5(s[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#e.set(t,i),i}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const e of this.#t.values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),this.#e.clear(),this.filterFactory.destroy(!0),Ds.cleanup()}}cachedPageNumber(t){if(!nr(t))return null;const e=t.gen===0?`${t.num}R`:`${t.num}R${t.gen}`;return this.#n.get(e)??null}}const Li=Symbol("INITIAL_DATA");class io{#e=Object.create(null);#t(t){return this.#e[t]||={...Promise.withResolvers(),data:Li}}get(t,e=null){if(e){const s=this.#t(t);return s.promise.then(()=>e(s.data)),null}const i=this.#e[t];if(!i||i.data===Li)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return i.data}has(t){const e=this.#e[t];return!!e&&e.data!==Li}resolve(t,e=null){const i=this.#t(t);i.data=e,i.resolve()}clear(){for(const t in this.#e){const{data:e}=this.#e[t];e?.bitmap?.close()}this.#e=Object.create(null)}*[Symbol.iterator](){for(const t in this.#e){const{data:e}=this.#e[t];e!==Li&&(yield[t,e])}}}class d8{#e=null;constructor(t){this.#e=t,this.onContinue=null}get promise(){return this.#e.capability.promise}cancel(t=0){this.#e.cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=this.#e.operatorList;if(!t)return!1;const{annotationCanvasMap:e}=this.#e;return t.form||t.canvas&&e?.size>0}}class Kt{#e=null;static#t=new WeakSet;constructor({callback:t,params:e,objs:i,commonObjs:s,annotationCanvasMap:n,operatorList:a,pageIndex:r,canvasFactory:o,filterFactory:l,useRequestAnimationFrame:c=!1,pdfBug:h=!1,pageColors:d=null}){this.callback=t,this.params=e,this.objs=i,this.commonObjs=s,this.annotationCanvasMap=n,this.operatorListIdx=null,this.operatorList=a,this._pageIndex=r,this.canvasFactory=o,this.filterFactory=l,this._pdfBug=h,this.pageColors=d,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=c===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new d8(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){if(this.cancelled)return;if(this._canvas){if(Kt.#t.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");Kt.#t.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:i,viewport:s,transform:n,background:a}=this.params;this.gfx=new Zt(i,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:n,viewport:s,transparency:t,background:a}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(t=null,e=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#e&&(window.cancelAnimationFrame(this.#e),this.#e=null),Kt.#t.delete(this._canvas),this.callback(t||new Xs(`Rendering cancelled, page ${this._pageIndex+1}`,e))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#e=window.requestAnimationFrame(()=>{this.#e=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),Kt.#t.delete(this._canvas),this.callback())))}}const f8="4.8.69",p8="3634dab10";function rr(u){return Math.floor(Math.max(0,Math.min(1,u))*255).toString(16).padStart(2,"0")}function li(u){return Math.max(0,Math.min(255,255*u))}class or{static CMYK_G([t,e,i,s]){return["G",1-Math.min(1,.3*t+.59*i+.11*e+s)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return t=li(t),[t,t,t]}static G_HTML([t]){const e=rr(t);return`#${e}${e}${e}`}static RGB_G([t,e,i]){return["G",.3*t+.59*e+.11*i]}static RGB_rgb(t){return t.map(li)}static RGB_HTML(t){return`#${t.map(rr).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,i,s]){return["RGB",1-Math.min(1,t+s),1-Math.min(1,i+s),1-Math.min(1,e+s)]}static CMYK_rgb([t,e,i,s]){return[li(1-Math.min(1,t+s)),li(1-Math.min(1,i+s)),li(1-Math.min(1,e+s))]}static CMYK_HTML(t){const e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK([t,e,i]){const s=1-t,n=1-e,a=1-i,r=Math.min(s,n,a);return["CMYK",s,n,a,r]}}class g8{create(t,e,i=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");const s=this._createSVG("svg:svg");return s.setAttribute("version","1.1"),i||(s.setAttribute("width",`${t}px`),s.setAttribute("height",`${e}px`)),s.setAttribute("preserveAspectRatio","none"),s.setAttribute("viewBox",`0 0 ${t} ${e}`),s}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){ke("Abstract method `_createSVG` called.")}}class on extends g8{_createSVG(t){return document.createElementNS(yt,t)}}class so{static setupStorage(t,e,i,s,n){const a=s.getValue(e,{value:null});switch(i.name){case"textarea":if(a.value!==null&&(t.textContent=a.value),n==="print")break;t.addEventListener("input",r=>{s.setValue(e,{value:r.target.value})});break;case"input":if(i.attributes.type==="radio"||i.attributes.type==="checkbox"){if(a.value===i.attributes.xfaOn?t.setAttribute("checked",!0):a.value===i.attributes.xfaOff&&t.removeAttribute("checked"),n==="print")break;t.addEventListener("change",r=>{s.setValue(e,{value:r.target.checked?r.target.getAttribute("xfaOn"):r.target.getAttribute("xfaOff")})})}else{if(a.value!==null&&t.setAttribute("value",a.value),n==="print")break;t.addEventListener("input",r=>{s.setValue(e,{value:r.target.value})})}break;case"select":if(a.value!==null){t.setAttribute("value",a.value);for(const r of i.children)r.attributes.value===a.value?r.attributes.selected=!0:r.attributes.hasOwnProperty("selected")&&delete r.attributes.selected}t.addEventListener("input",r=>{const o=r.target.options,l=o.selectedIndex===-1?"":o[o.selectedIndex].value;s.setValue(e,{value:l})});break}}static setAttributes({html:t,element:e,storage:i=null,intent:s,linkService:n}){const{attributes:a}=e,r=t instanceof HTMLAnchorElement;a.type==="radio"&&(a.name=`${a.name}-${s}`);for(const[o,l]of Object.entries(a))if(l!=null)switch(o){case"class":l.length&&t.setAttribute(o,l.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",l);break;case"style":Object.assign(t.style,l);break;case"textContent":t.textContent=l;break;default:(!r||o!=="href"&&o!=="newWindow")&&t.setAttribute(o,l)}r&&n.addLinkAttributes(t,a.href,a.newWindow),i&&a.dataId&&this.setupStorage(t,a.dataId,e,i)}static render(t){const e=t.annotationStorage,i=t.linkService,s=t.xfaHtml,n=t.intent||"display",a=document.createElement(s.name);s.attributes&&this.setAttributes({html:a,element:s,intent:n,linkService:i});const r=n!=="richText",o=t.div;if(o.append(a),t.viewport){const h=`matrix(${t.viewport.transform.join(",")})`;o.style.transform=h}r&&o.setAttribute("class","xfaLayer xfaFont");const l=[];if(s.children.length===0){if(s.value){const h=document.createTextNode(s.value);a.append(h),r&&mi.shouldBuildText(s.name)&&l.push(h)}return{textDivs:l}}const c=[[s,-1,a]];for(;c.length>0;){const[h,d,f]=c.at(-1);if(d+1===h.children.length){c.pop();continue}const p=h.children[++c.at(-1)[1]];if(p===null)continue;const{name:m}=p;if(m==="#text"){const w=document.createTextNode(p.value);l.push(w),f.append(w);continue}const v=p?.attributes?.xmlns?document.createElementNS(p.attributes.xmlns,m):document.createElement(m);if(f.append(v),p.attributes&&this.setAttributes({html:v,element:p,storage:e,intent:n,linkService:i}),p.children?.length>0)c.push([p,-1,v]);else if(p.value){const w=document.createTextNode(p.value);r&&mi.shouldBuildText(m)&&l.push(w),v.append(w)}}for(const h of o.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))h.setAttribute("readOnly",!0);return{textDivs:l}}static update(t){const e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}}const wi=1e3,m8=9,Ot=new WeakSet;function St(u){return{width:u[2]-u[0],height:u[3]-u[1]}}class v8{static create(t){switch(t.data.annotationType){case He.LINK:return new no(t);case He.TEXT:return new y8(t);case He.WIDGET:switch(t.data.fieldType){case"Tx":return new w8(t);case"Btn":return t.data.radioButton?new ro(t):t.data.checkBox?new x8(t):new S8(t);case"Ch":return new E8(t);case"Sig":return new b8(t)}return new zt(t);case He.POPUP:return new ks(t);case He.FREETEXT:return new oo(t);case He.LINE:return new _8(t);case He.SQUARE:return new A8(t);case He.CIRCLE:return new C8(t);case He.POLYLINE:return new ao(t);case He.CARET:return new R8(t);case He.INK:return new an(t);case He.POLYGON:return new P8(t);case He.HIGHLIGHT:return new lo(t);case He.UNDERLINE:return new L8(t);case He.SQUIGGLY:return new D8(t);case He.STRIKEOUT:return new k8(t);case He.STAMP:return new co(t);case He.FILEATTACHMENT:return new I8(t);default:return new Fe(t)}}}class Fe{#e=null;#t=!1;#i=null;constructor(t,{isRenderable:e=!1,ignoreBorder:i=!1,createQuadrilaterals:s=!1}={}){this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,e&&(this.container=this._createContainer(i)),s&&this._createQuadrilaterals()}static _hasPopupData({titleObj:t,contentsObj:e,richText:i}){return!!(t?.str||e?.str||i?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return Fe._hasPopupData(this.data)}updateEdited(t){if(!this.container)return;this.#e||={rect:this.data.rect.slice(0)};const{rect:e}=t;e&&this.#n(e),this.#i?.popup.updateEdited(t)}resetEdited(){this.#e&&(this.#n(this.#e.rect),this.#i?.popup.resetEdited(),this.#e=null)}#n(t){const{container:{style:e},data:{rect:i,rotation:s},parent:{viewport:{rawDims:{pageWidth:n,pageHeight:a,pageX:r,pageY:o}}}}=this;i?.splice(0,4,...t);const{width:l,height:c}=St(t);e.left=`${100*(t[0]-r)/n}%`,e.top=`${100*(a-t[3]+o)/a}%`,s===0?(e.width=`${100*l/n}%`,e.height=`${100*c/a}%`):this.setRotation(s)}_createContainer(t){const{data:e,parent:{page:i,viewport:s}}=this,n=document.createElement("section");n.setAttribute("data-annotation-id",e.id),this instanceof zt||(n.tabIndex=wi);const{style:a}=n;if(a.zIndex=this.parent.zIndex++,e.alternativeText&&(n.title=e.alternativeText),e.noRotate&&n.classList.add("norotate"),!e.rect||this instanceof ks){const{rotation:m}=e;return!e.hasOwnCanvas&&m!==0&&this.setRotation(m,n),n}const{width:r,height:o}=St(e.rect);if(!t&&e.borderStyle.width>0){a.borderWidth=`${e.borderStyle.width}px`;const m=e.borderStyle.horizontalCornerRadius,v=e.borderStyle.verticalCornerRadius;if(m>0||v>0){const S=`calc(${m}px * var(--scale-factor)) / calc(${v}px * var(--scale-factor))`;a.borderRadius=S}else if(this instanceof ro){const S=`calc(${r}px * var(--scale-factor)) / calc(${o}px * var(--scale-factor))`;a.borderRadius=S}switch(e.borderStyle.style){case oi.SOLID:a.borderStyle="solid";break;case oi.DASHED:a.borderStyle="dashed";break;case oi.BEVELED:pe("Unimplemented border style: beveled");break;case oi.INSET:pe("Unimplemented border style: inset");break;case oi.UNDERLINE:a.borderBottomStyle="solid";break}const w=e.borderColor||null;w?(this.#t=!0,a.borderColor=ne.makeHexColor(w[0]|0,w[1]|0,w[2]|0)):a.borderWidth=0}const l=ne.normalizeRect([e.rect[0],i.view[3]-e.rect[1]+i.view[1],e.rect[2],i.view[3]-e.rect[3]+i.view[1]]),{pageWidth:c,pageHeight:h,pageX:d,pageY:f}=s.rawDims;a.left=`${100*(l[0]-d)/c}%`,a.top=`${100*(l[1]-f)/h}%`;const{rotation:p}=e;return e.hasOwnCanvas||p===0?(a.width=`${100*r/c}%`,a.height=`${100*o/h}%`):this.setRotation(p,n),n}setRotation(t,e=this.container){if(!this.data.rect)return;const{pageWidth:i,pageHeight:s}=this.parent.viewport.rawDims,{width:n,height:a}=St(this.data.rect);let r,o;t%180===0?(r=100*n/i,o=100*a/s):(r=100*a/i,o=100*n/s),e.style.width=`${r}%`,e.style.height=`${o}%`,e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){const t=(e,i,s)=>{const n=s.detail[e],a=n[0],r=n.slice(1);s.target.style[i]=or[`${a}_HTML`](r),this.annotationStorage.setValue(this.data.id,{[i]:or[`${a}_rgb`](r)})};return xe(this,"_commonActions",{display:e=>{const{display:i}=e.detail,s=i%2===1;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:s,noPrint:i===1||i===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:i}=e.detail;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:i,noView:i})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:e=>{const i=e.detail.rotation;this.setRotation(i),this.annotationStorage.setValue(this.data.id,{rotation:i})}})}_dispatchEventFromSandbox(t,e){const i=this._commonActions;for(const s of Object.keys(e.detail))(t[s]||i[s])?.(e)}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const i=this._commonActions;for(const[s,n]of Object.entries(e)){const a=i[s];if(a){const r={detail:{[s]:n},target:t};a(r),delete e[s]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:t}=this.data;if(!t)return;const[e,i,s,n]=this.data.rect.map(m=>Math.fround(m));if(t.length===8){const[m,v,w,S]=t.subarray(2,6);if(s===m&&n===v&&e===w&&i===S)return}const{style:a}=this.container;let r;if(this.#t){const{borderColor:m,borderWidth:v}=a;a.borderWidth=0,r=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${m}" stroke-width="${v}">`],this.container.classList.add("hasBorder")}const o=s-e,l=n-i,{svgFactory:c}=this,h=c.createElement("svg");h.classList.add("quadrilateralsContainer"),h.setAttribute("width",0),h.setAttribute("height",0);const d=c.createElement("defs");h.append(d);const f=c.createElement("clipPath"),p=`clippath_${this.data.id}`;f.setAttribute("id",p),f.setAttribute("clipPathUnits","objectBoundingBox"),d.append(f);for(let m=2,v=t.length;m<v;m+=8){const w=t[m],S=t[m+1],_=t[m+2],A=t[m+3],P=c.createElement("rect"),k=(_-e)/o,N=(n-S)/l,O=(w-_)/o,j=(S-A)/l;P.setAttribute("x",k),P.setAttribute("y",N),P.setAttribute("width",O),P.setAttribute("height",j),f.append(P),r?.push(`<rect vector-effect="non-scaling-stroke" x="${k}" y="${N}" width="${O}" height="${j}"/>`)}this.#t&&(r.push("</g></svg>')"),a.backgroundImage=r.join("")),this.container.append(h),this.container.style.clipPath=`url(#${p})`}_createPopup(){const{data:t}=this,e=this.#i=new ks({data:{color:t.color,titleObj:t.titleObj,modificationDate:t.modificationDate,contentsObj:t.contentsObj,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation},parent:this.parent,elements:[this]});this.parent.div.append(e.render())}render(){ke("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){const i=[];if(this._fieldObjects){const s=this._fieldObjects[t];if(s)for(const{page:n,id:a,exportValues:r}of s){if(n===-1||a===e)continue;const o=typeof r=="string"?r:null,l=document.querySelector(`[data-element-id="${a}"]`);if(l&&!Ot.has(l)){pe(`_getElementsByName - element not allowed: ${a}`);continue}i.push({id:a,exportValue:o,domElement:l})}return i}for(const s of document.getElementsByName(t)){const{exportValue:n}=s,a=s.getAttribute("data-element-id");a!==e&&Ot.has(s)&&i.push({id:a,exportValue:n,domElement:s})}return i}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(const e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e})})}}class no extends Fe{constructor(t,e=null){super(t,{isRenderable:!0,ignoreBorder:!!e?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:e}=this,i=document.createElement("a");i.setAttribute("data-element-id",t.id);let s=!1;return t.url?(e.addLinkAttributes(i,t.url,t.newWindow),s=!0):t.action?(this._bindNamedAction(i,t.action),s=!0):t.attachment?(this.#t(i,t.attachment,t.attachmentDest),s=!0):t.setOCGState?(this.#i(i,t.setOCGState),s=!0):t.dest?(this._bindLink(i,t.dest),s=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,t),s=!0),t.resetForm?(this._bindResetFormAction(i,t.resetForm),s=!0):this.isTooltipOnly&&!s&&(this._bindLink(i,""),s=!0)),this.container.classList.add("linkAnnotation"),s&&this.container.append(i),this.container}#e(){this.container.setAttribute("data-internal-link","")}_bindLink(t,e){t.href=this.linkService.getDestinationHash(e),t.onclick=()=>(e&&this.linkService.goToDestination(e),!1),(e||e==="")&&this.#e()}_bindNamedAction(t,e){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(e),!1),this.#e()}#t(t,e,i=null){t.href=this.linkService.getAnchorUrl(""),e.description&&(t.title=e.description),t.onclick=()=>(this.downloadManager?.openOrDownloadData(e.content,e.filename,i),!1),this.#e()}#i(t,e){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(e),!1),this.#e()}_bindJSAction(t,e){t.href=this.linkService.getAnchorUrl("");const i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const s of Object.keys(e.actions)){const n=i.get(s);n&&(t[n]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e.id,name:s}}),!1))}t.onclick||(t.onclick=()=>!1),this.#e()}_bindResetFormAction(t,e){const i=t.onclick;if(i||(t.href=this.linkService.getAnchorUrl("")),this.#e(),!this._fieldObjects){pe('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),i||(t.onclick=()=>!1);return}t.onclick=()=>{i?.();const{fields:s,refs:n,include:a}=e,r=[];if(s.length!==0||n.length!==0){const c=new Set(n);for(const h of s){const d=this._fieldObjects[h]||[];for(const{id:f}of d)c.add(f)}for(const h of Object.values(this._fieldObjects))for(const d of h)c.has(d.id)===a&&r.push(d)}else for(const c of Object.values(this._fieldObjects))r.push(...c);const o=this.annotationStorage,l=[];for(const c of r){const{id:h}=c;switch(l.push(h),c.type){case"text":{const f=c.defaultValue||"";o.setValue(h,{value:f});break}case"checkbox":case"radiobutton":{const f=c.defaultValue===c.exportValues;o.setValue(h,{value:f});break}case"combobox":case"listbox":{const f=c.defaultValue||"";o.setValue(h,{value:f});break}default:continue}const d=document.querySelector(`[data-element-id="${h}"]`);if(d){if(!Ot.has(d)){pe(`_bindResetFormAction - element not allowed: ${h}`);continue}}else continue;d.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:l,name:"ResetForm"}}),!1}}}class y8 extends Fe{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(t),this.container}}class zt extends Fe{render(){return this.container}showElementAndHideCanvas(t){this.data.hasOwnCanvas&&(t.previousSibling?.nodeName==="CANVAS"&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return et.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,i,s,n){i.includes("mouse")?t.addEventListener(i,a=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:n(a),shift:a.shiftKey,modifier:this._getKeyModifier(a)}})}):t.addEventListener(i,a=>{if(i==="blur"){if(!e.focused||!a.relatedTarget)return;e.focused=!1}else if(i==="focus"){if(e.focused)return;e.focused=!0}n&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:n(a)}})})}_setEventListeners(t,e,i,s){for(const[n,a]of i)(a==="Action"||this.data.actions?.[a])&&((a==="Focus"||a==="Blur")&&(e||={focused:!1}),this._setEventListener(t,e,n,a,s),a==="Focus"&&!this.data.actions?.Blur?this._setEventListener(t,e,"blur","Blur",null):a==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(t,e,"focus","Focus",null))}_setBackgroundColor(t){const e=this.data.backgroundColor||null;t.style.backgroundColor=e===null?"transparent":ne.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){const e=["left","center","right"],{fontColor:i}=this.data.defaultAppearanceData,s=this.data.defaultAppearanceData.fontSize||m8,n=t.style;let a;const r=2,o=l=>Math.round(10*l)/10;if(this.data.multiLine){const l=Math.abs(this.data.rect[3]-this.data.rect[1]-r),c=Math.round(l/(fs*s))||1,h=l/c;a=Math.min(s,o(h/fs))}else{const l=Math.abs(this.data.rect[3]-this.data.rect[1]-r);a=Math.min(s,o(l/fs))}n.fontSize=`calc(${a}px * var(--scale-factor))`,n.color=ne.makeHexColor(i[0],i[1],i[2]),this.data.textAlignment!==null&&(n.textAlign=e[this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}class w8 extends zt{constructor(t){const e=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;super(t,{isRenderable:e})}setPropertyOnSiblings(t,e,i,s){const n=this.annotationStorage;for(const a of this._getElementsByName(t.name,t.id))a.domElement&&(a.domElement[e]=i),n.setValue(a.id,{[s]:i})}render(){const t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let i=null;if(this.renderForms){const s=t.getValue(e,{value:this.data.fieldValue});let n=s.value||"";const a=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;a&&n.length>a&&(n=n.slice(0,a));let r=s.formattedValue||this.data.textContent?.join(`
`)||null;r&&this.data.comb&&(r=r.replaceAll(/\s+/g,""));const o={userValue:n,formattedValue:r,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(i=document.createElement("textarea"),i.textContent=r??n,this.data.doNotScroll&&(i.style.overflowY="hidden")):(i=document.createElement("input"),i.type="text",i.setAttribute("value",r??n),this.data.doNotScroll&&(i.style.overflowX="hidden")),this.data.hasOwnCanvas&&(i.hidden=!0),Ot.add(i),i.setAttribute("data-element-id",e),i.disabled=this.data.readOnly,i.name=this.data.fieldName,i.tabIndex=wi,this._setRequired(i,this.data.required),a&&(i.maxLength=a),i.addEventListener("input",c=>{t.setValue(e,{value:c.target.value}),this.setPropertyOnSiblings(i,"value",c.target.value,"value"),o.formattedValue=null}),i.addEventListener("resetform",c=>{const h=this.data.defaultFieldValue??"";i.value=o.userValue=h,o.formattedValue=null});let l=c=>{const{formattedValue:h}=o;h!=null&&(c.target.value=h),c.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){i.addEventListener("focus",h=>{if(o.focused)return;const{target:d}=h;o.userValue&&(d.value=o.userValue),o.lastCommittedValue=d.value,o.commitKey=1,this.data.actions?.Focus||(o.focused=!0)}),i.addEventListener("updatefromsandbox",h=>{this.showElementAndHideCanvas(h.target);const d={value(f){o.userValue=f.detail.value??"",t.setValue(e,{value:o.userValue.toString()}),f.target.value=o.userValue},formattedValue(f){const{formattedValue:p}=f.detail;o.formattedValue=p,p!=null&&f.target!==document.activeElement&&(f.target.value=p),t.setValue(e,{formattedValue:p})},selRange(f){f.target.setSelectionRange(...f.detail.selRange)},charLimit:f=>{const{charLimit:p}=f.detail,{target:m}=f;if(p===0){m.removeAttribute("maxLength");return}m.setAttribute("maxLength",p);let v=o.userValue;!v||v.length<=p||(v=v.slice(0,p),m.value=o.userValue=v,t.setValue(e,{value:v}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:v,willCommit:!0,commitKey:1,selStart:m.selectionStart,selEnd:m.selectionEnd}}))}};this._dispatchEventFromSandbox(d,h)}),i.addEventListener("keydown",h=>{o.commitKey=1;let d=-1;if(h.key==="Escape"?d=0:h.key==="Enter"&&!this.data.multiLine?d=2:h.key==="Tab"&&(o.commitKey=3),d===-1)return;const{value:f}=h.target;o.lastCommittedValue!==f&&(o.lastCommittedValue=f,o.userValue=f,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:f,willCommit:!0,commitKey:d,selStart:h.target.selectionStart,selEnd:h.target.selectionEnd}}))});const c=l;l=null,i.addEventListener("blur",h=>{if(!o.focused||!h.relatedTarget)return;this.data.actions?.Blur||(o.focused=!1);const{value:d}=h.target;o.userValue=d,o.lastCommittedValue!==d&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:d,willCommit:!0,commitKey:o.commitKey,selStart:h.target.selectionStart,selEnd:h.target.selectionEnd}}),c(h)}),this.data.actions?.Keystroke&&i.addEventListener("beforeinput",h=>{o.lastCommittedValue=null;const{data:d,target:f}=h,{value:p,selectionStart:m,selectionEnd:v}=f;let w=m,S=v;switch(h.inputType){case"deleteWordBackward":{const _=p.substring(0,m).match(/\w*[^\w]*$/);_&&(w-=_[0].length);break}case"deleteWordForward":{const _=p.substring(m).match(/^[^\w]*\w*/);_&&(S+=_[0].length);break}case"deleteContentBackward":m===v&&(w-=1);break;case"deleteContentForward":m===v&&(S+=1);break}h.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:p,change:d||"",willCommit:!1,selStart:w,selEnd:S}})}),this._setEventListeners(i,o,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],h=>h.target.value)}if(l&&i.addEventListener("blur",l),this.data.comb){const h=(this.data.rect[2]-this.data.rect[0])/a;i.classList.add("comb"),i.style.letterSpacing=`calc(${h}px * var(--scale-factor) - 1ch)`}}else i=document.createElement("div"),i.textContent=this.data.fieldValue,i.style.verticalAlign="middle",i.style.display="table-cell",this.data.hasOwnCanvas&&(i.hidden=!0);return this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class b8 extends zt{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class x8 extends zt{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const t=this.annotationStorage,e=this.data,i=e.id;let s=t.getValue(i,{value:e.exportValue===e.fieldValue}).value;typeof s=="string"&&(s=s!=="Off",t.setValue(i,{value:s})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const n=document.createElement("input");return Ot.add(n),n.setAttribute("data-element-id",i),n.disabled=e.readOnly,this._setRequired(n,this.data.required),n.type="checkbox",n.name=e.fieldName,s&&n.setAttribute("checked",!0),n.setAttribute("exportValue",e.exportValue),n.tabIndex=wi,n.addEventListener("change",a=>{const{name:r,checked:o}=a.target;for(const l of this._getElementsByName(r,i)){const c=o&&l.exportValue===e.exportValue;l.domElement&&(l.domElement.checked=c),t.setValue(l.id,{value:c})}t.setValue(i,{value:o})}),n.addEventListener("resetform",a=>{const r=e.defaultFieldValue||"Off";a.target.checked=r===e.exportValue}),this.enableScripting&&this.hasJSActions&&(n.addEventListener("updatefromsandbox",a=>{const r={value(o){o.target.checked=o.detail.value!=="Off",t.setValue(i,{value:o.target.checked})}};this._dispatchEventFromSandbox(r,a)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class ro extends zt{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const t=this.annotationStorage,e=this.data,i=e.id;let s=t.getValue(i,{value:e.fieldValue===e.buttonValue}).value;if(typeof s=="string"&&(s=s!==e.buttonValue,t.setValue(i,{value:s})),s)for(const a of this._getElementsByName(e.fieldName,i))t.setValue(a.id,{value:!1});const n=document.createElement("input");if(Ot.add(n),n.setAttribute("data-element-id",i),n.disabled=e.readOnly,this._setRequired(n,this.data.required),n.type="radio",n.name=e.fieldName,s&&n.setAttribute("checked",!0),n.tabIndex=wi,n.addEventListener("change",a=>{const{name:r,checked:o}=a.target;for(const l of this._getElementsByName(r,i))t.setValue(l.id,{value:!1});t.setValue(i,{value:o})}),n.addEventListener("resetform",a=>{const r=e.defaultFieldValue;a.target.checked=r!=null&&r===e.buttonValue}),this.enableScripting&&this.hasJSActions){const a=e.buttonValue;n.addEventListener("updatefromsandbox",r=>{const o={value:l=>{const c=a===l.detail.value;for(const h of this._getElementsByName(l.target.name)){const d=c&&h.id===i;h.domElement&&(h.domElement.checked=d),t.setValue(h.id,{value:d})}}};this._dispatchEventFromSandbox(o,r)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],r=>r.target.checked)}return this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class S8 extends no{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){const t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");const e=t.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",i=>{this._dispatchEventFromSandbox({},i)})),t}}class E8 extends zt{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const t=this.annotationStorage,e=this.data.id,i=t.getValue(e,{value:this.data.fieldValue}),s=document.createElement("select");Ot.add(s),s.setAttribute("data-element-id",e),s.disabled=this.data.readOnly,this._setRequired(s,this.data.required),s.name=this.data.fieldName,s.tabIndex=wi;let n=this.data.combo&&this.data.options.length>0;this.data.combo||(s.size=this.data.options.length,this.data.multiSelect&&(s.multiple=!0)),s.addEventListener("resetform",c=>{const h=this.data.defaultFieldValue;for(const d of s.options)d.selected=d.value===h});for(const c of this.data.options){const h=document.createElement("option");h.textContent=c.displayValue,h.value=c.exportValue,i.value.includes(c.exportValue)&&(h.setAttribute("selected",!0),n=!1),s.append(h)}let a=null;if(n){const c=document.createElement("option");c.value=" ",c.setAttribute("hidden",!0),c.setAttribute("selected",!0),s.prepend(c),a=()=>{c.remove(),s.removeEventListener("input",a),a=null},s.addEventListener("input",a)}const r=c=>{const h=c?"value":"textContent",{options:d,multiple:f}=s;return f?Array.prototype.filter.call(d,p=>p.selected).map(p=>p[h]):d.selectedIndex===-1?null:d[d.selectedIndex][h]};let o=r(!1);const l=c=>{const h=c.target.options;return Array.prototype.map.call(h,d=>({displayValue:d.textContent,exportValue:d.value}))};return this.enableScripting&&this.hasJSActions?(s.addEventListener("updatefromsandbox",c=>{const h={value(d){a?.();const f=d.detail.value,p=new Set(Array.isArray(f)?f:[f]);for(const m of s.options)m.selected=p.has(m.value);t.setValue(e,{value:r(!0)}),o=r(!1)},multipleSelection(d){s.multiple=!0},remove(d){const f=s.options,p=d.detail.remove;f[p].selected=!1,s.remove(p),f.length>0&&Array.prototype.findIndex.call(f,v=>v.selected)===-1&&(f[0].selected=!0),t.setValue(e,{value:r(!0),items:l(d)}),o=r(!1)},clear(d){for(;s.length!==0;)s.remove(0);t.setValue(e,{value:null,items:[]}),o=r(!1)},insert(d){const{index:f,displayValue:p,exportValue:m}=d.detail.insert,v=s.children[f],w=document.createElement("option");w.textContent=p,w.value=m,v?v.before(w):s.append(w),t.setValue(e,{value:r(!0),items:l(d)}),o=r(!1)},items(d){const{items:f}=d.detail;for(;s.length!==0;)s.remove(0);for(const p of f){const{displayValue:m,exportValue:v}=p,w=document.createElement("option");w.textContent=m,w.value=v,s.append(w)}s.options.length>0&&(s.options[0].selected=!0),t.setValue(e,{value:r(!0),items:l(d)}),o=r(!1)},indices(d){const f=new Set(d.detail.indices);for(const p of d.target.options)p.selected=f.has(p.index);t.setValue(e,{value:r(!0)}),o=r(!1)},editable(d){d.target.disabled=!d.detail.editable}};this._dispatchEventFromSandbox(h,c)}),s.addEventListener("input",c=>{const h=r(!0),d=r(!1);t.setValue(e,{value:h}),c.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:o,change:d,changeEx:h,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(s,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],c=>c.target.value)):s.addEventListener("input",function(c){t.setValue(e,{value:r(!0)})}),this.data.combo&&this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class ks extends Fe{constructor(t){const{data:e,elements:i}=t;super(t,{isRenderable:Fe._hasPopupData(e)}),this.elements=i,this.popup=null}render(){this.container.classList.add("popupAnnotation");const t=this.popup=new T8({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),e=[];for(const i of this.elements)i.popup=t,i.container.ariaHasPopup="dialog",e.push(i.data.id),i.addHighlightArea();return this.container.setAttribute("aria-controls",e.map(i=>`${Ws}${i}`).join(",")),this.container}}class T8{#e=this.#N.bind(this);#t=this.#P.bind(this);#i=this.#_.bind(this);#n=this.#x.bind(this);#r=null;#s=null;#l=null;#c=null;#h=null;#a=null;#u=null;#o=!1;#d=null;#p=null;#f=null;#v=null;#m=null;#g=null;#y=!1;constructor({container:t,color:e,elements:i,titleObj:s,modificationDate:n,contentsObj:a,richText:r,parent:o,rect:l,parentRect:c,open:h}){this.#s=t,this.#m=s,this.#l=a,this.#v=r,this.#a=o,this.#r=e,this.#f=l,this.#u=c,this.#h=i,this.#c=Hr.toDateObject(n),this.trigger=i.flatMap(d=>d.getElementsToTriggerPopup());for(const d of this.trigger)d.addEventListener("click",this.#n),d.addEventListener("mouseenter",this.#i),d.addEventListener("mouseleave",this.#t),d.classList.add("popupTriggerArea");for(const d of i)d.container?.addEventListener("keydown",this.#e);this.#s.hidden=!0,h&&this.#x()}render(){if(this.#d)return;const t=this.#d=document.createElement("div");if(t.className="popup",this.#r){const n=t.style.outlineColor=ne.makeHexColor(...this.#r);CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?t.style.backgroundColor=`color-mix(in srgb, ${n} 30%, white)`:t.style.backgroundColor=ne.makeHexColor(...this.#r.map(r=>Math.floor(.7*(255-r)+r)))}const e=document.createElement("span");e.className="header";const i=document.createElement("h1");if(e.append(i),{dir:i.dir,str:i.textContent}=this.#m,t.append(e),this.#c){const n=document.createElement("span");n.classList.add("popupDate"),n.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),n.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#c.valueOf()})),e.append(n)}const s=this.#b;if(s)so.render({xfaHtml:s,intent:"richText",div:t}),t.lastChild.classList.add("richText","popupContent");else{const n=this._formatContents(this.#l);t.append(n)}this.#s.append(t)}get#b(){const t=this.#v,e=this.#l;return t?.str&&(!e?.str||e.str===t.str)&&this.#v.html||null}get#A(){return this.#b?.attributes?.style?.fontSize||0}get#E(){return this.#b?.attributes?.style?.color||null}#T(t){const e=[],i={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}},s={style:{color:this.#E,fontSize:this.#A?`calc(${this.#A}px * var(--scale-factor))`:""}};for(const n of t.split(`
`))e.push({name:"span",value:n,attributes:s});return i}_formatContents({str:t,dir:e}){const i=document.createElement("p");i.classList.add("popupContent"),i.dir=e;const s=t.split(/(?:\r\n?|\n)/);for(let n=0,a=s.length;n<a;++n){const r=s[n];i.append(document.createTextNode(r)),n<a-1&&i.append(document.createElement("br"))}return i}#N(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||(t.key==="Enter"||t.key==="Escape"&&this.#o)&&this.#x()}updateEdited({rect:t,popupContent:e}){this.#g||={contentsObj:this.#l,richText:this.#v},t&&(this.#p=null),e&&(this.#v=this.#T(e),this.#l=null),this.#d?.remove(),this.#d=null}resetEdited(){this.#g&&({contentsObj:this.#l,richText:this.#v}=this.#g,this.#g=null,this.#d?.remove(),this.#d=null,this.#p=null)}#C(){if(this.#p!==null)return;const{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:i,pageX:s,pageY:n}}}=this.#a;let a=!!this.#u,r=a?this.#u:this.#f;for(const p of this.#h)if(!r||ne.intersect(p.data.rect,r)!==null){r=p.data.rect,a=!0;break}const o=ne.normalizeRect([r[0],t[3]-r[1]+t[1],r[2],t[3]-r[3]+t[1]]),c=a?r[2]-r[0]+5:0,h=o[0]+c,d=o[1];this.#p=[100*(h-s)/e,100*(d-n)/i];const{style:f}=this.#s;f.left=`${this.#p[0]}%`,f.top=`${this.#p[1]}%`}#x(){this.#o=!this.#o,this.#o?(this.#_(),this.#s.addEventListener("click",this.#n),this.#s.addEventListener("keydown",this.#e)):(this.#P(),this.#s.removeEventListener("click",this.#n),this.#s.removeEventListener("keydown",this.#e))}#_(){this.#d||this.render(),this.isVisible?this.#o&&this.#s.classList.add("focused"):(this.#C(),this.#s.hidden=!1,this.#s.style.zIndex=parseInt(this.#s.style.zIndex)+1e3)}#P(){this.#s.classList.remove("focused"),!(this.#o||!this.isVisible)&&(this.#s.hidden=!0,this.#s.style.zIndex=parseInt(this.#s.style.zIndex)-1e3)}forceHide(){this.#y=this.isVisible,this.#y&&(this.#s.hidden=!0)}maybeShow(){this.#y&&(this.#d||this.#_(),this.#y=!1,this.#s.hidden=!1)}get isVisible(){return this.#s.hidden===!1}}class oo extends Fe{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=fe.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const t=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(const e of this.textContent){const i=document.createElement("span");i.textContent=e,t.append(i)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class _8 extends Fe{#e=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const t=this.data,{width:e,height:i}=St(t.rect),s=this.svgFactory.create(e,i,!0),n=this.#e=this.svgFactory.createElement("svg:line");return n.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),n.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),n.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),n.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),n.setAttribute("stroke-width",t.borderStyle.width||1),n.setAttribute("stroke","transparent"),n.setAttribute("fill","transparent"),s.append(n),this.container.append(s),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class A8 extends Fe{#e=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const t=this.data,{width:e,height:i}=St(t.rect),s=this.svgFactory.create(e,i,!0),n=t.borderStyle.width,a=this.#e=this.svgFactory.createElement("svg:rect");return a.setAttribute("x",n/2),a.setAttribute("y",n/2),a.setAttribute("width",e-n),a.setAttribute("height",i-n),a.setAttribute("stroke-width",n||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),s.append(a),this.container.append(s),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class C8 extends Fe{#e=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const t=this.data,{width:e,height:i}=St(t.rect),s=this.svgFactory.create(e,i,!0),n=t.borderStyle.width,a=this.#e=this.svgFactory.createElement("svg:ellipse");return a.setAttribute("cx",e/2),a.setAttribute("cy",i/2),a.setAttribute("rx",e/2-n/2),a.setAttribute("ry",i/2-n/2),a.setAttribute("stroke-width",n||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),s.append(a),this.container.append(s),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class ao extends Fe{#e=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:e,borderStyle:i,popupRef:s}}=this;if(!e)return this.container;const{width:n,height:a}=St(t),r=this.svgFactory.create(n,a,!0);let o=[];for(let c=0,h=e.length;c<h;c+=2){const d=e[c]-t[0],f=t[3]-e[c+1];o.push(`${d},${f}`)}o=o.join(" ");const l=this.#e=this.svgFactory.createElement(this.svgElementName);return l.setAttribute("points",o),l.setAttribute("stroke-width",i.width||1),l.setAttribute("stroke","transparent"),l.setAttribute("fill","transparent"),r.append(l),this.container.append(r),!s&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class P8 extends ao{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class R8 extends Fe{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class an extends Fe{#e=[];constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?fe.HIGHLIGHT:fe.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,inkLists:e,borderStyle:i,popupRef:s}}=this,{width:n,height:a}=St(t),r=this.svgFactory.create(n,a,!0);for(const o of e){let l=[];for(let h=0,d=o.length;h<d;h+=2){const f=o[h]-t[0],p=t[3]-o[h+1];l.push(`${f},${p}`)}l=l.join(" ");const c=this.svgFactory.createElement(this.svgElementName);this.#e.push(c),c.setAttribute("points",l),c.setAttribute("stroke-width",i.width||1),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),r.append(c)}return!s&&this.hasPopupData&&this._createPopup(),this.container.append(r),this._editOnDoubleClick(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class lo extends Fe{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=fe.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}}class L8 extends Fe{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class D8 extends Fe{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class k8 extends Fe{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class co extends Fe{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=fe.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class I8 extends Fe{#e=null;constructor(t){super(t,{isRenderable:!0});const{file:e}=this.data;this.filename=e.filename,this.content=e.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...e})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:e}=this;let i;e.hasAppearance||e.fillAlpha===0?i=document.createElement("div"):(i=document.createElement("img"),i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(e.name)?"paperclip":"pushpin"}.svg`,e.fillAlpha&&e.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(e.fillAlpha*100)}%);`)),i.addEventListener("dblclick",this.#t.bind(this)),this.#e=i;const{isMac:s}=et.platform;return t.addEventListener("keydown",n=>{n.key==="Enter"&&(s?n.metaKey:n.ctrlKey)&&this.#t()}),!e.popupRef&&this.hasPopupData?this._createPopup():i.classList.add("popupTriggerArea"),t.append(i),t}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}#t(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}let M8=class{#e=null;#t=null;#i=new Map;#n=null;constructor({div:t,accessibilityManager:e,annotationCanvasMap:i,annotationEditorUIManager:s,page:n,viewport:a,structTreeLayer:r}){this.div=t,this.#e=e,this.#t=i,this.#n=r||null,this.page=n,this.viewport=a,this.zIndex=0,this._annotationEditorUIManager=s}hasEditableAnnotations(){return this.#i.size>0}async#r(t,e){const i=t.firstChild||t,s=i.id=`${Ws}${e}`,n=await this.#n?.getAriaAttributes(s);if(n)for(const[a,r]of n)i.setAttribute(a,r);this.div.append(t),this.#e?.moveElementInDOM(this.div,t,i,!1)}async render(t){const{annotations:e}=t,i=this.div;Ft(i,this.viewport);const s=new Map,n={data:null,layer:i,linkService:t.linkService,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:t.renderForms!==!1,svgFactory:new on,annotationStorage:t.annotationStorage||new Qs,enableScripting:t.enableScripting===!0,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const a of e){if(a.noHTML)continue;const r=a.annotationType===He.POPUP;if(r){const c=s.get(a.id);if(!c)continue;n.elements=c}else{const{width:c,height:h}=St(a.rect);if(c<=0||h<=0)continue}n.data=a;const o=v8.create(n);if(!o.isRenderable)continue;if(!r&&a.popupRef){const c=s.get(a.popupRef);c?c.push(o):s.set(a.popupRef,[o])}const l=o.render();a.hidden&&(l.style.visibility="hidden"),await this.#r(l,a.id),o._isEditable&&(this.#i.set(o.data.id,o),this._annotationEditorUIManager?.renderAnnotationElement(o))}this.#s()}update({viewport:t}){const e=this.div;this.viewport=t,Ft(e,{rotation:t.rotation}),this.#s(),e.hidden=!1}#s(){if(!this.#t)return;const t=this.div;for(const[e,i]of this.#t){const s=t.querySelector(`[data-annotation-id="${e}"]`);if(!s)continue;i.className="annotationContent";const{firstChild:n}=s;n?n.nodeName==="CANVAS"?n.replaceWith(i):n.classList.contains("annotationContent")?n.after(i):n.before(i):s.append(i)}this.#t.clear()}getEditableAnnotations(){return Array.from(this.#i.values())}getEditableAnnotation(t){return this.#i.get(t)}};const Di=/\r\n?|\n/g;class Be extends ce{#e;#t="";#i=`${this.id}-editor`;#n=null;#r;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const t=Be.prototype,e=n=>n.isEmpty(),i=Pt.TRANSLATE_SMALL,s=Pt.TRANSLATE_BIG;return xe(this,"_keyboardManager",new yi([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-s,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[i,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[s,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-s],checker:e}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,i],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,s],checker:e}]]))}static _type="freetext";static _editorType=fe.FREETEXT;constructor(t){super({...t,name:"freeTextEditor"}),this.#e=t.color||Be._defaultColor||ce._defaultLineColor,this.#r=t.fontSize||Be._defaultFontSize}static initialize(t,e){ce.initialize(t,e);const i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,e){switch(t){case he.FREETEXT_SIZE:Be._defaultFontSize=e;break;case he.FREETEXT_COLOR:Be._defaultColor=e;break}}updateParams(t,e){switch(t){case he.FREETEXT_SIZE:this.#s(e);break;case he.FREETEXT_COLOR:this.#l(e);break}}static get defaultPropertiesToUpdate(){return[[he.FREETEXT_SIZE,Be._defaultFontSize],[he.FREETEXT_COLOR,Be._defaultColor||ce._defaultLineColor]]}get propertiesToUpdate(){return[[he.FREETEXT_SIZE,this.#r],[he.FREETEXT_COLOR,this.#e]]}#s(t){const e=s=>{this.editorDiv.style.fontSize=`calc(${s}px * var(--scale-factor))`,this.translate(0,-(s-this.#r)*this.parentScale),this.#r=s,this.#h()},i=this.#r;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:he.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#l(t){const e=s=>{this.#e=this.editorDiv.style.color=s},i=this.#e;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:he.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(t,e){this._uiManager.translateSelectedEditors(t,e,!0)}getInitialTranslation(){const t=this.parentScale;return[-Be._internalPadding*t,-(Be._internalPadding+this.#r)*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(fe.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#n=new AbortController;const t=this._uiManager.combinedSignal(this.#n);this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t})}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#i),this._isDraggable=!0,this.#n?.abort(),this.#n=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){this.width||(this.enableEditMode(),this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#c(){const t=[];this.editorDiv.normalize();let e=null;for(const i of this.editorDiv.childNodes)e?.nodeType===Node.TEXT_NODE&&i.nodeName==="BR"||(t.push(Be.#a(i)),e=i);return t.join(`
`)}#h(){const[t,e]=this.parentDimensions;let i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{const{currentLayer:s,div:n}=this,a=n.style.display,r=n.classList.contains("hidden");n.classList.remove("hidden"),n.style.display="hidden",s.div.append(this.div),i=n.getBoundingClientRect(),n.remove(),n.style.display=a,n.classList.toggle("hidden",r)}this.rotation%180===this.parentRotation%180?(this.width=i.width/t,this.height=i.height/e):(this.width=i.height/t,this.height=i.width/e),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=this.#t,e=this.#t=this.#c().trimEnd();if(t===e)return;const i=s=>{if(this.#t=s,!s){this.remove();return}this.#u(),this._uiManager.rebuild(this),this.#h()};this.addCommands({cmd:()=>{i(e)},undo:()=>{i(t)},mustExec:!1}),this.#h()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(t){this.enterInEditMode()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){Be._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let t,e;this.width&&(t=this.x,e=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#i),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:i}=this.editorDiv;if(i.fontSize=`calc(${this.#r}px * var(--scale-factor))`,i.color=this.#e,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),Hi(this,this.div,["dblclick","keydown"]),this.width){const[s,n]=this.parentDimensions;if(this.annotationElementId){const{position:a}=this._initialData;let[r,o]=this.getInitialTranslation();[r,o]=this.pageTranslationToScreen(r,o);const[l,c]=this.pageDimensions,[h,d]=this.pageTranslation;let f,p;switch(this.rotation){case 0:f=t+(a[0]-h)/l,p=e+this.height-(a[1]-d)/c;break;case 90:f=t+(a[0]-h)/l,p=e-(a[1]-d)/c,[r,o]=[o,-r];break;case 180:f=t-this.width+(a[0]-h)/l,p=e-(a[1]-d)/c,[r,o]=[-r,-o];break;case 270:f=t+(a[0]-h-this.height*c)/l,p=e+(a[1]-d-this.width*l)/c,[r,o]=[-o,r];break}this.setAt(f*s,p*n,r,o)}else this.setAt(t*s,e*n,this.width*s,this.height*n);this.#u(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#a(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(Di,"")}editorDivPaste(t){const e=t.clipboardData||window.clipboardData,{types:i}=e;if(i.length===1&&i[0]==="text/plain")return;t.preventDefault();const s=Be.#d(e.getData("text")||"").replaceAll(Di,`
`);if(!s)return;const n=window.getSelection();if(!n.rangeCount)return;this.editorDiv.normalize(),n.deleteFromDocument();const a=n.getRangeAt(0);if(!s.includes(`
`)){a.insertNode(document.createTextNode(s)),this.editorDiv.normalize(),n.collapseToStart();return}const{startContainer:r,startOffset:o}=a,l=[],c=[];if(r.nodeType===Node.TEXT_NODE){const f=r.parentElement;if(c.push(r.nodeValue.slice(o).replaceAll(Di,"")),f!==this.editorDiv){let p=l;for(const m of this.editorDiv.childNodes){if(m===f){p=c;continue}p.push(Be.#a(m))}}l.push(r.nodeValue.slice(0,o).replaceAll(Di,""))}else if(r===this.editorDiv){let f=l,p=0;for(const m of this.editorDiv.childNodes)p++===o&&(f=c),f.push(Be.#a(m))}this.#t=`${l.join(`
`)}${s}${c.join(`
`)}`,this.#u();const h=new Range;let d=l.reduce((f,p)=>f+p.length,0);for(const{firstChild:f}of this.editorDiv.childNodes)if(f.nodeType===Node.TEXT_NODE){const p=f.nodeValue.length;if(d<=p){h.setStart(f,d),h.setEnd(f,d);break}d-=p}n.removeAllRanges(),n.addRange(h)}#u(){if(this.editorDiv.replaceChildren(),!!this.#t)for(const t of this.#t.split(`
`)){const e=document.createElement("div");e.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(e)}}#o(){return this.#t.replaceAll("Â "," ")}static#d(t){return t.replaceAll(" ","Â ")}get contentDiv(){return this.editorDiv}static async deserialize(t,e,i){let s=null;if(t instanceof oo){const{data:{defaultAppearanceData:{fontSize:a,fontColor:r},rect:o,rotation:l,id:c,popupRef:h},textContent:d,textPosition:f,parent:{page:{pageNumber:p}}}=t;if(!d||d.length===0)return null;s=t={annotationType:fe.FREETEXT,color:Array.from(r),fontSize:a,value:d.join(`
`),position:f,pageIndex:p-1,rect:o.slice(0),rotation:l,id:c,deleted:!1,popupRef:h}}const n=await super.deserialize(t,e,i);return n.#r=t.fontSize,n.#e=ne.makeHexColor(...t.color),n.#t=Be.#d(t.value),n.annotationElementId=t.id||null,n._initialData=s,n}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const e=Be._internalPadding*this.parentScale,i=this.getRect(e,e),s=ce._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#e),n={annotationType:fe.FREETEXT,color:s,fontSize:this.#r,value:this.#o(),pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?n:this.annotationElementId&&!this.#p(n)?null:(n.id=this.annotationElementId,n)}#p(t){const{value:e,fontSize:i,color:s,pageIndex:n}=this._initialData;return this._hasBeenMoved||t.value!==e||t.fontSize!==i||t.color.some((a,r)=>a!==s[r])||t.pageIndex!==n}renderAnnotationElement(t){const e=super.renderAnnotationElement(t);if(this.deleted)return e;const{style:i}=e;i.fontSize=`calc(${this.#r}px * var(--scale-factor))`,i.color=this.#e,e.replaceChildren();for(const n of this.#t.split(`
`)){const a=document.createElement("div");a.append(n?document.createTextNode(n):document.createElement("br")),e.append(a)}const s=Be._internalPadding*this.parentScale;return t.updateEdited({rect:this.getRect(s,s),popupContent:this.#t}),e}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}}class ho{toSVGPath(){ke("Abstract method `toSVGPath` must be implemented.")}get box(){ke("Abstract getter `box` must be implemented.")}serialize(t,e){ke("Abstract method `serialize` must be implemented.")}get classNamesForDrawing(){ke("Abstract getter `classNamesForDrawing` must be implemented.")}get classNamesForOutlining(){ke("Abstract getter `classNamesForOutlining` must be implemented.")}get mustRemoveSelfIntersections(){return!1}}class kt{#e;#t=[];#i;#n;#r=[];#s=new Float64Array(18);#l;#c;#h;#a;#u;#o;#d=[];static#p=8;static#f=2;static#v=kt.#p+kt.#f;constructor({x:t,y:e},i,s,n,a,r=0){this.#e=i,this.#o=n*s,this.#n=a,this.#s.set([NaN,NaN,NaN,NaN,t,e],6),this.#i=r,this.#a=kt.#p*s,this.#h=kt.#v*s,this.#u=s,this.#d.push(t,e)}isEmpty(){return isNaN(this.#s[8])}#m(){const t=this.#s.subarray(4,6),e=this.#s.subarray(16,18),[i,s,n,a]=this.#e;return[(this.#l+(t[0]-e[0])/2-i)/n,(this.#c+(t[1]-e[1])/2-s)/a,(this.#l+(e[0]-t[0])/2-i)/n,(this.#c+(e[1]-t[1])/2-s)/a]}add({x:t,y:e}){this.#l=t,this.#c=e;const[i,s,n,a]=this.#e;let[r,o,l,c]=this.#s.subarray(8,12);const h=t-l,d=e-c,f=Math.hypot(h,d);if(f<this.#h)return!1;const p=f-this.#a,m=p/f,v=m*h,w=m*d;let S=r,_=o;r=l,o=c,l+=v,c+=w,this.#d?.push(t,e);const A=-w/p,P=v/p,k=A*this.#o,N=P*this.#o;return this.#s.set(this.#s.subarray(2,8),0),this.#s.set([l+k,c+N],4),this.#s.set(this.#s.subarray(14,18),12),this.#s.set([l-k,c-N],16),isNaN(this.#s[6])?(this.#r.length===0&&(this.#s.set([r+k,o+N],2),this.#r.push(NaN,NaN,NaN,NaN,(r+k-i)/n,(o+N-s)/a),this.#s.set([r-k,o-N],14),this.#t.push(NaN,NaN,NaN,NaN,(r-k-i)/n,(o-N-s)/a)),this.#s.set([S,_,r,o,l,c],6),!this.isEmpty()):(this.#s.set([S,_,r,o,l,c],6),Math.abs(Math.atan2(_-o,S-r)-Math.atan2(w,v))<Math.PI/2?([r,o,l,c]=this.#s.subarray(2,6),this.#r.push(NaN,NaN,NaN,NaN,((r+l)/2-i)/n,((o+c)/2-s)/a),[r,o,S,_]=this.#s.subarray(14,18),this.#t.push(NaN,NaN,NaN,NaN,((S+r)/2-i)/n,((_+o)/2-s)/a),!0):([S,_,r,o,l,c]=this.#s.subarray(0,6),this.#r.push(((S+5*r)/6-i)/n,((_+5*o)/6-s)/a,((5*r+l)/6-i)/n,((5*o+c)/6-s)/a,((r+l)/2-i)/n,((o+c)/2-s)/a),[l,c,r,o,S,_]=this.#s.subarray(12,18),this.#t.push(((S+5*r)/6-i)/n,((_+5*o)/6-s)/a,((5*r+l)/6-i)/n,((5*o+c)/6-s)/a,((r+l)/2-i)/n,((o+c)/2-s)/a),!0))}toSVGPath(){if(this.isEmpty())return"";const t=this.#r,e=this.#t;if(isNaN(this.#s[6])&&!this.isEmpty())return this.#g();const i=[];i.push(`M${t[4]} ${t[5]}`);for(let s=6;s<t.length;s+=6)isNaN(t[s])?i.push(`L${t[s+4]} ${t[s+5]}`):i.push(`C${t[s]} ${t[s+1]} ${t[s+2]} ${t[s+3]} ${t[s+4]} ${t[s+5]}`);this.#b(i);for(let s=e.length-6;s>=6;s-=6)isNaN(e[s])?i.push(`L${e[s+4]} ${e[s+5]}`):i.push(`C${e[s]} ${e[s+1]} ${e[s+2]} ${e[s+3]} ${e[s+4]} ${e[s+5]}`);return this.#y(i),i.join(" ")}#g(){const[t,e,i,s]=this.#e,[n,a,r,o]=this.#m();return`M${(this.#s[2]-t)/i} ${(this.#s[3]-e)/s} L${(this.#s[4]-t)/i} ${(this.#s[5]-e)/s} L${n} ${a} L${r} ${o} L${(this.#s[16]-t)/i} ${(this.#s[17]-e)/s} L${(this.#s[14]-t)/i} ${(this.#s[15]-e)/s} Z`}#y(t){const e=this.#t;t.push(`L${e[4]} ${e[5]} Z`)}#b(t){const[e,i,s,n]=this.#e,a=this.#s.subarray(4,6),r=this.#s.subarray(16,18),[o,l,c,h]=this.#m();t.push(`L${(a[0]-e)/s} ${(a[1]-i)/n} L${o} ${l} L${c} ${h} L${(r[0]-e)/s} ${(r[1]-i)/n}`)}newFreeDrawOutline(t,e,i,s,n,a){return new uo(t,e,i,s,n,a)}getOutlines(){const t=this.#r,e=this.#t,i=this.#s,[s,n,a,r]=this.#e,o=new Float64Array((this.#d?.length??0)+2);for(let h=0,d=o.length-2;h<d;h+=2)o[h]=(this.#d[h]-s)/a,o[h+1]=(this.#d[h+1]-n)/r;if(o[o.length-2]=(this.#l-s)/a,o[o.length-1]=(this.#c-n)/r,isNaN(i[6])&&!this.isEmpty())return this.#A(o);const l=new Float64Array(this.#r.length+24+this.#t.length);let c=t.length;for(let h=0;h<c;h+=2){if(isNaN(t[h])){l[h]=l[h+1]=NaN;continue}l[h]=t[h],l[h+1]=t[h+1]}c=this.#T(l,c);for(let h=e.length-6;h>=6;h-=6)for(let d=0;d<6;d+=2){if(isNaN(e[h+d])){l[c]=l[c+1]=NaN,c+=2;continue}l[c]=e[h+d],l[c+1]=e[h+d+1],c+=2}return this.#E(l,c),this.newFreeDrawOutline(l,o,this.#e,this.#u,this.#i,this.#n)}#A(t){const e=this.#s,[i,s,n,a]=this.#e,[r,o,l,c]=this.#m(),h=new Float64Array(36);return h.set([NaN,NaN,NaN,NaN,(e[2]-i)/n,(e[3]-s)/a,NaN,NaN,NaN,NaN,(e[4]-i)/n,(e[5]-s)/a,NaN,NaN,NaN,NaN,r,o,NaN,NaN,NaN,NaN,l,c,NaN,NaN,NaN,NaN,(e[16]-i)/n,(e[17]-s)/a,NaN,NaN,NaN,NaN,(e[14]-i)/n,(e[15]-s)/a],0),this.newFreeDrawOutline(h,t,this.#e,this.#u,this.#i,this.#n)}#E(t,e){const i=this.#t;return t.set([NaN,NaN,NaN,NaN,i[4],i[5]],e),e+=6}#T(t,e){const i=this.#s.subarray(4,6),s=this.#s.subarray(16,18),[n,a,r,o]=this.#e,[l,c,h,d]=this.#m();return t.set([NaN,NaN,NaN,NaN,(i[0]-n)/r,(i[1]-a)/o,NaN,NaN,NaN,NaN,l,c,NaN,NaN,NaN,NaN,h,d,NaN,NaN,NaN,NaN,(s[0]-n)/r,(s[1]-a)/o],e),e+=24}}class uo extends ho{#e;#t=null;#i;#n;#r;#s;#l;constructor(t,e,i,s,n,a){super(),this.#l=t,this.#r=e,this.#e=i,this.#s=s,this.#i=n,this.#n=a,this.#a(a);const{x:r,y:o,width:l,height:c}=this.#t;for(let h=0,d=t.length;h<d;h+=2)t[h]=(t[h]-r)/l,t[h+1]=(t[h+1]-o)/c;for(let h=0,d=e.length;h<d;h+=2)e[h]=(e[h]-r)/l,e[h+1]=(e[h+1]-o)/c}toSVGPath(){const t=[`M${this.#l[4]} ${this.#l[5]}`];for(let e=6,i=this.#l.length;e<i;e+=6){if(isNaN(this.#l[e])){t.push(`L${this.#l[e+4]} ${this.#l[e+5]}`);continue}t.push(`C${this.#l[e]} ${this.#l[e+1]} ${this.#l[e+2]} ${this.#l[e+3]} ${this.#l[e+4]} ${this.#l[e+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,e,i,s],n){const a=i-t,r=s-e;let o,l;switch(n){case 0:o=this.#c(this.#l,t,s,a,-r),l=this.#c(this.#r,t,s,a,-r);break;case 90:o=this.#h(this.#l,t,e,a,r),l=this.#h(this.#r,t,e,a,r);break;case 180:o=this.#c(this.#l,i,e,-a,r),l=this.#c(this.#r,i,e,-a,r);break;case 270:o=this.#h(this.#l,i,s,-a,-r),l=this.#h(this.#r,i,s,-a,-r);break}return{outline:Array.from(o),points:[Array.from(l)]}}#c(t,e,i,s,n){const a=new Float64Array(t.length);for(let r=0,o=t.length;r<o;r+=2)a[r]=e+t[r]*s,a[r+1]=i+t[r+1]*n;return a}#h(t,e,i,s,n){const a=new Float64Array(t.length);for(let r=0,o=t.length;r<o;r+=2)a[r]=e+t[r+1]*s,a[r+1]=i+t[r]*n;return a}#a(t){const e=this.#l;let i=e[4],s=e[5],n=i,a=s,r=i,o=s,l=i,c=s;const h=t?Math.max:Math.min;for(let v=6,w=e.length;v<w;v+=6){if(isNaN(e[v]))n=Math.min(n,e[v+4]),a=Math.min(a,e[v+5]),r=Math.max(r,e[v+4]),o=Math.max(o,e[v+5]),c<e[v+5]?(l=e[v+4],c=e[v+5]):c===e[v+5]&&(l=h(l,e[v+4]));else{const S=ne.bezierBoundingBox(i,s,...e.slice(v,v+6));n=Math.min(n,S[0]),a=Math.min(a,S[1]),r=Math.max(r,S[2]),o=Math.max(o,S[3]),c<S[3]?(l=S[2],c=S[3]):c===S[3]&&(l=h(l,S[2]))}i=e[v+4],s=e[v+5]}const d=n-this.#i,f=a-this.#i,p=r-n+2*this.#i,m=o-a+2*this.#i;this.#t={x:d,y:f,width:p,height:m,lastPoint:[l,c]}}get box(){return this.#t}newOutliner(t,e,i,s,n,a=0){return new kt(t,e,i,s,n,a)}getNewOutline(t,e){const{x:i,y:s,width:n,height:a}=this.#t,[r,o,l,c]=this.#e,h=n*l,d=a*c,f=i*l+r,p=s*c+o,m=this.newOutliner({x:this.#r[0]*h+f,y:this.#r[1]*d+p},this.#e,this.#s,t,this.#n,e??this.#i);for(let v=2;v<this.#r.length;v+=2)m.add({x:this.#r[v]*h+f,y:this.#r[v+1]*d+p});return m.getOutlines()}get mustRemoveSelfIntersections(){return!0}}class ar{#e;#t=[];#i=[];constructor(t,e=0,i=0,s=!0){let n=1/0,a=-1/0,r=1/0,o=-1/0;const l=10**-4;for(const{x:v,y:w,width:S,height:_}of t){const A=Math.floor((v-e)/l)*l,P=Math.ceil((v+S+e)/l)*l,k=Math.floor((w-e)/l)*l,N=Math.ceil((w+_+e)/l)*l,O=[A,k,N,!0],j=[P,k,N,!1];this.#t.push(O,j),n=Math.min(n,A),a=Math.max(a,P),r=Math.min(r,k),o=Math.max(o,N)}const c=a-n+2*i,h=o-r+2*i,d=n-i,f=r-i,p=this.#t.at(s?-1:-2),m=[p[0],p[2]];for(const v of this.#t){const[w,S,_]=v;v[0]=(w-d)/c,v[1]=(S-f)/h,v[2]=(_-f)/h}this.#e={x:d,y:f,width:c,height:h,lastPoint:m}}getOutlines(){this.#t.sort((e,i)=>e[0]-i[0]||e[1]-i[1]||e[2]-i[2]);const t=[];for(const e of this.#t)e[3]?(t.push(...this.#c(e)),this.#s(e)):(this.#l(e),t.push(...this.#c(e)));return this.#n(t)}#n(t){const e=[],i=new Set;for(const a of t){const[r,o,l]=a;e.push([r,o,a],[r,l,a])}e.sort((a,r)=>a[1]-r[1]||a[0]-r[0]);for(let a=0,r=e.length;a<r;a+=2){const o=e[a][2],l=e[a+1][2];o.push(l),l.push(o),i.add(o),i.add(l)}const s=[];let n;for(;i.size>0;){const a=i.values().next().value;let[r,o,l,c,h]=a;i.delete(a);let d=r,f=o;for(n=[r,l],s.push(n);;){let p;if(i.has(c))p=c;else if(i.has(h))p=h;else break;i.delete(p),[r,o,l,c,h]=p,d!==r&&(n.push(d,f,r,f===o?o:l),d=r),f=f===o?l:o}n.push(d,f)}return new N8(s,this.#e)}#r(t){const e=this.#i;let i=0,s=e.length-1;for(;i<=s;){const n=i+s>>1,a=e[n][0];if(a===t)return n;a<t?i=n+1:s=n-1}return s+1}#s([,t,e]){const i=this.#r(t);this.#i.splice(i,0,[t,e])}#l([,t,e]){const i=this.#r(t);for(let s=i;s<this.#i.length;s++){const[n,a]=this.#i[s];if(n!==t)break;if(n===t&&a===e){this.#i.splice(s,1);return}}for(let s=i-1;s>=0;s--){const[n,a]=this.#i[s];if(n!==t)break;if(n===t&&a===e){this.#i.splice(s,1);return}}}#c(t){const[e,i,s]=t,n=[[e,i,s]],a=this.#r(s);for(let r=0;r<a;r++){const[o,l]=this.#i[r];for(let c=0,h=n.length;c<h;c++){const[,d,f]=n[c];if(!(l<=d||f<=o)){if(d>=o){if(f>l)n[c][1]=l;else{if(h===1)return[];n.splice(c,1),c--,h--}continue}n[c][2]=o,f>l&&n.push([e,l,f])}}}return n}}class N8 extends ho{#e;#t;constructor(t,e){super(),this.#t=t,this.#e=e}toSVGPath(){const t=[];for(const e of this.#t){let[i,s]=e;t.push(`M${i} ${s}`);for(let n=2;n<e.length;n+=2){const a=e[n],r=e[n+1];a===i?(t.push(`V${r}`),s=r):r===s&&(t.push(`H${a}`),i=a)}t.push("Z")}return t.join(" ")}serialize([t,e,i,s],n){const a=[],r=i-t,o=s-e;for(const l of this.#t){const c=new Array(l.length);for(let h=0;h<l.length;h+=2)c[h]=t+l[h]*r,c[h+1]=s-l[h+1]*o;a.push(c)}return a}get box(){return this.#e}get classNamesForDrawing(){return["highlight"]}get classNamesForOutlining(){return["highlightOutline"]}}class Is extends kt{newFreeDrawOutline(t,e,i,s,n,a){return new F8(t,e,i,s,n,a)}get classNamesForDrawing(){return["highlight","free"]}}class F8 extends uo{get classNamesForDrawing(){return["highlight","free"]}get classNamesForOutlining(){return["highlightOutline","free"]}newOutliner(t,e,i,s,n,a=0){return new Is(t,e,i,s,n,a)}}class lt{#e=null;#t=null;#i;#n=null;#r=!1;#s=!1;#l=null;#c;#h=null;#a=null;#u;static#o=null;static get _keyboardManager(){return xe(this,"_keyboardManager",new yi([[["Escape","mac+Escape"],lt.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],lt.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],lt.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],lt.prototype._moveToPrevious],[["Home","mac+Home"],lt.prototype._moveToBeginning],[["End","mac+End"],lt.prototype._moveToEnd]]))}constructor({editor:t=null,uiManager:e=null}){t?(this.#s=!1,this.#u=he.HIGHLIGHT_COLOR,this.#l=t):(this.#s=!0,this.#u=he.HIGHLIGHT_DEFAULT_COLOR),this.#a=t?._uiManager||e,this.#c=this.#a._eventBus,this.#i=t?.color||this.#a?.highlightColors.values().next().value||"#FFFF98",lt.#o||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const t=this.#e=document.createElement("button");t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.setAttribute("aria-haspopup",!0);const e=this.#a._signal;t.addEventListener("click",this.#v.bind(this),{signal:e}),t.addEventListener("keydown",this.#f.bind(this),{signal:e});const i=this.#t=document.createElement("span");return i.className="swatch",i.setAttribute("aria-hidden",!0),i.style.backgroundColor=this.#i,t.append(i),t}renderMainDropdown(){const t=this.#n=this.#d();return t.setAttribute("aria-orientation","horizontal"),t.setAttribute("aria-labelledby","highlightColorPickerLabel"),t}#d(){const t=document.createElement("div"),e=this.#a._signal;t.addEventListener("contextmenu",ht,{signal:e}),t.className="dropdown",t.role="listbox",t.setAttribute("aria-multiselectable",!1),t.setAttribute("aria-orientation","vertical"),t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[i,s]of this.#a.highlightColors){const n=document.createElement("button");n.tabIndex="0",n.role="option",n.setAttribute("data-color",s),n.title=i,n.setAttribute("data-l10n-id",lt.#o[i]);const a=document.createElement("span");n.append(a),a.className="swatch",a.style.backgroundColor=s,n.setAttribute("aria-selected",s===this.#i),n.addEventListener("click",this.#p.bind(this,s),{signal:e}),t.append(n)}return t.addEventListener("keydown",this.#f.bind(this),{signal:e}),t}#p(t,e){e.stopPropagation(),this.#c.dispatch("switchannotationeditorparams",{source:this,type:this.#u,value:t})}_colorSelectFromKeyboard(t){if(t.target===this.#e){this.#v(t);return}const e=t.target.getAttribute("data-color");e&&this.#p(e,t)}_moveToNext(t){if(!this.#g){this.#v(t);return}if(t.target===this.#e){this.#n.firstChild?.focus();return}t.target.nextSibling?.focus()}_moveToPrevious(t){if(t.target===this.#n?.firstChild||t.target===this.#e){this.#g&&this._hideDropdownFromKeyboard();return}this.#g||this.#v(t),t.target.previousSibling?.focus()}_moveToBeginning(t){if(!this.#g){this.#v(t);return}this.#n.firstChild?.focus()}_moveToEnd(t){if(!this.#g){this.#v(t);return}this.#n.lastChild?.focus()}#f(t){lt._keyboardManager.exec(this,t)}#v(t){if(this.#g){this.hideDropdown();return}if(this.#r=t.detail===0,this.#h||(this.#h=new AbortController,window.addEventListener("pointerdown",this.#m.bind(this),{signal:this.#a.combinedSignal(this.#h)})),this.#n){this.#n.classList.remove("hidden");return}const e=this.#n=this.#d();this.#e.append(e)}#m(t){this.#n?.contains(t.target)||this.hideDropdown()}hideDropdown(){this.#n?.classList.add("hidden"),this.#h?.abort(),this.#h=null}get#g(){return this.#n&&!this.#n.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#s){if(!this.#g){this.#l?.unselect();return}this.hideDropdown(),this.#e.focus({preventScroll:!0,focusVisible:this.#r})}}updateColor(t){if(this.#t&&(this.#t.style.backgroundColor=t),!this.#n)return;const e=this.#a.highlightColors.values();for(const i of this.#n.children)i.setAttribute("aria-selected",e.next().value===t)}destroy(){this.#e?.remove(),this.#e=null,this.#t=null,this.#n?.remove(),this.#n=null}}class Ne extends ce{#e=null;#t=0;#i;#n=null;#r=null;#s=null;#l=null;#c=0;#h=null;#a=null;#u=null;#o=!1;#d=null;#p;#f=null;#v="";#m;#g="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=fe.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const t=Ne.prototype;return xe(this,"_keyboardManager",new yi([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}constructor(t){super({...t,name:"highlightEditor"}),this.color=t.color||Ne._defaultColor,this.#m=t.thickness||Ne._defaultThickness,this.#p=t.opacity||Ne._defaultOpacity,this.#i=t.boxes||null,this.#g=t.methodOfCreation||"",this.#v=t.text||"",this._isDraggable=!1,t.highlightId>-1?(this.#o=!0,this.#b(t),this.#C()):this.#i&&(this.#e=t.anchorNode,this.#t=t.anchorOffset,this.#l=t.focusNode,this.#c=t.focusOffset,this.#y(),this.#C(),this.rotate(this.rotation))}get telemetryInitialData(){return{action:"added",type:this.#o?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:this.#m,methodOfCreation:this.#g}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}#y(){const t=new ar(this.#i,.001);this.#a=t.getOutlines(),{x:this.x,y:this.y,width:this.width,height:this.height}=this.#a.box;const e=new ar(this.#i,.0025,.001,this._uiManager.direction==="ltr");this.#s=e.getOutlines();const{lastPoint:i}=this.#s.box;this.#d=[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height]}#b({highlightOutlines:t,highlightId:e,clipPathId:i}){this.#a=t;const s=1.5;if(this.#s=t.getNewOutline(this.#m/2+s,.0025),e>=0)this.#u=e,this.#n=i,this.parent.drawLayer.finalizeLine(e,t),this.#f=this.parent.drawLayer.drawOutline(this.#s);else if(this.parent){const c=this.parent.viewport.rotation;this.parent.drawLayer.updateLine(this.#u,t),this.parent.drawLayer.updateBox(this.#u,Ne.#x(this.#a.box,(c-this.rotation+360)%360)),this.parent.drawLayer.updateLine(this.#f,this.#s),this.parent.drawLayer.updateBox(this.#f,Ne.#x(this.#s.box,c))}const{x:n,y:a,width:r,height:o}=t.box;switch(this.rotation){case 0:this.x=n,this.y=a,this.width=r,this.height=o;break;case 90:{const[c,h]=this.parentDimensions;this.x=a,this.y=1-n,this.width=r*h/c,this.height=o*c/h;break}case 180:this.x=1-n,this.y=1-a,this.width=r,this.height=o;break;case 270:{const[c,h]=this.parentDimensions;this.x=1-a,this.y=n,this.width=r*h/c,this.height=o*c/h;break}}const{lastPoint:l}=this.#s.box;this.#d=[(l[0]-n)/r,(l[1]-a)/o]}static initialize(t,e){ce.initialize(t,e),Ne._defaultColor||=e.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(t,e){switch(t){case he.HIGHLIGHT_DEFAULT_COLOR:Ne._defaultColor=e;break;case he.HIGHLIGHT_THICKNESS:Ne._defaultThickness=e;break}}translateInPage(t,e){}get toolbarPosition(){return this.#d}updateParams(t,e){switch(t){case he.HIGHLIGHT_COLOR:this.#A(e);break;case he.HIGHLIGHT_THICKNESS:this.#E(e);break}}static get defaultPropertiesToUpdate(){return[[he.HIGHLIGHT_DEFAULT_COLOR,Ne._defaultColor],[he.HIGHLIGHT_THICKNESS,Ne._defaultThickness]]}get propertiesToUpdate(){return[[he.HIGHLIGHT_COLOR,this.color||Ne._defaultColor],[he.HIGHLIGHT_THICKNESS,this.#m||Ne._defaultThickness],[he.HIGHLIGHT_FREE,this.#o]]}#A(t){const e=(n,a)=>{this.color=n,this.parent?.drawLayer.changeColor(this.#u,n),this.#r?.updateColor(n),this.#p=a,this.parent?.drawLayer.changeOpacity(this.#u,a)},i=this.color,s=this.#p;this.addCommands({cmd:e.bind(this,t,Ne._defaultOpacity),undo:e.bind(this,i,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:he.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0)}#E(t){const e=this.#m,i=s=>{this.#m=s,this.#T(s)};this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:he.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)}async addEditToolbar(){const t=await super.addEditToolbar();return t?(this._uiManager.highlightColors&&(this.#r=new lt({editor:this}),t.addColorPicker(this.#r)),t):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#R())}getBaseTranslation(){return[0,0]}getRect(t,e){return super.getRect(t,e,this.#R())}onceAdded(){this.annotationElementId||this.parent.addUndoableEditor(this),this.div.focus()}remove(){this.#N(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#C(),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?this.#N():t&&(this.#C(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),this.show(this._isVisible),e&&this.select()}#T(t){if(!this.#o)return;this.#b({highlightOutlines:this.#a.getNewOutline(t/2)}),this.fixAndSetPosition();const[e,i]=this.parentDimensions;this.setDims(this.width*e,this.height*i)}#N(){this.#u===null||!this.parent||(this.parent.drawLayer.remove(this.#u),this.#u=null,this.parent.drawLayer.remove(this.#f),this.#f=null)}#C(t=this.parent){this.#u===null&&({id:this.#u,clipPathId:this.#n}=t.drawLayer.draw(this.#a,this.color,this.#p),this.#f=t.drawLayer.drawOutline(this.#s),this.#h&&(this.#h.style.clipPath=this.#n))}static#x({x:t,y:e,width:i,height:s},n){switch(n){case 90:return{x:1-e-s,y:t,width:s,height:i};case 180:return{x:1-t-i,y:1-e-s,width:i,height:s};case 270:return{x:e,y:1-t-i,width:s,height:i}}return{x:t,y:e,width:i,height:s}}rotate(t){const{drawLayer:e}=this.parent;let i;this.#o?(t=(t-this.rotation+360)%360,i=Ne.#x(this.#a.box,t)):i=Ne.#x(this,t),e.rotate(this.#u,t),e.rotate(this.#f,t),e.updateBox(this.#u,i),e.updateBox(this.#f,Ne.#x(this.#s.box,t))}render(){if(this.div)return this.div;const t=super.render();this.#v&&(t.setAttribute("aria-label",this.#v),t.setAttribute("role","mark")),this.#o?t.classList.add("free"):this.div.addEventListener("keydown",this.#_.bind(this),{signal:this._uiManager._signal});const e=this.#h=document.createElement("div");t.append(e),e.setAttribute("aria-hidden","true"),e.className="internal",e.style.clipPath=this.#n;const[i,s]=this.parentDimensions;return this.setDims(this.width*i,this.height*s),Hi(this,this.#h,["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){this.isSelected||this.parent.drawLayer.addClass(this.#f,"hovered")}pointerleave(){this.isSelected||this.parent.drawLayer.removeClass(this.#f,"hovered")}#_(t){Ne._keyboardManager.exec(this,t)}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:this.#P(!0);break;case 1:case 3:this.#P(!1);break}}#P(t){if(!this.#e)return;const e=window.getSelection();t?e.setPosition(this.#e,this.#t):e.setPosition(this.#l,this.#c)}select(){super.select(),this.#f&&(this.parent?.drawLayer.removeClass(this.#f,"hovered"),this.parent?.drawLayer.addClass(this.#f,"selected"))}unselect(){super.unselect(),this.#f&&(this.parent?.drawLayer.removeClass(this.#f,"selected"),this.#o||this.#P(!1))}get _mustFixPosition(){return!this.#o}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.show(this.#u,t),this.parent.drawLayer.show(this.#f,t))}#R(){return this.#o?this.rotation:0}#k(){if(this.#o)return null;const[t,e]=this.pageDimensions,[i,s]=this.pageTranslation,n=this.#i,a=new Float32Array(n.length*8);let r=0;for(const{x:o,y:l,width:c,height:h}of n){const d=o*t+i,f=(1-l-h)*e+s;a[r]=a[r+4]=d,a[r+1]=a[r+3]=f,a[r+2]=a[r+6]=d+c*t,a[r+5]=a[r+7]=f+h*e,r+=8}return a}#S(t){return this.#a.serialize(t,this.#R())}static startHighlighting(t,e,{target:i,x:s,y:n}){const{x:a,y:r,width:o,height:l}=i.getBoundingClientRect(),c=new AbortController,h=t.combinedSignal(c),d=p=>{p.preventDefault(),p.stopPropagation()},f=p=>{c.abort(),this.#I(t,p)};window.addEventListener("blur",f,{signal:h}),window.addEventListener("pointerup",f,{signal:h}),window.addEventListener("pointerdown",d,{capture:!0,passive:!1,signal:h}),window.addEventListener("contextmenu",ht,{signal:h}),i.addEventListener("pointermove",this.#w.bind(this,t),{signal:h}),this._freeHighlight=new Is({x:s,y:n},[a,r,o,l],t.scale,this._defaultThickness/2,e,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw(this._freeHighlight,this._defaultColor,this._defaultOpacity,!0)}static#w(t,e){this._freeHighlight.add(e)&&t.drawLayer.updatePath(this._freeHighlightId,this._freeHighlight)}static#I(t,e){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(e,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(t,e,i){let s=null;if(t instanceof lo){const{data:{quadPoints:p,rect:m,rotation:v,id:w,color:S,opacity:_,popupRef:A},parent:{page:{pageNumber:P}}}=t;s=t={annotationType:fe.HIGHLIGHT,color:Array.from(S),opacity:_,quadPoints:p,boxes:null,pageIndex:P-1,rect:m.slice(0),rotation:v,id:w,deleted:!1,popupRef:A}}else if(t instanceof an){const{data:{inkLists:p,rect:m,rotation:v,id:w,color:S,borderStyle:{rawWidth:_},popupRef:A},parent:{page:{pageNumber:P}}}=t;s=t={annotationType:fe.HIGHLIGHT,color:Array.from(S),thickness:_,inkLists:p,boxes:null,pageIndex:P-1,rect:m.slice(0),rotation:v,id:w,deleted:!1,popupRef:A}}const{color:n,quadPoints:a,inkLists:r,opacity:o}=t,l=await super.deserialize(t,e,i);l.color=ne.makeHexColor(...n),l.#p=o||1,r&&(l.#m=t.thickness),l.annotationElementId=t.id||null,l._initialData=s;const[c,h]=l.pageDimensions,[d,f]=l.pageTranslation;if(a){const p=l.#i=[];for(let m=0;m<a.length;m+=8)p.push({x:(a[m]-d)/c,y:1-(a[m+1]-f)/h,width:(a[m+2]-a[m])/c,height:(a[m+1]-a[m+5])/h});l.#y(),l.#C(),l.rotate(l.rotation)}else if(r){l.#o=!0;const p=r[0],m={x:p[0]-d,y:h-(p[1]-f)},v=new Is(m,[0,0,c,h],1,l.#m/2,!0,.001);for(let _=0,A=p.length;_<A;_+=2)m.x=p[_]-d,m.y=h-(p[_+1]-f),v.add(m);const{id:w,clipPathId:S}=e.drawLayer.draw(v,l.color,l._defaultOpacity,!0);l.#b({highlightOutlines:v.getOutlines(),highlightId:w,clipPathId:S}),l.#C()}return l}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const e=this.getRect(0,0),i=ce._colorManager.convert(this.color),s={annotationType:fe.HIGHLIGHT,color:i,opacity:this.#p,thickness:this.#m,quadPoints:this.#k(),outlines:this.#S(e),pageIndex:this.pageIndex,rect:e,rotation:this.#R(),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!this.#M(s)?null:(s.id=this.annotationElementId,s)}#M(t){const{color:e}=this._initialData;return t.color.some((i,s)=>i!==e[s])}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}}class We extends ce{#e=0;#t=0;#i=null;#n=new Path2D;#r=!1;#s=null;#l=!1;#c=!1;#h=null;#a=null;#u=0;#o=0;#d=null;static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=1;static _type="ink";static _editorType=fe.INK;constructor(t){super({...t,name:"inkEditor"}),this.color=t.color||null,this.thickness=t.thickness||null,this.opacity=t.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(t,e){ce.initialize(t,e)}static updateDefaultParams(t,e){switch(t){case he.INK_THICKNESS:We._defaultThickness=e;break;case he.INK_COLOR:We._defaultColor=e;break;case he.INK_OPACITY:We._defaultOpacity=e/100;break}}updateParams(t,e){switch(t){case he.INK_THICKNESS:this.#p(e);break;case he.INK_COLOR:this.#f(e);break;case he.INK_OPACITY:this.#v(e);break}}static get defaultPropertiesToUpdate(){return[[he.INK_THICKNESS,We._defaultThickness],[he.INK_COLOR,We._defaultColor||ce._defaultLineColor],[he.INK_OPACITY,Math.round(We._defaultOpacity*100)]]}get propertiesToUpdate(){return[[he.INK_THICKNESS,this.thickness||We._defaultThickness],[he.INK_COLOR,this.color||We._defaultColor||ce._defaultLineColor],[he.INK_OPACITY,Math.round(100*(this.opacity??We._defaultOpacity))]]}#p(t){const e=s=>{this.thickness=s,this.#L()},i=this.thickness;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:he.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})}#f(t){const e=s=>{this.color=s,this.#x()},i=this.color;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:he.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})}#v(t){const e=s=>{this.opacity=s,this.#x()};t/=100;const i=this.opacity;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:he.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.canvas||(this.#k(),this.#S()),this.isAttachedToDOM||(this.parent.add(this),this.#w()),this.#L()))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,this.#i&&(clearTimeout(this.#i),this.#i=null),this.#h?.disconnect(),this.#h=null,super.remove())}setParent(t){!this.parent&&t?this._uiManager.removeShouldRescale(this):this.parent&&t===null&&this._uiManager.addShouldRescale(this),super.setParent(t)}onScaleChanging(){const[t,e]=this.parentDimensions,i=this.width*t,s=this.height*e;this.setDimensions(i,s)}enableEditMode(){this.#r||this.canvas===null||(super.enableEditMode(),this._isDraggable=!1,this.#_())}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.#P())}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}#m(){const{parentRotation:t,parentDimensions:[e,i]}=this;switch(t){case 90:return[0,i,i,e];case 180:return[e,i,e,i];case 270:return[e,0,i,e];default:return[0,0,e,i]}}#g(){const{ctx:t,color:e,opacity:i,thickness:s,parentScale:n,scaleFactor:a}=this;t.lineWidth=s*n/a,t.lineCap="round",t.lineJoin="round",t.miterLimit=10,t.strokeStyle=`${e}${n5(i)}`}#y(t,e){this.canvas.addEventListener("contextmenu",ht,{signal:this._uiManager._signal}),this.#P(),this.#s=new AbortController;const i=this._uiManager.combinedSignal(this.#s);this.canvas.addEventListener("pointerleave",this.canvasPointerleave.bind(this),{signal:i}),this.canvas.addEventListener("pointermove",this.canvasPointermove.bind(this),{signal:i}),this.canvas.addEventListener("pointerup",this.canvasPointerup.bind(this),{signal:i}),this.isEditing=!0,this.#c||(this.#c=!0,this.#w(),this.thickness||=We._defaultThickness,this.color||=We._defaultColor||ce._defaultLineColor,this.opacity??=We._defaultOpacity),this.currentPath.push([t,e]),this.#l=!1,this.#g(),this.#d=()=>{this.#T(),this.#d&&window.requestAnimationFrame(this.#d)},window.requestAnimationFrame(this.#d)}#b(t,e){const[i,s]=this.currentPath.at(-1);if(this.currentPath.length>1&&t===i&&e===s)return;const n=this.currentPath;let a=this.#n;if(n.push([t,e]),this.#l=!0,n.length<=2){a.moveTo(...n[0]),a.lineTo(t,e);return}n.length===3&&(this.#n=a=new Path2D,a.moveTo(...n[0])),this.#N(a,...n.at(-3),...n.at(-2),t,e)}#A(){if(this.currentPath.length===0)return;const t=this.currentPath.at(-1);this.#n.lineTo(...t)}#E(t,e){this.#d=null,t=Math.min(Math.max(t,0),this.canvas.width),e=Math.min(Math.max(e,0),this.canvas.height),this.#b(t,e),this.#A();let i;if(this.currentPath.length!==1)i=this.#C();else{const o=[t,e];i=[[o,o.slice(),o.slice(),o]]}const s=this.#n,n=this.currentPath;this.currentPath=[],this.#n=new Path2D;const a=()=>{this.allRawPaths.push(n),this.paths.push(i),this.bezierPath2D.push(s),this._uiManager.rebuild(this)},r=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(this.#k(),this.#S()),this.#L())};this.addCommands({cmd:a,undo:r,mustExec:!0})}#T(){if(!this.#l)return;this.#l=!1;const t=Math.ceil(this.thickness*this.parentScale),e=this.currentPath.slice(-3),i=e.map(a=>a[0]),s=e.map(a=>a[1]);Math.min(...i)-t,Math.max(...i)+t,Math.min(...s)-t,Math.max(...s)+t;const{ctx:n}=this;n.save(),n.clearRect(0,0,this.canvas.width,this.canvas.height);for(const a of this.bezierPath2D)n.stroke(a);n.stroke(this.#n),n.restore()}#N(t,e,i,s,n,a,r){const o=(e+s)/2,l=(i+n)/2,c=(s+a)/2,h=(n+r)/2;t.bezierCurveTo(o+2*(s-o)/3,l+2*(n-l)/3,c+2*(s-c)/3,h+2*(n-h)/3,c,h)}#C(){const t=this.currentPath;if(t.length<=2)return[[t[0],t[0],t.at(-1),t.at(-1)]];const e=[];let i,[s,n]=t[0];for(i=1;i<t.length-2;i++){const[d,f]=t[i],[p,m]=t[i+1],v=(d+p)/2,w=(f+m)/2,S=[s+2*(d-s)/3,n+2*(f-n)/3],_=[v+2*(d-v)/3,w+2*(f-w)/3];e.push([[s,n],S,_,[v,w]]),[s,n]=[v,w]}const[a,r]=t[i],[o,l]=t[i+1],c=[s+2*(a-s)/3,n+2*(r-n)/3],h=[o+2*(a-o)/3,l+2*(r-l)/3];return e.push([[s,n],c,h,[o,l]]),e}#x(){if(this.isEmpty()){this.#M();return}this.#g();const{canvas:t,ctx:e}=this;e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,t.width,t.height),this.#M();for(const i of this.bezierPath2D)e.stroke(i)}commit(){this.#r||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),this.#r=!0,this.div.classList.add("disabled"),this.#L(!0),this.select(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),this.enableEditMode())}#_(){if(this.#a)return;this.#a=new AbortController;const t=this._uiManager.combinedSignal(this.#a);this.canvas.addEventListener("pointerdown",this.canvasPointerdown.bind(this),{signal:t})}#P(){this.pointerdownAC?.abort(),this.pointerdownAC=null}canvasPointerdown(t){t.button!==0||!this.isInEditMode()||this.#r||(this.setInForeground(),t.preventDefault(),this.div.contains(document.activeElement)||this.div.focus({preventScroll:!0}),this.#y(t.offsetX,t.offsetY))}canvasPointermove(t){t.preventDefault(),this.#b(t.offsetX,t.offsetY)}canvasPointerup(t){t.preventDefault(),this.#R(t)}canvasPointerleave(t){this.#R(t)}#R(t){this.#s?.abort(),this.#s=null,this.#_(),this.#i&&clearTimeout(this.#i),this.#i=setTimeout(()=>{this.#i=null,this.canvas.removeEventListener("contextmenu",ht)},10),this.#E(t.offsetX,t.offsetY),this.addToAnnotationStorage(),this.setInBackground()}#k(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",this.canvas.setAttribute("data-l10n-id","pdfjs-ink-canvas"),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")}#S(){this.#h=new ResizeObserver(t=>{const e=t[0].contentRect;e.width&&e.height&&this.setDimensions(e.width,e.height)}),this.#h.observe(this.div),this._uiManager._signal.addEventListener("abort",()=>{this.#h?.disconnect(),this.#h=null},{once:!0})}get isResizable(){return!this.isEmpty()&&this.#r}render(){if(this.div)return this.div;let t,e;this.width&&(t=this.x,e=this.y),super.render(),this.div.setAttribute("data-l10n-id","pdfjs-ink");const[i,s,n,a]=this.#m();if(this.setAt(i,s,0,0),this.setDims(n,a),this.#k(),this.width){const[r,o]=this.parentDimensions;this.setAspectRatio(this.width*r,this.height*o),this.setAt(t*r,e*o,this.width*r,this.height*o),this.#c=!0,this.#w(),this.setDims(this.width*r,this.height*o),this.#x(),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return this.#S(),this.div}#w(){if(!this.#c)return;const[t,e]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*t),this.canvas.height=Math.ceil(this.height*e),this.#M()}setDimensions(t,e){const i=Math.round(t),s=Math.round(e);if(this.#u===i&&this.#o===s)return;this.#u=i,this.#o=s,this.canvas.style.visibility="hidden";const[n,a]=this.parentDimensions;this.width=t/n,this.height=e/a,this.fixAndSetPosition(),this.#r&&this.#I(t,e),this.#w(),this.#x(),this.canvas.style.visibility="visible",this.fixDims()}#I(t,e){const i=this.#z(),s=(t-i)/this.#t,n=(e-i)/this.#e;this.scaleFactor=Math.min(s,n)}#M(){const t=this.#z()/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+t,this.translationY*this.scaleFactor+t)}static#F(t){const e=new Path2D;for(let i=0,s=t.length;i<s;i++){const[n,a,r,o]=t[i];i===0&&e.moveTo(...n),e.bezierCurveTo(a[0],a[1],r[0],r[1],o[0],o[1])}return e}static#U(t,e,i){const[s,n,a,r]=e;switch(i){case 0:for(let o=0,l=t.length;o<l;o+=2)t[o]+=s,t[o+1]=r-t[o+1];break;case 90:for(let o=0,l=t.length;o<l;o+=2){const c=t[o];t[o]=t[o+1]+s,t[o+1]=c+n}break;case 180:for(let o=0,l=t.length;o<l;o+=2)t[o]=a-t[o],t[o+1]+=n;break;case 270:for(let o=0,l=t.length;o<l;o+=2){const c=t[o];t[o]=a-t[o+1],t[o+1]=r-c}break;default:throw new Error("Invalid rotation")}return t}static#H(t,e,i){const[s,n,a,r]=e;switch(i){case 0:for(let o=0,l=t.length;o<l;o+=2)t[o]-=s,t[o+1]=r-t[o+1];break;case 90:for(let o=0,l=t.length;o<l;o+=2){const c=t[o];t[o]=t[o+1]-n,t[o+1]=c-s}break;case 180:for(let o=0,l=t.length;o<l;o+=2)t[o]=a-t[o],t[o+1]-=n;break;case 270:for(let o=0,l=t.length;o<l;o+=2){const c=t[o];t[o]=r-t[o+1],t[o+1]=a-c}break;default:throw new Error("Invalid rotation")}return t}#O(t,e,i,s){const n=[],a=this.thickness/2,r=t*e+a,o=t*i+a;for(const l of this.paths){const c=[],h=[];for(let d=0,f=l.length;d<f;d++){const[p,m,v,w]=l[d];if(p[0]===w[0]&&p[1]===w[1]&&f===1){const U=t*p[0]+r,G=t*p[1]+o;c.push(U,G),h.push(U,G);break}const S=t*p[0]+r,_=t*p[1]+o,A=t*m[0]+r,P=t*m[1]+o,k=t*v[0]+r,N=t*v[1]+o,O=t*w[0]+r,j=t*w[1]+o;d===0&&(c.push(S,_),h.push(S,_)),c.push(A,P,k,N,O,j),h.push(A,P),d===f-1&&h.push(O,j)}n.push({bezier:We.#U(c,s,this.rotation),points:We.#U(h,s,this.rotation)})}return n}#j(){let t=1/0,e=-1/0,i=1/0,s=-1/0;for(const n of this.paths)for(const[a,r,o,l]of n){const c=ne.bezierBoundingBox(...a,...r,...o,...l);t=Math.min(t,c[0]),i=Math.min(i,c[1]),e=Math.max(e,c[2]),s=Math.max(s,c[3])}return[t,i,e,s]}#z(){return this.#r?Math.ceil(this.thickness*this.parentScale):0}#L(t=!1){if(this.isEmpty())return;if(!this.#r){this.#x();return}const e=this.#j(),i=this.#z();this.#t=Math.max(ce.MIN_SIZE,e[2]-e[0]),this.#e=Math.max(ce.MIN_SIZE,e[3]-e[1]);const s=Math.ceil(i+this.#t*this.scaleFactor),n=Math.ceil(i+this.#e*this.scaleFactor),[a,r]=this.parentDimensions;this.width=s/a,this.height=n/r,this.setAspectRatio(s,n);const o=this.translationX,l=this.translationY;this.translationX=-e[0],this.translationY=-e[1],this.#w(),this.#x(),this.#u=s,this.#o=n,this.setDims(s,n);const c=t?i/this.scaleFactor/2:0;this.translate(o-this.translationX-c,l-this.translationY-c)}static async deserialize(t,e,i){if(t instanceof an)return null;const s=await super.deserialize(t,e,i);s.thickness=t.thickness,s.color=ne.makeHexColor(...t.color),s.opacity=t.opacity;const[n,a]=s.pageDimensions,r=s.width*n,o=s.height*a,l=s.parentScale,c=t.thickness/2;s.#r=!0,s.#u=Math.round(r),s.#o=Math.round(o);const{paths:h,rect:d,rotation:f}=t;for(let{bezier:m}of h){m=We.#H(m,d,f);const v=[];s.paths.push(v);let w=l*(m[0]-c),S=l*(m[1]-c);for(let A=2,P=m.length;A<P;A+=6){const k=l*(m[A]-c),N=l*(m[A+1]-c),O=l*(m[A+2]-c),j=l*(m[A+3]-c),U=l*(m[A+4]-c),G=l*(m[A+5]-c);v.push([[w,S],[k,N],[O,j],[U,G]]),w=U,S=G}const _=this.#F(v);s.bezierPath2D.push(_)}const p=s.#j();return s.#t=Math.max(ce.MIN_SIZE,p[2]-p[0]),s.#e=Math.max(ce.MIN_SIZE,p[3]-p[1]),s.#I(r,o),s}serialize(){if(this.isEmpty())return null;const t=this.getRect(0,0),e=ce._colorManager.convert(this.ctx.strokeStyle);return{annotationType:fe.INK,color:e,thickness:this.thickness,opacity:this.opacity,paths:this.#O(this.scaleFactor/this.parentScale,this.translationX,this.translationY,t),pageIndex:this.pageIndex,rect:t,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}}class ln extends ce{#e=null;#t=null;#i=null;#n=null;#r=null;#s="";#l=null;#c=null;#h=null;#a=!1;#u=!1;static _type="stamp";static _editorType=fe.STAMP;constructor(t){super({...t,name:"stampEditor"}),this.#n=t.bitmapUrl,this.#r=t.bitmapFile}static initialize(t,e){ce.initialize(t,e)}static get supportedTypes(){return xe(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(e=>`image/${e}`))}static get supportedTypesStr(){return xe(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(t){return this.supportedTypes.includes(t)}static paste(t,e){e.pasteEditor(fe.STAMP,{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(t){const e=t.get("hasAltText");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}#o(t,e=!1){if(!t){this.remove();return}this.#e=t.bitmap,e||(this.#t=t.id,this.#a=t.isSvg),t.file&&(this.#s=t.file.name),this.#f()}#d(){if(this.#i=null,this._uiManager.enableWaiting(!1),!!this.#l){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#e){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#e){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(t=null,e=!0){if(this.hasAltTextData())return null;const{mlManager:i}=this._uiManager;if(!i)throw new Error("No ML.");if(!await i.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:s,width:n,height:a}=t||this.copyCanvas(null,null,!0).imageData,r=await i.guess({name:"altText",request:{data:s,width:n,height:a,channels:s.length/(n*a)}});if(!r)throw new Error("No response from the AI service.");if(r.error)throw new Error("Error from the AI service.");if(r.cancel)return null;if(!r.output)throw new Error("No valid response from the AI service.");const o=r.output;return await this.setGuessedAltText(o),e&&!this.hasAltTextData()&&(this.altTextData={alt:o,decorative:!1}),o}#p(){if(this.#t){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#t).then(i=>this.#o(i,!0)).finally(()=>this.#d());return}if(this.#n){const i=this.#n;this.#n=null,this._uiManager.enableWaiting(!0),this.#i=this._uiManager.imageManager.getFromUrl(i).then(s=>this.#o(s)).finally(()=>this.#d());return}if(this.#r){const i=this.#r;this.#r=null,this._uiManager.enableWaiting(!0),this.#i=this._uiManager.imageManager.getFromFile(i).then(s=>this.#o(s)).finally(()=>this.#d());return}const t=document.createElement("input");t.type="file",t.accept=ln.supportedTypesStr;const e=this._uiManager._signal;this.#i=new Promise(i=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const s=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#o(s)}i()},{signal:e}),t.addEventListener("cancel",()=>{this.remove(),i()},{signal:e})}).finally(()=>this.#d()),t.click()}remove(){this.#t&&(this.#e=null,this._uiManager.imageManager.deleteId(this.#t),this.#l?.remove(),this.#l=null,this.#c?.disconnect(),this.#c=null,this.#h&&(clearTimeout(this.#h),this.#h=null)),super.remove()}rebuild(){if(!this.parent){this.#t&&this.#p();return}super.rebuild(),this.div!==null&&(this.#t&&this.#l===null&&this.#p(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(this.#i||this.#e||this.#n||this.#r||this.#t)}get isResizable(){return!0}render(){if(this.div)return this.div;let t,e;if(this.width&&(t=this.x,e=this.y),super.render(),this.div.hidden=!0,this.div.setAttribute("role","figure"),this.addAltTextButton(),this.#e?this.#f():this.#p(),this.width&&!this.annotationElementId){const[i,s]=this.parentDimensions;this.setAt(t*i,e*s,this.width*i,this.height*s)}return this.div}#f(){const{div:t}=this;let{width:e,height:i}=this.#e;const[s,n]=this.pageDimensions,a=.75;if(this.width)e=this.width*s,i=this.height*n;else if(e>a*s||i>a*n){const c=Math.min(a*s/e,a*n/i);e*=c,i*=c}const[r,o]=this.parentDimensions;this.setDims(e*r/s,i*o/n),this._uiManager.enableWaiting(!1);const l=this.#l=document.createElement("canvas");l.setAttribute("role","img"),this.addContainer(l),(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),this.#g(e,i),this.#b(),this.#u||(this.parent.addUndoableEditor(this),this.#u=!0),this._reportTelemetry({action:"inserted_image"}),this.#s&&l.setAttribute("aria-label",this.#s)}copyCanvas(t,e,i=!1){t||(t=224);const{width:s,height:n}=this.#e,a=new As;let r=this.#e,o=s,l=n,c=null;if(e){if(s>e||n>e){const k=Math.min(e/s,e/n);o=Math.floor(s*k),l=Math.floor(n*k)}c=document.createElement("canvas");const d=c.width=Math.ceil(o*a.sx),f=c.height=Math.ceil(l*a.sy);this.#a||(r=this.#m(d,f));const p=c.getContext("2d");p.filter=this._uiManager.hcmFilter;let m="white",v="#cfcfd8";this._uiManager.hcmFilter!=="none"?v="black":window.matchMedia?.("(prefers-color-scheme: dark)").matches&&(m="#8f8f9d",v="#42414d");const w=15,S=w*a.sx,_=w*a.sy,A=new OffscreenCanvas(S*2,_*2),P=A.getContext("2d");P.fillStyle=m,P.fillRect(0,0,S*2,_*2),P.fillStyle=v,P.fillRect(0,0,S,_),P.fillRect(S,_,S,_),p.fillStyle=p.createPattern(A,"repeat"),p.fillRect(0,0,d,f),p.drawImage(r,0,0,r.width,r.height,0,0,d,f)}let h=null;if(i){let d,f;if(a.symmetric&&r.width<t&&r.height<t)d=r.width,f=r.height;else if(r=this.#e,s>t||n>t){const v=Math.min(t/s,t/n);d=Math.floor(s*v),f=Math.floor(n*v),this.#a||(r=this.#m(d,f))}const m=new OffscreenCanvas(d,f).getContext("2d",{willReadFrequently:!0});m.drawImage(r,0,0,r.width,r.height,0,0,d,f),h={width:d,height:f,data:m.getImageData(0,0,d,f).data}}return{canvas:c,width:o,height:l,imageData:h}}#v(t,e){const[i,s]=this.parentDimensions;this.width=t/i,this.height=e/s,this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,this.#h!==null&&clearTimeout(this.#h);const n=200;this.#h=setTimeout(()=>{this.#h=null,this.#g(t,e)},n)}#m(t,e){const{width:i,height:s}=this.#e;let n=i,a=s,r=this.#e;for(;n>2*t||a>2*e;){const o=n,l=a;n>2*t&&(n=n>=16384?Math.floor(n/2)-1:Math.ceil(n/2)),a>2*e&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2));const c=new OffscreenCanvas(n,a);c.getContext("2d").drawImage(r,0,0,o,l,0,0,n,a),r=c.transferToImageBitmap()}return r}#g(t,e){const i=new As,s=Math.ceil(t*i.sx),n=Math.ceil(e*i.sy),a=this.#l;if(!a||a.width===s&&a.height===n)return;a.width=s,a.height=n;const r=this.#a?this.#e:this.#m(s,n),o=a.getContext("2d");o.filter=this._uiManager.hcmFilter,o.drawImage(r,0,0,r.width,r.height,0,0,s,n)}getImageForAltText(){return this.#l}#y(t){if(t){if(this.#a){const s=this._uiManager.imageManager.getSvgUrl(this.#t);if(s)return s}const e=document.createElement("canvas");return{width:e.width,height:e.height}=this.#e,e.getContext("2d").drawImage(this.#e,0,0),e.toDataURL()}if(this.#a){const[e,i]=this.pageDimensions,s=Math.round(this.width*e*ii.PDF_TO_CSS_UNITS),n=Math.round(this.height*i*ii.PDF_TO_CSS_UNITS),a=new OffscreenCanvas(s,n);return a.getContext("2d").drawImage(this.#e,0,0,this.#e.width,this.#e.height,0,0,s,n),a.transferToImageBitmap()}return structuredClone(this.#e)}#b(){this._uiManager._signal&&(this.#c=new ResizeObserver(t=>{const e=t[0].contentRect;e.width&&e.height&&this.#v(e.width,e.height)}),this.#c.observe(this.div),this._uiManager._signal.addEventListener("abort",()=>{this.#c?.disconnect(),this.#c=null},{once:!0}))}static async deserialize(t,e,i){let s=null;if(t instanceof co){const{data:{rect:p,rotation:m,id:v,structParent:w,popupRef:S},container:_,parent:{page:{pageNumber:A}}}=t,P=_.querySelector("canvas"),k=i.imageManager.getFromCanvas(_.id,P);P.remove();const N=(await e._structTree.getAriaAttributes(`${Ws}${v}`))?.get("aria-label")||"";s=t={annotationType:fe.STAMP,bitmapId:k.id,bitmap:k.bitmap,pageIndex:A-1,rect:p.slice(0),rotation:m,id:v,deleted:!1,accessibilityData:{decorative:!1,altText:N},isSvg:!1,structParent:w,popupRef:S}}const n=await super.deserialize(t,e,i),{rect:a,bitmap:r,bitmapUrl:o,bitmapId:l,isSvg:c,accessibilityData:h}=t;l&&i.imageManager.isValidId(l)?(n.#t=l,r&&(n.#e=r)):n.#n=o,n.#a=c;const[d,f]=n.pageDimensions;return n.width=(a[2]-a[0])/d,n.height=(a[3]-a[1])/f,n.annotationElementId=t.id||null,h&&(n.altTextData=h),n._initialData=s,n.#u=!!s,n}serialize(t=!1,e=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const i={annotationType:fe.STAMP,bitmapId:this.#t,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#a,structTreeParentId:this._structTreeParentId};if(t)return i.bitmapUrl=this.#y(!0),i.accessibilityData=this.serializeAltText(!0),i;const{decorative:s,altText:n}=this.serializeAltText(!1);if(!s&&n&&(i.accessibilityData={type:"Figure",alt:n}),this.annotationElementId){const r=this.#A(i);if(r.isSame)return null;r.isSameAltText?delete i.accessibilityData:i.accessibilityData.structParent=this._initialData.structParent??-1}if(i.id=this.annotationElementId,e===null)return i;e.stamps||=new Map;const a=this.#a?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(!e.stamps.has(this.#t))e.stamps.set(this.#t,{area:a,serialized:i}),i.bitmap=this.#y(!1);else if(this.#a){const r=e.stamps.get(this.#t);a>r.area&&(r.area=a,r.serialized.bitmap.close(),r.serialized.bitmap=this.#y(!1))}return i}#A(t){const{rect:e,pageIndex:i,accessibilityData:{altText:s}}=this._initialData,n=t.rect.every((o,l)=>Math.abs(o-e[l])<1),a=t.pageIndex===i,r=(t.accessibilityData?.alt||"")===s;return{isSame:n&&a&&r,isSameAltText:r}}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}}class wt{#e;#t=!1;#i=null;#n=null;#r=null;#s=new Map;#l=!1;#c=!1;#h=!1;#a=null;#u=null;#o;static _initialized=!1;static#d=new Map([Be,We,ln,Ne].map(t=>[t._editorType,t]));constructor({uiManager:t,pageIndex:e,div:i,structTreeLayer:s,accessibilityManager:n,annotationLayer:a,drawLayer:r,textLayer:o,viewport:l,l10n:c}){const h=[...wt.#d.values()];if(!wt._initialized){wt._initialized=!0;for(const d of h)d.initialize(c,t)}t.registerEditorTypes(h),this.#o=t,this.pageIndex=e,this.div=i,this.#e=n,this.#i=a,this.viewport=l,this.#a=o,this.drawLayer=r,this._structTree=s,this.#o.addLayer(this)}get isEmpty(){return this.#s.size===0}get isInvisible(){return this.isEmpty&&this.#o.getMode()===fe.NONE}updateToolbar(t){this.#o.updateToolbar(t)}updateMode(t=this.#o.getMode()){switch(this.#g(),t){case fe.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case fe.INK:this.addInkEditorIfNeeded(!1),this.disableTextSelection(),this.togglePointerEvents(!0),this.disableClick();break;case fe.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:e}=this.div;for(const i of wt.#d.values())e.toggle(`${i._type}Editing`,t===i._editorType);this.div.hidden=!1}hasTextLayer(t){return t===this.#a?.div}addInkEditorIfNeeded(t){if(this.#o.getMode()!==fe.INK)return;if(!t){for(const i of this.#s.values())if(i.isEmpty()){i.setInBackground();return}}this.createAndAddNewEditor({offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(t){this.#o.setEditingState(t)}addCommands(t){this.#o.addCommands(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){this.#i?.div.classList.toggle("disabled",!t)}async enable(){this.div.tabIndex=0,this.togglePointerEvents(!0);const t=new Set;for(const i of this.#s.values())i.enableEditing(),i.show(!0),i.annotationElementId&&(this.#o.removeChangedExistingAnnotation(i),t.add(i.annotationElementId));if(!this.#i)return;const e=this.#i.getEditableAnnotations();for(const i of e){if(i.hide(),this.#o.isDeletedAnnotationElement(i.data.id)||t.has(i.data.id))continue;const s=await this.deserialize(i);s&&(this.addOrRebuild(s),s.enableEditing())}}disable(){this.#h=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1);const t=new Map,e=new Map;for(const s of this.#s.values())if(s.disableEditing(),!!s.annotationElementId){if(s.serialize()!==null){t.set(s.annotationElementId,s);continue}else e.set(s.annotationElementId,s);this.getEditableAnnotation(s.annotationElementId)?.show(),s.remove()}if(this.#i){const s=this.#i.getEditableAnnotations();for(const n of s){const{id:a}=n.data;if(this.#o.isDeletedAnnotationElement(a))continue;let r=e.get(a);if(r){r.resetAnnotationElement(n),r.show(!1),n.show();continue}r=t.get(a),r&&(this.#o.addChangedExistingAnnotation(r),r.renderAnnotationElement(n)&&r.show(!1)),n.show()}}this.#g(),this.isEmpty&&(this.div.hidden=!0);const{classList:i}=this.div;for(const s of wt.#d.values())i.remove(`${s._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#h=!1}getEditableAnnotation(t){return this.#i?.getEditableAnnotation(t)||null}setActiveEditor(t){this.#o.getActive()!==t&&this.#o.setActiveEditor(t)}enableTextSelection(){if(this.div.tabIndex=-1,this.#a?.div&&!this.#u){this.#u=new AbortController;const t=this.#o.combinedSignal(this.#u);this.#a.div.addEventListener("pointerdown",this.#p.bind(this),{signal:t}),this.#a.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#a?.div&&this.#u&&(this.#u.abort(),this.#u=null,this.#a.div.classList.remove("highlighting"))}#p(t){this.#o.unselectAll();const{target:e}=t;if(e===this.#a.div||(e.getAttribute("role")==="img"||e.classList.contains("endOfContent"))&&this.#a.div.contains(e)){const{isMac:i}=et.platform;if(t.button!==0||t.ctrlKey&&i)return;this.#o.showAllEditors("highlight",!0,!0),this.#a.div.classList.add("free"),this.toggleDrawing(),Ne.startHighlighting(this,this.#o.direction==="ltr",{target:this.#a.div,x:t.x,y:t.y}),this.#a.div.addEventListener("pointerup",()=>{this.#a.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#o._signal}),t.preventDefault()}}enableClick(){if(this.#n)return;this.#n=new AbortController;const t=this.#o.combinedSignal(this.#n);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t}),this.div.addEventListener("pointerup",this.pointerup.bind(this),{signal:t})}disableClick(){this.#n?.abort(),this.#n=null}attach(t){this.#s.set(t.id,t);const{annotationElementId:e}=t;e&&this.#o.isDeletedAnnotationElement(e)&&this.#o.removeDeletedAnnotationElement(t)}detach(t){this.#s.delete(t.id),this.#e?.removePointerInTextLayer(t.contentDiv),!this.#h&&t.annotationElementId&&this.#o.addDeletedAnnotationElement(t)}remove(t){this.detach(t),this.#o.removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1,this.#c||this.addInkEditorIfNeeded(!1)}changeParent(t){t.parent!==this&&(t.parent&&t.annotationElementId&&(this.#o.addDeletedAnnotationElement(t.annotationElementId),ce.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),t.parent?.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),this.#o.addEditor(t),this.attach(t),!t.isAttachedToDOM){const e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(),this.#o.addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){if(!t.isAttachedToDOM)return;const{activeElement:e}=document;t.div.contains(e)&&!this.#r&&(t._focusEventsAllowed=!1,this.#r=setTimeout(()=>{this.#r=null,t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this.#o._signal}),e.focus())},0)),t._structTreeParentId=this.#e?.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||=this,t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){const e=()=>t._uiManager.rebuild(t),i=()=>{t.remove()};this.addCommands({cmd:e,undo:i,mustExec:!1})}getNextId(){return this.#o.getId()}get#f(){return wt.#d.get(this.#o.getMode())}combinedSignal(t){return this.#o.combinedSignal(t)}#v(t){const e=this.#f;return e?new e.prototype.constructor(t):null}canCreateNewEmptyEditor(){return this.#f?.canCreateNewEmptyEditor()}pasteEditor(t,e){this.#o.updateToolbar(t),this.#o.updateMode(t);const{offsetX:i,offsetY:s}=this.#m(),n=this.getNextId(),a=this.#v({parent:this,id:n,x:i,y:s,uiManager:this.#o,isCentered:!0,...e});a&&this.add(a)}async deserialize(t){return await wt.#d.get(t.annotationType??t.annotationEditorType)?.deserialize(t,this,this.#o)||null}createAndAddNewEditor(t,e,i={}){const s=this.getNextId(),n=this.#v({parent:this,id:s,x:t.offsetX,y:t.offsetY,uiManager:this.#o,isCentered:e,...i});return n&&this.add(n),n}#m(){const{x:t,y:e,width:i,height:s}=this.div.getBoundingClientRect(),n=Math.max(0,t),a=Math.max(0,e),r=Math.min(window.innerWidth,t+i),o=Math.min(window.innerHeight,e+s),l=(n+r)/2-t,c=(a+o)/2-e,[h,d]=this.viewport.rotation%180===0?[l,c]:[c,l];return{offsetX:h,offsetY:d}}addNewEditor(){this.createAndAddNewEditor(this.#m(),!0)}setSelected(t){this.#o.setSelected(t)}toggleSelected(t){this.#o.toggleSelected(t)}unselect(t){this.#o.unselect(t)}pointerup(t){const{isMac:e}=et.platform;if(!(t.button!==0||t.ctrlKey&&e)&&t.target===this.div&&this.#l){if(this.#l=!1,!this.#t){this.#t=!0;return}if(this.#o.getMode()===fe.STAMP){this.#o.unselectAll();return}this.createAndAddNewEditor(t,!1)}}pointerdown(t){if(this.#o.getMode()===fe.HIGHLIGHT&&this.enableTextSelection(),this.#l){this.#l=!1;return}const{isMac:e}=et.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div)return;this.#l=!0;const i=this.#o.getActive();this.#t=!i||i.isEmpty()}findNewParent(t,e,i){const s=this.#o.findParent(e,i);return s===null||s===this?!1:(s.changeParent(t),!0)}destroy(){this.#o.getActive()?.parent===this&&(this.#o.commitOrRemove(),this.#o.setActiveEditor(null)),this.#r&&(clearTimeout(this.#r),this.#r=null);for(const t of this.#s.values())this.#e?.removePointerInTextLayer(t.contentDiv),t.setParent(null),t.isAttachedToDOM=!1,t.div.remove();this.div=null,this.#s.clear(),this.#o.removeLayer(this)}#g(){this.#c=!0;for(const t of this.#s.values())t.isEmpty()&&t.remove();this.#c=!1}render({viewport:t}){this.viewport=t,Ft(this.div,t);for(const e of this.#o.getEditors(this.pageIndex))this.add(e),e.rebuild();this.updateMode()}update({viewport:t}){this.#o.commitOrRemove(),this.#g();const e=this.viewport.rotation,i=t.rotation;if(this.viewport=t,Ft(this.div,{rotation:i}),e!==i)for(const s of this.#s.values())s.rotate(i);this.addInkEditorIfNeeded(!1)}get pageDimensions(){const{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return this.#o.viewParameters.realScale}}class Ke{#e=null;#t=0;#i=new Map;#n=new Map;constructor({pageIndex:t}){this.pageIndex=t}setParent(t){if(!this.#e){this.#e=t;return}if(this.#e!==t){if(this.#i.size>0)for(const e of this.#i.values())e.remove(),t.append(e);this.#e=t}}static get _svgFactory(){return xe(this,"_svgFactory",new on)}static#r(t,{x:e=0,y:i=0,width:s=1,height:n=1}={}){const{style:a}=t;a.top=`${100*i}%`,a.left=`${100*e}%`,a.width=`${100*s}%`,a.height=`${100*n}%`}#s(t){const e=Ke._svgFactory.create(1,1,!0);return this.#e.append(e),e.setAttribute("aria-hidden",!0),Ke.#r(e,t),e}#l(t,e){const i=Ke._svgFactory.createElement("clipPath");t.append(i);const s=`clip_${e}`;i.setAttribute("id",s),i.setAttribute("clipPathUnits","objectBoundingBox");const n=Ke._svgFactory.createElement("use");return i.append(n),n.setAttribute("href",`#${e}`),n.classList.add("clip"),s}draw(t,e,i,s=!1){const n=this.#t++,a=this.#s(t.box);a.classList.add(...t.classNamesForDrawing);const r=Ke._svgFactory.createElement("defs");a.append(r);const o=Ke._svgFactory.createElement("path");r.append(o);const l=`path_p${this.pageIndex}_${n}`;o.setAttribute("id",l),o.setAttribute("d",t.toSVGPath()),s&&this.#n.set(n,o);const c=this.#l(r,l),h=Ke._svgFactory.createElement("use");return a.append(h),a.setAttribute("fill",e),a.setAttribute("fill-opacity",i),h.setAttribute("href",`#${l}`),this.#i.set(n,a),{id:n,clipPathId:`url(#${c})`}}drawOutline(t){const e=this.#t++,i=this.#s(t.box);i.classList.add(...t.classNamesForOutlining);const s=Ke._svgFactory.createElement("defs");i.append(s);const n=Ke._svgFactory.createElement("path");s.append(n);const a=`path_p${this.pageIndex}_${e}`;n.setAttribute("id",a),n.setAttribute("d",t.toSVGPath()),n.setAttribute("vector-effect","non-scaling-stroke");let r;if(t.mustRemoveSelfIntersections){const c=Ke._svgFactory.createElement("mask");s.append(c),r=`mask_p${this.pageIndex}_${e}`,c.setAttribute("id",r),c.setAttribute("maskUnits","objectBoundingBox");const h=Ke._svgFactory.createElement("rect");c.append(h),h.setAttribute("width","1"),h.setAttribute("height","1"),h.setAttribute("fill","white");const d=Ke._svgFactory.createElement("use");c.append(d),d.setAttribute("href",`#${a}`),d.setAttribute("stroke","none"),d.setAttribute("fill","black"),d.setAttribute("fill-rule","nonzero"),d.classList.add("mask")}const o=Ke._svgFactory.createElement("use");i.append(o),o.setAttribute("href",`#${a}`),r&&o.setAttribute("mask",`url(#${r})`);const l=o.cloneNode();return i.append(l),o.classList.add("mainOutline"),l.classList.add("secondaryOutline"),this.#i.set(e,i),e}finalizeLine(t,e){const i=this.#n.get(t);this.#n.delete(t),this.updateBox(t,e.box),i.setAttribute("d",e.toSVGPath())}updateLine(t,e){this.#i.get(t).firstChild.firstChild.setAttribute("d",e.toSVGPath())}updatePath(t,e){this.#n.get(t).setAttribute("d",e.toSVGPath())}updateBox(t,e){Ke.#r(this.#i.get(t),e)}show(t,e){this.#i.get(t).classList.toggle("hidden",!e)}rotate(t,e){this.#i.get(t).setAttribute("data-main-rotation",e)}changeColor(t,e){this.#i.get(t).setAttribute("fill",e)}changeOpacity(t,e){this.#i.get(t).setAttribute("fill-opacity",e)}addClass(t,e){this.#i.get(t).classList.add(e)}removeClass(t,e){this.#i.get(t).classList.remove(e)}getSVGRoot(t){return this.#i.get(t)}remove(t){this.#n.delete(t),this.#e!==null&&(this.#i.get(t).remove(),this.#i.delete(t))}destroy(){this.#e=null;for(const t of this.#i.values())t.remove();this.#i.clear(),this.#n.clear()}}ue.AbortException;ue.AnnotationEditorLayer;ue.AnnotationEditorParamsType;ue.AnnotationEditorType;ue.AnnotationEditorUIManager;var fo=ue.AnnotationLayer,po=ue.AnnotationMode;ue.ColorPicker;ue.DOMSVGFactory;ue.DrawLayer;ue.FeatureTest;var cn=ue.GlobalWorkerOptions;ue.ImageKind;ue.InvalidPDFException;ue.MissingPDFException;ue.OPS;ue.OutputScale;var O8=ue.PDFDataRangeTransport;ue.PDFDateString;ue.PDFWorker;ue.PasswordResponses;ue.PermissionFlag;ue.PixelsPerInch;ue.RenderingCancelledException;var go=ue.TextLayer;ue.UnexpectedResponseException;ue.Util;ue.VerbosityLevel;ue.XfaLayer;ue.build;ue.createValidAbsoluteUrl;ue.fetchData;var mo=ue.getDocument;ue.getFilenameFromUrl;ue.getPdfFilenameFromUrl;ue.getXfaPageViewport;ue.isDataScheme;ue.isPdfFile;ue.noContextMenu;ue.normalizeUnicode;ue.setLayerDimensions;ue.shadow;var vo=ue.version;const j8=Object.freeze(Object.defineProperty({__proto__:null,AnnotationLayer:fo,AnnotationMode:po,GlobalWorkerOptions:cn,PDFDataRangeTransport:O8,TextLayer:go,getDocument:mo,version:vo},Symbol.toStringTag,{value:"Module"}));var qe=function(u,t,e){if(e||arguments.length===2)for(var i=0,s=t.length,n;i<s;i++)(n||!(i in t))&&(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return u.concat(n||Array.prototype.slice.call(t))},H8=["onCopy","onCut","onPaste"],B8=["onCompositionEnd","onCompositionStart","onCompositionUpdate"],z8=["onFocus","onBlur"],U8=["onInput","onInvalid","onReset","onSubmit"],V8=["onLoad","onError"],q8=["onKeyDown","onKeyPress","onKeyUp"],G8=["onAbort","onCanPlay","onCanPlayThrough","onDurationChange","onEmptied","onEncrypted","onEnded","onError","onLoadedData","onLoadedMetadata","onLoadStart","onPause","onPlay","onPlaying","onProgress","onRateChange","onSeeked","onSeeking","onStalled","onSuspend","onTimeUpdate","onVolumeChange","onWaiting"],W8=["onClick","onContextMenu","onDoubleClick","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp"],X8=["onDrag","onDragEnd","onDragEnter","onDragExit","onDragLeave","onDragOver","onDragStart","onDrop"],Y8=["onSelect"],K8=["onTouchCancel","onTouchEnd","onTouchMove","onTouchStart"],Z8=["onPointerDown","onPointerMove","onPointerUp","onPointerCancel","onGotPointerCapture","onLostPointerCapture","onPointerEnter","onPointerLeave","onPointerOver","onPointerOut"],J8=["onScroll"],Q8=["onWheel"],$8=["onAnimationStart","onAnimationEnd","onAnimationIteration"],e4=["onTransitionEnd"],t4=["onToggle"],i4=["onChange"],s4=qe(qe(qe(qe(qe(qe(qe(qe(qe(qe(qe(qe(qe(qe(qe(qe(qe(qe([],H8,!0),B8,!0),z8,!0),U8,!0),V8,!0),q8,!0),G8,!0),W8,!0),X8,!0),Y8,!0),K8,!0),Z8,!0),J8,!0),Q8,!0),$8,!0),e4,!0),i4,!0),t4,!0);function yo(u,t){var e={};return s4.forEach(function(i){var s=u[i];s&&(t?e[i]=(function(n){return s(n,t(i))}):e[i]=s)}),e}function bi(u){var t=!1,e=new Promise(function(i,s){u.then(function(n){return!t&&i(n)}).catch(function(n){return!t&&s(n)})});return{promise:e,cancel:function(){t=!0}}}var ws,lr;function n4(){if(lr)return ws;lr=1;var u=function(){};return ws=u,ws}var r4=n4();const Ze=zs(r4);var cr=Object.prototype.hasOwnProperty;function hr(u,t,e){for(e of u.keys())if(Qt(e,t))return e}function Qt(u,t){var e,i,s;if(u===t)return!0;if(u&&t&&(e=u.constructor)===t.constructor){if(e===Date)return u.getTime()===t.getTime();if(e===RegExp)return u.toString()===t.toString();if(e===Array){if((i=u.length)===t.length)for(;i--&&Qt(u[i],t[i]););return i===-1}if(e===Set){if(u.size!==t.size)return!1;for(i of u)if(s=i,s&&typeof s=="object"&&(s=hr(t,s),!s)||!t.has(s))return!1;return!0}if(e===Map){if(u.size!==t.size)return!1;for(i of u)if(s=i[0],s&&typeof s=="object"&&(s=hr(t,s),!s)||!Qt(i[1],t.get(s)))return!1;return!0}if(e===ArrayBuffer)u=new Uint8Array(u),t=new Uint8Array(t);else if(e===DataView){if((i=u.byteLength)===t.byteLength)for(;i--&&u.getInt8(i)===t.getInt8(i););return i===-1}if(ArrayBuffer.isView(u)){if((i=u.byteLength)===t.byteLength)for(;i--&&u[i]===t[i];);return i===-1}if(!e||typeof u=="object"){i=0;for(e in u)if(cr.call(u,e)&&++i&&!cr.call(t,e)||!(e in t)||!Qt(u[e],t[e]))return!1;return Object.keys(t).length===i}}return u!==u&&t!==t}const wo=L.createContext(null);function $t({children:u,type:t}){return g.jsx("div",{className:`react-pdf__message react-pdf__message--${t}`,children:u})}const o4="noopener noreferrer nofollow";class a4{constructor(){this.externalLinkEnabled=!0,this.externalLinkRel=void 0,this.externalLinkTarget=void 0,this.isInPresentationMode=!1,this.pdfDocument=void 0,this.pdfViewer=void 0}setDocument(t){this.pdfDocument=t}setViewer(t){this.pdfViewer=t}setExternalLinkRel(t){this.externalLinkRel=t}setExternalLinkTarget(t){this.externalLinkTarget=t}setHistory(){}get pagesCount(){return this.pdfDocument?this.pdfDocument.numPages:0}get page(){return Le(this.pdfViewer),this.pdfViewer.currentPageNumber||0}set page(t){Le(this.pdfViewer),this.pdfViewer.currentPageNumber=t}get rotation(){return 0}set rotation(t){}goToDestination(t){return new Promise(e=>{Le(this.pdfDocument),Le(t),typeof t=="string"?this.pdfDocument.getDestination(t).then(e):Array.isArray(t)?e(t):t.then(e)}).then(e=>{Le(Array.isArray(e));const i=e[0];new Promise(s=>{Le(this.pdfDocument),i instanceof Object?this.pdfDocument.getPageIndex(i).then(n=>{s(n)}).catch(()=>{Le(!1)}):typeof i=="number"?s(i):Le(!1)}).then(s=>{const n=s+1;Le(this.pdfViewer),Le(n>=1&&n<=this.pagesCount),this.pdfViewer.scrollPageIntoView({dest:e,pageIndex:s,pageNumber:n})})})}navigateTo(t){this.goToDestination(t)}goToPage(t){const e=t-1;Le(this.pdfViewer),Le(t>=1&&t<=this.pagesCount),this.pdfViewer.scrollPageIntoView({pageIndex:e,pageNumber:t})}addLinkAttributes(t,e,i){t.href=e,t.rel=this.externalLinkRel||o4,t.target=i?"_blank":this.externalLinkTarget||""}getDestinationHash(){return"#"}getAnchorUrl(){return"#"}setHash(){}executeNamedAction(){}cachePageRef(){}isPageVisible(){return!0}isPageCached(){return!0}executeSetOCGState(){}}const ur={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},is=typeof window<"u",bo=is&&window.location.protocol==="file:";function l4(u){return typeof u<"u"}function Dt(u){return l4(u)&&u!==null}function c4(u){return typeof u=="string"}function h4(u){return u instanceof ArrayBuffer}function u4(u){return Le(is),u instanceof Blob}function Ms(u){return c4(u)&&/^data:/.test(u)}function dr(u){Le(Ms(u));const[t="",e=""]=u.split(",");return t.split(";").indexOf("base64")!==-1?atob(e):unescape(e)}function d4(){return is&&window.devicePixelRatio||1}const xo="On Chromium based browsers, you can use --allow-file-access-from-files flag for debugging purposes.";function fr(){Ze(!bo,`Loading PDF as base64 strings/URLs may not work on protocols other than HTTP/HTTPS. ${xo}`)}function f4(){Ze(!bo,`Loading PDF.js worker may not work on protocols other than HTTP/HTTPS. ${xo}`)}function jt(u){u?.cancel&&u.cancel()}function Ns(u,t){return Object.defineProperty(u,"width",{get(){return this.view[2]*t},configurable:!0}),Object.defineProperty(u,"height",{get(){return this.view[3]*t},configurable:!0}),Object.defineProperty(u,"originalWidth",{get(){return this.view[2]},configurable:!0}),Object.defineProperty(u,"originalHeight",{get(){return this.view[3]},configurable:!0}),u}function p4(u){return u.name==="RenderingCancelledException"}function g4(u){return new Promise((t,e)=>{const i=new FileReader;i.onload=()=>{if(!i.result)return e(new Error("Error while reading a file."));t(i.result)},i.onerror=s=>{if(!s.target)return e(new Error("Error while reading a file."));const{error:n}=s.target;if(!n)return e(new Error("Error while reading a file."));switch(n.code){case n.NOT_FOUND_ERR:return e(new Error("Error while reading a file: File not found."));case n.SECURITY_ERR:return e(new Error("Error while reading a file: Security error."));case n.ABORT_ERR:return e(new Error("Error while reading a file: Aborted."));default:return e(new Error("Error while reading a file."))}},i.readAsArrayBuffer(u)})}function m4(u,t){switch(t.type){case"RESOLVE":return{value:t.value,error:void 0};case"REJECT":return{value:!1,error:t.error};case"RESET":return{value:void 0,error:void 0};default:return u}}function si(){return L.useReducer(m4,{value:void 0,error:void 0})}var v4=function(u,t,e,i){function s(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function r(c){try{l(i.next(c))}catch(h){a(h)}}function o(c){try{l(i.throw(c))}catch(h){a(h)}}function l(c){c.done?n(c.value):s(c.value).then(r,o)}l((i=i.apply(u,t||[])).next())})},pr=function(u,t){var e={};for(var i in u)Object.prototype.hasOwnProperty.call(u,i)&&t.indexOf(i)<0&&(e[i]=u[i]);if(u!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(u);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(u,i[s])&&(e[i[s]]=u[i[s]]);return e};const{PDFDataRangeTransport:y4}=j8,w4=(u,t)=>{switch(t){case ur.NEED_PASSWORD:{const e=prompt("Enter the password to open this PDF file.");u(e);break}case ur.INCORRECT_PASSWORD:{const e=prompt("Invalid password. Please try again.");u(e);break}}};function gr(u){return typeof u=="object"&&u!==null&&("data"in u||"range"in u||"url"in u)}const b4=L.forwardRef(function(t,e){var{children:i,className:s,error:n="Failed to load PDF file.",externalLinkRel:a,externalLinkTarget:r,file:o,inputRef:l,imageResourcesPath:c,loading:h="Loading PDFâ€¦",noData:d="No PDF file specified.",onItemClick:f,onLoadError:p,onLoadProgress:m,onLoadSuccess:v,onPassword:w=w4,onSourceError:S,onSourceSuccess:_,options:A,renderMode:P,rotate:k}=t,N=pr(t,["children","className","error","externalLinkRel","externalLinkTarget","file","inputRef","imageResourcesPath","loading","noData","onItemClick","onLoadError","onLoadProgress","onLoadSuccess","onPassword","onSourceError","onSourceSuccess","options","renderMode","rotate"]);const[O,j]=si(),{value:U,error:G}=O,[R,D]=si(),{value:I,error:W}=R,z=L.useRef(new a4),B=L.useRef([]),H=L.useRef(void 0),$=L.useRef(void 0);o&&o!==H.current&&gr(o)&&(Ze(!Qt(o,H.current),`File prop passed to <Document /> changed, but it's equal to previous one. This might result in unnecessary reloads. Consider memoizing the value passed to "file" prop.`),H.current=o),A&&A!==$.current&&(Ze(!Qt(A,$.current),`Options prop passed to <Document /> changed, but it's equal to previous one. This might result in unnecessary reloads. Consider memoizing the value passed to "options" prop.`),$.current=A);const J=L.useRef({scrollPageIntoView:Y=>{const{dest:le,pageNumber:ve,pageIndex:be=ve-1}=Y;if(f){f({dest:le,pageIndex:be,pageNumber:ve});return}const y=B.current[be];if(y){y.scrollIntoView();return}Ze(!1,`An internal link leading to page ${ve} was clicked, but neither <Document> was provided with onItemClick nor it was able to find the page within itself. Either provide onItemClick to <Document> and handle navigating by yourself or ensure that all pages are rendered within <Document>.`)}});L.useImperativeHandle(e,()=>({linkService:z,pages:B,viewer:J}),[]);function re(){_&&_()}function me(){G&&(Ze(!1,G.toString()),S&&S(G))}function Q(){j({type:"RESET"})}L.useEffect(Q,[o,j]);const Te=L.useCallback(()=>v4(this,void 0,void 0,function*(){if(!o)return null;if(typeof o=="string")return Ms(o)?{data:dr(o)}:(fr(),{url:o});if(o instanceof y4)return{range:o};if(h4(o))return{data:o};if(is&&u4(o))return{data:yield g4(o)};if(Le(typeof o=="object"),Le(gr(o)),"url"in o&&typeof o.url=="string"){if(Ms(o.url)){const{url:Y}=o,le=pr(o,["url"]),ve=dr(Y);return Object.assign({data:ve},le)}fr()}return o}),[o]);L.useEffect(()=>{const Y=bi(Te());return Y.promise.then(le=>{j({type:"RESOLVE",value:le})}).catch(le=>{j({type:"REJECT",error:le})}),()=>{jt(Y)}},[Te,j]),L.useEffect(()=>{if(!(typeof U>"u")){if(U===!1){me();return}re()}},[U]);function Ae(){I&&(v&&v(I),B.current=new Array(I.numPages),z.current.setDocument(I))}function ge(){W&&(Ze(!1,W.toString()),p&&p(W))}L.useEffect(function(){D({type:"RESET"})},[D,U]),L.useEffect(function(){if(!U)return;const le=A?Object.assign(Object.assign({},U),A):U,ve=mo(le);m&&(ve.onProgress=m),w&&(ve.onPassword=w);const be=ve,y=be.promise.then(T=>{D({type:"RESOLVE",value:T})}).catch(T=>{be.destroyed||D({type:"REJECT",error:T})});return()=>{y.finally(()=>be.destroy())}},[A,D,U]),L.useEffect(()=>{if(!(typeof I>"u")){if(I===!1){ge();return}Ae()}},[I]),L.useEffect(function(){z.current.setViewer(J.current),z.current.setExternalLinkRel(a),z.current.setExternalLinkTarget(r)},[a,r]);const ae=L.useCallback((Y,le)=>{B.current[Y]=le},[]),Re=L.useCallback(Y=>{delete B.current[Y]},[]),Ce=L.useMemo(()=>({imageResourcesPath:c,linkService:z.current,onItemClick:f,pdf:I,registerPage:ae,renderMode:P,rotate:k,unregisterPage:Re}),[c,f,I,ae,P,k,Re]),de=L.useMemo(()=>yo(N,()=>I),[N,I]);function je(){return g.jsx(wo.Provider,{value:Ce,children:i})}function Ue(){return o?I==null?g.jsx($t,{type:"loading",children:typeof h=="function"?h():h}):I===!1?g.jsx($t,{type:"error",children:typeof n=="function"?n():n}):je():g.jsx($t,{type:"no-data",children:typeof d=="function"?d():d})}return g.jsx("div",Object.assign({className:Xi("react-pdf__Document",s),ref:l,style:{"--scale-factor":"1"}},de,{children:Ue()}))});function So(){return L.useContext(wo)}function Eo(){for(var u=[],t=0;t<arguments.length;t++)u[t]=arguments[t];var e=u.filter(Boolean);if(e.length<=1){var i=e[0];return i||null}return function(n){e.forEach(function(a){typeof a=="function"?a(n):a&&(a.current=n)})}}const To=L.createContext(null),_o={Document:null,DocumentFragment:null,Part:"group",Sect:"group",Div:"group",Aside:"note",NonStruct:"none",P:null,H:"heading",Title:null,FENote:"note",Sub:"group",Lbl:null,Span:null,Em:null,Strong:null,Link:"link",Annot:"note",Form:"form",Ruby:null,RB:null,RT:null,RP:null,Warichu:null,WT:null,WP:null,L:"list",LI:"listitem",LBody:null,Table:"table",TR:"row",TH:"columnheader",TD:"cell",THead:"columnheader",TBody:null,TFoot:null,Caption:null,Figure:"figure",Formula:null,Artifact:null},x4=/^H(\d+)$/;function S4(u){return u in _o}function ss(u){return"children"in u}function Ao(u){return ss(u)?u.children.length===1&&0 in u.children&&"id"in u.children[0]:!1}function E4(u){const t={};if(ss(u)){const{role:e}=u,i=e.match(x4);if(i)t.role="heading",t["aria-level"]=Number(i[1]);else if(S4(e)){const s=_o[e];s&&(t.role=s)}}return t}function Co(u){const t={};if(ss(u)){if(u.alt!==void 0&&(t["aria-label"]=u.alt),u.lang!==void 0&&(t.lang=u.lang),Ao(u)){const[e]=u.children;if(e){const i=Co(e);return Object.assign(Object.assign({},t),i)}}}else"id"in u&&(t["aria-owns"]=u.id);return t}function T4(u){return u?Object.assign(Object.assign({},E4(u)),Co(u)):null}function Po({className:u,node:t}){const e=L.useMemo(()=>T4(t),[t]),i=L.useMemo(()=>!ss(t)||Ao(t)?null:t.children.map((s,n)=>g.jsx(Po,{node:s},n)),[t]);return g.jsx("span",Object.assign({className:u},e,{children:i}))}function ns(){return L.useContext(To)}function _4(){const u=ns();Le(u);const{onGetStructTreeError:t,onGetStructTreeSuccess:e}=u,[i,s]=si(),{value:n,error:a}=i,{customTextRenderer:r,page:o}=u;function l(){n&&e&&e(n)}function c(){a&&(Ze(!1,a.toString()),t&&t(a))}return L.useEffect(function(){s({type:"RESET"})},[s,o]),L.useEffect(function(){if(r||!o)return;const d=bi(o.getStructTree()),f=d;return d.promise.then(p=>{s({type:"RESOLVE",value:p})}).catch(p=>{s({type:"REJECT",error:p})}),()=>jt(f)},[r,o,s]),L.useEffect(()=>{if(n!==void 0){if(n===!1){c();return}l()}},[n]),n?g.jsx(Po,{className:"react-pdf__Page__structTree structTree",node:n}):null}const mr=po;function A4(u){const t=ns();Le(t);const e=Object.assign(Object.assign({},t),u),{_className:i,canvasBackground:s,devicePixelRatio:n=d4(),onRenderError:a,onRenderSuccess:r,page:o,renderForms:l,renderTextLayer:c,rotate:h,scale:d}=e,{canvasRef:f}=u;Le(o);const p=L.useRef(null);function m(){o&&r&&r(Ns(o,d))}function v(A){p4(A)||(Ze(!1,A.toString()),a&&a(A))}const w=L.useMemo(()=>o.getViewport({scale:d*n,rotation:h}),[n,o,h,d]),S=L.useMemo(()=>o.getViewport({scale:d,rotation:h}),[o,h,d]);L.useEffect(function(){if(!o)return;o.cleanup();const{current:P}=p;if(!P)return;P.width=w.width,P.height=w.height,P.style.width=`${Math.floor(S.width)}px`,P.style.height=`${Math.floor(S.height)}px`,P.style.visibility="hidden";const k={annotationMode:l?mr.ENABLE_FORMS:mr.ENABLE,canvasContext:P.getContext("2d",{alpha:!1}),viewport:w};s&&(k.background=s);const N=o.render(k),O=N;return N.promise.then(()=>{P.style.visibility="",m()}).catch(v),()=>jt(O)},[s,o,l,w,S]);const _=L.useCallback(()=>{const{current:A}=p;A&&(A.width=0,A.height=0)},[]);return L.useEffect(()=>_,[_]),g.jsx("canvas",{className:`${i}__canvas`,dir:"ltr",ref:Eo(f,p),style:{display:"block",userSelect:"none"},children:c?g.jsx(_4,{}):null})}function C4(u){return"str"in u}function P4(){const u=ns();Le(u);const{customTextRenderer:t,onGetTextError:e,onGetTextSuccess:i,onRenderTextLayerError:s,onRenderTextLayerSuccess:n,page:a,pageIndex:r,pageNumber:o,rotate:l,scale:c}=u;Le(a);const[h,d]=si(),{value:f,error:p}=h,m=L.useRef(null);Ze(Number.parseInt(window.getComputedStyle(document.body).getPropertyValue("--react-pdf-text-layer"),10)===1,"TextLayer styles not found. Read more: https://github.com/wojtekmaj/react-pdf#support-for-text-layer");function v(){f&&i&&i(f)}function w(){p&&(Ze(!1,p.toString()),e&&e(p))}L.useEffect(function(){d({type:"RESET"})},[a,d]),L.useEffect(function(){if(!a)return;const O=bi(a.getTextContent()),j=O;return O.promise.then(U=>{d({type:"RESOLVE",value:U})}).catch(U=>{d({type:"REJECT",error:U})}),()=>jt(j)},[a,d]),L.useEffect(()=>{if(f!==void 0){if(f===!1){w();return}v()}},[f]);const S=L.useCallback(()=>{n&&n()},[n]),_=L.useCallback(N=>{Ze(!1,N.toString()),s&&s(N)},[s]);function A(){const N=m.current;N&&N.classList.add("selecting")}function P(){const N=m.current;N&&N.classList.remove("selecting")}const k=L.useMemo(()=>a.getViewport({scale:c,rotation:l}),[a,l,c]);return L.useLayoutEffect(function(){if(!a||!f)return;const{current:O}=m;if(!O)return;O.innerHTML="";const j=a.streamTextContent({includeMarkedContent:!0}),U={container:O,textContentSource:j,viewport:k},G=new go(U),R=G;return G.render().then(()=>{const D=document.createElement("div");D.className="endOfContent",O.append(D);const I=O.querySelectorAll('[role="presentation"]');if(t){let W=0;f.items.forEach((z,B)=>{if(!C4(z))return;const H=I[W];if(!H)return;const $=t(Object.assign({pageIndex:r,pageNumber:o,itemIndex:B},z));H.innerHTML=$,W+=z.str&&z.hasEOL?2:1})}S()}).catch(_),()=>jt(R)},[t,_,S,a,r,o,f,k]),g.jsx("div",{className:Xi("react-pdf__Page__textContent","textLayer"),onMouseUp:P,onMouseDown:A,ref:m})}function R4(){const u=So(),t=ns();Le(t);const e=Object.assign(Object.assign({},u),t),{imageResourcesPath:i,linkService:s,onGetAnnotationsError:n,onGetAnnotationsSuccess:a,onRenderAnnotationLayerError:r,onRenderAnnotationLayerSuccess:o,page:l,pdf:c,renderForms:h,rotate:d,scale:f=1}=e;Le(c),Le(l),Le(s);const[p,m]=si(),{value:v,error:w}=p,S=L.useRef(null);Ze(Number.parseInt(window.getComputedStyle(document.body).getPropertyValue("--react-pdf-annotation-layer"),10)===1,"AnnotationLayer styles not found. Read more: https://github.com/wojtekmaj/react-pdf#support-for-annotations");function _(){v&&a&&a(v)}function A(){w&&(Ze(!1,w.toString()),n&&n(w))}L.useEffect(function(){m({type:"RESET"})},[m,l]),L.useEffect(function(){if(!l)return;const j=bi(l.getAnnotations()),U=j;return j.promise.then(G=>{m({type:"RESOLVE",value:G})}).catch(G=>{m({type:"REJECT",error:G})}),()=>{jt(U)}},[m,l]),L.useEffect(()=>{if(v!==void 0){if(v===!1){A();return}_()}},[v]);function P(){o&&o()}function k(O){Ze(!1,`${O}`),r&&r(O)}const N=L.useMemo(()=>l.getViewport({scale:f,rotation:d}),[l,d,f]);return L.useEffect(function(){if(!c||!l||!s||!v)return;const{current:j}=S;if(!j)return;const U=N.clone({dontFlip:!0}),G={accessibilityManager:null,annotationCanvasMap:null,annotationEditorUIManager:null,div:j,l10n:null,page:l,structTreeLayer:null,viewport:U},R={annotations:v,annotationStorage:c.annotationStorage,div:j,imageResourcesPath:i,linkService:s,page:l,renderForms:h,viewport:U};j.innerHTML="";try{new fo(G).render(R),P()}catch(D){k(D)}return()=>{}},[v,i,s,l,c,h,N]),g.jsx("div",{className:Xi("react-pdf__Page__annotations","annotationLayer"),ref:S})}var L4=function(u,t){var e={};for(var i in u)Object.prototype.hasOwnProperty.call(u,i)&&t.indexOf(i)<0&&(e[i]=u[i]);if(u!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(u);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(u,i[s])&&(e[i[s]]=u[i[s]]);return e};const vr=1;function D4(u){const t=So(),e=Object.assign(Object.assign({},t),u),{_className:i="react-pdf__Page",_enableRegisterUnregisterPage:s=!0,canvasBackground:n,canvasRef:a,children:r,className:o,customRenderer:l,customTextRenderer:c,devicePixelRatio:h,error:d="Failed to load the page.",height:f,inputRef:p,loading:m="Loading pageâ€¦",noData:v="No page specified.",onGetAnnotationsError:w,onGetAnnotationsSuccess:S,onGetStructTreeError:_,onGetStructTreeSuccess:A,onGetTextError:P,onGetTextSuccess:k,onLoadError:N,onLoadSuccess:O,onRenderAnnotationLayerError:j,onRenderAnnotationLayerSuccess:U,onRenderError:G,onRenderSuccess:R,onRenderTextLayerError:D,onRenderTextLayerSuccess:I,pageIndex:W,pageNumber:z,pdf:B,registerPage:H,renderAnnotationLayer:$=!0,renderForms:J=!1,renderMode:re="canvas",renderTextLayer:me=!0,rotate:Q,scale:Te=vr,unregisterPage:Ae,width:ge}=e,ae=L4(e,["_className","_enableRegisterUnregisterPage","canvasBackground","canvasRef","children","className","customRenderer","customTextRenderer","devicePixelRatio","error","height","inputRef","loading","noData","onGetAnnotationsError","onGetAnnotationsSuccess","onGetStructTreeError","onGetStructTreeSuccess","onGetTextError","onGetTextSuccess","onLoadError","onLoadSuccess","onRenderAnnotationLayerError","onRenderAnnotationLayerSuccess","onRenderError","onRenderSuccess","onRenderTextLayerError","onRenderTextLayerSuccess","pageIndex","pageNumber","pdf","registerPage","renderAnnotationLayer","renderForms","renderMode","renderTextLayer","rotate","scale","unregisterPage","width"]),[Re,Ce]=si(),{value:de,error:je}=Re,Ue=L.useRef(null);Le(B);const Y=Dt(z)?z-1:W??null,le=z??(Dt(W)?W+1:null),ve=Q??(de?de.rotate:null),be=L.useMemo(()=>{if(!de)return null;let se=1;const X=Te??vr;if(ge||f){const x=de.getViewport({scale:1,rotation:ve});ge?se=ge/x.width:f&&(se=f/x.height)}return X*se},[f,de,ve,Te,ge]);L.useEffect(function(){return()=>{Dt(Y)&&s&&Ae&&Ae(Y)}},[s,B,Y,Ae]);function y(){if(O){if(!de||!be)return;O(Ns(de,be))}if(s&&H){if(!Dt(Y)||!Ue.current)return;H(Y,Ue.current)}}function T(){je&&(Ze(!1,je.toString()),N&&N(je))}L.useEffect(function(){Ce({type:"RESET"})},[Ce,B,Y]),L.useEffect(function(){if(!B||!le)return;const X=bi(B.getPage(le)),x=X;return X.promise.then(b=>{Ce({type:"RESOLVE",value:b})}).catch(b=>{Ce({type:"REJECT",error:b})}),()=>jt(x)},[Ce,B,le]),L.useEffect(()=>{if(de!==void 0){if(de===!1){T();return}y()}},[de,be]);const M=L.useMemo(()=>de&&Dt(Y)&&le&&Dt(ve)&&Dt(be)?{_className:i,canvasBackground:n,customTextRenderer:c,devicePixelRatio:h,onGetAnnotationsError:w,onGetAnnotationsSuccess:S,onGetStructTreeError:_,onGetStructTreeSuccess:A,onGetTextError:P,onGetTextSuccess:k,onRenderAnnotationLayerError:j,onRenderAnnotationLayerSuccess:U,onRenderError:G,onRenderSuccess:R,onRenderTextLayerError:D,onRenderTextLayerSuccess:I,page:de,pageIndex:Y,pageNumber:le,renderForms:J,renderTextLayer:me,rotate:ve,scale:be}:null,[i,n,c,h,w,S,_,A,P,k,j,U,G,R,D,I,de,Y,le,J,me,ve,be]),K=L.useMemo(()=>yo(ae,()=>de&&(be?Ns(de,be):void 0)),[ae,de,be]),q=`${Y}@${be}/${ve}`;function te(){switch(re){case"custom":return Le(l),g.jsx(l,{},`${q}_custom`);case"none":return null;default:return g.jsx(A4,{canvasRef:a},`${q}_canvas`)}}function Z(){return me?g.jsx(P4,{},`${q}_text`):null}function ye(){return $?g.jsx(R4,{},`${q}_annotations`):null}function Ee(){return g.jsxs(To.Provider,{value:M,children:[te(),Z(),ye(),r]})}function _e(){return le?B===null||de===void 0||de===null?g.jsx($t,{type:"loading",children:typeof m=="function"?m():m}):B===!1||de===!1?g.jsx($t,{type:"error",children:typeof d=="function"?d():d}):Ee():g.jsx($t,{type:"no-data",children:typeof v=="function"?v():v})}return g.jsx("div",Object.assign({className:Xi(i,o),"data-page-number":le,ref:Eo(p,Ue),style:{"--scale-factor":`${be}`,backgroundColor:n||"white",position:"relative",minWidth:"min-content",minHeight:"min-content"}},K,{children:_e()}))}f4();cn.workerSrc="pdf.worker.mjs";function k4(){return g.jsx("div",{className:"flex h-full w-full flex-col items-center justify-center bg-muted",children:g.jsxs("div",{className:"chat-alert-box",children:[g.jsxs("span",{className:"flex gap-2",children:[g.jsx(ie,{name:"FileX2"}),g.jsx("span",{className:"vetrai-chat-span",children:ha})]}),g.jsx("br",{}),g.jsx("div",{className:"vetrai-chat-desc",children:g.jsxs("span",{className:"vetrai-chat-desc-span",children:[ua," "]})})]})})}function I4(){return g.jsx("div",{className:"flex h-full w-full flex-col items-center justify-center bg-muted",children:g.jsxs("div",{className:"chat-alert-box",children:[g.jsxs("span",{children:["ğŸ“„ ",g.jsx("span",{className:"vetrai-chat-span",children:da})]}),g.jsx("br",{}),g.jsx("div",{className:"vetrai-chat-desc",children:g.jsxs("span",{className:"vetrai-chat-desc-span",children:[fa," "]})})]})})}cn.workerSrc=`//unpkg.com/pdfjs-dist@${vo}/build/pdf.worker.min.js`;function M4({pdf:u}){const[t,e]=L.useState(-1),[i,s]=L.useState(1),[n,a]=L.useState(1),[r,o]=L.useState(void 0),[l,c]=L.useState(!1),h=L.useRef(null);L.useEffect(()=>{function A(P){P.key==="ArrowLeft"?i>1&&p():P.key==="ArrowRight"&&i<t&&m()}return document.addEventListener("keydown",A),()=>{document.removeEventListener("keydown",A)}},[i]);function d({numPages:A}){e(A),s(1)}function f(A){s(P=>P+A)}function p(){f(-1)}function m(){f(1)}function v(A){isNaN(A)||A<.1||(A=Math.round(A*10)/10,a(A))}function w(){v(n+.1)}function S(){n>.1&&v(n-.1)}function _(A){if(!h.current)return;const P=h.current.clientWidth,k=A.width;P>k&&o(P-10)}return g.jsxs("div",{ref:h,onMouseEnter:A=>c(!0),onMouseLeave:A=>c(!1),className:"flex h-full w-full flex-col items-center justify-end overflow-clip rounded-lg border border-border",children:[g.jsx("div",{className:"h-full min-h-0 w-full overflow-auto custom-scroll",children:g.jsx(b4,{loading:g.jsx("div",{className:"flex h-full w-full items-center justify-center align-middle",children:g.jsx(zi,{})}),onLoadSuccess:d,file:u,noData:g.jsx(I4,{}),error:g.jsx(k4,{}),className:"h-full w-full",children:g.jsx(D4,{width:r,onLoadSuccess:_,scale:n,renderTextLayer:!0,pageNumber:i,className:"h-full max-h-0 w-full"})})}),g.jsx("div",{className:"absolute z-50 pb-5 "+(l&&t>0?"":" hidden"),children:g.jsxs("div",{className:"flex w-min items-center justify-center gap-0.5 rounded-xl bg-muted px-2 align-middle",children:[g.jsx("button",{type:"button",disabled:i<=1,onClick:p,children:g.jsx(ie,{name:"ChevronLeft",className:"h-6 w-6"})}),g.jsxs("p",{children:[i||(t?1:"--"),"/",t||"--"]}),g.jsx("button",{type:"button",disabled:i>=t,onClick:m,children:g.jsx(ie,{name:"ChevronRight",className:"h-6 w-6"})}),g.jsx("p",{className:"px-2",children:"|"}),g.jsx("button",{type:"button",onClick:S,children:g.jsx(ie,{name:"ZoomOut",className:"h-6 w-6"})}),g.jsx("input",{type:"number",step:.1,className:"w-6 border-b bg-transparent text-center arrow-hide",onChange:A=>v(A.target.value),value:n}),g.jsx("button",{type:"button",onClick:w,children:g.jsx(ie,{name:"ZoomIn",className:"h-6 w-6"})})]})})]})}function N4({node:u,handleChangeSelect:t}){return g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"flex justify-between",children:"Expand the output to see the CSV"}),g.jsxs("div",{className:"flex items-center justify-between pt-5",children:[g.jsx("span",{children:"CSV separator "}),g.jsxs(Ui,{value:u.data.node.template.separator.value,onValueChange:e=>t(e),children:[g.jsx(Vi,{className:"w-[70px]",children:g.jsx(qi,{})}),g.jsx(Gi,{children:g.jsx(Wi,{children:u?.data?.node?.template?.separator?.options.map(e=>g.jsx(gi,{value:e,children:e},e))})})]})]})]})}function yr({value:u=[],onChange:t,left:e,output:i}){const s=L.useRef(null);s.current=u;const n=L.useRef(null);return L.useEffect(()=>{n.current&&n.current.set({json:u||{}})},[u]),g.jsx("div",{className:"h-400px w-full",children:g.jsx(pa,{data:{json:u},jsonRef:n,height:"400px"})})}function wr({type:u,fieldType:t,fieldId:e,left:i}){const s=Se(m=>m.nodes),n=Se(m=>m.setNode),a=Se(m=>m.flowPool),r=s.find(m=>m.id===e),o=(a[r.id]??[])[(a[r.id]?.length??1)-1],l=m=>{if(r){const v=_t.cloneDeep(r);v.data.node?.template.separator&&(v.data.node.template.separator.value=m,n(v.id,v))}},[c,h]=L.useState(!1),d=(a[r.id]??[])[(a[r.id]?.length??1)-1]?.data.results.text??"",{handleOnNewValue:f}=r?.data.node?ga({node:r.data.node,nodeId:r.id,name:"input_value"}):{handleOnNewValue:(m,v)=>{}};function p(){if(!r)return g.jsx(g.Fragment,{children:'"No node found!"'});switch(u){case ji.INPUT:switch(t){case ri.TEXT:return g.jsx(ui,{className:`w-full custom-scroll ${i?"min-h-32":"h-full"}`,placeholder:"Enter text...",value:r.data.node.template.input_value.value,onChange:m=>{if(m.target.value,r){const v=_t.cloneDeep(r);v.data.node.template.input_value.value=m.target.value,n(r.id,v)}}});case ri.FILE_LOADER:return g.jsx(A3,{field:r.data.node.template.file_path.value,updateValue:m=>{if(r){const v=_t.cloneDeep(r);v.data.node.template.file_path.value=m,n(r.id,v)}}});case ri.KEYPAIR:return g.jsx(Tn,{value:r.data.node.template.input_value?.value,onChange:m=>{if(r){const w=_t.cloneDeep(r);w.data.node.template.input_value.value=m,n(r.id,w)}const v=_n(m);h(An(v))},duplicateKey:c,isList:r.data.node.template.input_value?.list??!1,isInputField:!0});case ri.JSON:return g.jsx(yr,{value:r.data.node.template.input_value?.value,onChange:m=>{if(r){const v=_t.cloneDeep(r);v.data.node.template.input_value.value=m,n(r.id,v)}},left:i});case ri.STRING_LIST:return g.jsx(g.Fragment,{children:g.jsx(En,{id:`playground_${r.id}_input_list`,editNode:!1,value:r.data.node.template.input_value?.value,handleOnNewValue:f,disabled:!1})});default:return g.jsx(ui,{className:`w-full custom-scroll ${i?"min-h-32":"h-full"}`,placeholder:"Enter text...",value:r.data.node.template.input_value,onChange:m=>{if(m.target.value,r){const v=_t.cloneDeep(r);v.data.node.template.input_value.value=m.target.value,n(r.id,v)}}})}case ji.OUTPUT:switch(t){case Tt.TEXT:return g.jsx(ya,{left:i,value:d});case Tt.PDF:return i?g.jsx("div",{children:va}):g.jsx(M4,{pdf:o?.params??""});case Tt.CSV:return i?g.jsx(g.Fragment,{children:g.jsx(N4,{node:r,handleChangeSelect:l})}):g.jsx(g.Fragment,{children:g.jsx(F3,{csvNode:r,flowPool:o})});case Tt.IMAGE:return i?g.jsx("div",{children:"Expand the view to see the image"}):g.jsx(M3,{image:(a[r.id]??[])[(a[r.id]?.length??1)-1]?.params??""});case Tt.JSON:return g.jsx(yr,{value:r.data.node.template.input_value?.value,onChange:m=>{if(r){const v=_t.cloneDeep(r);v.data.node.template.input_value.value=m,n(r.id,v)}},left:i,output:!0});case Tt.KEY_PAIR:return g.jsx(Tn,{value:r.data.node.template.input_value?.value,onChange:m=>{if(r){const w=_t.cloneDeep(r);w.data.node.template.input_value.value=m,n(r.id,w)}const v=_n(m);h(An(v))},duplicateKey:c,isList:r.data.node.template.input_value?.list??!1});case Tt.STRING_LIST:return g.jsx(g.Fragment,{children:g.jsx(En,{id:`playground_${r.id}_output_list`,editNode:!1,value:r.data.node.template.input_value?.value,handleOnNewValue:f,disabled:!0})});case Tt.DATA:return g.jsx("div",{className:i?"h-56":"h-full",children:g.jsx(ma,{pagination:!i,rows:Array.isArray(o?.data?.artifacts)?o?.data?.artifacts?.map(m=>m.data)??[]:[o?.data?.artifacts],columnMode:"union"})});default:return g.jsx(ui,{className:`w-full custom-scroll ${i?"min-h-32":"h-full"}`,placeholder:"Empty",value:(a[r.id]??[])[(a[r.id]?.length??1)-1]?.data.results.result??"",readOnly:!0})}}}return p()}const F4=({selectedViewField:u,setSelectedViewField:t,haveChat:e,inputs:i,outputs:s,sessions:n,currentFlowId:a,nodes:r})=>g.jsx(g.Fragment,{children:g.jsxs("div",{className:Pe("flex h-full w-full flex-col items-start gap-4 p-4",u?"":"hidden"),children:[g.jsxs("div",{className:"font-xl flex items-center justify-center gap-3 font-semibold",children:[e&&g.jsx("button",{onClick:()=>t(void 0),children:g.jsx(ie,{name:"ArrowLeft",className:"h-6 w-6"})}),r.find(o=>o.id===u?.id)?.data.node.display_name]}),g.jsxs("div",{className:"h-full w-full",children:[i.some(o=>o.id===u?.id)&&g.jsx(wr,{type:ji.INPUT,left:!1,fieldType:u?.type,fieldId:u?.id}),s.some(o=>o.id===u?.id)&&g.jsx(wr,{type:ji.OUTPUT,left:!1,fieldType:u?.type,fieldId:u?.id}),n.some(o=>o===u?.id)&&g.jsx(wa,{session:u?.id,id:a})]})]})});function O4({deleteSession:u,session:t,toggleVisibility:e,isVisible:i,inspectSession:s,updateVisibleSession:n,selectedView:a,setSelectedView:r,playgroundPage:o,setActiveSession:l}){const c=Us(),[h,d]=L.useState(!1),[f,p]=L.useState(t),{mutate:m}=ba(),v=L.useRef(null);Se(j=>j.setNewChatOnPlayground),L.useEffect(()=>{p(t)},[t]);const w=j=>{d(!0)},S=j=>{p(j.target.value)},_=()=>{d(!1),f.trim()!==t&&m({old_session_id:t,new_session_id:f.trim()},{onSuccess:()=>{i&&n(f.trim()),a?.type==="Session"&&a?.id===t&&r({type:"Session",id:f.trim()})}})},A=()=>{d(!1),p(t)},P=j=>{switch(j){case"rename":w();break;case"messageLogs":s(t);break;case"delete":u(t);break}},k=j=>{(!j.relatedTarget||j.relatedTarget.getAttribute("data-confirm")!=="true")&&A()},N=j=>{j.key==="Enter"&&(j.preventDefault(),j.stopPropagation(),_())},O=rt(j=>j.setNewSessionCloseVoiceAssistant);return g.jsx("div",{"data-testid":"session-selector",onClick:j=>{O(!0),h?j.stopPropagation():e()},className:Pe("file-component-accordion-div group cursor-pointer rounded-md text-left text-mmd hover:bg-secondary-hover",i?"bg-secondary-hover font-semibold":"font-normal"),children:g.jsxs("div",{className:"flex w-full items-center justify-between overflow-hidden px-2 py-1 align-middle",children:[g.jsx("div",{className:"flex w-full min-w-0 items-center",children:h?g.jsxs("div",{className:"flex items-center",children:[g.jsx(xa,{ref:v,value:f,onKeyDown:N,onChange:S,onBlur:k,autoFocus:!0,className:"h-6 flex-grow px-1 py-0"}),g.jsx("button",{onClick:A,className:"hover:text-status-red-hover ml-2 text-status-red",children:g.jsx(ie,{name:"X",className:"h-4 w-4"})}),g.jsx("button",{onClick:_,"data-confirm":"true",className:"ml-2 text-green-500 hover:text-green-600",children:g.jsx(ie,{name:"Check",className:"h-4 w-4"})})]}):g.jsx(Xe,{styleClasses:"z-50",content:t,children:g.jsxs("div",{className:"relative w-full overflow-hidden",children:[g.jsx("span",{className:"w-full truncate",children:t===c?"Default Session":t}),g.jsx("div",{className:Pe("pointer-events-none absolute left-0 right-0 top-0 h-full whitespace-nowrap"),children:g.jsx("div",{className:Pe("h-full w-full group-hover:truncate-secondary-hover",i?"truncate-secondary-hover":"truncate-muted dark:truncate-canvas")})})]})})}),g.jsxs(Sa,{value:"",onValueChange:P,children:[g.jsx(Xe,{styleClasses:"z-50",side:"right",content:"Options",children:g.jsx(Ea,{onClick:j=>{j.stopPropagation()},onFocusCapture:()=>{v.current?.focus()},"data-confirm":"true",className:Pe("h-8 w-fit border-none bg-transparent p-2 focus:ring-0",i?"visible":"invisible group-hover:visible"),children:g.jsx(ie,{name:"MoreHorizontal",className:"h-4 w-4"})})}),g.jsxs(Ta,{side:"right",align:"start",className:"p-0",children:[g.jsx(cs,{value:"rename",className:"cursor-pointer px-3 py-2 focus:bg-muted",children:g.jsxs("div",{className:"flex items-center",children:[g.jsx(ie,{name:"SquarePen",className:"mr-2 h-4 w-4"}),"Rename"]})}),g.jsx(cs,{value:"messageLogs",className:"cursor-pointer px-3 py-2 focus:bg-muted",children:g.jsx("div",{className:"flex w-full items-center justify-between",children:g.jsxs("div",{className:"flex items-center",children:[g.jsx(ie,{name:"Scroll",className:"mr-2 h-4 w-4"}),"Message logs"]})})}),g.jsx(cs,{value:"delete",className:"cursor-pointer px-3 py-2 focus:bg-muted",children:g.jsxs("div",{className:"flex items-center text-status-red hover:text-status-red",children:[g.jsx(ie,{name:"Trash2",className:"mr-2 h-4 w-4"}),"Delete"]})})]})]})]})})}const j4=({sessions:u,setSelectedViewField:t,setvisibleSession:e,handleDeleteSession:i,visibleSession:s,selectedViewField:n,playgroundPage:a,setActiveSession:r})=>{const o=rt(c=>c.setNewSessionCloseVoiceAssistant),l=Se(c=>c.setNewChatOnPlayground);return g.jsx(g.Fragment,{children:g.jsxs("div",{className:"flex flex-col pl-3",children:[g.jsx("div",{className:"flex flex-col gap-2 pb-2",children:g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx(ie,{name:"MessagesSquare",className:"h-[18px] w-[18px] text-ring"}),g.jsx("div",{className:"text-mmd font-normal",children:"Chat"})]}),g.jsx(Xe,{styleClasses:"z-50",content:"New Chat",children:g.jsx("div",{children:g.jsx(De,{"data-testid":"new-chat",variant:"ghost",className:"flex h-8 w-8 items-center justify-center !p-0 hover:bg-secondary-hover",onClick:c=>{e(void 0),t(void 0),o(!0),l(!0)},children:g.jsx(ie,{name:"Plus",className:"h-[18px] w-[18px] text-ring"})})})})]})}),g.jsx("div",{className:"flex flex-col",children:u.map((c,h)=>g.jsx(O4,{setSelectedView:t,selectedView:n,session:c,playgroundPage:a,deleteSession:d=>{i(d),n?.id===d&&t(void 0)},updateVisibleSession:d=>{e(d)},toggleVisibility:()=>{e(c)},isVisible:s===c,inspectSession:d=>{t({id:d,type:"Session"})},setActiveSession:d=>{r(d)}},h))})]})})};function H4({children:u,open:t,setOpen:e,disable:i,isPlayground:s,canvasOpen:n,playgroundPage:a}){const r=xt(X=>X.setIOModalOpen),o=Se(X=>X.inputs),l=Se(X=>X.outputs),c=Se(X=>X.nodes),h=Se(X=>X.buildFlow),d=Se(X=>X.setIsBuilding),f=Se(X=>X.isBuilding),p=Se(X=>X.newChatOnPlayground),m=Se(X=>X.setNewChatOnPlayground),{flowIcon:v,flowId:w,flowGradient:S,flowName:_}=Se(_a(X=>({flowIcon:X.currentFlow?.icon,flowId:X.currentFlow?.id,flowGradient:X.currentFlow?.gradient,flowName:X.currentFlow?.name}))),A=o.filter(X=>X.type!=="ChatInput"),P=o.find(X=>X.type==="ChatInput"),k=l.filter(X=>X.type!=="ChatOutput"),N=l.find(X=>X.type==="ChatOutput"),O=c.filter(X=>o.some(x=>x.id===X.id)||k.some(x=>x.id===X.id)),j=P||N,U=Et(X=>X.setErrorData),G=Et(X=>X.setSuccessData),R=Nt(X=>X.deleteSession),D=Us(),[I,W]=L.useState(!0),{mutate:z}=Aa(),[B,H]=L.useState(D),$=a&&_?_:"Playground",{data:J,isLoading:re,refetch:me}=Ca({id:D},{enabled:t});L.useEffect(()=>{if(J&&!re){const X=[...J.sessions];X.includes(D)||X.unshift(D),de(X)}},[J,re,D]),L.useEffect(()=>(r(t),()=>{r(!1)}),[t]);function Q(X){if(B===X){const x=Ce.filter(b=>b!==X);x.length>0?H(x[0]):H(D)}z({sessionId:X},{onSuccess:()=>{R(X);const x=ae.filter(b=>b.session_id===X).map(b=>b.id);x.length>0&&Re(x),G({title:"Session deleted successfully."})},onError:()=>{B!==X&&H(X),U({title:"Error deleting session."})}})}function Te(){if(!P&&!N)return A.length>0?A[0]:k[0]}const[Ae,ge]=L.useState(Te()),ae=Nt(X=>X.messages),Re=Nt(X=>X.removeMessages),[Ce,de]=L.useState([]),[je,Ue]=L.useState(D),Y=ct(X=>X.setCurrentSessionId),{isFetched:le,refetch:ve}=Pa({mode:"union",id:D,params:{session_id:B}},{enabled:t}),be=ct(X=>X.chatValueStore),y=ct(X=>X.setChatValueStore),T=ct(X=>X.eventDelivery),M=L.useCallback(async({repeat:X=1,files:x})=>{if(!f){y("");for(let b=0;b<X;b++)await h({input_value:be,startNodeId:P?.id,files:x,silent:!0,session:je,eventDelivery:T}).catch(E=>{throw console.error(E),E})}},[f,d,be,P?.id,je,h]);L.useEffect(()=>{a&&ae.length>0&&window.sessionStorage.setItem(D,JSON.stringify(ae)),p&&!re&&((async()=>{try{const x=await me();x.data?.sessions&&x.data.sessions.length>0&&H(x.data.sessions[x.data.sessions.length-1])}catch(x){console.error("Error refetching sessions:",x)}})(),m(!1))},[ae,a]),L.useEffect(()=>{B?B&&(Ue(B),Y(B),Ae?.type==="Session"&&ge({id:B,type:"Session"})):(Ue(T3()),Y(D))},[B]);const K=ct(X=>X.setPlaygroundScrollBehaves);L.useEffect(()=>{t&&K("instant")},[t]),L.useEffect(()=>{const X=()=>{window.innerWidth<1024?W(!1):W(!0)};return X(),window.addEventListener("resize",X),()=>{window.removeEventListener("resize",X)}},[]);const q=a&&La,te=()=>{Vs(),ka(Ia())},Z=(S&&!isNaN(parseInt(S))?parseInt(S):Ra(S??w??""))%Cn.length,ye=X=>{H(x=>{if(x!==X)return X})},[Ee,_e]=L.useState(!1),se=L.useRef(B);return L.useEffect(()=>{if(!Ee){_e(!0),se.current=B;return}t&&B&&se.current!==B&&ve(),se.current=B},[B]),g.jsxs(hs,{open:t,setOpen:e,disable:i,type:s?"full-screen":void 0,onSubmit:async()=>await M({repeat:1}),size:"x-large",className:"!rounded-[12px] p-0",children:[g.jsx(hs.Trigger,{children:u}),g.jsx(hs.Content,{overflowHidden:!0,className:"h-full",children:t&&g.jsxs("div",{className:"flex-max-width h-full",children:[g.jsx("div",{className:Pe("flex h-full flex-shrink-0 flex-col justify-start overflow-hidden transition-all duration-300",I?"absolute z-50 lg:relative lg:w-1/5 lg:max-w-[280px]":"w-0"),children:g.jsxs("div",{className:Pe("relative flex h-full flex-col overflow-y-auto border-r border-border bg-muted p-4 text-center custom-scroll dark:bg-canvas",a?"pt-[15px]":"pt-3.5"),children:[g.jsxs("div",{className:"flex items-center justify-between gap-2 pb-8 align-middle",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:Pe("flex rounded p-1",Cn[Z]),children:g.jsx(ie,{name:v??"Workflow",className:"h-3.5 w-3.5"})}),I&&g.jsx("div",{className:"truncate font-semibold",children:$})]}),g.jsx(Xe,{styleClasses:"z-50",side:"right",content:"Hide sidebar",children:g.jsx(De,{variant:"ghost",className:"flex h-8 w-8 items-center justify-center !p-0",onClick:()=>W(!I),children:g.jsx(ie,{name:I?"PanelLeftClose":"PanelLeftOpen",className:"h-[18px] w-[18px] text-ring"})})})]}),I&&!re&&g.jsx(j4,{sessions:Ce,setSelectedViewField:ge,setvisibleSession:H,handleDeleteSession:Q,visibleSession:B,selectedViewField:Ae,playgroundPage:!!a,setActiveSession:ye}),I&&q&&g.jsxs("div",{className:"absolute bottom-2 left-0 flex w-full flex-col gap-8 border-t border-border px-2 py-4 transition-all",children:[g.jsxs("div",{className:"flex items-center justify-between px-2",children:[g.jsx("div",{className:"text-sm",children:"Theme"}),g.jsx(Da,{})]}),g.jsxs(De,{onClick:te,variant:"primary",className:"w-full !rounded-xl shadow-lg",children:[g.jsx(Rn,{}),g.jsx("div",{className:"text-sm",children:"Built with Vetrai"})]})]})]})}),!I&&q&&g.jsx("div",{className:"absolute bottom-6 left-4 hidden transition-all md:block",children:g.jsx(Xe,{styleClasses:"z-50",side:"right",content:"Built with Vetrai",children:g.jsx(De,{variant:"primary",className:"h-12 w-12 !rounded-xl !p-4 shadow-lg",onClick:te,children:g.jsx(Rn,{className:"h-[18px] w-[18px] scale-150"})})})}),g.jsxs("div",{className:"flex h-full min-w-96 flex-grow bg-background",children:[Ae&&!re&&g.jsx(F4,{selectedViewField:Ae,setSelectedViewField:ge,haveChat:j,inputs:A,outputs:k,sessions:Ce,currentFlowId:D,nodes:O}),g.jsx(E3,{playgroundPage:a,selectedViewField:Ae,visibleSession:B,sessions:Ce,sidebarOpen:I,currentFlowId:D,setSidebarOpen:W,isPlayground:s,setvisibleSession:H,setSelectedViewField:ge,haveChat:j,messagesFetched:le,sessionId:je,sendMessage:M,canvasOpen:n,setOpen:e,playgroundTitle:$})]})]})})]})}function B4({children:u,open:t,setOpen:e,disable:i,isPlayground:s,canvasOpen:n,playgroundPage:a}){return g.jsx(H4,{children:u,open:t,setOpen:e,disable:i,isPlayground:s,canvasOpen:n,playgroundPage:a})}function G4(){xr();const u=xt(c=>c.setCurrentFlow),t=xt(c=>c.currentFlow),e=ct(c=>c.setClientId),{id:i}=Ma(),{mutateAsync:s}=Na(),n=Fa(),a=xt(c=>c.currentFlowId),r=xt(c=>c.setIsLoading),o=Se(c=>c.setPlaygroundPage);async function l(){try{return await s({id:i,public:!0})}catch(c){console.error(c),n("/")}}return L.useEffect(()=>{(async()=>{if(r(!0),a===""){const h=await l();h?u(h):n("/")}})(),r(!1)},[i]),L.useEffect(()=>{i&&Vs("Playground Page Loaded",{}),o(!0)},[]),L.useEffect(()=>{if(document.title=t?.name||"Vetrai",t?.data){const{inputs:c,outputs:h}=Oa(t?.data?.nodes||[]);(c.length===0&&h.length===0||t?.access_type!=="PUBLIC")&&n("/")}},[t]),L.useEffect(()=>{const c=ja("client_id");if(c)e(c);else{const h=Va(),d={secure:window.location.protocol==="https:",sameSite:"Strict"};Ha("client_id",h,d),e(h)}},[]),g.jsx("div",{className:"flex h-full w-full flex-col items-center justify-center align-middle",children:t&&g.jsx(B4,{open:!0,setOpen:()=>{},isPlayground:!0,playgroundPage:!0,children:g.jsx(g.Fragment,{})})})}export{G4 as default};
